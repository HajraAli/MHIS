{"version":3,"sources":["webpack:///webpack/bootstrap acfcca31f439835775f9","webpack:///./scripts/index.js","webpack:///./scripts/app.js","webpack:///./scripts/eventCaptureModule.js","webpack:///../d2-tracker/lib/dhis2.angular.services.js","webpack:///../d2-tracker/lib/dhis2.angular.directives.js","webpack:///../d2-tracker/lib/dhis2.angular.validations.js","webpack:///../d2-tracker/lib/dhis2.angular.filters.js","webpack:///../d2-tracker/lib/dhis2.angular.controllers.js","webpack:///../d2-tracker/lib/dhis2.angular.templates.js","webpack:///./~/leaflet/dist/leaflet-src.js","webpack:///./~/leaflet-geocoder-mapzen/dist/leaflet-geocoder-mapzen.js","webpack:///./~/leaflet-contextmenu/dist/leaflet.contextmenu.js","webpack:///../d2-tracker/lib/Google.js","webpack:///./scripts/services.js","webpack:///./scripts/filters.js","webpack:///./scripts/directives.js","webpack:///./scripts/controllers.js","webpack:///./scripts/ng-csv.js"],"names":["require","Icon","Default","imagePath","angular","module","value","config","$routeProvider","$translateProvider","$logProvider","when","templateUrl","controller","reloadOnSearch","otherwise","redirectTo","preferredLanguage","useSanitizeValueStrategy","useLoader","debugEnabled","d2Services","factory","$q","$http","SessionStorageService","DHIS2URL","getTranslationStrings","locale","defaultUrl","url","tx","promise","get","then","response","keys","dhis2","util","parseJavaProperties","data","p","getProfile","set","settings","keyUiLocale","deferred","defer","translations","userProfile","resolve","service","getAuthorities","roles","authority","userCredentials","userRoles","forEach","role","authorities","auth","getUserAuthorities","canDeleteEvent","canAddOrUpdateEvent","canSearchTei","canDeleteTei","canRegisterTei","canEnrollTei","canUnEnrollTei","canAdministerDashboard","fileName","$window","key","JSON","parse","sessionStorage","getItem","obj","setItem","stringify","clearAll","removeItem","storage","$rootScope","getSetting","dhis2CalendarFormat","keyDateFormat","keyCalendar","momentFormat","storedFormat","isObject","$filter","CalendarService","NotificationService","$translate","getDate","dateValue","calendarSetting","moment","_d","Date","format","formatToHrsMins","dateFormat","formatToHrsMinsSecs","getToday","tdy","$","calendars","instance","newDate","today","_year","_month","_day","isValid","convertedDate","copy","isBeforeToday","isBefore","isAfterToday","isAfter","formatFromUserToApi","formatFromApiToUser","getDateAfterOffsetDays","offSetDays","date","setDate","fromJSDate","dateAfterOffset","verifyExpiryDate","expiryPeriodType","expiryDays","eventPeriodEndDate","eventDate","eventPeriod","generator","period","PeriodGenerator","getPeriodForTheDate","endDate","add","showNotifcationDialog","instant","verifyOrgUnitPeriodDate","periodStartDate","periodEndDate","startDate","hideHeaderMessage","setHeaderDelayMessage","getAge","_dob","now","dob","age","years","diff","months","days","getDateFromUTCString","utcDateTimeString","getCode","options","i","length","displayName","code","getName","DateUtils","OptionSetService","CurrentSelection","FileService","OrgUnitFactory","setFileName","event","valueId","dataElementId","fileNames","getFileNames","setFileNames","setOrgUnitName","id","orgUnitNames","getOrgUnitNames","getFromStoreOrServer","setOrgUnitNames","formatDataValue","val","optionSets","destination","valueType","validation","isNumber","parseFloat","parseInt","optionSetValue","optionSet","String","displayBooleanAsYesNo","dataElement","isUndefined","userHasValidRole","prop","indexOf","j","checkAndSetOrgUnitName","checkAndSetFileName","getUsername","username","getSystemSetting","getForProgramStage","programStage","programStageDataElements","htmlCode","dataEntryForm","inputRegex","match","inputFields","hasEventDate","exec","push","inputField","inputElement","parseHTML","attributes","each","nodeName","fieldId","newInputField","hasOwnProperty","getAttributesAsString","substring","split","prStDe","disableInputField","commonInputFieldProperty","optionSetId","maxDate","allowFutureDate","replace","addPopOver","getForTrackedEntity","trackedEntityForm","target","trackedEntityFormAttributes","att","hasProgramDate","attId","fieldName","programId","attMaxDate","isTrackerAssociate","mandatory","unique","enMaxDate","selectEnrollmentDatesInFuture","displayIncidentDate","inMaxDate","selectIncidentDatesInFuture","attributesAsString","htmlCodeToInsertPopOver","popOverContent","tagToInsertPopOver","tagWithPopOver","insertPopOverSpanToTag","tagToInsertPopOverSpan","attribute","description","element","attValue","popOverSpanElement","tagWithPopOverSpan","index","name","attr","html","outerHTML","selectedItem","setSelectedItem","getSelectedItem","$modal","modalDefaults","backdrop","keyboard","modalFade","modalOptions","closeButtonText","actionButtonText","headerText","bodyText","showModal","customModalDefaults","customModalOptions","show","tempModalDefaults","tempModalOptions","extend","$scope","$modalInstance","ok","result","close","dismiss","open","dialogDefaults","backdropClick","dialogOptions","showDialog","customDialogDefaults","customDialogOptions","summaries","tempDialogDefaults","tempDialogOptions","DialogService","$timeout","errorMsgheader","errorMsgBody","errorResponse","message","status","importSummaries","showNotifcationWithOptions","displayDelayedHeaderMessage","displayHeaderMessage","setHeaderMessage","removeHeaderMessage","page","pageSize","itemCount","pageCount","toolBarDisplay","setPage","getPageCount","getPage","setPageSize","getPageSize","setItemCount","getItemCount","setPageCount","setToolBarDisplay","getToolBarDisplay","lowerLimit","pageCountLimitPerPageDiff","low","Math","ceil","max","GRIDCOLUMNS_URL","columnExists","cols","colExists","gridColumns","httpMessage","method","headers","error","columns","gridColumnsFromSessionStore","uid","download","upload","file","formData","FormData","append","transformRequest","identity","undefined","post","MetaDataFactory","staticReplacements","regExp","RegExp","replacement","performStaticReplacements","expression","staticReplacement","loadRules","programUid","def","getAll","constants","getByProgram","pis","variables","programRules","pi","displayInForm","newAction","content","displayDescription","programRuleActionType","location","newRule","shortname","program","condition","filter","programRuleActions","variablesInCondition","variablesInData","valueCountPresent","positiveValueCountPresent","variableObjectsCurrentExpression","pushDirectAddressedVariable","variableWithCurls","variableName","variableNameParts","newVariableObject","programRuleVariableSourceType","useCodeForOptionSet","trackedEntityAttribute","variableInCondition","pushed","variableInData","valueCountText","variableCurrentRule","zeroPosValueCountText","programIndicators","rules","programVariables","prs","rule","actions","programStageId","$log","processSingleValue","processedValue","eval","Number","warn","pushVariable","variablename","varValue","allValues","varType","variablefound","variablePrefix","variableEventDate","processedValues","alternateValue","variableValue","variableType","hasValue","getDataElementValueOrCodeForValueInternal","allDes","geTrackedEntityAttributeValueOrCodeForValueInternal","trackedEntityAttributeId","allTeis","processValue","type","getDataElementValueOrCode","getDataElementValueOrCodeForValue","getTrackedEntityValueOrCodeForValue","getVariables","allProgramRules","executingEvent","evs","selectedEntity","selectedEnrollment","concat","programVariable","valueFound","byStage","isDefined","all","previousvalue","previousEventDate","currentEventPassed","dueDate","enrollmentDate","enrollment","incidentDate","constant","VariableService","DHIS2EventFactory","RulesFactory","orderByFilter","NUMBER_OF_EVENTS_IN_SCOPE","crossEventRulesExist","lastEventId","lastEventDate","lastProgramId","eventScopeExceptCurrent","replaceVariables","variablesHash","variablespresent","variablepresent","runDhisFunctions","flag","dhisFunctions","parameters","continueLooping","expressionUpdated","brokenExecution","dhisFunction","regularExFunctionCall","callsToThisFunction","callToThisFunction","justparameters","trim","numParameters","runExpression","firstdate","seconddate","floored","floor","dividend","divisor","rest","returnString","daystoadd","newdate","newdatestring","number","output","variableObject","count","valueToCompare","ceiled","rounded","round","inputToValidate","toString","pattern","regEx","matchFound","baseNumber","baseDigits","firstDigit","secondDigit","firstSum","baseNumberLength","firstWeights","secondWeights","secondSum","string","numChars","startChar","endChar","splitArray","returnPart","beforereplacement","identifier","answer","debug","dhisfunctionsevaluated","verbose","info","e","determineValueType","isNaN","performCreateEventAction","effect","currentEvents","valArray","newEventDataValues","idList","active","valParts","valId","valVal","valuesAlreadyExists","currentEvent","misMatch","dataValues","currentDataValue","newEvent","trackedEntityInstance","orgUnit","notes","dontPersistOnCreate","notPersisted","$broadcast","create","internalExecuteRules","allDataElements","allTrackedEntityAttributes","isArray","ruleeffects","ruleEffectKey","updatedEffectsExits","eventsCreated","ruleEffective","action","programIndicator","programStageSection","ineffect","oldData","nameWithoutBrackets","createdNow","variabletoassign","updatedValue","callerId","internalProcessEventGrid","eventGrid","events","rows","row","ev","h","internalGetOrLoadScope","orgUnitId","pager","ordering","direction","getByStage","allEventsWithPossibleDuplicates","filterUrl","eventIdDictionary","eventInScope","allEventsInScope","reverse","allEvents","internalGetOrLoadRules","executeRules","flags","loadAndExecuteRulesScope","scope","processRuleEffectsForTrackedEntityAttributes","context","currentTei","teiOriginalValues","attributesById","hiddenFields","assignedFields","hiddenSections","warningMessages","alert","processRuleEffectsForEvent","eventId","currentEventOriginalValues","prStDes","displayFormName","headerTxt","bodyTxt","processRuleEffectAttribute","selectedTei","tei","currentEventOriginialValue","affectedEvent","teiAttributesEffects","eventEffects","reconstructEvent","dvs","coordinate","latitude","longitude","refreshList","eventList","continueLoop","getEventExpiryStatus","selectedOrgUnit","completedDate","daysAfterCompletion","completeEventsExpiryDays","currentSelection","relationshipInfo","ouLevels","sortedTeiIds","selectedTeiEvents","relationshipOwner","advancedSearchOptions","trackedEntities","setRelationshipInfo","getRelationshipInfo","setOptionSets","getOptionSets","setAttributesById","getAttributesById","setOuLevels","getOuLevels","setSortedTeiIds","getSortedTeiIds","setSelectedTeiEvents","getSelectedTeiEvents","setRelationshipOwner","getRelationshipOwner","setLocation","getLocation","setAdvancedSearchOptions","searchOptions","getAdvancedSearchOptions","setTrackedEntities","getTrackedEntities","setSortColumn","sortColumn","setColumnReverse","reverseSortStatus","setGridColumns","getAuditHistoryData","dataId","dataType","orgUnitPromise","rootOrgUnitPromise","orgUnitTreePromise","indexedDB","db","openStore","request","onsuccess","onerror","reject","getChildren","getViewTreeRoot","organisationUnits","ous","dataViewOrganisationUnits","getSearchTreeRoot","teiSearchOrganisationUnits","getOrgUnits","fieldUrl","getOrgUnit","getOrgUnitReportDateRange","reportDateRange","minDate","cdate","closedDate","odate","openingDate","orgUnitFactory","getOu","transaction","store","objectStore","query","closedStatus","getOrgUnitClosedStatus","n","t","s","q","ou","closed","d2Directives","directive","$location","restrict","link","attrs","orgUnitFromUrl","one","ids","names","tc","metaDataCached","treeLoaded","$apply","selection","responseReceived","console","log","search","addClass","downloadMetaData","setListenerFunction","setSelectedOu","setOrgUnitFromURL","trigger","$watch","focus","click","toggle","autocomplete","source","select","ui","item","findByName","elem","calendarsPicker","onSelect","blurOrChange","change","bind","which","$eval","d2Enter","preventDefault","$compile","$templateCache","title","template","placement","popover","on","contains","sortable","connectWith","placeholder","tolerance","handle","getSortedItems","receive","biggerWidgets","smallerWidgets","movedIsIdentifeid","layout","applyWidgetsOrderChange","Paginator","paginator","elm","customDataEntryForm","contents","customRegistrationForm","contextMenu","menuHeight","height","menuWidth","width","winHeight","window","winWidth","pageX","pageY","css","left","top","hide","document","$parse","ctrl","calendar","initializeDatePicker","sDate","eDate","changeMonth","yearRange","duration","showAnim","renderer","picker","themeRollerRenderer","onClose","blur","$setViewValue","DHIS2EventService","d2FileInputList","d2FileInput","d2FileInputName","d2FileInputCurrentName","d2FileInputPs","de","inputFieldId","updateModel","update","files","fileResource","updatedSingleValueEvent","updatedFullValueEvent","updateForSingleValue","valueGetter","d2FileInputDelete","nameGetter","nameSetter","assign","nameIdMap","showAuditHistory","openModal","ops","required","disabled","customOnClick","currentElement","$element","$attrs","CommonUtils","clickedButton","valueClicked","buttonValue","originalValue","tempValue","getDisabledValue","inValue","getDisabledIcon","radioButtonColor","errorStatus","radioButtonImage","d2Object","d2ValueSaved","d2Disabled","d2Required","d2Options","d2CallbackFunction","newObj","oldObj","model","radio","saveValue","$document","onDeselected","preSelected","abortDeselect","documentEventListenerSet","elementClicked","documentClick","modalPresent","calendarPresent","calendarPresentInEvent","parents","off","selectedOrgUnitId","d2OrgunitNames","d2OrgUnitNames","fetchOu","showOrgUnitTree","modalInstance","res","selected","removeSelectedOrgUnit","d2CallbackFunctionParamText","d2CallbackFunctionParamCoordinate","d2LatSaved","d2LngSaved","d2CoordinateFormat","DHIS2COORDINATESIZE","coordinateObject","processCoordinate","coordinatePattern","test","coordinates","slice","showMap","windowClass","lat","lng","arg1","coordinateInteracted","field","form","$submitted","$dirty","coordinateForm","saveD2Coordinate","saveCoordinate","param","d2CallbackFunctionParam","d2AgeSaved","formatAge","_age","newValue","oldValue","saveDOB","saveAge","subtract","removeAge","ageInteracted","ageForm","ngModel","setValidity","numberType","isRequired","$validators","posInt","isPositiveInt","negInt","isNegativeInt","zeroPositiveInt","isZeroOrPositiveInt","integer","isInt","percentValue","ngRequired","dateValidator","futureDateValidator","customCoordinateValidator","latitudeValidator","longitudeValidator","optionValidator","TEIService","uniqunessValidatior","attributeData","$asyncValidators","uniqunessValidator","modelValue","viewValue","currentValue","programUrl","ouMode","attUrl","ouId","selectedProgram","programScope","orgUnitScope","selectedTeiId","ngDisabled","d2Filters","filters","filterTypes","dateFilter","textFilter","numberFilter","filteredData","start","end","dateComparator","numberComparator","input","rowsPerPage","beingTrimmed","trimmingComplete","beforeTrimming","items","filtered","confidential","trimmed","Array","d2Controllers","hiddenGridColumns","gridColumnDomainKey","gridColumnKey","gridColumnsInUserStore","GridColumnService","showHideColumns","gridColumn","leafletData","tilesDictionary","openstreetmap","attribution","googlemap","layers","baselayers","googleRoadmap","layerType","googleHybrid","googleTerrain","tilesDictionaryKeys","selectedTileKey","currentLevel","maxZoom","center","zoom","systemSetting","keyGoogleMapsApiKey","keyMapzenSearchApiKey","setCoordinateLabel","zoomInLabel","zoomOutLabel","centerMapLabel","contextmenuItems","text","callback","setCoordinate","separator","zoomIn","zoomOut","centerMap","mapDefaults","map","contextmenu","contextmenuWidth","geojsonMarkerOptions","radius","fillColor","color","weight","opacity","fillOpacity","style","marker","m1","draggable","pointToLayer","feature","latlng","L","circleMarker","onEachFeature","layer","properties","_layers","eachLayer","l","bindContextMenu","contextmenuInheritItems","getGeoJsonByOuLevel","initialize","mode","parent","level","parentGraph","success","currentGeojson","getMap","latlngs","features","geometry","coord","points","k","GeoJSON","coordsToLatLng","setView","fitBounds","zoomMap","m","integrateMapzen","geocoder","control","markers","addTo","c","getLatLng","loadGoogleMapApi","initMap","script","createElement","src","body","appendChild","setTile","tileKey","googleMapLayers","google","maps","captureCoordinate","args","$on","AuditHistoryDataService","searchPlaceholder","auditColumns","itemList","uniqueRows","showStatus","reponseData","trackedEntityDataValueAudits","trackedEntityAttributeValueAudits","dataValue","audit","auditType","modifiedBy","created","sort","expandOrgUnit","path","hasChildren","children","attachOrgUnit","orgUnits","selectedOuFetched","levelsFetched","o","expandCollapse","setSelectedOrgUnit","run","put","Google","Class","includes","Mixin","Events","minZoom","tileSize","subdomains","errorTileUrl","continuousWorld","noWrap","mapOptions","backgroundColor","Util","setOptions","_ready","Map","asyncWait","_type","onAdd","insertAtTheBottom","_map","_insertAtTheBottom","_initContainer","_initMapObject","_resetCallback","_limitedUpdate","limitExecByInterval","_update","_handleZoomAnim","_controlCorners","bottomright","marginBottom","_reset","onRemove","_container","removeChild","getAttribution","setOpacity","DomUtil","setElementSize","size","x","y","tilePane","first","firstChild","stamp","zIndex","insertBefore","getSize","_google_center","LatLng","tilt","mapTypeId","MapTypeId","disableDefaultUI","keyboardShortcuts","disableDoubleClickZoom","scrollwheel","streetViewControl","styles","_this","_reposition","addListenerOnce","onReposition","_google","_checkZoomLevels","fire","mapObject","getZoom","setZoom","hard","clearOldContainer","_resize","getCenter","_center","setCenter","asyncInitialize","eventCaptureServices","Store","adapters","IndexedDBAdapter","DomSessionStorageAdapter","InMemoryAdapter","objectStores","currentStore","ECStorageService","ModalService","hasLocalData","done","getKeys","getLocalData","uploadLocalData","localData","evResponse","ec","removeAll","serverLog","is","getProgramsByOu","programs","pr","pv","objs","getByIds","internalGetByFilters","attributeCategoryUrl","paging","filterings","filterParam","sortParam","filtering","default","cc","cp","pgSize","pg","metaData","eventUid","state","dhis2Event","reference","delete","remove","singleValue","fullValue","updateForEventDate","fullEvent","eventCaptureFilters","eventCaptureDirectives","eventCapture","$route","$anchorScroll","ProgramFactory","ContextMenuSelectedItem","CustomFormService","AuthorityService","TrackerRulesExecutionService","maxOptionSize","selectedSection","resetView","eventRegistration","editingEventInFull","editingEventInGrid","editGridColumns","updateSuccess","currentGridColumnId","dhis2Events","displayCustomForm","proceedSelection","formUnsaved","currentFileNames","exportFormats","savingRegistration","note","displayTextEffects","storedBy","noteExists","eventIdFromUrl","orgUnitFromStore","ouDates","editingDisabled","pleaseSelectLabel","registeringUnitLabel","eventCaptureLabel","programLabel","searchLabel","findLabel","searchOusLabel","yesLabel","noLabel","userAuthority","loadPrograms","completeEnrollment","resetOu","selectedProgramStage","currentStage","showEventForEditing","getProgramDetails","programStages","formatEvent","showEditEventInFull","setCommonEventProps","lastUpdated","captureCoordinates","formatEventFromGrid","formatNumberResult","restoreGridColumnsFromUserStore","savedGridColumns","savedColumn","selectedOptions","eventFetched","optionsReady","sortHeader","filterText","getShowStatus","defaultShowStatus","programStageSections","section","newDhis2Event","eventGridColumns","compulsory","filterWithRange","showFilter","group","reportDateDescription","displayInReports","emptyFilterText","selectedCategories","categoryCombo","isDefault","categories","loadEvents","loadOptions","categoryOptions","attributeCategoryOptions","index1","index2","selectedOption","getCategoryOptions","join","dataElementUrl","_dhis2Events","isOffline","r","total","jumpToPage","resetPageSize","sortEventGrid","gridHeader","oldCols","newCols","filterEvents","applyFilter","col","filt","removeStartFilterText","gridColumnId","removeEndFilterText","resetFilter","cancel","resetUrl","formIsChanged","equals","selectedOptionsOriginal","showEventList","updated","showEventRegistration","outerForm","submitted","preGenerateUID","eventUID","showEditEventInGrid","$valid","checkEventEditingStatus","lastRoute","current","params","newRouteParams","switchDataEntryForm","checkAndShowProgramRuleFeedback","warningSection","warningMessagesOnComplete","bodyList","itemType","errorSection","errorMessagesOnComplete","sections","addEvent","addingAnotherEvent","$invalid","storedDate","updateFileNames","splice","eventLength","$setPristine","updateEvent","updatedEvent","updateEventDate","rawDate","invalidDate","updateEventDataValue","pending","failed","isFormInvalid","removeEvent","getCSVExportList","csvFields","selectedDataElements","substr","headerArray","headerFieldNames","headerFieldIds","eventsCSV","csvFieldsIndices","csvRow","processedData","object","column","rowArray","idx","getProcessedValue","getExportList","eventsJSON","eventsXML","eventJSON","isDataValue","saveFile","toLowerCase","a","blob","Blob","endings","URL","createObjectURL","href","setTimeout","revokeObjectURL","fieldValue","showNotes","getHelpContent","isChanged","emptyForm","formIsEmpty","deId","formIsInvalid","$error","$watchCollection","removeClass","interacted","currentStageEvents","searchedEvent","toTwoDecimals","isHidden","saveDatavalue","saveDatavalueRadio","saveCurrentEventStatus","getInputNotifcationClass","custom","getClickFunction","downloadFile","dataElementUid","stopPropagation","deleteFile","filterTextExist","$compileProvider","urlSanitizationWhitelist","aHrefSanitizationWhitelist","exports","EOL","BOM","specialChars","stringifyField","decimalSep","isFloat","toLocaleString","quoteStrings","txtDelim","isFinite","Boolean","that","csv","csvContent","dataPromise","responseData","header","encodingArray","headerString","fieldSep","arrData","isFunction","label","labelArray","labelString","oldRow","dataString","infoArray","iterator","columnOrder","addByteOrderMarker","err","isSpecialChar","getSpecialChar","CSV","filename","lazyLoad","ngClick","charset","$transclude","buildCSV","getFilename","getBuildCsvOptions","csvHeader","csvColumnOrder","csvLabel","ngCsvLoadingClass","doClick","navigator","msSaveOrOpenBlob","msSaveBlob","downloadContainer","downloadLink","find"],"mappings":"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;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA,yBAAwB,cAAc;AACtC;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF,iCAAgC;AAChC;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA,cAAa,4BAA4B;AACzC;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,yBAAwB,yBAAyB;;;AAGjD;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,EAAC;;AAED;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,8BAA6B;AAC7B;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,+BAA8B,QAAQ;;AAEtC;AACA;AACA;;AAEA;;AAEA,iDAAgD,SAAS;AACzD;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,sCAAqC;AACrC;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA,mDAAkD;;AAElD;AACA,4EAA2E,aAAa;;AAExF,uDAAsD;AACtD;AACA;;AAEA;AACA;;AAEA,kCAAiC,SAAS;AAC1C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;;AAGA,KAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF,sCAAqC;AACrC;AACA;AACA;AACA,GAAE;;AAEF,sDAAqD;;AAErD;AACA;AACA;;AAEA;AACA;AACA;;AAEA,+EAA8E,aAAa;;AAE3F;AACA;AACA;;AAEA;;AAEA,kCAAiC,SAAS;AAC1C;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,KAAI;AACJ;;AAEA;AACA,oCAAmC,QAAQ;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF,oCAAmC;AACnC;AACA;AACA;;AAEA,+BAA8B,SAAS,2BAA2B;;AAElE;AACA;;AAEA;AACA;AACA;;AAEA,uCAAsC,SAAS;AAC/C;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;;AAEA,mFAAkF,aAAa;;AAE/F;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,EAAC;;;AAGD;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA,6BAA4B;AAC5B,WAAU,QAAQ;;AAElB;;AAEA,sCAAqC,SAAS;AAC9C;AACA;AACA;;AAEA;AACA;AACA,4BAA2B;AAC3B;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF,+BAA8B;AAC9B;AACA;AACA;AACA,GAAE;;AAEF,8BAA6B;AAC7B;AACA,GAAE;;AAEF,4BAA2B;AAC3B;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF,4BAA2B;AAC3B;;AAEA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF,iCAAgC;AAChC;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,6BAA4B;AAC5B;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,sCAAqC;AACrC;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,4DAA2D,OAAO;;AAElE;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA,IAAG;;AAEH;;AAEA;AACA,yBAAwB,OAAO;;AAE/B;AACA;;AAEA;AACA,IAAG;;AAEH;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,yCAAwC,SAAS;AACjD;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;;AAEA;AACA;;AAEA,IAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,uBAAsB,QAAQ;AAC9B;;AAEA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;;AAEA,kBAAiB,kBAAkB;AACnC;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF,gDAA+C;;AAE/C;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,cAAa;;AAEb;AACA;AACA;AACA,UAAS;AACT,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;;AAEA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA,GAAE;AACF,EAAC;;;AAGD;AACA;AACA;;AAEA,sCAAqC;AACrC;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA,0BAAyB;AACzB,cAAa,cAAc;;AAE3B;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF,kCAAiC;AACjC;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,gCAA+B;AAC/B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF,yBAAwB;AACxB;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,6BAA4B;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;;AAEA,mDAAkD;AAClD,mBAAkB,QAAQ;;AAE1B;;AAEA,uCAAsC,SAAS;AAC/C;AACA;AACA;;AAEA;AACA;AACA,0BAAyB;AACzB,cAAa,aAAa;;AAE1B;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA,+BAA8B;AAC9B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF,0BAAyB;AACzB;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF,4BAA2B;AAC3B;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA,GAAE;;AAEF,iCAAgC;AAChC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF,6BAA4B;AAC5B,iBAAgB,cAAc;;AAE9B;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;;AAEA,mCAAkC;AAClC;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA,8BAA6B;AAC7B;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF,+BAA8B;AAC9B;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA,0CAAyC;AACzC;AACA;;AAEA;AACA,GAAE;;AAEF,yCAAwC;AACxC;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA,2BAA0B;AAC1B;AACA;;AAEA;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;AACA;;AAEA,6BAA4B;AAC5B;;AAEA;AACA;;AAEA,8BAA6B;AAC7B;AACA;AACA;AACA;AACA,EAAC;;AAED,+BAA8B;AAC9B;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA,6BAA4B;AAC5B;;AAEA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF,sCAAqC;AACrC;;;AAGA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,0DAAyD,YAAY;AACrE;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;;AAGF;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,gDAA+C,cAAc;AAC7D,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;;AAEA,yCAAwC,cAAc;AACtD,GAAE;;AAEF;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF,qCAAoC;AACpC,4CAA2C,aAAa;AACxD,GAAE;;AAEF,4BAA2B;AAC3B;AACA;;AAEA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA,kCAAiC,aAAa;;AAE9C;AACA,GAAE;;AAEF;AACA;;AAEA;;AAEA,0BAAyB,aAAa;;AAEtC;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA,2BAA0B,aAAa;;AAEvC;AACA;AACA;;AAEA;;AAEA;AACA,8BAA6B,aAAa;AAC1C;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA,gBAAe,cAAc;;AAE7B;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA,uBAAsB,aAAa;;AAEnC;AACA;AACA;AACA,IAAG,sBAAsB,cAAc;;AAEvC;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,gCAA+B,aAAa;;AAE5C;AACA;;AAEA,IAAG;AACH;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA,uBAAsB,aAAa;;AAEnC;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;;AAGF;;AAEA,0BAAyB;AACzB;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF,qDAAoD;AACpD;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA,IAAG;;AAEH;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;;AAGF;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;;AAGF;;AAEA,oCAAmC;AACnC;AACA;AACA,GAAE;;AAEF,qCAAoC;AACpC;AACA;AACA,GAAE;;AAEF,wCAAuC;AACvC;AACA;AACA,GAAE;;AAEF,yCAAwC;AACxC;AACA;AACA,GAAE;;AAEF,gDAA+C;AAC/C;AACA,GAAE;;AAEF,gDAA+C;AAC/C;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF,4CAA2C;AAC3C;AACA,GAAE;;AAEF,wCAAuC;AACvC;AACA,GAAE;;AAEF,oCAAmC;AACnC;AACA,GAAE;;;AAGF;;AAEA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,uCAAsC,SAAS;AAC/C;AACA;AACA,GAAE;;;AAGF;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA,IAAG;AACH;AACA;;AAEA;;AAEA;AACA;;AAEA,2BAA0B,yBAAyB;;AAEnD;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,yBAAwB,yBAAyB;AACjD,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,yBAAwB;AACxB;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;AACA,qBAAoB,QAAQ;;AAE5B;;AAEA;;AAEA;AACA;AACA;;AAEA,mCAAkC,SAAS;AAC3C;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,wBAAuB,sBAAsB,sBAAsB,EAAE,EAAE;AACvE,GAAE;;AAEF;AACA;AACA;AACA;AACA,wCAAuC,QAAQ;;AAE/C;AACA;AACA,GAAE;;AAEF;AACA,iDAAgD,QAAQ;;AAExD;;AAEA;;AAEA,uCAAsC,QAAQ;;AAE9C;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA,+CAA8C,SAAS;AACvD;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,0BAAyB,aAAa;AACtC,GAAE;;;AAGF;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,iBAAgB,eAAe;;AAE/B;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,iBAAgB,eAAe;;AAE/B;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA,yCAAwC;AACxC;;AAEA;AACA;;AAEA;AACA;;AAEA,8BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF,+BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;AAIA,6BAA4B;AAC5B;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAE;AACF,EAAC;;;AAGD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,KAAI;AACJ;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,KAAI;AACJ;;AAEA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,iBAAgB,WAAW;AAC3B;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;AACA;AACA;;AAEA,mCAAkC,SAAS;;AAE3C;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA,KAAI;AACJ;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,6BAA4B,uBAAuB;AACnD;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;;AAEA,oBAAmB,QAAQ;;AAE3B;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;;AAEA,yBAAwB,mBAAmB;AAC3C,0BAAyB,mBAAmB;AAC5C;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,2BAA0B,QAAQ;;AAElC;AACA;AACA;AACA,IAAG;;AAEH;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,cAAa,iBAAiB;AAC9B;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,iBAAgB;AAChB;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,iDAAgD,cAAc;AAC9D;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,+CAA8C,cAAc;AAC5D;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,4BAA2B,0BAA0B;;AAErD;AACA;AACA;;AAEA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA,oCAAmC;;AAEnC;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF,uCAAsC;;AAEtC;;AAEA,8BAA6B;AAC7B;;AAEA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF,oCAAmC;;AAEnC;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,yCAAwC,iCAAiC;;AAEzE;AACA,GAAE;;AAEF;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,iBAAgB,WAAW;AAC3B;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF,+CAA8C;AAC9C;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;;AAEA;;AAEA,mCAAkC,SAAS;AAC3C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,IAAG;;AAEH;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;;AAEA,6BAA4B,uBAAuB;AACnD,GAAE;;AAEF;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA,GAAE;;AAEF;;AAEA,iCAAgC,QAAQ;;AAExC;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,kBAAiB,mBAAmB;AACpC;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA,oBAAmB,QAAQ;;AAE3B,yGAAwG,QAAQ;;AAEhH;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA,GAAE;;AAEF;;AAEA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA,0BAAyB,YAAY;;AAErC;AACA,oCAAmC,YAAY;AAC/C;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,+CAA8C;;AAE9C;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA,2BAA0B,YAAY;;AAEtC;AACA,qCAAoC,YAAY;AAChD;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA,oBAAmB,QAAQ;;AAE3B;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mCAAkC;AAClC;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA,wBAAuB,QAAQ;;AAE/B;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA,GAAE;;AAEF;AACA,oBAAmB,QAAQ;;AAE3B;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA,GAAE;;AAEF;AACA,+BAA8B,QAAQ;;AAEtC;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gEAA+D;AAC/D;AACA;AACA,+CAA8C;AAC9C;AACA;AACA,iEAAgE;AAChE;AACA;AACA,+CAA8C;AAC9C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA,gDAA+C;AAC/C;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,uBAAsB,eAAe;;AAErC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,oCAAmC,SAAS;AAC5C;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA,gBAAe,cAAc;;AAE7B;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,iCAAgC,aAAa;AAC7C,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,oCAAmC,aAAa;AAChD,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA,IAAG;;AAEH;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,mBAAkB,mBAAmB;AACrC;AACA;AACA;AACA,GAAE;;AAEF;AACA,0DAAyD,QAAQ;;AAEjE;AACA,GAAE;;AAEF;AACA,uDAAsD,QAAQ;;AAE9D;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL,KAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;AACA;AACA;AACA;;AAEA,qBAAoB,eAAe;AACnC;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA,GAAE;AACF;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA,6CAA4C;AAC5C;AACA;AACA,EAAC;;AAED,mDAAkD;AAClD;AACA,wBAAuB,QAAQ;;AAE/B;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;;AAEA,wCAAuC,SAAS;AAChD,6CAA4C,UAAU;AACtD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA,8BAA6B,QAAQ;;AAErC;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA,gDAA+C,QAAQ;;AAEvD;AACA;AACA;AACA;AACA;;AAEA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED,gFAA+E;AAC/E;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,2BAA0B,QAAQ;AAClC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA,cAAa,SAAS;AACtB;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;;AAEA;AACA;;AAEA,sBAAqB,eAAe;AACpC;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA,iDAAgD,SAAS;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,KAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA,kBAAiB;AACjB;AACA,IAAG,qBAAqB;AACxB;AACA,IAAG,qBAAqB;AACxB;AACA,IAAG,qBAAqB;AACxB;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,4BAA2B;AAC3B;AACA,IAAG,+BAA+B;AAClC;AACA;AACA,4BAA2B;AAC3B;AACA,IAAG,+BAA+B;AAClC;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,8CAA6C,SAAS;AACtD;AACA;AACA,GAAE;;AAEF;AACA,sDAAqD,SAAS;AAC9D;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF,8BAA6B;AAC7B;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,uCAAsC,UAAU;AAChD;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,oCAAmC,SAAS;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,qDAAoD,UAAU;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,qBAAoB,aAAa;AACjC;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,sCAAqC,SAAS;AAC9C;AACA;AACA,GAAE;;AAEF;AACA,oBAAmB,QAAQ;;AAE3B;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,kCAAiC,SAAS;AAC1C;AACA;;AAEA;AACA,aAAY,OAAO;AACnB;AACA;;AAEA,gDAA+C,SAAS;AACxD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA,yCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA,sBAAqB,QAAQ;;AAE7B;;AAEA,wCAAuC,SAAS;AAChD;;AAEA,6CAA4C,UAAU;AACtD;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;;AAEA,6BAA4B,QAAQ;;AAEpC,4CAA2C,SAAS;AACpD;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,KAAI;;AAEJ;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA,MAAK;;AAEL;AACA;AACA;;AAEA;AACA,KAAI;;AAEJ;AACA;;AAEA;AACA;AACA,MAAK;;AAEL;AACA;AACA,IAAG;AACH;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;;AAEA,uCAAsC;AACtC;AACA;AACA;;AAEA;AACA,YAAW;AACX;;AAEA,wCAAuC,SAAS;AAChD;AACA,iDAAgD,UAAU;AAC1D;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA,sCAAqC;AACrC;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,wCAAuC,SAAS;AAChD;;AAEA,iDAAgD,UAAU;AAC1D;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA,qCAAoC;AACpC;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA,2CAA0C;AAC1C;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,oDAAmD,QAAQ;;AAE3D;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,oCAAmC,SAAS;AAC5C;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,iDAAgD,SAAS;;AAEzD;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF,qCAAoC;AACpC;AACA,GAAE;;AAEF,kEAAiE;AACjE;AACA;;AAEA,mCAAkC,SAAS;AAC3C;AACA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,wCAAuC,SAAS;AAChD;AACA;;AAEA;AACA,GAAE;;AAEF;AACA,qCAAoC,kBAAkB,sBAAsB;AAC5E,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,EAAC;;AAED;AACA;AACA;AACA;;AAEA;;AAEA;AACA,yCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA,EAAC;;AAED;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAI;;AAEJ;AACA;AACA;AACA,KAAI;AACJ;AACA;;AAEA,2BAA0B,6CAA6C;AACvE,0BAAyB,0CAA0C;;AAEnE;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAI;;AAEJ;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA,kDAAiD;;AAEjD;AACA;AACA;;AAEA,kBAAiB,aAAa;;AAE9B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,KAAI;;AAEJ;AACA;;AAEA;AACA,4CAA2C,QAAQ;AACnD;AACA;;AAEA;;AAEA,KAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA,KAAI;AACJ;AACA;;AAEA,IAAG;AACH;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF,4CAA2C;;AAE3C;AACA;AACA;;AAEA,kBAAiB,aAAa;;AAE9B;AACA;AACA,IAAG;AACH;;AAEA,IAAG;;AAEH;AACA;AACA;;AAEA,KAAI;AACJ;AACA,KAAI;AACJ;AACA;AACA,IAAG;AACH;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,6CAA4C,QAAQ;AACpD;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF,iBAAgB;;AAEhB;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;;AAEA,kBAAiB,aAAa;;AAE9B;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF,0BAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA,uBAAsB,QAAQ;;AAE9B,6CAA4C,QAAQ;AACpD;AACA;;AAEA;AACA,GAAE;;AAEF;AACA,wBAAuB,QAAQ;;AAE/B,6CAA4C,QAAQ;AACpD;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,2EAA0E,QAAQ;;AAElF;;AAEA,+BAA8B,QAAQ;;AAEtC;AACA;;AAEA,sBAAqB,QAAQ;;AAE7B;;AAEA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,gCAA+B,QAAQ;AACvC,wEAAuE,QAAQ;;AAE/E;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,KAAI;AACJ;;AAEA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA,uBAAsB,QAAQ;;AAE9B;AACA;AACA,GAAE;;AAEF;AACA,wBAAuB,QAAQ;;AAE/B;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,KAAI;;AAEJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA,IAAG;;AAEH;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,KAAI;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN,MAAK;AACL;AACA;AACA;AACA,EAAC;;AAED;;;AAGA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,EAAC;;AAED;;;AAGA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,gBAAe,QAAQ;;AAEvB;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,EAAC;;AAED;;;AAGA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAqB,EAAE;AACvB;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,mBAAkB,qBAAqB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,oBAAmB,qBAAqB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;;AAEA;AACA,qGAAoG,QAAQ;;AAE5G,mBAAkB,oBAAoB;AACtC;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA,mBAAkB,oBAAoB;AACtC;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,qFAAoF,QAAQ;;AAE5F;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA,gEAA+D,QAAQ;;AAEvE;AACA;;AAEA;AACA;;AAEA,2BAA0B,QAAQ;;AAElC;AACA;AACA,kEAAiE,QAAQ;AACzE;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,EAAC;;AAED;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA,oBAAmB,QAAQ;;AAE3B;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,8DAA6D,cAAc;;AAE3E;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;;AAEA;AACA;;AAEA,kDAAiD,QAAQ;;AAEzD;AACA;AACA;;AAEA;;AAEA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,EAAC;;AAED;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA,uBAAsB,QAAQ;;AAE9B;AACA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA,gCAA+B;AAC/B;AACA;;AAEA,uCAAsC,SAAS;AAC/C;AACA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA,uCAAsC,SAAS;AAC/C;AACA;AACA,qCAAoC,SAAS;AAC7C;AACA;AACA,GAAE;;AAEF;AACA,iCAAgC;AAChC;AACA;;AAEA,yCAAwC,SAAS;AACjD;AACA;AACA,0CAAyC,SAAS;AAClD;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;;AAEA,mDAAkD,QAAQ;;AAE1D;;AAEA;AACA;AACA;;AAEA,IAAG;AACH;;AAEA,IAAG;AACH;AACA;;AAEA;AACA;AACA,EAAC;;AAED;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,sBAAqB,eAAe;AACpC;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA,0CAAyC;AACzC;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;;AAIA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA,eAAc,QAAQ;;AAEtB;AACA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA,eAAc,QAAQ;;AAEtB;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA,oBAAmB,QAAQ;;AAE3B;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,IAAG;AACH;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;;AAEJ;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA,cAAa,QAAQ;;AAErB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;;AAEA,cAAa,eAAe;AAC5B;AACA;;AAEA;AACA;;AAEA,KAAI;AACJ;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA,uDAAsD;AACtD;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA,2BAA0B,QAAQ;;AAElC;AACA;;AAEA;AACA;AACA,wCAAuC;AACvC,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAkB,QAAQ;AAC1B;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA,2BAA0B,QAAQ;AAClC;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA,EAAC;;;AAGD;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,8BAA6B,yBAAyB;AACtD,6BAA4B,yBAAyB;AACrD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA,mFAAkF,cAAc;;AAEhG;;AAEA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;AACA;;AAEA;;AAEA,uDAAsD;AACtD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA,2BAA0B,QAAQ;;AAElC;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAC;;AAED;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;;AAEA,yCAAwC;;AAExC;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;;AAEA,6BAA4B,aAAa;;AAEzC;;AAEA;AACA;AACA,+EAA8E,cAAc;;AAE5F;AACA;AACA;AACA;;AAEA;AACA,sEAAqE,cAAc;;AAEnF;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA,8BAA6B,QAAQ;;AAErC;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA,uCAAsC;;AAEtC;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA,kCAAiC,SAAS;AAC1C;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,kCAAiC,SAAS;AAC1C;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;;AAEA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;;AAGD,EAAC,oB;;;;;;AC/8RD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC,qBAAqB;AACtB;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;;AAEA;AACA,8BAA6B;AAC7B,4CAA2C;AAC3C,kCAAiC;AACjC,4BAA2B;;AAE3B;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA,WAAU,iBAAiB;AAC3B,WAAU,iBAAiB;AAC3B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA,QAAO;AACP,iFAAgF;AAChF;AACA;AACA;AACA;;AAEA;AACA,MAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,MAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,MAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,QAAO;AACP,MAAK;;AAEL;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,2CAA0C,OAAO;AACjD;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAW;AACX;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,MAAK;;AAEL;AACA;AACA,wBAAuB,yBAAyB;AAChD;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;;AAEA;;AAEA;AACA,2EAA0E;AAC1E;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;;AAEA,0BAAyB,iBAAiB;AAC1C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,mGAAkG;;AAElG;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAe;;AAEf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,6EAA4E;;AAE5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAe;;AAEf;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;;AAEA;AACA;AACA,YAAW;AACX;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,mDAAkD;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,MAAK;AACL;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,MAAK;AACL;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,oCAAmC,EAAE;AACrC;AACA,EAAC;;;;;;;ACl9BD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA,EAAC;;AAED;;AAEA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,U;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA,2D;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,KAAI;AACJ,I;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,sCAAqC,OAAO;AAC5C;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,sCAAqC,OAAO;AAC5C;AACA;AACA,I;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,KAAI;AACJ;AACA;AACA;AACA;AACA,MAAK;AACL,K;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,sCAAqC,OAAO;AAC5C;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;;AAEA,sC;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,sCAAqC,OAAO;AAC5C;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,gB;AACA;;AAEA;AACA,iD;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,+BAA8B,GAAG,kBAAkB;;AAEnD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,0B;;AAEA;AACA,6C;AACA,0B;AACA,KAAI;AACJ,2B;AACA;;AAEA;AACA;AACA,GAAE;;AAEF,sB;AACA;AACA;AACA;AACA,wCAAuC,kBAAkB;AACzD;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF,kC;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,mBAAkB,0CAA0C;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA,8BAA6B,oBAAoB;;AAEjD;;AAEA;AACA;AACA;;AAEA,yDAAwD,OAAO;AAC/D;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA,sCAAqC,OAAO;AAC5C;AACA;AACA,0B;;AAEA;AACA;AACA;AACA,G;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;;AAEA,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","file":"app-acfcca31f439835775f9.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap acfcca31f439835775f9","require('./app.js');\n\n\n// WEBPACK FOOTER //\n// ./scripts/index.js","import './eventCaptureModule';\r\n\r\n// Tracker core\r\nimport 'd2-tracker/lib/dhis2.angular.services.js';\r\nimport 'd2-tracker/lib/dhis2.angular.directives.js';\r\nimport 'd2-tracker/lib/dhis2.angular.validations.js';\r\nimport 'd2-tracker/lib/dhis2.angular.filters.js';\r\nimport 'd2-tracker/lib/dhis2.angular.controllers.js';\r\nimport 'd2-tracker/lib/dhis2.angular.templates.js';\r\n\r\nimport L from 'leaflet';\r\nimport 'leaflet-geocoder-mapzen';\r\nimport 'leaflet-contextmenu';\r\nimport 'd2-tracker/lib/Google.js';\r\n\r\nL.Icon.Default.imagePath = '../dhis-web-commons/leaflet/images';\r\n\r\nimport '../scripts/services.js';\r\nimport '../scripts/filters.js';\r\nimport '../scripts/directives.js';\r\nimport '../scripts/controllers.js';\r\nimport './ng-csv.js';\r\n\r\nangular.module('eventCapture')\r\n\r\n.value('DHIS2URL', '../api/26')\r\n\r\n.value('DHIS2COORDINATESIZE', 6)\r\n\r\n.config(function ($routeProvider, $translateProvider, $logProvider) {\r\n\r\n    $routeProvider.when('/', {\r\n        templateUrl: 'views/home.html',\r\n        controller: 'MainController',\r\n        reloadOnSearch: false\r\n    }).otherwise({\r\n        redirectTo: '/'\r\n    });\r\n\r\n    $translateProvider.preferredLanguage('en');\r\n    $translateProvider.useSanitizeValueStrategy('escaped');\r\n    $translateProvider.useLoader('i18nLoader');\r\n\r\n    $logProvider.debugEnabled(false);\r\n});\r\n\n\n\n// WEBPACK FOOTER //\n// ./scripts/app.js","export default angular.module('eventCapture',\n    ['ui.bootstrap',\n    'ngRoute',\n    'ngCookies',\n    'ngMessages',\n    'ngSanitize',\n    'eventCaptureDirectives',    \n    'eventCaptureServices',\n    'eventCaptureFilters',\n    'd2Filters',\n    'd2Directives',\n    'd2Services',\n    'd2Controllers',\n    'd2Templates',\n    'ui.select',\n    'angularLocalStorage',\n    'pascalprecht.translate',\n    'leaflet-directive',\n    'ngCsv'\n    ])\n\n\n// WEBPACK FOOTER //\n// ./scripts/eventCaptureModule.js","/* Pagination service */\n/* global angular, dhis2, moment */\n\nvar d2Services = angular.module('d2Services', ['ngResource'])\n\n/* Factory for loading translation strings */\n.factory('i18nLoader', function ($q, $http, SessionStorageService, DHIS2URL) {\n\n    var getTranslationStrings = function (locale) {\n        var defaultUrl = 'i18n/i18n_app.properties';\n        var url = '';\n        if (locale === 'en' || !locale) {\n            url = defaultUrl;\n        }\n        else {\n            url = 'i18n/i18n_app_' + locale + '.properties';\n        }\n\n        var tx = {locale: locale};\n\n        var promise = $http.get(url).then(function (response) {\n            tx = {locale: locale, keys: dhis2.util.parseJavaProperties(response.data)};\n            return tx;\n        }, function () {\n\n            var p = $http.get(defaultUrl).then(function (response) {\n                tx = {locale: locale, keys: dhis2.util.parseJavaProperties(response.data)};\n                return tx;\n            });\n            return p;\n        });\n        return promise;\n    };\n\n    var getProfile = function () {\n        var locale = 'en';\n\n        var promise = $http.get( DHIS2URL + '/me.json?fields=id,displayName,userCredentials[username,userRoles[id,programs,authorities]],organisationUnits[id,displayName,level,path,children[id,displayName,level,children[id]]],dataViewOrganisationUnits[id,displayName,level,path,children[id,displayName,level,children[id]]],teiSearchOrganisationUnits[id,displayName,level,path,children[id,displayName,level,children[id]]]').then(function (response) {\n            SessionStorageService.set('USER_PROFILE', response.data);\n            if (response.data && response.data.settings && response.data.settings.keyUiLocale) {\n                locale = response.data.settings.keyUiLocale;\n            }\n            return locale;\n        }, function () {\n            return locale;\n        });\n\n        return promise;\n    };\n    return function () {\n        var deferred = $q.defer(), translations;\n        var userProfile = SessionStorageService.get('USER_PROFILE');\n        if (userProfile && userProfile.settings && userProfile.settings.keyUiLocale) {\n            getTranslationStrings(userProfile.settings.keyUiLocale).then(function (response) {\n                translations = response.keys;\n                deferred.resolve(translations);\n            });\n            return deferred.promise;\n        }\n        else {\n            getProfile().then(function (locale) {\n                getTranslationStrings(locale).then(function (response) {\n                    translations = response.keys;\n                    deferred.resolve(translations);\n                });\n            });\n            return deferred.promise;\n        }\n    };\n})\n\n.service('AuthorityService', function () {\n    var getAuthorities = function (roles) {\n        var authority = {};\n        if (roles && roles.userCredentials && roles.userCredentials.userRoles) {\n            angular.forEach(roles.userCredentials.userRoles, function (role) {\n                angular.forEach(role.authorities, function (auth) {\n                    authority[auth] = true;\n                });\n            });\n        }\n        return authority;\n    };\n\n    return {\n        getUserAuthorities: function (roles) {\n            var auth = getAuthorities(roles);\n            var authority = {};\n            authority.canDeleteEvent = auth['F_TRACKED_ENTITY_DATAVALUE_DELETE'] || auth['ALL'] ? true : false;\n            authority.canAddOrUpdateEvent = auth['F_TRACKED_ENTITY_DATAVALUE_ADD'] || auth['ALL'] ? true : false;\n            authority.canSearchTei = auth['F_TRACKED_ENTITY_INSTANCE_SEARCH'] || auth['ALL'] ? true : false;\n            authority.canDeleteTei = auth['F_TRACKED_ENTITY_INSTANCE_DELETE'] || auth['ALL'] ? true : false;\n            authority.canRegisterTei = auth['F_TRACKED_ENTITY_INSTANCE_ADD'] || auth['ALL'] ? true : false;\n            authority.canEnrollTei = auth['F_PROGRAM_ENROLLMENT'] || auth['ALL'] ? true : false;\n            authority.canUnEnrollTei = auth['F_PROGRAM_UNENROLLMENT'] || auth['ALL'] ? true : false;\n            authority.canAdministerDashboard = auth['F_PROGRAM_DASHBOARD_CONFIG_ADMIN'] || auth['ALL'] ? true : false;\n            return authority;\n        }\n    };\n})\n\n/* Factory for loading external data */\n.factory('ExternalDataFactory', function ($http) {\n\n    return {\n        get: function (fileName) {\n            var promise = $http.get(fileName).then(function (response) {\n                return response.data;\n            });\n            return promise;\n        }\n    };\n})\n\n/* service for wrapping sessionStorage '*/\n.service('SessionStorageService', function ($window) {\n    return {\n        get: function (key) {\n            return JSON.parse($window.sessionStorage.getItem(key));\n        },\n        set: function (key, obj) {\n            $window.sessionStorage.setItem(key, JSON.stringify(obj));\n        },\n        clearAll: function () {\n            for (var key in $window.sessionStorage) {\n                $window.sessionStorage.removeItem(key);\n            }\n        }\n    };\n})\n\n/* service for getting calendar setting */\n.service('CalendarService', function (storage, $rootScope) {\n\n    return {\n        getSetting: function () {\n\n            var dhis2CalendarFormat = {keyDateFormat: 'yyyy-MM-dd', keyCalendar: 'gregorian', momentFormat: 'YYYY-MM-DD'};\n            var storedFormat = storage.get('SYSTEM_SETTING');\n            \n            if (angular.isObject(storedFormat) && storedFormat.keyDateFormat && storedFormat.keyCalendar) {\n                if (storedFormat.keyCalendar === 'iso8601') {\n                    storedFormat.keyCalendar = 'gregorian';\n                }\n\n                if (storedFormat.keyDateFormat === 'dd-MM-yyyy') {\n                    dhis2CalendarFormat.momentFormat = 'DD-MM-YYYY';\n                }\n\n                dhis2CalendarFormat.keyCalendar = storedFormat.keyCalendar;\n                dhis2CalendarFormat.keyDateFormat = storedFormat.keyDateFormat;\n            }\n            $rootScope.dhis2CalendarFormat = dhis2CalendarFormat;\n            return dhis2CalendarFormat;\n        }\n    };\n})\n\n/* service for dealing with dates */\n.service('DateUtils', function ($filter, CalendarService, NotificationService, $translate) {\n\n    return {        \n        getDate: function (dateValue) {\n            if (!dateValue) {\n                return;\n            }\n            var calendarSetting = CalendarService.getSetting();\n            dateValue = moment(dateValue, calendarSetting.momentFormat)._d;\n            return Date.parse(dateValue);\n        },\n        format: function (dateValue) {\n            if (!dateValue) {\n                return;\n            }\n\n            var calendarSetting = CalendarService.getSetting();\n            dateValue = moment(dateValue, calendarSetting.momentFormat)._d;\n            dateValue = $filter('date')(dateValue, calendarSetting.keyDateFormat);\n            return dateValue;\n        },\n        formatToHrsMins: function (dateValue) {\n            var calendarSetting = CalendarService.getSetting();\n            var dateFormat = 'YYYY-MM-DD @ hh:mm A';\n            if (calendarSetting.keyDateFormat === 'dd-MM-yyyy') {\n                dateFormat = 'DD-MM-YYYY @ hh:mm A';\n            }\n            return moment(dateValue).format(dateFormat);\n        },\n        formatToHrsMinsSecs: function (dateValue) {\n            var calendarSetting = CalendarService.getSetting();\n            var dateFormat = 'YYYY-MM-DD @ hh:mm:ss A';\n            if (calendarSetting.keyDateFormat === 'dd-MM-yyyy') {\n                dateFormat = 'DD-MM-YYYY @ hh:mm:ss A';\n            }\n            return moment(dateValue).format(dateFormat);\n        },\n        getToday: function () {\n            var calendarSetting = CalendarService.getSetting();\n            var tdy = $.calendars.instance(calendarSetting.keyCalendar).newDate();\n            var today = moment(tdy._year + '-' + tdy._month + '-' + tdy._day, 'YYYY-MM-DD')._d;\n            today = Date.parse(today);\n            today = $filter('date')(today, calendarSetting.keyDateFormat);\n            return today;\n        },\n        isValid: function( dateValue ){\n            if( !dateValue ){\n                return false;\n            }\n            var convertedDate = this.format(angular.copy(dateValue));\n            return dateValue === convertedDate;\n        },\n        isBeforeToday: function (dateValue) {\n            if (!dateValue) {\n                return;\n            }\n            dateValue = moment(dateValue, \"YYYY-MM-DD\");\n            if (dateValue.isBefore(moment())) {\n                return true;\n            }\n            return false;\n        },\n        isAfterToday: function (dateValue) {\n            if (!dateValue) {\n                return;\n            }\n            dateValue = moment(dateValue, \"YYYY-MM-DD\");\n            if (dateValue.isAfter(moment())) {\n                return true;\n            }\n            return false;\n        },\n        formatFromUserToApi: function (dateValue) {\n            if (!dateValue) {\n                return;\n            }\n            var calendarSetting = CalendarService.getSetting();\n            dateValue = moment(dateValue, calendarSetting.momentFormat)._d;\n            dateValue = Date.parse(dateValue);\n            dateValue = $filter('date')(dateValue, 'yyyy-MM-dd');\n            return dateValue;\n        },\n        formatFromApiToUser: function (dateValue) {\n            if (!dateValue) {\n                return;\n            }\n            var calendarSetting = CalendarService.getSetting();\n            if (moment(dateValue, calendarSetting.momentFormat).format(calendarSetting.momentFormat) === dateValue) {\n                return dateValue;\n            }\n            dateValue = moment(dateValue, 'YYYY-MM-DD')._d;\n            return $filter('date')(dateValue, calendarSetting.keyDateFormat);\n        },\n        getDateAfterOffsetDays: function (offSetDays) {\n            var date = new Date();\n            date.setDate(date.getDate()+offSetDays);\n            var calendarSetting = CalendarService.getSetting();\n            var tdy = $.calendars.instance(calendarSetting.keyCalendar).fromJSDate(date);\n            var dateAfterOffset = moment(tdy._year + '-' + tdy._month + '-' + tdy._day, 'YYYY-MM-DD')._d;\n            dateAfterOffset = Date.parse(dateAfterOffset);\n            dateAfterOffset = $filter('date')(dateAfterOffset, calendarSetting.keyDateFormat);\n            return dateAfterOffset;\n        },\n        verifyExpiryDate: function(date, expiryPeriodType, expiryDays){\n            var eventPeriodEndDate, eventDate, eventPeriod;\n            var isValid = true;\n            var calendarSetting, dateFormat, generator, today;\n            if(!date || !expiryPeriodType || !expiryDays) {\n                return isValid;\n            }\n            calendarSetting = CalendarService.getSetting();\n            dateFormat = calendarSetting.momentFormat;\n            generator = new dhis2.period.PeriodGenerator($.calendars.instance(calendarSetting.keyCalendar), dateFormat);\n            today = moment(this.getToday(), dateFormat);\n            eventDate = moment(date, dateFormat);\n            eventPeriod = generator.getPeriodForTheDate(eventDate.format(\"YYYY-MM-DD\"), expiryPeriodType, true);\n            if (eventPeriod && eventPeriod.endDate) {\n                eventPeriodEndDate = moment(eventPeriod.endDate, \"YYYY-MM-DD\").add(expiryDays, \"day\");\n                if (today.isAfter(eventPeriodEndDate)) {\n                    NotificationService.showNotifcationDialog($translate.instant(\"error\"), $translate.instant(\"event_date_out_of_range\"));\n                    isValid = false;\n                }\n            }\n            return isValid;\n        },\n        verifyOrgUnitPeriodDate: function(date, periodStartDate, periodEndDate) {\n            var isValid = true;\n            var dateFormat, startDate, endDate, eventDate, calendarSetting;\n            if(!date) {\n                hideHeaderMessage();\n                return isValid;\n            }\n            if (!periodStartDate && !periodEndDate) {\n                hideHeaderMessage();\n                return isValid;\n            } else {\n                calendarSetting = CalendarService.getSetting();\n                dateFormat = calendarSetting.momentFormat;\n                eventDate = moment(date, dateFormat);\n                if (!periodStartDate) {\n                    endDate = moment(periodEndDate, \"YYYY-MM-DD\");\n                    if (eventDate.isAfter(endDate)) {\n                        isValid = false;\n                    }\n                } else if (!periodEndDate) {\n                    startDate = moment(periodStartDate, \"YYYY-MM-DD\");\n                    if (eventDate.isBefore(startDate)) {\n                        isValid = false;\n                    }\n                } else {\n                    startDate = moment(periodStartDate, \"YYYY-MM-DD\");\n                    endDate = moment(periodEndDate, \"YYYY-MM-DD\");\n                    if (eventDate.isBefore(startDate) || eventDate.isAfter(endDate)) {\n                        isValid = false;\n                    }\n                }\n            }\n            if(!isValid) {\n                setHeaderDelayMessage($translate.instant(\"date_out_of_ou_period\"));\n            } else {\n                hideHeaderMessage();\n            }\n            return isValid;\n        },\n        getAge: function( _dob ){\n            var calendarSetting = CalendarService.getSetting();\n            var now = moment();\n            var dob = moment( _dob, calendarSetting.momentFormat);\n            var age = {};\n\n            age.years = now.diff(dob, 'years');\n            dob.add(age.years, 'years');\n\n            age.months = now.diff(dob, 'months');\n            dob.add(age.months, 'months');\n\n            age.days = now.diff(dob, 'days');\n            \n            return age;\n        },\n        getDateFromUTCString: function(utcDateTimeString) {\n            var calendarSetting = CalendarService.getSetting();\n            return moment(utcDateTimeString).format(calendarSetting.momentFormat);\n        }\n    };\n})\n\n/* Service for option name<->code conversion */\n.factory('OptionSetService', function() {\n    return {\n        getCode: function(options, key){\n            if(options){\n                for(var i=0; i<options.length; i++){\n                    if( key === options[i].displayName){\n                        return options[i].code;\n                    }\n                }\n            }\n            return key;\n        },\n        getName: function(options, key){\n            if(options){\n                for(var i=0; i<options.length; i++){\n                    if( key === options[i].code){\n                        return options[i].displayName;\n                    }\n                }\n            }\n            return key;\n        }\n    };\n})\n\n/* service for common utils */\n.service('CommonUtils', function($translate, DateUtils, OptionSetService, CurrentSelection, FileService, OrgUnitFactory, NotificationService, SessionStorageService, storage){\n    \n    var setFileName = function(event, valueId, dataElementId){\n        var fileNames = CurrentSelection.getFileNames() || {};\n        FileService.get(valueId).then(function(response){\n            if(response && response.displayName){\n                if(!fileNames[event.event]){\n                    fileNames[event.event] = {};\n                }\n                fileNames[event.event][dataElementId] = response.displayName;\n                CurrentSelection.setFileNames( fileNames );\n            }\n        });\n    };\n    \n    var setOrgUnitName = function( id ){\n        var orgUnitNames = CurrentSelection.getOrgUnitNames() || {};\n        if( !orgUnitNames[id] ){                \n            OrgUnitFactory.getFromStoreOrServer( id ).then(function (response) {\n                if(response && response.displayName) {                                                        \n                    orgUnitNames[id] = response.displayName;\n                    CurrentSelection.setOrgUnitNames( orgUnitNames );\n                }\n            });\n        }\n    };\n    \n    return {\n        formatDataValue: function(event, val, obj, optionSets, destination){\n            if(val &&\n                obj.valueType === 'NUMBER' ||\n                obj.valueType === 'PERCENTAGE' ||\n                obj.valueType === 'INTEGER' ||\n                obj.valueType === 'INTEGER_POSITIVE' ||\n                obj.valueType === 'INTEGER_NEGATIVE' ||\n                obj.valueType === 'INTEGER_ZERO_OR_POSITIVE'){\n                if( dhis2.validation.isNumber(val)){\n                    if(obj.valueType === 'NUMBER'){\n                        val = parseFloat(val);\n                    }else{\n                        val = parseInt(val);\n                    }\n                }\n            }\n            if(val && obj.optionSetValue && obj.optionSet && obj.optionSet.id && optionSets[obj.optionSet.id] && optionSets[obj.optionSet.id].options  ){\n                if(destination === 'USER'){\n                    val = OptionSetService.getName(optionSets[obj.optionSet.id].options, String(val));\n                }\n                else{\n                    val = OptionSetService.getCode(optionSets[obj.optionSet.id].options, val);\n                }\n\n            }\n            if(val && obj.valueType === 'DATE'){\n                if(destination === 'USER'){\n                    val = DateUtils.formatFromApiToUser(val);\n                }\n                else{\n                    val = DateUtils.formatFromUserToApi(val);\n                }\n            }\n            if(obj.valueType === 'TRUE_ONLY'){\n                if(destination === 'USER'){\n                    val = val === 'true' ? true : '';\n                }\n                else{\n                    val = val === true ? 'true' : '';\n                }\n            }\n            if( val && obj.valueType === 'ORGANISATION_UNIT' ){\n                if( destination === 'USER' ){                    \n                    setOrgUnitName( val );\n                }\n            }\n            if(event && val && destination === 'USER' && obj.valueType === 'FILE_RESOURCE'){                \n                setFileName(event, val, obj.id);\n            }\n            return val;\n        },\n        displayBooleanAsYesNo: function(value, dataElement){\n            if(angular.isUndefined(dataElement) || dataElement.valueType === \"BOOLEAN\"){\n                if(value === \"true\" || value === true){\n                    return \"Yes\";\n                }\n                else if(value === \"false\" || value === false){\n                    return \"No\";\n                }\n            }\n            return value;\n        },\n        userHasValidRole: function(obj, prop, userRoles){\n        \tif( !obj || !prop || !userRoles){\n                return false;\n        \t}\n        \tfor(var i=0; i < userRoles.length; i++){            \n                if( userRoles[i].authorities && userRoles[i].authorities.indexOf('ALL') !== -1 ){\n                    return true;\n                }\n                if( userRoles[i][prop] && userRoles[i][prop].length > 0 ){\n                    for( var j=0; j< userRoles[i][prop].length; j++){\n                        if( obj.id === userRoles[i][prop][j].id ){\n                            return true;\n                        }\n                    }\n                }\n            }\n            return false;            \t\n        },        \n        checkAndSetOrgUnitName: function( id ){\n            setOrgUnitName( id );\n        },\n        checkAndSetFileName: function(event, valueId, dataElementId ){\n            setFileName(event, valueId, dataElementId);\n        },\n        getUsername: function(){            \n            var userProfile = SessionStorageService.get('USER_PROFILE');\n            var username = userProfile && userProfile.userCredentials && userProfile.userCredentials.username ? userProfile.userCredentials.username : '';\n            return username;\n        },\n        getSystemSetting: function(){\n            var settings = storage.get('SYSTEM_SETTING');            \n            return settings;\n        }\n    };\n})\n\n/* service for dealing with custom form */\n.service('CustomFormService', function ($translate, NotificationService) {\n\n    return {\n        getForProgramStage: function (programStage, programStageDataElements) {\n\n            var htmlCode = programStage.dataEntryForm ? programStage.dataEntryForm.htmlCode : null;\n\n            if (htmlCode) {\n                var inputRegex = /<input.*?\\/>/g,\n                    match,\n                    inputFields = [],\n                    hasEventDate = false;\n\n                while (match = inputRegex.exec(htmlCode)) {\n                    inputFields.push(match[0]);\n                }\n\n                for (var i = 0; i < inputFields.length; i++) {\n                    var inputField = inputFields[i];\n                    \n                    var inputElement = $.parseHTML(inputField);\n                    var attributes = {};\n\n                    $(inputElement[0].attributes).each(function () {\n                        attributes[this.nodeName] = this.value;\n                    });\n\n                    var fieldId = '', newInputField;\n                    if (attributes.hasOwnProperty('id')) {\n\n                        if (attributes['id'] === 'executionDate') {\n                            fieldId = 'eventDate';\n                            hasEventDate = true;\n\n                            //name needs to be unique so that it can be used for validation in angularjs\n                            if (attributes.hasOwnProperty('name')) {\n                                attributes['name'] = fieldId;\n                            }\n\n                            newInputField = '<span class=\"hideInPrint\"><input type=\"text\" ' +\n                                this.getAttributesAsString(attributes) +\n                                ' ng-model=\"currentEvent.' + fieldId + '\"' +\n                                ' ng-disabled=\"model.editingDisabled\"' +\n                                ' input-field-id=\"' + fieldId + '\"' +\n                                ' d2-date ' +\n                                ' d2-date-validator ' +\n                                ' max-date=\"' + 0 + '\"' +\n                                ' placeholder=\"{{dhis2CalendarFormat.keyDateFormat}}\" ' +\n                                ' ng-change=\"verifyExpiryDate()\"'+\n                                ' ng-class=\"getInputNotifcationClass(prStDes.' + fieldId + '.dataElement.id,true)\"' +\n                                ' blur-or-change=\"saveDatavalue(prStDes.' + fieldId + ')\"' +\n                                ' ng-required=\"{{true}}\"></span><span class=\"not-for-screen\"><input type=\"text\" value={{currentEvent.' + fieldId + '}}></span>';\n                        }\n                        else {\n                            fieldId = attributes['id'].substring(4, attributes['id'].length - 1).split(\"-\")[1];\n\n                            //name needs to be unique so that it can be used for validation in angularjs\n                            if (attributes.hasOwnProperty('name')) {\n                                attributes['name'] = fieldId;\n                            }\n\n                            var prStDe = programStageDataElements[fieldId];\n\n                            if (prStDe && prStDe.dataElement && prStDe.dataElement.valueType) {\n\n                                var disableInputField = 'model.editingDisabled || isHidden(prStDes.' + fieldId + '.dataElement.id) || selectedEnrollment.status===\\'CANCELLED\\' || selectedEnrollment.status===\\'COMPLETED\\' || currentEvent[uid]==\\'uid\\' || currentEvent.editingNotAllowed ';\n                                var commonInputFieldProperty = this.getAttributesAsString(attributes) +\n                                    ' ng-model=\"currentEvent.' + fieldId + '\" ' +\n                                    ' input-field-id=\"' + fieldId + '\"' +\n                                    ' ng-disabled=\"' + disableInputField + '\"' + \n                                    ' ng-required=\"{{prStDes.' + fieldId + '.compulsory}}\" ';\n\n                                \n                                //check if dataelement has optionset\n                                if (prStDe.dataElement.optionSetValue) {\n                                    var optionSetId = prStDe.dataElement.optionSet.id;\n                                    newInputField = '<span class=\"hideInPrint\"><ui-select theme=\"select2\" ' + commonInputFieldProperty + ' ng-disabled=\"model.editingDisabled\" on-select=\"saveDatavalue(prStDes.' + fieldId + ', outerForm.' + fieldId + ')\" >' +\n                                        '<ui-select-match ng-class=\"getInputNotifcationClass(prStDes.' + fieldId + '.dataElement.id, true)\" allow-clear=\"true\" placeholder=\"' + $translate.instant('select_or_search') + '\">{{$select.selected.displayName || $select.selected}}</ui-select-match>' +\n                                        '<ui-select-choices ' +\n                                        ' repeat=\"option.displayName as option in optionSets.' + optionSetId + '.options | filter: $select.search | limitTo:maxOptionSize\">' +\n                                        '<span ng-bind-html=\"option.displayName | highlight: $select.search\">' +\n                                        '</span>' +\n                                        '</ui-select-choices>' +\n                                        '</ui-select></span><span class=\"not-for-screen\"><input type=\"text\" value={{currentEvent.' + fieldId + '}}></span>';\n                                }\n                                else {\n                                    //check data element type and generate corresponding angular input field\n                                    if (prStDe.dataElement.valueType === \"NUMBER\" ||\n                                        prStDe.dataElement.valueType === \"PERCENTAGE\" ||\n                                        prStDe.dataElement.valueType === \"INTEGER\" ||\n                                        prStDe.dataElement.valueType === \"INTEGER_POSITIVE\" ||\n                                        prStDe.dataElement.valueType === \"INTEGER_NEGATIVE\" ||\n                                        prStDe.dataElement.valueType === \"INTEGER_ZERO_OR_POSITIVE\") {\n                                        newInputField = '<span class=\"hideInPrint\"><input type=\"number\" ' +\n                                            ' d2-number-validator ' +\n                                            //' ng-class=\"{{getInputNotifcationClass(prStDes.' + fieldId + '.dataElement.id, true)}}\" ' +\n                                            ' ng-class=\"getInputNotifcationClass(prStDes.' + fieldId + '.dataElement.id, true)\" ' +\n                                            ' number-type=\"' + prStDe.dataElement.valueType + '\" ' +\n                                            ' ng-blur=\"saveDatavalue(prStDes.' + fieldId + ', outerForm.' + fieldId + ')\"' +\n                                            commonInputFieldProperty + 'ng-disabled=\"model.editingDisabled\"></span><span class=\"not-for-screen\"><input type=\"text\" value={{currentEvent.' + fieldId + '}}></span>';\n                                    }\n                                    else if (prStDe.dataElement.valueType === \"BOOLEAN\") {\n                                    \tnewInputField = '<span class=\"hideInPrint\"><d2-radio-button ' +\n                                                                    ' dh-required=\"prStDes.' + fieldId + '.compulsory\" ' +\n                                                                    ' dh-disabled=\"' + disableInputField + '\"' +\n                                                                    ' dh-value=\"currentEvent.' + fieldId + '\" ' +\n                                                                    ' dh-name=\"foo\" ' +\n                                                                    ' dh-current-element=\"currentElement\" ' +\n                                                                    ' dh-event=\"currentEvent.event\" ' +\n                                                                    ' dh-id=\"prStDes.' + fieldId + '.dataElement.id\" ' +\n                                                                    ' dh-click=\"saveDatavalue(prStDes.' + fieldId + ', currentEvent, value )\">' +\n                                                            ' </d2-radio-button></span> ' +\n                                                            '<span class=\"not-for-screen\">' +\n                                                            \t'<label class=\"radio-inline\"><input type=\"radio\" value=\"true\" ng-model=\"currentEvent.' + fieldId +'\">{{\\'yes\\' | translate}}</label>' +\n                                                            \t'<label class=\"radio-inline\"><input type=\"radio\" value=\"false\" ng-model=\"currentEvent.' + fieldId + '\">{{\\'no\\' | translate}}</label>' +\n                                                            '</span>';\n                                    }\n                                    else if (prStDe.dataElement.valueType === \"DATE\") {\n                                        var maxDate = prStDe.allowFutureDate ? '' : 0;\n                                        newInputField = '<span class=\"hideInPrint\"><input type=\"text\" ' +\n                                            ' placeholder=\"{{dhis2CalendarFormat.keyDateFormat}}\" ' +\n                                            ' ng-class=\"getInputNotifcationClass(prStDes.' + fieldId + '.dataElement.id, true)\" ' +\n                                            ' d2-date ' +\n                                            ' d2-date-validator ' +\n                                            ' max-date=\"' + maxDate + '\"' +\n                                            ' ng-change=\"verifyExpiryDate()\"'+\n                                            ' blur-or-change=\"saveDatavalue(prStDes.' + fieldId + ', outerForm.' + fieldId + ')\"' +\n                                            commonInputFieldProperty + ' ></span><span class=\"not-for-screen\"><input type=\"text\" value={{currentEvent.' + fieldId + '}}></span>';\n                                    }\n                                    else if (prStDe.dataElement.valueType === \"TRUE_ONLY\") {\n                                        newInputField = '<span class=\"hideInPrint\"><input type=\"checkbox\" ' +\n                                            ' ng-class=\"getInputNotifcationClass(prStDes.' + fieldId + '.dataElement.id, true)\" ' +\n                                            ' ng-change=\"saveDatavalue(prStDes.' + fieldId + ', outerForm.' + fieldId + ')\"' +\n                                            commonInputFieldProperty + ' ></span><span class=\"not-for-screen\"><input type=\"checkbox\" ng-checked={{currentEvent.' + fieldId + '}}></span>';\n                                    }\n                                    else if (prStDe.dataElement.valueType === \"LONG_TEXT\") {\n                                        newInputField = '<span class=\"hideInPrint\"><textarea row=\"3\" ' +\n                                            ' ng-class=\"getInputNotifcationClass(prStDes.' + fieldId + '.dataElement.id, true)\" ' +\n                                            ' ng-blur=\"saveDatavalue(prStDes.' + fieldId + ', outerForm.' + fieldId + ')\"' +\n                                            commonInputFieldProperty + '></textarea></span><span class=\"not-for-screen\"><textarea row=\"3\" value={{currentEvent.' + fieldId + '}}></textarea></span>';\n                                    }\n                                    else if (prStDe.dataElement.valueType === \"FILE_RESOURCE\") {\n                                        newInputField = '<span ng-disabled=\"' + disableInputField + '\" class=\"input-group hideInPrint\">\\n\\\n                                                        <span ng-if=\"currentEvent.' + fieldId + '\">\\n\\\n                                                            <a href ng-click=\"downloadFile(null, \\'' + fieldId + '\\', null)\" title=\"fileNames[currentEvent.event][' + fieldId + ']\" >{{fileNames[currentEvent.event][' + fieldId + '].length > 20 ? fileNames[currentEvent.event][' + fieldId + '].substring(0,20).concat(\\'...\\') : fileNames[currentEvent.event][' + fieldId + ']}}</a>\\n\\\n                                                        </span>\\n\\\n                                                        <span class=\"input-group-btn\">\\n\\\n                                                            <span class=\"btn btn-grp btn-file\">\\n\\\n                                                                <span ng-if=\"currentEvent.' + fieldId + '\" title=\"{{\\'delete\\' | translate}}\" d2-file-input-name=\"fileNames[currentEvent.event][' + fieldId + ']\" d2-file-input-delete=\"currentEvent.' + fieldId + '\">\\n\\\n                                                                    <a href ng-click=\"deleteFile(\\'' + fieldId + '\\')\"><i class=\"fa fa-trash alert-danger\"></i></a>\\n\\\n                                                                </span>\\n\\\n                                                                <span ng-if=\"!currentEvent.' + fieldId + '\" title=\"{{\\'upload\\' | translate}}\" >\\n\\\n                                                                    <i class=\"fa fa-upload\"></i>\\n\\\n                                                                    <input  type=\"file\" \\n\\\n                                                                            ' + this.getAttributesAsString(attributes) + '\\n\\\n                                                                            input-field-id=\"' + fieldId + '\"\\n\\\n                                                                            d2-file-input-ps=\"currentStage\"\\n\\\n                                                                            d2-file-input=\"currentEvent\"\\n\\\n                                                                            d2-file-input-current-name=\"currentFileNames\"\\n\\\n                                                                            d2-file-input-name=\"fileNames\">\\n\\\n                                                                </span>\\n\\\n                                                            </span>\\n\\\n                                                        </span>\\n\\\n                                                    </span>' \n                                                    '<span class=\"not-for-screen\">' +\n                                                    \t'<input type=\"text\" value={{currentEvent.' + fieldId + '}}' +\n                                                    '</span>';\n                                    }\n                                    else if (prStDe.dataElement.valueType === \"AGE\") {\n                                    \tnewInputField = '<span class=\"hideInPrint\"><d2-age ' +\n                                    \t\t\t\t\t\t\t' id=\" ' + fieldId + '\" ' +\n\t\t\t\t\t\t                                        ' d2-object=\"currentEvent\" ' + \n\t\t\t\t\t\t                                        ' d2-disabled=\"' + disableInputField + '\"' +\n                                                                ' d2-required=\"prStDes.' + fieldId + '.compulsory\" ' +\n\t\t\t\t\t\t                                        ' d2-function=\"saveDatavalue(arg1)\" ' +\t\t\t\t\t\t                                        \n\t\t\t\t\t\t                                        ' d2-function-param-text=\"prStDes.' + fieldId + '\" >' +\n\t\t\t\t\t\t                                '</d2-age></span>' +\n                                                        '<span class=\"not-for-screen\">' +\n                                                    \t\t'<input type=\"text\" value={{currentEvent.' + fieldId + '}}' +\n                                                    \t'</span>';\n                                    }\n                                    else if (prStDe.dataElement.valueType === \"COORDINATE\") {\n                                    \tnewInputField = '<span class=\"hideInPrint\"><d2-map ' +\n                                    \t\t\t\t\t\t\t' id=\" ' + fieldId + '\" ' +\n\t\t\t\t\t\t                                        ' d2-object=\"currentEvent\" ' + \n\t\t\t\t\t\t                                        ' d2-coordinate-format=\"\\'TEXT\\'\" ' + \n\t\t\t\t\t\t                                        ' d2-disabled=\"'+ disableInputField + '\"' +\n                                                                ' d2-required=\"prStDes.' + fieldId + '.compulsory\" ' +\n\t\t\t\t\t\t                                        ' d2-function=\"saveDatavalue(arg1)\" ' +\t\t\t\t\t\t                                        \n\t\t\t\t\t\t                                        ' d2-function-param-text=\"prStDes.' + fieldId + '\" ' +\n\t\t\t\t\t\t                                        ' d2-function-param-coordinate=\"\\'LATLNG\\'\" > ' +\n\t\t\t\t\t\t                                '</d2-map></span>' +\n\t\t\t\t\t\t                                '<span class=\"not-for-screen\">' +\n                                                    \t\t'<input type=\"text\" value={{currentEvent.' + fieldId + '}}' +\n                                                    \t'</span>';\n                                    }\n                                    else if (prStDe.dataElement.valueType === \"ORGANISATION_UNIT\") {\n                                    \tnewInputField = '<span class=\"hideInPrint\"><d2-org-unit-tree ' +\n\t\t\t\t\t                                            ' selected-org-unit-id=\"{{selectedOrgUnit.id}}\" ' +\n\t\t\t\t\t                                            ' id=\"{{prStDes.' + fieldId + '.dataElement.id}}\" ' +\n\t\t\t\t\t                                            ' d2-object=\"currentEvent\" ' +\n\t\t\t\t\t                                            ' d2-value=\"currentEvent.' + fieldId + '\" ' +\n\t\t\t\t\t                                            ' d2-disabled=\"'+ disableInputField + '\"' +\n\t\t\t\t\t                                            ' d2-required=\"prStDes.' + fieldId + '.compulsory\" ' +\n                                                                ' d2-orgunit-names=\"orgUnitNames\" ' +\n\t\t\t\t\t                                            ' d2-function=\"saveDatavalue(prStDes.' + fieldId + ', currentEvent, value )\" >' +\n\t\t\t\t\t                                    ' </d2-org-unit-tree></span>' +\n\t\t\t\t\t                                    '<span class=\"not-for-screen\">' +\n                                                    \t\t'<input type=\"text\" value={{currentEvent.' + fieldId + '}}' +\n                                                    \t'</span>';\n                                    }\n                                    else if (prStDe.dataElement.valueType === \"PHONE_NUMBER\") {\n                                        newInputField = '<span class=\"hideInPrint\"><input type=\"text\" ' +\n                                            ' ng-class=\"getInputNotifcationClass(prStDes.' + fieldId + '.dataElement.id, true)\" ' +\n                                            ' ng-blur=\"saveDatavalue(prStDes.' + fieldId + ', outerForm.' + fieldId + ')\"' +\n                                            commonInputFieldProperty + '></span><span class=\"not-for-screen\"><input type=\"text\" value={{currentEvent.' + fieldId + '}}></span>';\n                                    }\n                                    else if (prStDe.dataElement.valueType === \"EMAIL\") {\n                                        newInputField = '<span class=\"hideInPrint\"><input style=\"width:100%;\" type=\"email\"' +\n                                            ' ng-blur=\"saveDatavalue(prStDes.' + fieldId + ', outerForm.' + fieldId + ')\" ' +\n                                            commonInputFieldProperty +\n                                            ' ng-model=\"currentEvent.' + fieldId + '\">' +\n                                            '<span class=\"not-for-screen\"><input type=\"email\" value={{currentEvent.' + fieldId + '}}></span>';\n                                    }\n                                    else if (prStDe.dataElement.valueType === \"TEXT\") {\n                                        newInputField = '<span class=\"hideInPrint\"><input type=\"text\" ' +\n                                            ' ng-class=\"getInputNotifcationClass(prStDes.' + fieldId + '.dataElement.id, true)\" ' +\n                                            ' ng-blur=\"saveDatavalue(prStDes.' + fieldId + ', outerForm.' + fieldId + ')\"' +\n                                            commonInputFieldProperty + '></span><span class=\"not-for-screen\"><input type=\"text\" value={{currentEvent.' + fieldId + '}}></span>';\n                                    }\n                                    else{\n                                    \tnewInputField = ' {{\"unsupported_value_type\" | translate }}: ' + prStDe.dataElement.valueType;\n                                    }\n                                }\n                            }\n                            else{\n                                NotificationService.showNotifcationDialog($translate.instant(\"error\"),\n                                    $translate.instant(\"custom_form_has_invalid_dataelement\"));\n\n                                return;\n                            }\n                            \n                            \n                        }\n                        newInputField = newInputField + ' <span ng-messages=\"outerForm.' + fieldId + '.$error\" class=\"required\" ng-if=\"interacted(outerForm.' + fieldId + ')\" ng-messages-include=\"./templates/error-messages.html\"></span>';\n\n                        htmlCode = htmlCode.replace(inputField, newInputField);\n\n                    }\n                }\n                htmlCode = addPopOver(htmlCode, programStageDataElements);\n                return {htmlCode: htmlCode, hasEventDate: hasEventDate};\n            }\n            return null;\n        },\n        getForTrackedEntity: function (trackedEntityForm, target) {\n            if (!trackedEntityForm) {\n                return null;\n            }\n\n            var htmlCode = trackedEntityForm.htmlCode ? trackedEntityForm.htmlCode : null;\n            if (htmlCode) {\n\n                var trackedEntityFormAttributes = [];\n                angular.forEach(trackedEntityForm.attributes, function (att) {\n                    trackedEntityFormAttributes[att.id] = att;\n                });\n\n\n                var inputRegex = /<input.*?\\/>/g, match, inputFields = [];\n                var hasProgramDate = false;\n                while (match = inputRegex.exec(htmlCode)) {\n                    inputFields.push(match[0]);\n                }\n\n                for (var i = 0; i < inputFields.length; i++) {\n                    var inputField = inputFields[i];\n                    var inputElement = $.parseHTML(inputField);\n                    var attributes = {};\n\n                    $(inputElement[0].attributes).each(function () {\n                        attributes[this.nodeName] = this.value;\n                    });\n\n                    var attId = '', fieldName = '', newInputField, programId;\n                    if (attributes.hasOwnProperty('attributeid')) {\n                        attId = attributes['attributeid'];\n                        fieldName = attId;\n                        var att = trackedEntityFormAttributes[attId];\n\n                        if (att) {\n                            var attMaxDate = att.allowFutureDate ? '' : 0;\n                            var isTrackerAssociate = att.valueType === 'TRACKER_ASSOCIATE';\n                            var disableInputField = 'selectedOrgUnit.closedStatus || editingDisabled || isHidden(attributesById.' + attId + '.id) || ' + isTrackerAssociate+ '|| attributesById.' + attId + '.generated';\n                            var commonInputFieldProperty = ' name=\"' + fieldName + '\"' +\n                                ' element-id=\"' + i + '\"' +\n                                this.getAttributesAsString(attributes) +\n                                ' d2-focus-next-on-enter' +\n                                ' ng-model=\"selectedTei.' + attId + '\" ' +\n                                ' attribute-data=\"attributesById.' + attId + '\" ' +\n                                ' selected-program-id=\"selectedProgram.id\" ' +\n                                ' selected-tei-id=\"selectedTei.trackedEntityInstance\" ' +\n                                ' ng-disabled=\"' + disableInputField + '\"'+ \n                                ' d2-attribute-validator ' +\n                                ' ng-required=\" ' + att.mandatory + '\" ';\n\n                            //check if attribute has optionset\n                            if (att.optionSetValue) {\n                                var optionSetId = att.optionSet.id;\n                                newInputField = '<span class=\"hideInPrint\"><ui-select style=\"width:100%;\" theme=\"select2\" ' + commonInputFieldProperty + '  on-select=\"teiValueUpdated(selectedTei,\\'' + attId + '\\')\" >' +\n                                    '<ui-select-match allow-clear=\"true\" placeholder=\"' + $translate.instant('select_or_search') + '\">{{$select.selected.displayName || $select.selected}}</ui-select-match>' +\n                                    '<ui-select-choices ' +\n                                    'repeat=\"option.displayName as option in optionSets.' + optionSetId + '.options | filter: $select.search | limitTo:maxOptionSize\">' +\n                                    '<span ng-bind-html=\"option.displayName | highlight: $select.search\"></span>' +\n                                    '</ui-select-choices>' +\n                                    '</ui-select></span><span class=\"not-for-screen\"><input type=\"text\" value={{selectedTei.' + attId + '}}></span>';\n                            }\n                            else {\n                                //check attribute type and generate corresponding angular input field\n                                if (att.valueType === \"NUMBER\" ||\n                                    att.valueType === \"PERCENTAGE\" ||\n                                    att.valueType === \"INTEGER\" ||\n                                \t\tatt.valueType === \"INTEGER_POSITIVE\" ||\n                                \t\tatt.valueType === \"INTEGER_NEGATIVE\" ||\n                                \t\tatt.valueType === \"INTEGER_ZERO_OR_POSITIVE\" ) {\n                                    newInputField = '<span class=\"hideInPrint\"><input style=\"width:100%;\" type=\"number\"' +\n                                        ' d2-number-validator ' +\n                                        ' number-type=\"' + att.valueType + '\" ' +\n                                        ' ng-blur=\"teiValueUpdated(selectedTei,\\'' + attId + '\\')\" ' +\n                                        commonInputFieldProperty + ' ></span><span class=\"not-for-screen\"><input type=\"text\" value={{selectedTei.' + attId + '}}></span>';\n                                }\n                                else if (att.valueType === \"BOOLEAN\") {\n                                \tnewInputField = '<span class=\"hideInPrint\"><d2-radio-button ' +\n                                                            ' dh-required=\" ' + (att.mandatory || att.unique) + '\" ' +\n                                                            ' dh-disabled=\"'+ disableInputField + '\"' +\n                                                            ' dh-value=\"selectedTei.' + attId + '\" ' +\n                                                            ' dh-name=\"foo\" ' +\n                                                            ' dh-current-element=\"currentElement\" ' +\n                                                            ' dh-event=\"currentEvent.event\" ' +\n                                                            ' dh-id=\"' + attId + '\" >' +\n                                                    ' </d2-radio-button></span>' +\n                                                    '<span class=\"not-for-screen\">' +\n                                                        '<label class=\"radio-inline\"><input type=\"radio\" value=\"true\" ng-model=\"selectedTei.' + attId + '\">{{\\'yes\\' | translate}}</label>' +\n                                                        '<label class=\"radio-inline\"><input type=\"radio\" value=\"false\" ng-model=\"selectedTei.' + attId + '\">{{\\'no\\' | translate}}</label>' +\n                                                    '</span>';\n                                }\n                                else if (att.valueType === \"DATE\") {\n                                    newInputField = '<span class=\"hideInPrint\"><input  style=\"width:100%;\" type=\"text\"' +\n                                        ' placeholder=\"{{dhis2CalendarFormat.keyDateFormat}}\" ' +\n                                        ' max-date=\" ' + attMaxDate + ' \" ' +\n                                        ' d2-date' +\n                                        ' ng-change=\"verifyExpiryDate(\\'selectedTei.'+attId+'\\')\"'+\n                                        ' blur-or-change=\"teiValueUpdated(selectedTei,\\'' + attId + '\\')\" ' +\n                                        commonInputFieldProperty + ' ></span>' +\n                                        '<span class=\"not-for-screen\"><input type=\"text\" value={{selectedTei.' + attId + '}}></span>';\n                                }\n                                else if (att.valueType === \"TRUE_ONLY\") {\n                                    newInputField = '<span class=\"hideInPrint\"><input style=\"width:100%;\" type=\"checkbox\" ' +\n                                        ' ng-change=\"teiValueUpdated(selectedTei,\\'' + attId + '\\')\" ' +\n                                        commonInputFieldProperty + ' ></span>' +\n                                        '<span class=\"not-for-screen\"><input type=\"checkbox\" ng-checked={{selectedTei.' + attId + '}}></span>';\n                                }\n                                else if (att.valueType === \"EMAIL\") {\n                                    newInputField = '<span class=\"hideInPrint\"><input style=\"width:100%;\" type=\"email\"' +\n                                        ' ng-blur=\"teiValueUpdated(selectedTei,\\'' + attId + '\\')\" ' +\n                                        commonInputFieldProperty + ' >' +\n                                        '<span class=\"not-for-screen\"><input type=\"text\" value={{selectedTei.' + attId + '}}></span>';\n                                }\n                                else if (att.valueType === \"TRACKER_ASSOCIATE\") {\n                                \tnewInputField = '<span class=\"input-group hideInPrint\"> ' +\n                                                                        ' <input type=\"text\" style=\"width:100%;\"' +\n                                                                        ' ng-blur=\"teiValueUpdated(selectedTei,\\'' + attId + '\\')\" ' +\n                                                                        commonInputFieldProperty + ' >' +\n                                                                        '<span class=\"input-group-btn input-group-btn-no-width\"> ' +\n                                                            '<button class=\"btn btn-grp default-btn-height\" type=\"button\" ' + \n                                                                ' title=\"{{\\'add\\' | translate}} {{attributesById.' + attId + '.displayName}}\" ' +\n                                                                ' ng-if=\"!selectedTei.' + attId + '\" ' +                                                                \n                                                                ' ng-class=\"{true: \\'disable-clicks\\'} [editingDisabled]\" ' +\n                                                                ' ng-click=\"getTrackerAssociate(attributesById.' + attId + ', selectedTei.' + attId + ')\" >' +\n                                                                '<i class=\"fa fa-external-link\"></i> ' +\n                                                            '</button> ' + \n                                                            '<button class=\"btn btn-grp default-btn-height\" type=\"button\" ' + \n                                                                ' title=\"{{\\'remove\\' | translate}} {{attributesById.' + attId + '.displayName}}\" ' +\n                                                                ' ng-if=\"selectedTei.' + attId + '\" ' +\n                                                                ' ng-disabled=\"' + disableInputField + '\"'+\n                                                                ' ng-class=\"{true: \\'disable-clicks\\'} [editingDisabled]\" ' +\n                                                                ' ng-click=\"selectedTei.' + attId + ' = null\" >' +\n                                                                '<i class=\"fa fa-trash-o\"></i> ' +\n                                                            '</button> ' + \n                                                        '</span>'+\n                                                    '</span>'+\n                                                    '<span class=\"not-for-screen\"><input type=\"text\" value={{selectedTei.' + attId + '}}></span>';\n                                }\n                                else if (att.valueType === \"AGE\") {\n                                \tnewInputField = '<span class=\"hideInPrint\"><d2-age ' +\n                                                            ' id=\" ' + attId + '\" ' +\n\t\t\t\t\t\t                                    ' d2-object=\"selectedTei\" ' +  \t\t\t\t\t\t                                    \n\t\t\t\t\t\t                                    ' d2-required=\" ' + (att.mandatory || att.unique) + '\" ' +\n                                                            ' d2-disabled=\"'+ disableInputField +'\" >' +\n\t\t\t\t\t\t                                '</d2-age></span>'+\n                                                    '<span class=\"not-for-screen\"><input type=\"text\" value={{selectedTei.' + attId + '}}></span>';\n                                }\n                                else if (att.valueType === \"COORDINATE\") {\n                                \tnewInputField = '<span class=\"hideInPrint\"><d2-map ' +\n                                                            ' id=\" ' + attId + '\" ' +\n\t\t\t\t\t\t                                    ' d2-object=\"selectedTei\" ' +  \n\t\t\t\t\t\t                                    ' d2-value=\"selectedTei.' + attId + '\" ' +\n\t\t\t\t\t\t                                    ' d2-required=\" ' + (att.mandatory || att.unique) + '\" ' +\n\t\t\t\t\t                                        ' d2-disabled=\"'+ disableInputField + '\"' +\n\t\t\t\t\t\t                                    ' d2-coordinate-format=\"\\'TEXT\\'\" > ' +\n\t\t\t\t\t\t                            '</d2-map></span>'+\n                                                    '<span class=\"not-for-screen\"><input type=\"text\" value={{selectedTei.' + attId + '}}></span>';\n                                }\n                                else if (att.valueType === \"ORGANISATION_UNIT\") {\n                                \tnewInputField = '<span class=\"hideInPrint\"><d2-org-unit-tree ' +\n\t\t\t\t                                            ' selected-org-unit-id=\"{{selectedOrgUnit.id}}\" ' +\n\t\t\t\t                                            ' id=\" ' + attId + '\" ' +\n\t\t\t\t                                            ' d2-object=\"selectedTei\" ' +  \n\t\t\t\t\t\t                                    ' d2-value=\"selectedTei.' + attId + '\" ' +\n\t\t\t\t\t\t                                    ' d2-required=\" ' + (att.mandatory || att.unique) + '\" ' +\n\t\t\t\t\t                                        ' d2-disabled=\"'+ disableInputField + '\"' +\n                                                            ' d2-orgunit-names=\"orgUnitNames\" ' +\n\t\t\t\t\t                                        ' d2-function=\"teiValueUpdated()\" >' +\n\t\t\t\t                                        ' </d2-org-unit-tree></span>'+\n                                                    '<span class=\"not-for-screen\"><input type=\"text\" value={{selectedTei.' + attId + '}}></span>';\n                                }\n                                else if (att.valueType === \"LONG_TEXT\") {\n                                    newInputField = '<span><textarea style=\"width:100%;\" row =\"3\" ' +\n                                        ' ng-blur=\"teiValueUpdated(selectedTei,\\'' + attId + '\\')\" ' +\n                                        commonInputFieldProperty + ' ></textarea></span>';\n                                }\n                                else if (att.valueType === \"TEXT\") {\n                                    newInputField = '<input type=\"text\" style=\"width:100%;\"' +\n                                        ' ng-blur=\"teiValueUpdated(selectedTei,\\'' + attId + '\\')\" ' +\n                                        commonInputFieldProperty + '>';\n                                }\n                                else if (att.valueType === \"PHONE_NUMBER\") {\n                                    newInputField = '<input type=\"text\" style=\"width:100%;\"' +\n                                        ' ng-blur=\"teiValueUpdated(selectedTei,\\'' + attId + '\\')\" ' +\n                                        commonInputFieldProperty + '>';\n                                }\n                                else {                                \t\n                                    newInputField = ' {{\"unsupported_value_type\" | translate }} ' + att.valueType;\n                                }                                \n                            }\n                        }\n                        else{\n                            NotificationService.showNotifcationDialog($translate.instant(\"error\"),\n                                $translate.instant(\"custom_form_has_invalid_attribute\"));\n                            return;\n                        }\n                    }\n\n                    if (attributes.hasOwnProperty('programid')) {\n                        hasProgramDate = true;\n                        programId = attributes['programid'];\n                        if (programId === 'enrollmentDate') {\n                            fieldName = 'dateOfEnrollment';\n                            var enMaxDate = trackedEntityForm.selectEnrollmentDatesInFuture ? '' : 0;\n                            newInputField = '<input type=\"text\" style=\"width:100%;\"' +\n                                ' name=\"' + fieldName + '\"' +\n                                ' element-id=\"' + i + '\"' +\n                                this.getAttributesAsString(attributes) +\n                                ' d2-focus-next-on-enter' +\n                                ' placeholder=\"{{dhis2CalendarFormat.keyDateFormat}}\" ' +\n                                ' ng-model=\"selectedEnrollment.dateOfEnrollment\" ' +\n                                ' ng-change=\"verifyExpiryDate(\\'selectedEnrollment.dateOfEnrollment\\')\"'+\n                                ' ng-disabled=\"\\'' + target + '\\' === \\'PROFILE\\' || selectedOrgUnit.closedStatus\"' +\n                                ' d2-date' +\n                                ' max-date=\"' + enMaxDate + '\"' +\n                                ' ng-required=\"true\">';\n                        }\n                        if (programId === 'dateOfIncident' && trackedEntityForm.displayIncidentDate) {\n                            fieldName = 'dateOfIncident';\n                            var inMaxDate = trackedEntityForm.selectIncidentDatesInFuture ? '' : 0;\n                            newInputField = '<input type=\"text\" style=\"width:100%;\"' +\n                                ' name=\"' + fieldName + '\"' +\n                                ' element-id=\"' + i + '\"' +\n                                this.getAttributesAsString(attributes) +\n                                ' d2-focus-next-on-enter' +\n                                ' placeholder=\"{{dhis2CalendarFormat.keyDateFormat}}\" ' +\n                                ' ng-model=\"selectedEnrollment.dateOfIncident\" ' +\n                                ' ng-change=\"verifyExpiryDate(\\'selectedEnrollment.dateOfIncident\\')\"'+\n                                ' ng-disabled=\"\\'' + target + '\\' === \\'PROFILE\\' || selectedOrgUnit.closedStatus\"' +\n                                ' d2-date ' +\n                                ' max-date=\"' + inMaxDate + '\">';\n                        }\n                    }\n\n                    newInputField = newInputField + ' <span ng-messages=\"outerForm.' + fieldName + '.$error\" class=\"required\" ng-if=\"interacted(outerForm.' + fieldName + ')\" ng-messages-include=\"./templates/error-messages.html\"></span>';\n\n                    htmlCode = htmlCode.replace(inputField, newInputField);\n                }\n                htmlCode = addPopOver(htmlCode, trackedEntityFormAttributes);\n                return {htmlCode: htmlCode, hasProgramDate: hasProgramDate};\n            }\n            return null;\n        },\n        getAttributesAsString: function (attributes) {\n            if (attributes) {\n                var attributesAsString = '';\n                for (var prop in attributes) {\n                    if (prop !== 'value') {\n                        attributesAsString += prop + '=\"' + attributes[prop] + '\" ';\n                    }\n                }\n                return attributesAsString;\n            }\n            return null;\n        }\n    };\n    /* This function inserts the d2-pop-over attributes into the tags containing d2-input-label attribute to\n     * add description and url popover to those tags */\n    function addPopOver(htmlCodeToInsertPopOver, popOverContent) {\n\n        var inputRegex = /<span.*?\\/span>/g;\n        var match, tagToInsertPopOver, tagWithPopOver;\n        var htmlCode = htmlCodeToInsertPopOver;\n        while (match = inputRegex.exec(htmlCodeToInsertPopOver)) {\n            if (match[0].indexOf(\"d2-input-label\") > -1) {\n                tagToInsertPopOver = match[0];\n                tagWithPopOver = insertPopOverSpanToTag(tagToInsertPopOver, popOverContent);\n                htmlCode = htmlCode.replace(tagToInsertPopOver,tagWithPopOver);\n            }\n        }\n        return htmlCode;\n\n    }\n\n    function insertPopOverSpanToTag(tagToInsertPopOverSpan, popOverContent)  {\n\n        var attribute, attributes, fieldId, description, url, element, attValue;\n        var popOverSpanElement, tagWithPopOverSpan;\n\n        element = $(tagToInsertPopOverSpan);\n        attributes = element[0].attributes;\n\n        for (var index = 0; index < attributes.length; index++) {\n            if (attributes[index].name === \"d2-input-label\") {\n                attValue = attributes[index].value;\n                break;\n            }\n        }\n        if (attValue) {\n            popOverSpanElement = $('<span></span>');\n            popOverSpanElement.attr(\"d2-pop-over\",\"\");\n            popOverSpanElement.attr(\"details\",\"{{'details'| translate}}\");\n            popOverSpanElement.attr(\"trigger\",\"click\");\n            popOverSpanElement.attr(\"placement\",\"right\");\n            popOverSpanElement.attr(\"class\",\"popover-label\");\n\n            if (attValue.indexOf(\"attributeId.\") > -1) {\n                fieldId = attValue.split(\".\")[1];\n                description = popOverContent[fieldId].description ? \"'\" + popOverContent[fieldId].description + \"'\" :\n                    \"undefined\";\n                popOverSpanElement.attr(\"content\",\"{description: \" + description + \"}\");\n                popOverSpanElement.attr(\"template\",\"attribute-details.html\");\n\n            } else {\n                fieldId = attValue.split(\"-\")[1];\n                description = popOverContent[fieldId].dataElement.description ? \"'\" +\n                popOverContent[fieldId].dataElement.description + \"'\" : \"undefined\";\n                url = popOverContent[fieldId].dataElement.url ? \"'\" +\n                popOverContent[fieldId].dataElement.url + \"'\" : \"undefined\";\n                popOverSpanElement.attr(\"content\",\"{description: \" + description + \", url:\" + url + \"}\");\n                popOverSpanElement.attr(\"template\",\"dataelement-details.html\");\n            }\n            popOverSpanElement.html(\"<a href title=\\\"{{'details'| translate}}\\\" class=\\\"wrap-text\\\" tabindex=\\\"-1\\\">\" +element.html() + \"</a>\");\n            element.html(popOverSpanElement[0].outerHTML.replace('d2-pop-over=\"\"','d2-pop-over'));\n            tagWithPopOverSpan = element[0].outerHTML;\n        }\n        return tagWithPopOverSpan;\n    }\n})\n\n/* Context menu for grid*/\n.service('ContextMenuSelectedItem', function () {\n    this.selectedItem = '';\n\n    this.setSelectedItem = function (selectedItem) {\n        this.selectedItem = selectedItem;\n    };\n\n    this.getSelectedItem = function () {\n        return this.selectedItem;\n    };\n})\n\n/* Modal service for user interaction */\n.service('ModalService', ['$modal', function ($modal) {\n\n    var modalDefaults = {\n        backdrop: true,\n        keyboard: true,\n        modalFade: true,\n        templateUrl: 'views/modal.html'\n    };\n\n    var modalOptions = {\n        closeButtonText: 'Close',\n        actionButtonText: 'OK',\n        headerText: 'Proceed?',\n        bodyText: 'Perform this action?'\n    };\n\n    this.showModal = function (customModalDefaults, customModalOptions) {\n        if (!customModalDefaults)\n            customModalDefaults = {};\n        customModalDefaults.backdrop = 'static';\n        return this.show(customModalDefaults, customModalOptions);\n    };\n\n    this.show = function (customModalDefaults, customModalOptions) {\n        //Create temp objects to work with since we're in a singleton service\n        var tempModalDefaults = {};\n        var tempModalOptions = {};\n\n        //Map angular-ui modal custom defaults to modal defaults defined in service\n        angular.extend(tempModalDefaults, modalDefaults, customModalDefaults);\n\n        //Map modal.html $scope custom properties to defaults defined in service\n        angular.extend(tempModalOptions, modalOptions, customModalOptions);\n\n        if (!tempModalDefaults.controller) {\n            tempModalDefaults.controller = ['$scope','$modalInstance', function ($scope, $modalInstance) {\n                $scope.modalOptions = tempModalOptions;\n                $scope.modalOptions.ok = function (result) {\n                    $modalInstance.close(result);\n                };\n                $scope.modalOptions.close = function (result) {\n                    $modalInstance.dismiss('cancel');\n                };\n            }];\n        }\n\n        return $modal.open(tempModalDefaults).result;\n    };\n\n}])\n\n/* Dialog service for user interaction */\n.service('DialogService', ['$modal', function ($modal) {\n\n    var dialogDefaults = {\n        backdrop: true,\n        keyboard: true,\n        backdropClick: true,\n        modalFade: true,\n        templateUrl: 'views/dialog.html'\n    };\n\n    var dialogOptions = {\n        closeButtonText: 'close',\n        actionButtonText: 'ok',\n        headerText: 'dhis2_tracker',\n        bodyText: 'Perform this action?'\n    };\n\n    this.showDialog = function (customDialogDefaults, customDialogOptions, summaries) {\n        if (!customDialogDefaults)\n            customDialogDefaults = {};\n        customDialogDefaults.backdropClick = false;\n        return this.show(customDialogDefaults, customDialogOptions, summaries);\n    };\n\n    this.show = function (customDialogDefaults, customDialogOptions, summaries) {\n        //Create temp objects to work with since we're in a singleton service\n        var tempDialogDefaults = {};\n        var tempDialogOptions = {};\n\n        //Map angular-ui modal custom defaults to modal defaults defined in service\n        angular.extend(tempDialogDefaults, dialogDefaults, customDialogDefaults);\n\n        //Map modal.html $scope custom properties to defaults defined in service\n        angular.extend(tempDialogOptions, dialogOptions, customDialogOptions);\n\n        if (!tempDialogDefaults.controller) {\n            tempDialogDefaults.controller = ['$scope','$modalInstance', function ($scope, $modalInstance) {\n                $scope.dialogOptions = tempDialogOptions;\n                $scope.dialogOptions.ok = function (result) {\n                    $modalInstance.close(result);\n                };\n                if(summaries) {\n                    $scope.summaries = summaries;\n                }\n            }];\n            \n        }\n\n        return $modal.open(tempDialogDefaults).result;\n    };\n\n}])\n.service('NotificationService', function (DialogService, $timeout) {\n    this.showNotifcationDialog = function(errorMsgheader, errorMsgBody, errorResponse){\n        var dialogOptions = {\n            headerText: errorMsgheader,\n            bodyText: errorMsgBody\n        };\n        var summaries = null;\n        if (errorResponse && errorResponse.data) {\n            if(errorResponse.data.message && (errorResponse.data.status === 'ERROR' || errorResponse.data.status === 'WARNING')) {\n                dialogOptions.bodyText += \"<br/>\"+errorResponse.data.message+\"<br/>\";\n            }\n            if( errorResponse.data.response && errorResponse.data.response.importSummaries && errorResponse.data.response.importSummaries.length > 0 ){\n                summaries = JSON.stringify(errorResponse.data.response.importSummaries);\n            }\n        }\n        DialogService.showDialog({}, dialogOptions, summaries);\n    };\n\n    this.showNotifcationWithOptions = function(dialogDefaults, dialogOptions){\n        DialogService.showDialog(dialogDefaults, dialogOptions);\n    };\n    \n    this.displayDelayedHeaderMessage = function( message ){\n        setHeaderDelayMessage( message );\n    };\n    \n    this.displayHeaderMessage = function( message ){\n        $timeout(function(){\n            setHeaderMessage( message );\n        }, 1000);\n    };\n    \n    this.removeHeaderMessage = function(){\n        hideHeaderMessage();\n    };\n})\n.service('Paginator', function () {\n    this.page = 1;\n    this.pageSize = 50;\n    this.itemCount = 0;\n    this.pageCount = 0;\n    this.toolBarDisplay = 5;\n\n    this.setPage = function (page) {\n        if (page > this.getPageCount()) {\n            return;\n        }\n\n        this.page = page;\n    };\n\n    this.getPage = function () {\n        return this.page;\n    };\n\n    this.setPageSize = function (pageSize) {\n        this.pageSize = pageSize;\n    };\n\n    this.getPageSize = function () {\n        return this.pageSize;\n    };\n\n    this.setItemCount = function (itemCount) {\n        this.itemCount = itemCount;\n    };\n\n    this.getItemCount = function () {\n        return this.itemCount;\n    };\n\n    this.setPageCount = function (pageCount) {\n        this.pageCount = pageCount;\n    };\n\n    this.getPageCount = function () {\n        return this.pageCount;\n    };\n\n    this.setToolBarDisplay = function (toolBarDisplay) {\n        this.toolBarDisplay = toolBarDisplay;\n    };\n\n    this.getToolBarDisplay = function () {\n        return this.toolBarDisplay;\n    };\n\n    this.lowerLimit = function () {\n        var pageCountLimitPerPageDiff = this.getPageCount() - this.getToolBarDisplay();\n\n        if (pageCountLimitPerPageDiff < 0) {\n            return 0;\n        }\n\n        if (this.getPage() > pageCountLimitPerPageDiff + 1) {\n            return pageCountLimitPerPageDiff;\n        }\n\n        var low = this.getPage() - (Math.ceil(this.getToolBarDisplay() / 2) - 1);\n\n        return Math.max(low, 0);\n    };\n})\n\n.service('GridColumnService', function ($http, $q, DHIS2URL, $translate, SessionStorageService, NotificationService) {\n    var GRIDCOLUMNS_URL = DHIS2URL+'/userDataStore/gridColumns/';\n    return {\n        columnExists: function (cols, id) {\n            var colExists = false;\n            if (!angular.isObject(cols) || !id || angular.isObject(cols) && !cols.length) {\n                return colExists;\n            }\n\n            for (var i = 0; i < cols.length && !colExists; i++) {\n                if (cols[i].id === id) {\n                    colExists = true;\n                }\n            }\n            return colExists;\n        },\n        set: function (gridColumns, name) {\n            var deferred = $q.defer();\n            var httpMessage = {\n                method: \"put\",\n                url: GRIDCOLUMNS_URL + name,\n                data: {\"gridColumns\": gridColumns},\n                headers: {'Content-Type': 'application/json;charset=UTF-8'}\n            };\n\n            $http(httpMessage).then(function (response) {\n                deferred.resolve(response.data);\n            },function (error) {\n                httpMessage.method = \"post\";\n                $http(httpMessage).then(function (response) {\n                    deferred.resolve(response.data);\n                }, function (error) {\n                    if (error && error.data) {\n                        deferred.resolve(error.data);\n                    } else {\n                        deferred.resolve(null);\n                    }\n                });\n            });\n            return deferred.promise;\n        },\n        get: function (name) {\n            var promise = $http.get(GRIDCOLUMNS_URL+name).then(function (response) {\n                if (response && response.data && response.data.gridColumns) {\n                    SessionStorageService.set(name, {id:name, columns:response.data.gridColumns});\n                    return response.data.gridColumns;\n                } else {\n                    NotificationService.showNotifcationDialog($translate.instant(\"error\"), $translate.instant(\"gridColumns_invalid\"));\n                    return null;\n                }\n            }, function (error) {\n                var gridColumnsFromSessionStore = SessionStorageService.get(name);\n                if (gridColumnsFromSessionStore && gridColumnsFromSessionStore.columns) {\n                    return gridColumnsFromSessionStore.columns;\n                }\n                return null;\n            });\n            return promise;\n        }\n    };\n})\n\n/* Service for uploading/downloading file */\n.service('FileService', function ($http, DHIS2URL) {\n\n    return {\n        get: function (uid) {\n            var promise = $http.get(DHIS2URL + '/fileResources/' + uid).then(function (response) {\n                return response.data;\n            } ,function(error) {\n                return null;\n            });\n            return promise;\n        },\n        download: function (fileName) {\n            var promise = $http.get(fileName).then(function (response) {\n                return response.data;\n            }, function(error) {\n                return null;\n            });\n            return promise;\n        },\n        upload: function(file){\n            var formData = new FormData();\n            formData.append('file', file);\n            var headers = {transformRequest: angular.identity, headers: {'Content-Type': undefined}};\n            var promise = $http.post(DHIS2URL + '/fileResources', formData, headers).then(function(response){\n                return response.data;\n            },function(error) {\n               return null;\n            });\n            return promise;\n        }\n    };\n})\n/* Returns a function for getting rules for a specific program */\n.factory('RulesFactory', function($q,MetaDataFactory,$filter){\n    var staticReplacements = \n                        [{regExp:new RegExp(\"([^\\w\\d])(and)([^\\w\\d])\",\"gi\"), replacement:\"$1&&$3\"},\n                        {regExp:new RegExp(\"([^\\w\\d])(or)([^\\w\\d])\",\"gi\"), replacement:\"$1||$3\"},\n                        {regExp:new RegExp(\"V{execution_date}\",\"g\"), replacement:\"V{event_date}\"}];\n\n    var performStaticReplacements = function(expression) {\n        angular.forEach(staticReplacements, function(staticReplacement) {\n            expression = expression.replace(staticReplacement.regExp, staticReplacement.replacement);\n        });\n\n        return expression;\n    };\n\n    return{        \n        loadRules : function(programUid){            \n            var def = $q.defer();            \n            MetaDataFactory.getAll('constants').then(function(constants) {\n                MetaDataFactory.getByProgram('programIndicators',programUid).then(function(pis){                    \n                    var variables = [];\n                    var programRules = [];\n                    angular.forEach(pis, function(pi){\n                        if(pi.displayInForm){\n                            var newAction = {\n                                    id:pi.id,\n                                    content:pi.displayDescription ? pi.displayDescription : pi.displayName,\n                                    data:pi.expression,\n                                    programRuleActionType:'DISPLAYKEYVALUEPAIR',\n                                    location:'indicators'\n                                };\n                            var newRule = {\n                                    displayName:pi.displayName,\n                                    id: pi.id,\n                                    shortname:pi.shortname,\n                                    code:pi.code,\n                                    program:pi.program,\n                                    description:pi.description,\n                                    condition:pi.filter ? pi.filter : 'true',\n                                    programRuleActions: [newAction]\n                                };\n\n                            programRules.push(newRule);\n\n                            var variablesInCondition = newRule.condition.match(/[A#]{\\w+.?\\w*}/g);\n                            var variablesInData = newAction.data.match(/[A#]{\\w+.?\\w*}/g);\n                            var valueCountPresent = newRule.condition.indexOf(\"V{value_count}\") >= 0 \n                                                            || newAction.data.indexOf(\"V{value_count}\") >= 0;\n                            var positiveValueCountPresent = newRule.condition.indexOf(\"V{zero_pos_value_count}\") >= 0\n                                                            || newAction.data.indexOf(\"V{zero_pos_value_count}\") >= 0;\n                            var variableObjectsCurrentExpression = [];\n\n                            var pushDirectAddressedVariable = function(variableWithCurls) {\n                                var variableName = $filter('trimvariablequalifiers')(variableWithCurls);\n                                var variableNameParts = variableName.split('.');\n\n                                var newVariableObject;\n\n                                if(variableNameParts.length === 2) {\n                                    //this is a programstage and dataelement specification. translate to program variable:\n                                    newVariableObject = {\n                                        displayName:variableName,\n                                        programRuleVariableSourceType:'DATAELEMENT_CURRENT_EVENT',\n                                        dataElement:variableNameParts[1],\n                                        program:programUid,\n                                        useCodeForOptionSet:true\n                                    };\n                                }\n                                else if(variableNameParts.length === 1)\n                                {\n                                    //This is an attribute - let us translate to program variable:\n                                    newVariableObject = {\n                                        displayName:variableName,\n                                        programRuleVariableSourceType:'TEI_ATTRIBUTE',\n                                        trackedEntityAttribute:variableNameParts[0],\n                                        program:programUid,\n                                        useCodeForOptionSet:true\n                                    };\n                                }\n                                \n                                variables.push(newVariableObject);\n\n                                return newVariableObject;\n\n                            };\n\n                            angular.forEach(variablesInCondition, function(variableInCondition) {\n                                var pushed = pushDirectAddressedVariable(variableInCondition);\n                            });\n\n                            angular.forEach(variablesInData, function(variableInData) {\n                                var pushed = pushDirectAddressedVariable(variableInData);\n\n                                //We only count the number of values in the data part of the rule\n                                //(Called expression in program indicators)\n                                variableObjectsCurrentExpression.push(pushed);\n                            });\n\n                            //Change expression or data part of the rule to match the program rules execution model\n                            if(valueCountPresent) {\n                                var valueCountText;\n                                angular.forEach(variableObjectsCurrentExpression, function(variableCurrentRule) {\n                                   if(valueCountText) {\n                                       //This is not the first value in the value count part of the expression. \n                                       valueCountText +=  ' + d2:count(\\'' + variableCurrentRule.displayName + '\\')';\n                                   }\n                                   else\n                                   {\n                                       //This is the first part value in the value count expression:\n                                       valueCountText = '(d2:count(\\'' + variableCurrentRule.displayName + '\\')';\n                                   }\n                                });\n                                //To finish the value count expression we need to close the paranthesis:\n                                valueCountText += ')';\n\n                                //Replace all occurrences of value counts in both the data and expression:\n                                newRule.condition = newRule.condition.replace(new RegExp(\"V{value_count}\", 'g'),valueCountText);\n                                newAction.data = newAction.data.replace(new RegExp(\"V{value_count}\", 'g'),valueCountText);\n                            }\n                            if(positiveValueCountPresent) {\n                                var zeroPosValueCountText;\n                                angular.forEach(variableObjectsCurrentExpression, function(variableCurrentRule) {\n                                   if(zeroPosValueCountText) {\n                                       //This is not the first value in the value count part of the expression. \n                                       zeroPosValueCountText +=  '+ d2:countifzeropos(\\'' + variableCurrentRule.displayName + '\\')';\n                                   }\n                                   else\n                                   {\n                                       //This is the first part value in the value count expression:\n                                       zeroPosValueCountText = '(d2:countifzeropos(\\'' + variableCurrentRule.displayName + '\\')';\n                                   }\n                                });\n                                //To finish the value count expression we need to close the paranthesis:\n                                zeroPosValueCountText += ')';\n\n                                //Replace all occurrences of value counts in both the data and expression:\n                                newRule.condition = newRule.condition.replace(new RegExp(\"V{zero_pos_value_count}\", 'g'),zeroPosValueCountText);\n                                newAction.data = newAction.data.replace(new RegExp(\"V{zero_pos_value_count}\", 'g'),zeroPosValueCountText);\n                            }\n\n                            newAction.data = performStaticReplacements(newAction.data);\n                            newRule.condition = performStaticReplacements(newRule.condition);\n                        }\n                    });\n\n                    var programIndicators = {rules:programRules, variables:variables};\n\n                    MetaDataFactory.getByProgram('programRuleVariables',programUid).then(function(programVariables){                    \n                        MetaDataFactory.getByProgram('programRules',programUid).then(function(prs){\n                            var programRules = [];\n                            angular.forEach(prs, function(rule){\n                                rule.actions = [];\n                                rule.programStageId = rule.programStage && rule.programStage.id ? rule.programStage.id : null;\n                                programRules.push(rule);\n                            });                                \n                            def.resolve({constants: constants, programIndicators: programIndicators, programVariables: programVariables, programRules: programRules});\n                        });\n                    });                    \n                }); \n            });                        \n            return def.promise;\n        }\n    };  \n})\n/* service for building variables based on the data in users fields */\n.service('VariableService', function(DateUtils,OptionSetService,$filter,$log){\n    var processSingleValue = function(processedValue,valueType){\n        //First clean away single or double quotation marks at the start and end of the variable name.\n        processedValue = $filter('trimquotes')(processedValue);\n\n        //Append single quotation marks in case the variable is of text or date type:\n        if(valueType === 'LONG_TEXT' || valueType === 'TEXT' || valueType === 'DATE' || valueType === 'OPTION_SET') {\n            if(processedValue) {\n                processedValue = \"'\" + processedValue + \"'\";\n            } else {\n                processedValue = \"''\";\n            }\n        }\n        else if(valueType === 'BOOLEAN' || valueType === 'TRUE_ONLY') {\n            if(processedValue === \"Yes\") {\n            processedValue = true;\n            }\n            else if(processedValue === \"No\") {\n                processedValue = false;\n            }\n            else if(processedValue && eval(processedValue)) {\n                processedValue = true;\n            }\n            else {\n                processedValue = false;\n            }\n        }\n        else if( valueType === \"INTEGER\" || valueType === \"NUMBER\" || valueType === \"INTEGER_POSITIVE\"\n             ||  valueType === \"INTEGER_NEGATIVE\" || valueType === \"INTEGER_ZERO_OR_POSITIVE\" ||\n                 valueType === \"PERCENTAGE\") {\n            if(processedValue) {\n                processedValue = Number(processedValue);\n            } else {\n                processedValue = 0;\n            }\n        }\n        else{\n            $log.warn(\"unknown datatype:\" + valueType);\n        }\n\n        return processedValue;\n    };\n\n    var pushVariable = function(variables, variablename, varValue, allValues, varType, variablefound, variablePrefix, variableEventDate, useCodeForOptionSet) {\n\n        var processedValues = [];\n\n        angular.forEach(allValues, function(alternateValue) {\n            processedValues.push(processSingleValue(alternateValue,varType));\n        });\n\n        variables[variablename] = {\n            variableValue:processSingleValue(varValue, varType),\n            useCodeForOptionSet:useCodeForOptionSet,\n            variableType:varType,\n            hasValue:variablefound,\n            variableEventDate:variableEventDate,\n            variablePrefix:variablePrefix,\n            allValues:processedValues\n        };\n        return variables;\n    };\n    \n    var getDataElementValueOrCodeForValueInternal = function(useCodeForOptionSet, value, dataElementId, allDes, optionSets) {\n        return useCodeForOptionSet && allDes && allDes[dataElementId].dataElement.optionSet ? \n                                            OptionSetService.getCode(optionSets[allDes[dataElementId].dataElement.optionSet.id].options, value)\n                                            : value;\n    };\n    \n    var geTrackedEntityAttributeValueOrCodeForValueInternal = function(useCodeForOptionSet, value, trackedEntityAttributeId, allTeis, optionSets) {\n        return useCodeForOptionSet && allTeis && allTeis[trackedEntityAttributeId].optionSet ? \n                                            OptionSetService.getCode(optionSets[allTeis[trackedEntityAttributeId].optionSet.id].options, value)\n                                            : value;\n    };\n\n    return {\n        processValue: function(value, type) {\n            return processSingleValue(value,type);\n        },\n        getDataElementValueOrCode: function(useCodeForOptionSet, event, dataElementId, allDes, optionSets) {\n            return getDataElementValueOrCodeForValueInternal(useCodeForOptionSet, event[dataElementId], dataElementId, allDes, optionSets);\n        },\n        getDataElementValueOrCodeForValue: function(useCodeForOptionSet, value, dataElementId, allDes, optionSets) {\n            return getDataElementValueOrCodeForValueInternal(useCodeForOptionSet, value, dataElementId, allDes, optionSets);\n        },\n        getTrackedEntityValueOrCodeForValue: function(useCodeForOptionSet, value, trackedEntityAttributeId, allTeis, optionSets) {\n            return geTrackedEntityAttributeValueOrCodeForValueInternal(useCodeForOptionSet, value, trackedEntityAttributeId, allTeis, optionSets);\n        },\n        getVariables: function(allProgramRules, executingEvent, evs, allDes, allTeis, selectedEntity, selectedEnrollment, optionSets) {\n\n            var variables = {};\n\n            var programVariables = allProgramRules.programVariables;\n\n            programVariables = programVariables.concat(allProgramRules.programIndicators.variables);\n\n            angular.forEach(programVariables, function(programVariable) {\n                var dataElementId = programVariable.dataElement;\n                if(programVariable.dataElement && programVariable.dataElement.id) {\n                    dataElementId = programVariable.dataElement.id;\n                }\n\n                var trackedEntityAttributeId = programVariable.trackedEntityAttribute;\n                if(programVariable.trackedEntityAttribute && programVariable.trackedEntityAttribute.id) {\n                    trackedEntityAttributeId = programVariable.trackedEntityAttribute.id;\n                }\n\n                var programStageId = programVariable.programStage;\n                if(programVariable.programStage && programVariable.programStage.id) {\n                    programStageId = programVariable.programStage.id;\n                }\n\n                var valueFound = false;\n                //If variable evs is not defined, it means the rules is run before any events is registered, skip the types that require an event\n                if(programVariable.programRuleVariableSourceType === \"DATAELEMENT_NEWEST_EVENT_PROGRAM_STAGE\" && evs && evs.byStage){\n                    if(programStageId) {\n                        var allValues = [];\n                        angular.forEach(evs.byStage[programStageId], function(event) {\n                            if(event[dataElementId] !== null) {\n                                if(angular.isDefined(event[dataElementId])\n                                        && event[dataElementId] !== \"\"){\n                                    var value = getDataElementValueOrCodeForValueInternal(programVariable.useCodeForOptionSet, event[dataElementId], dataElementId, allDes, optionSets);\n                                            \n                                    allValues.push(value);\n                                    valueFound = true;\n                                    variables = pushVariable(variables, programVariable.displayName, value, allValues, allDes[dataElementId].dataElement.valueType, valueFound, '#', event.eventDate, programVariable.useCodeForOptionSet);\n                                }\n                            }\n                        });\n                    } else {\n                        $log.warn(\"Variable id:'\" + programVariable.id + \"' name:'\" + programVariable.displayName\n                            + \"' does not have a programstage defined,\"\n                            + \" despite that the variable has sourcetype DATAELEMENT_NEWEST_EVENT_PROGRAM_STAGE\" );\n                    }\n                }\n                else if(programVariable.programRuleVariableSourceType === \"DATAELEMENT_NEWEST_EVENT_PROGRAM\" && evs){\n                    var allValues = [];\n                    angular.forEach(evs.all, function(event) {\n                        if(angular.isDefined(event[dataElementId])\n                            && event[dataElementId] !== null \n                            && event[dataElementId] !== \"\"){\n                            var value = getDataElementValueOrCodeForValueInternal(programVariable.useCodeForOptionSet, event[dataElementId], dataElementId, allDes, optionSets);\n                                    \n                            allValues.push(value);\n                            valueFound = true;\n                            variables = pushVariable(variables, programVariable.displayName, value, allValues, allDes[dataElementId].dataElement.valueType, valueFound, '#', event.eventDate, programVariable.useCodeForOptionSet);\n                        }\n                    });\n                }\n                else if(programVariable.programRuleVariableSourceType === \"DATAELEMENT_CURRENT_EVENT\" && evs){\n                    if(angular.isDefined(executingEvent[dataElementId])\n                        && executingEvent[dataElementId] !== null \n                        && executingEvent[dataElementId] !== \"\"){\n                        var value = getDataElementValueOrCodeForValueInternal(programVariable.useCodeForOptionSet, executingEvent[dataElementId], dataElementId, allDes, optionSets);\n                            \n                        valueFound = true;\n                        variables = pushVariable(variables, programVariable.displayName, value, null, allDes[dataElementId].dataElement.valueType, valueFound, '#', executingEvent.eventDate, programVariable.useCodeForOptionSet );\n                    }\n                }\n                else if(programVariable.programRuleVariableSourceType === \"DATAELEMENT_PREVIOUS_EVENT\" && evs){\n                    //Only continue checking for a value if there is more than one event.\n                    if(evs.all && evs.all.length > 1) {\n                        var allValues = [];\n                        var previousvalue = null;\n                        var previousEventDate = null;\n                        var currentEventPassed = false;\n                        for(var i = 0; i < evs.all.length; i++) {\n                            //Store the values as we iterate through the stages\n                            //If the event[i] is not the current event, it is older(previous). Store the previous value if it exists\n                            if(!currentEventPassed && evs.all[i] !== executingEvent &&\n                                angular.isDefined(evs.all[i][dataElementId])\n                                && evs.all[i][dataElementId] !== \"\") {\n                                previousvalue = getDataElementValueOrCodeForValueInternal(programVariable.useCodeForOptionSet, evs.all[i][dataElementId], dataElementId, allDes, optionSets);\n                                previousEventDate = evs.all[i].eventDate;\n                                allValues.push(value);\n                                valueFound = true;\n                            }\n                            else if(evs.all[i] === executingEvent) {\n                                //We have iterated to the newest event - store the last collected variable value - if any is found:\n                                if(valueFound) {\n                                    variables = pushVariable(variables, programVariable.displayName, previousvalue, allValues, allDes[dataElementId].dataElement.valueType, valueFound, '#', previousEventDate, programVariable.useCodeForOptionSet);\n                                }\n                                //Set currentEventPassed, ending the iteration:\n                                currentEventPassed = true;\n                            }\n                        }\n                    }\n                }\n                else if(programVariable.programRuleVariableSourceType === \"TEI_ATTRIBUTE\"){\n                    angular.forEach(selectedEntity.attributes , function(attribute) {\n                        if(!valueFound) {\n                            if(attribute.attribute === trackedEntityAttributeId\n                                    && angular.isDefined(attribute.value)\n                                    && attribute.value !== null\n                                    && attribute.value !== \"\") {\n                                valueFound = true;\n                                //In registration, the attribute type is found in .type, while in data entry the same data is found in .valueType.\n                                //Handling here, but planning refactor in registration so it will always be .valueType\n                                variables = pushVariable(variables, \n                                    programVariable.displayName, \n                                    geTrackedEntityAttributeValueOrCodeForValueInternal(programVariable.useCodeForOptionSet,attribute.value, trackedEntityAttributeId, allTeis, optionSets),\n                                    null, \n                                    attribute.type ? attribute.type : attribute.valueType, valueFound, \n                                    'A', \n                                    '',\n                                    programVariable.useCodeForOptionSet);\n                            }\n                        }\n                    });\n                }\n                else if(programVariable.programRuleVariableSourceType === \"CALCULATED_VALUE\"){\n                    //We won't assign the calculated variables at this step. The rules execution will calculate and assign the variable.\n                }\n                else {\n                    //If the rules was executed without events, we ended up in this else clause as expected, as most of the variables require an event to be mapped\n                    if(evs)\n                    {\n                        //If the rules was executed and events was supplied, we should have found an if clause for the the source type, and not ended up in this dead end else.\n                        $log.warn(\"Unknown programRuleVariableSourceType:\" + programVariable.programRuleVariableSourceType);\n                    }\n                }\n\n\n                if(!valueFound){\n                    //If there is still no value found, assign default value:\n                    if(dataElementId && allDes) {\n                        var dataElement = allDes[dataElementId];\n                        if( dataElement ) {\n                            variables = pushVariable(variables, programVariable.displayName, \"\", null, dataElement.dataElement.valueType, false, '#', '', programVariable.useCodeForOptionSet );\n                        }\n                        else {\n                            $log.warn(\"Variable #{\" + programVariable.displayName + \"} is linked to a dataelement that is not part of the program\");\n                            variables = pushVariable(variables, programVariable.displayName, \"\", null, \"TEXT\",false, '#', '', programVariable.useCodeForOptionSet );\n                        }\n                    }\n                    else if (programVariable.trackedEntityAttribute) {\n                        //The variable is an attribute, set correct prefix and a blank value\n                        variables = pushVariable(variables, programVariable.displayName, \"\", null, \"TEXT\",false, 'A', '', programVariable.useCodeForOptionSet );\n                    }\n                    else {\n                        //Fallback for calculated(assigned) values:\n                        variables = pushVariable(variables, programVariable.displayName, \"\", null, \"TEXT\",false, '#', '', programVariable.useCodeForOptionSet );\n                    }\n                }\n            });\n\n            //add context variables:\n            //last parameter \"valuefound\" is always true for event date\n            variables = pushVariable(variables, 'current_date', DateUtils.getToday(), null, 'DATE', true, 'V', '', false );\n\n            variables = pushVariable(variables, 'event_date', executingEvent.eventDate, null, 'DATE', true, 'V', '', false );\n            variables = pushVariable(variables, 'due_date', executingEvent.dueDate, null, 'DATE', true, 'V', '' );\n            variables = pushVariable(variables, 'event_count', evs ? evs.all.length : 0, null, 'INTEGER', true, 'V', '', false );\n\n            variables = pushVariable(variables, 'enrollment_date', selectedEnrollment ? selectedEnrollment.enrollmentDate : '', null, 'DATE', selectedEnrollment ? true : false, 'V', '', false );\n            variables = pushVariable(variables, 'enrollment_id', selectedEnrollment ? selectedEnrollment.enrollment : '', null, 'TEXT',  selectedEnrollment ? true : false, 'V', '', false );\n            variables = pushVariable(variables, 'event_id', executingEvent ? executingEvent.event : '', null, 'TEXT',  executingEvent ? true : false, 'V', executingEvent ? executingEvent.eventDate : false, false);\n\n            variables = pushVariable(variables, 'incident_date', selectedEnrollment ? selectedEnrollment.incidentDate : '', null, 'DATE',  selectedEnrollment ? true : false, 'V', '', false);\n            variables = pushVariable(variables, 'enrollment_count', selectedEnrollment ? 1 : 0, null, 'INTEGER', true, 'V', '', false);\n            variables = pushVariable(variables, 'tei_count', selectedEnrollment ? 1 : 0, null, 'INTEGER', true, 'V', '', false);\n\n            //Push all constant values:\n            angular.forEach(allProgramRules.constants, function(constant){\n                variables = pushVariable(variables, constant.id, constant.value, null, 'INTEGER', true, 'C', '', false);\n            });\n\n            return variables;\n        }\n    };\n})\n\n/* service for executing tracker rules and broadcasting results */\n.service('TrackerRulesExecutionService', function($translate, VariableService, DateUtils, NotificationService, DHIS2EventFactory, RulesFactory, CalendarService, OptionSetService, $rootScope, $q, $log, $filter, orderByFilter){\n    var NUMBER_OF_EVENTS_IN_SCOPE = 10;\n\n    //Variables for storing scope and rules in memory from rules execution to rules execution:\n    var allProgramRules = false; \n    var crossEventRulesExist = false;\n    var lastEventId = null;\n    var lastEventDate = null;\n    var lastProgramId = null;\n    var eventScopeExceptCurrent = false;\n\n    var replaceVariables = function(expression, variablesHash){\n        //replaces the variables in an expression with actual variable values.\n\n        //Check if the expression contains program rule variables at all(any curly braces):\n        if(expression.indexOf('{') !== -1) {\n            //Find every variable name in the expression;\n            var variablespresent = expression.match(/[A#CV]\\{[\\w -_.]+}/g);\n            //Replace each matched variable:\n            angular.forEach(variablespresent, function(variablepresent) {\n                //First strip away any prefix and postfix signs from the variable name:\n                variablepresent = variablepresent.replace(\"#{\",\"\").replace(\"A{\",\"\").replace(\"C{\",\"\").replace(\"V{\",\"\").replace(\"}\",\"\");\n\n                if(angular.isDefined(variablesHash[variablepresent])) {\n                    //Replace all occurrences of the variable name(hence using regex replacement):\n                    expression = expression.replace(new RegExp( variablesHash[variablepresent].variablePrefix + \"\\\\{\" + variablepresent + \"\\\\}\", 'g'),\n                        variablesHash[variablepresent].variableValue);\n                }\n                else {\n                    $log.warn(\"Expression \" + expression + \" contains variable \" + variablepresent\n                        + \" - but this variable is not defined.\" );\n                }\n            });\n        }\n\n        //Check if the expression contains environment  variables\n        if(expression.indexOf('V{') !== -1) {\n            //Find every variable name in the expression;\n            var variablespresent = expression.match(/V{\\w+.?\\w*}/g);\n            //Replace each matched variable:\n            angular.forEach(variablespresent, function(variablepresent) {\n                //First strip away any prefix and postfix signs from the variable name:\n                variablepresent = variablepresent.replace(\"V{\",\"\").replace(\"}\",\"\");\n\n                if(angular.isDefined(variablesHash[variablepresent]) &&\n                    variablesHash[variablepresent].variablePrefix === 'V') {\n                    //Replace all occurrences of the variable name(hence using regex replacement):\n                    expression = expression.replace(new RegExp(\"V{\" + variablepresent + \"}\", 'g'),\n                        variablesHash[variablepresent].variableValue);\n                }\n                else {\n                    $log.warn(\"Expression \" + expression + \" conains context variable \" + variablepresent\n                        + \" - but this variable is not defined.\" );\n                }\n            });\n        }\n\n        //Check if the expression contains attribute variables:\n        if(expression.indexOf('A{') !== -1) {\n            //Find every attribute in the expression;\n            var variablespresent = expression.match(/A{\\w+.?\\w*}/g);\n            //Replace each matched variable:\n            angular.forEach(variablespresent, function(variablepresent) {\n                //First strip away any prefix and postfix signs from the variable name:\n                variablepresent = variablepresent.replace(\"A{\",\"\").replace(\"}\",\"\");\n\n                if(angular.isDefined(variablesHash[variablepresent]) &&\n                    variablesHash[variablepresent].variablePrefix === 'A') {\n                    //Replace all occurrences of the variable name(hence using regex replacement):\n                    expression = expression.replace(new RegExp(\"A{\" + variablepresent + \"}\", 'g'),\n                        variablesHash[variablepresent].variableValue);\n                }\n                else {\n                    $log.warn(\"Expression \" + expression + \" conains attribute \" + variablepresent\n                        + \" - but this attribute is not defined.\" );\n                }\n            });\n        }\n\n        //Check if the expression contains constants\n        if(expression.indexOf('C{') !== -1) {\n            //Find every constant in the expression;\n            var variablespresent = expression.match(/C{\\w+.?\\w*}/g);\n            //Replace each matched variable:\n            angular.forEach(variablespresent, function(variablepresent) {\n                //First strip away any prefix and postfix signs from the variable name:\n                variablepresent = variablepresent.replace(\"C{\",\"\").replace(\"}\",\"\");\n\n                if(angular.isDefined(variablesHash[variablepresent]) &&\n                    variablesHash[variablepresent].variablePrefix === 'C') {\n                    //Replace all occurrences of the variable name(hence using regex replacement):\n                    expression = expression.replace(new RegExp(\"C{\" + variablepresent + \"}\", 'g'),\n                        variablesHash[variablepresent].variableValue);\n                }\n                else {\n                    $log.warn(\"Expression \" + expression + \" conains constant \" + variablepresent\n                        + \" - but this constant is not defined.\" );\n                }\n            });\n        }\n\n        return expression;\n    };\n\n    var runDhisFunctions = function(expression, variablesHash, flag){\n        //Called from \"runExpression\". Only proceed with this logic in case there seems to be dhis function calls: \"d2:\" is present.\n        if(angular.isDefined(expression) && expression.indexOf(\"d2:\") !== -1){\n            var dhisFunctions = [{name:\"d2:daysBetween\",parameters:2},\n                {name:\"d2:weeksBetween\",parameters:2},\n                {name:\"d2:monthsBetween\",parameters:2},\n                {name:\"d2:yearsBetween\",parameters:2},\n                {name:\"d2:floor\",parameters:1},\n                {name:\"d2:modulus\",parameters:2},\n                {name:\"d2:concatenate\"},\n                {name:\"d2:addDays\",parameters:2},\n                {name:\"d2:zing\",parameters:1},\n                {name:\"d2:oizp\",parameters:1},\n                {name:\"d2:count\",parameters:1},\n                {name:\"d2:countIfZeroPos\",parameters:1},\n                {name:\"d2:countIfValue\",parameters:2},\n                {name:\"d2:ceil\",parameters:1},\n                {name:\"d2:round\",parameters:1},\n                {name:\"d2:hasValue\",parameters:1},\n                {name:\"d2:lastEventDate\",parameters:1},\n                {name:\"d2:validatePattern\",parameters:2},\n                {name:\"d2:addControlDigits\",parameters:1},\n                {name:\"d2:checkControlDigits\",parameters:1},\n                {name:\"d2:left\",parameters:2},\n                {name:\"d2:right\",parameters:2},\n                {name:\"d2:substring\",parameters:3},\n                {name:\"d2:split\",parameters:3},\n                {name:\"d2:length\",parameters:1}];\n            var continueLooping = true;\n            //Safety harness on 10 loops, in case of unanticipated syntax causing unintencontinued looping\n            for(var i = 0; i < 10 && continueLooping; i++ ) {\n                var expressionUpdated = false;\n                var brokenExecution = false;\n                angular.forEach(dhisFunctions, function(dhisFunction){\n                    //Select the function call, with any number of parameters inside single quotations, or number parameters witout quotations\n                    var regularExFunctionCall = new RegExp(dhisFunction.name + \"\\\\( *(([\\\\d/\\\\*\\\\+\\\\-%\\.]+)|( *'[^']*'))*( *, *(([\\\\d/\\\\*\\\\+\\\\-%\\.]+)|'[^']*'))* *\\\\)\",'g');\n                    var callsToThisFunction = expression.match(regularExFunctionCall);\n                    angular.forEach(callsToThisFunction, function(callToThisFunction){\n                        //Remove the function name and paranthesis:\n                        var justparameters = callToThisFunction.replace(/(^[^\\(]+\\()|\\)$/g,\"\");\n                        //Remove white spaces before and after parameters:\n                        justparameters = justparameters.trim();\n                        //Then split into single parameters:\n                        var parameters = justparameters.match(/(('[^']+')|([^,]+))/g);\n\n                        //Show error if no parameters is given and the function requires parameters,\n                        //or if the number of parameters is wrong.\n                        if(angular.isDefined(dhisFunction.parameters)){\n                            //But we are only checking parameters where the dhisFunction actually has a defined set of parameters(concatenate, for example, does not have a fixed number);\n                            var numParameters = parameters ? parameters.length : 0;\n                            \n                            if(numParameters !== dhisFunction.parameters){\n                                $log.warn(dhisFunction.name + \" was called with the incorrect number of parameters\");\n                                \n                                //Mark this function call as broken:\n                                brokenExecution = true;\n                            }\n                        }\n\n                        //In case the function call is nested, the parameter itself contains an expression, run the expression.\n                        if(!brokenExecution && angular.isDefined(parameters) && parameters !== null) {\n                            for (var i = 0; i < parameters.length; i++) {\n                                parameters[i] = runExpression(parameters[i],dhisFunction.name,\"parameter:\" + i, flag, variablesHash);\n                            }\n                        }\n\n                        //Special block for d2:weeksBetween(*,*) - add such a block for all other dhis functions.\n                        if(brokenExecution) {\n                            //Function call is not possible to evaluate, remove the call:\n                            expression = expression.replace(callToThisFunction, \"false\");\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:daysBetween\") {\n                            var firstdate = $filter('trimquotes')(parameters[0]);\n                            var seconddate = $filter('trimquotes')(parameters[1]);\n                            firstdate = moment(firstdate);\n                            seconddate = moment(seconddate);\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, seconddate.diff(firstdate,'days'));\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:weeksBetween\") {\n                            var firstdate = $filter('trimquotes')(parameters[0]);\n                            var seconddate = $filter('trimquotes')(parameters[1]);\n                            firstdate = moment(firstdate);\n                            seconddate = moment(seconddate);\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, seconddate.diff(firstdate,'weeks'));\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:monthsBetween\") {\n                            var firstdate = $filter('trimquotes')(parameters[0]);\n                            var seconddate = $filter('trimquotes')(parameters[1]);\n                            firstdate = moment(firstdate);\n                            seconddate = moment(seconddate);\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, seconddate.diff(firstdate,'months'));\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:yearsBetween\") {\n                            var firstdate = $filter('trimquotes')(parameters[0]);\n                            var seconddate = $filter('trimquotes')(parameters[1]);\n                            firstdate = moment(firstdate);\n                            seconddate = moment(seconddate);\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, seconddate.diff(firstdate,'years'));\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:floor\") {\n                            var floored = Math.floor(parameters[0]);\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, floored);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:modulus\") {\n                            var dividend = Number(parameters[0]);\n                            var divisor = Number(parameters[1]);\n                            var rest = dividend % divisor;\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, rest);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:concatenate\") {\n                            var returnString = \"'\";\n                            for (var i = 0; i < parameters.length; i++) {\n                                returnString += parameters[i];\n                            }\n                            returnString += \"'\";\n                            expression = expression.replace(callToThisFunction, returnString);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:addDays\") {\n                            var date = $filter('trimquotes')(parameters[0]);\n                            var daystoadd = $filter('trimquotes')(parameters[1]);\n                            var newdate = DateUtils.format( moment(date, CalendarService.getSetting().momentFormat).add(daystoadd, 'days') );\n                            var newdatestring = \"'\" + newdate + \"'\";\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, newdatestring);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:zing\") {\n                            var number = parameters[0];\n                            if( number < 0 ) {\n                                number = 0;\n                            }\n\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, number);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:oizp\") {\n                            var number = parameters[0];\n                            var output = 1;\n                            if( number < 0 ) {\n                                output = 0;\n                            }\n\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, output);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:count\") {\n                            var variableName = parameters[0];\n                            var variableObject = variablesHash[variableName];\n                            var count = 0;\n                            if(variableObject)\n                            {\n                                if(variableObject.hasValue){\n                                    if(variableObject.allValues)\n                                    {\n                                        count = variableObject.allValues.length;\n                                    } else {\n                                        //If there is a value found for the variable, the count is 1 even if there is no list of alternate values\n                                        //This happens for variables of \"DATAELEMENT_CURRENT_STAGE\" and \"TEI_ATTRIBUTE\"\n                                        count = 1;\n                                    }\n                                }\n                            }\n                            else\n                            {\n                                $log.warn(\"could not find variable to count: \" + variableName);\n                            }\n\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, count);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:countIfZeroPos\") {\n                            var variableName = $filter('trimvariablequalifiers') (parameters[0]);\n                            var variableObject = variablesHash[variableName];\n\n                            var count = 0;\n                            if(variableObject)\n                            {\n                                if( variableObject.hasValue ) {\n                                    if(variableObject.allValues && variableObject.allValues.length > 0)\n                                    {\n                                        for(var i = 0; i < variableObject.allValues.length; i++)\n                                        {\n                                            if(variableObject.allValues[i] >= 0) {\n                                                count++;\n                                            }\n                                        }\n                                    }\n                                    else {\n                                        //The variable has a value, but no list of alternates. This means we only compare the elements real value\n                                        if(variableObject.variableValue >= 0) {\n                                            count = 1;\n                                        }\n                                    }\n                                }\n                            }\n                            else\n                            {\n                                $log.warn(\"could not find variable to countifzeropos: \" + variableName);\n                            }\n\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, count);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:countIfValue\") {\n                            var variableName = parameters[0];\n                            var variableObject = variablesHash[variableName];\n\n                            var valueToCompare = VariableService.processValue(parameters[1],variableObject.variableType);\n\n                            var count = 0;\n                            if(variableObject)\n                            {\n                                if( variableObject.hasValue )\n                                {\n                                    if( variableObject.allValues )\n                                    {\n                                        for(var i = 0; i < variableObject.allValues.length; i++)\n                                        {\n                                            if(valueToCompare === variableObject.allValues[i]) {\n                                                count++;\n                                            }\n                                        }\n                                    } else {\n                                        //The variable has a value, but no list of alternates. This means we compare the standard variablevalue\n                                        if(valueToCompare === variableObject.variableValue) {\n                                            count = 1;\n                                        }\n                                    }\n\n                                }\n                            }\n                            else\n                            {\n                                $log.warn(\"could not find variable to countifvalue: \" + variableName);\n                            }\n\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, count);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:ceil\") {\n                            var ceiled = Math.ceil(parameters[0]);\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, ceiled);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:round\") {\n                            var rounded = Math.round(parameters[0]);\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, rounded);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:hasValue\") {\n                            var variableName = parameters[0];\n                            var variableObject = variablesHash[variableName];\n                            var valueFound = false;\n                            if(variableObject)\n                            {\n                                if(variableObject.hasValue){\n                                    valueFound = true;\n                                }\n                            }\n                            else\n                            {\n                                $log.warn(\"could not find variable to check if has value: \" + variableName);\n                            }\n\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, valueFound);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:lastEventDate\") {\n                            var variableName = parameters[0];\n                            var variableObject = variablesHash[variableName];\n                            var valueFound = \"''\";\n                            if(variableObject)\n                            {\n                                if(variableObject.variableEventDate){\n                                    valueFound = VariableService.processValue(variableObject.variableEventDate, 'DATE');\n                                }\n                                else {\n                                    $log.warn(\"no last event date found for variable: \" + variableName);\n                                }\n                            }\n                            else\n                            {\n                                $log.warn(\"could not find variable to check last event date: \" + variableName);\n                            }\n\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, valueFound);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:validatePattern\") {\n                            var inputToValidate = parameters[0].toString();\n                            var pattern = parameters[1];\n                            var regEx = new RegExp(pattern,'g');\n                            var match = inputToValidate.match(regEx);\n                            \n                            var matchFound = false;\n                            if(match !== null && inputToValidate === match[0]) {\n                                matchFound = true;\n                            }\n\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, matchFound);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:addControlDigits\") {\n\n                            var baseNumber = parameters[0];\n                            var baseDigits = baseNumber.split('');\n                            var error = false;\n\n                            var firstDigit = 0;\n                            var secondDigit = 0;\n\n                            if(baseDigits && baseDigits.length < 10 ) {\n                                var firstSum = 0;\n                                var baseNumberLength = baseDigits.length;\n                                //weights support up to 9 base digits:\n                                var firstWeights = [3,7,6,1,8,9,4,5,2];\n                                for(var i = 0; i < baseNumberLength && !error; i++) {\n                                    firstSum += parseInt(baseDigits[i]) * firstWeights[i];\n                                }\n                                firstDigit = firstSum % 11;\n\n                                //Push the first digit to the array before continuing, as the second digit is a result of the\n                                //base digits and the first control digit.\n                                baseDigits.push(firstDigit);\n                                //Weights support up to 9 base digits plus first control digit:\n                                var secondWeights = [5,4,3,2,7,6,5,4,3,2];\n                                var secondSum = 0;\n                                for(var i = 0; i < baseNumberLength + 1 && !error; i++) {\n                                    secondSum += parseInt(baseDigits[i]) * secondWeights[i];\n                                }\n                                secondDigit = secondSum % 11;\n\n                                if(firstDigit === 10) {\n                                    $log.warn(\"First control digit became 10, replacing with 0\");\n                                    firstDigit = 0;\n                                }\n                                if(secondDigit === 10) {\n                                    $log.warn(\"Second control digit became 10, replacing with 0\");\n                                    secondDigit = 0;\n                                }\n                            }\n                            else\n                            {\n                                $log.warn(\"Base nuber not well formed(\" + baseNumberLength + \" digits): \" + baseNumber);\n                            }\n\n                            if(!error) {\n                                //Replace the end evaluation of the dhis function:\n                                expression = expression.replace(callToThisFunction, baseNumber + firstDigit + secondDigit);\n                                expressionUpdated = true;\n                            }\n                            else\n                            {\n                                //Replace the end evaluation of the dhis function:\n                                expression = expression.replace(callToThisFunction, baseNumber);\n                                expressionUpdated = true;\n                            }\n                        }\n                        else if(dhisFunction.name === \"d2:checkControlDigits\") {\n                            $log.warn(\"checkControlDigits not implemented yet\");\n\n                            //Replace the end evaluation of the dhis function:\n                            expression = expression.replace(callToThisFunction, parameters[0]);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:left\") {\n                            var string = String(parameters[0]);\n                            var numChars = string.length < parameters[1] ? string.length : parameters[1];\n                            var returnString =  string.substring(0,numChars);\n                            returnString = VariableService.processValue(returnString, 'TEXT');\n                            expression = expression.replace(callToThisFunction, returnString);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:right\") {\n                            var string = String(parameters[0]);\n                            var numChars = string.length < parameters[1] ? string.length : parameters[1];\n                            var returnString =  string.substring(string.length - numChars, string.length);\n                            returnString = VariableService.processValue(returnString, 'TEXT');\n                            expression = expression.replace(callToThisFunction, returnString);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:substring\") {\n                            var string = String(parameters[0]);\n                            var startChar = string.length < parameters[1] - 1 ? -1 : parameters[1];\n                            var endChar = string.length < parameters[2] ? -1 : parameters[2];\n                            if(startChar < 0 || endChar < 0) {\n                                expression = expression.replace(callToThisFunction, \"''\");\n                                expressionUpdated = true;\n                            } else {\n                                var returnString =  string.substring(startChar, endChar);\n                                returnString = VariableService.processValue(returnString, 'TEXT');\n                                expression = expression.replace(callToThisFunction, returnString);\n                                expressionUpdated = true;\n                            }\n                        }\n                        else if(dhisFunction.name === \"d2:split\") {\n                            var string = String(parameters[0]);\n                            var splitArray = string.split(parameters[1]);\n                            var returnPart = \"\";\n                            if (splitArray.length >= parameters[2]) {\n                                returnPart = splitArray[parameters[2]];\n                            }\n                            returnPart = VariableService.processValue(returnPart, 'TEXT');\n                            expression = expression.replace(callToThisFunction, returnPart);\n                            expressionUpdated = true;\n                        }\n                        else if(dhisFunction.name === \"d2:length\") {\n                            expression = expression.replace(callToThisFunction, String(parameters[0]).length);\n                            expressionUpdated = true;\n                        }\n                    });\n                });\n\n                //We only want to continue looping until we made a successful replacement,\n                //and there is still occurrences of \"d2:\" in the code. In cases where d2: occur outside\n                //the expected d2: function calls, one unneccesary iteration will be done and the\n                //successfulExecution will be false coming back here, ending the loop. The last iteration\n                //should be zero to marginal performancewise.\n                if(expressionUpdated && expression.indexOf(\"d2:\") !== -1) {\n                    continueLooping = true;\n                } else {\n                    continueLooping = false;\n                }\n            }\n        }\n\n        return expression;\n    };\n\n    var runExpression = function(expression, beforereplacement, identifier, flag, variablesHash ){\n        //determine if expression is true, and actions should be effectuated\n        //If DEBUG mode, use try catch and report errors. If not, omit the heavy try-catch loop.:\n        var answer = false;\n        if(flag && flag.debug) {\n            try{\n\n                var dhisfunctionsevaluated = runDhisFunctions(expression, variablesHash, flag);\n                answer = eval(dhisfunctionsevaluated);\n\n                if(flag.verbose)\n                {\n                    $log.info(\"Expression with id \" + identifier + \" was successfully run. Original condition was: \" + beforereplacement + \" - Evaluation ended up as:\" + expression + \" - Result of evaluation was:\" + answer);\n                }\n            }\n            catch(e)\n            {\n                $log.warn(\"Expression with id \" + identifier + \" could not be run. Original condition was: \" + beforereplacement + \" - Evaluation ended up as:\" + expression + \" - error message:\" + e);\n            }\n        }\n        else {\n            //Just run the expression. This is much faster than the debug route: http://jsperf.com/try-catch-block-loop-performance-comparison\n            var dhisfunctionsevaluated = runDhisFunctions(expression, variablesHash, flag);\n            answer = eval(dhisfunctionsevaluated);\n        }\n        return answer;\n    };\n\n    var determineValueType = function(value) {\n        var valueType = 'TEXT';\n        if(value === 'true' || value === 'false') {\n            valueType = 'BOOLEAN';\n        }\n        else if(angular.isNumber(value) || !isNaN(value)) {\n            if(value % 1 !== 0) {\n                valueType = 'NUMBER';\n            }\n            else {\n                valueType = 'INTEGER';\n            }\n        }\n        return valueType;\n    };\n\n    var performCreateEventAction = function(effect, selectedEntity, selectedEnrollment, currentEvents,executingEvent, programStage){\n        var valArray = [];\n        if(effect.data) {\n            valArray = effect.data.split(',');\n            var newEventDataValues = [];\n            var idList = {active:false};\n\n            angular.forEach(valArray, function(value) {\n                var valParts = value.split(':');                \n                if(valParts && valParts.length >= 1) {\n                    var valId = valParts[0];\n\n                    //Check wether one or more fields is marked as the id to use for comparison purposes:\n                    if(valId.trim().substring(0, 4) === \"[id]\") {\n                        valId = valId.substring(4,valId.length);\n                        idList[valId] = true;\n                        idList.active = true;\n                    }\n\n                    var valVal = \"\";\n                    if(valParts.length > 1) {\n                        valVal = valParts[1];\n                    }\n                    var valueType = determineValueType(valVal);\n\n                    var processedValue = VariableService.processValue(valVal, valueType);\n                    processedValue = $filter('trimquotes')(processedValue);\n                    newEventDataValues.push({dataElement:valId,value:processedValue});\n                    newEventDataValues[valId] = processedValue;\n                }\n            });\n\n            var valuesAlreadyExists = false;\n            angular.forEach(currentEvents, function(currentEvent) {\n                var misMatch = false;\n                angular.forEach(newEventDataValues, function(value) {\n                    var valueFound = false;\n                    angular.forEach(currentEvent.dataValues, function(currentDataValue) {\n                        //Only count as mismatch if there is no particular ID to use, or the current field is part of the same ID\n                        if(!idList.active || idList[currentDataValue.dataElement]){\n                            if(currentDataValue.dataElement === value.dataElement) {\n                                valueFound = true;\n                                //Truthy comparison is needed to avoid false negatives for differing variable types:\n                                if( currentDataValue.value != newEventDataValues[value.dataElement] ) {\n                                    misMatch = true;\n                                }\n                            }\n                        }\n                    });\n                    //Also treat no value found as a mismatch, but when ID fields is set, only concider ID fields\n                    if((!idList.active || idList[value.dataElement] ) && !valueFound) {\n                        misMatch = true;\n                    }\n                });\n                if(!misMatch) {\n                    //if no mismatches on this point, the exact same event already exists, and we dont create it.\n                    valuesAlreadyExists = true;\n                }\n            });\n\n            if(!valuesAlreadyExists) {\n                var eventDate = DateUtils.getToday();\n                var dueDate = DateUtils.getToday();\n\n                var newEvent = {\n                    trackedEntityInstance: selectedEnrollment.trackedEntityInstance,\n                    program: selectedEnrollment.program,\n                    programStage: effect.programStage.id,\n                    enrollment: selectedEnrollment.enrollment,\n                    orgUnit: selectedEnrollment.orgUnit,\n                    dueDate: dueDate,\n                    eventDate: eventDate,\n                    notes: [],\n                    dataValues: newEventDataValues,\n                    status: 'ACTIVE',\n                    event: dhis2.util.uid()\n                };\n\n                if(programStage && programStage.dontPersistOnCreate){\n                    newEvent.notPersisted = true;\n                    newEvent.executingEvent = executingEvent;\n                    $rootScope.$broadcast(\"eventcreated\", { event:newEvent });\n                }\n                else{\n                    DHIS2EventFactory.create(newEvent).then(function(result){\n                       $rootScope.$broadcast(\"eventcreated\", { event:newEvent });\n                    }); \n                }\n                //1 event created\n                return 1;\n            }\n            else\n            {\n                //no events created\n                return 0;\n            }\n        } else {\n            $log.warn(\"Cannot create event with empty content.\");\n        }\n    };\n    \n    var internalExecuteRules = function(allProgramRules, executingEvent, evs, allDataElements, allTrackedEntityAttributes, selectedEntity, selectedEnrollment, optionSets, flag) {\n        if(allProgramRules) {\n            var variablesHash = {};\n\n            //Concatenate rules produced by indicator definitions into the other rules:\n            var rules = $filter('filter')(allProgramRules.programRules, {programStageId: null});\n\n            if(executingEvent && executingEvent.programStage){\n                if(!rules) {\n                    rules = [];\n                }\n                rules = rules.concat($filter('filter')(allProgramRules.programRules, {programStageId: executingEvent.programStage}));\n            }\n            if(!rules) {\n                rules = [];\n            }\n            rules = rules.concat(allProgramRules.programIndicators.rules);\n\n            //Run rules in priority - lowest number first(priority null is last)\n            rules = orderByFilter(rules, 'priority');\n\n            variablesHash = VariableService.getVariables(allProgramRules, executingEvent, evs, allDataElements, allTrackedEntityAttributes, selectedEntity, selectedEnrollment, optionSets);\n\n            if(angular.isObject(rules) && angular.isArray(rules)){\n                //The program has rules, and we want to run them.\n                //Prepare repository unless it is already prepared:\n                if(angular.isUndefined( $rootScope.ruleeffects ) ) {\n                    $rootScope.ruleeffects = {};\n                }\n\n                var ruleEffectKey = executingEvent.event ? executingEvent.event : executingEvent;\n                if( executingEvent.event && angular.isUndefined( $rootScope.ruleeffects[ruleEffectKey] )){\n                    $rootScope.ruleeffects[ruleEffectKey] = {};\n                }\n\n                if(!angular.isObject(executingEvent) && angular.isUndefined( $rootScope.ruleeffects[ruleEffectKey] )){\n                    $rootScope.ruleeffects[ruleEffectKey] = {};\n                }\n\n                var updatedEffectsExits = false;\n                var eventsCreated = 0;\n\n                angular.forEach(rules, function(rule) {\n                    var ruleEffective = false;\n\n                    var expression = rule.condition;\n                    //Go through and populate variables with actual values, but only if there actually is any replacements to be made(one or more \"$\" is present)\n                    if(expression) {\n                        if(expression.indexOf('{') !== -1) {\n                            expression = replaceVariables(expression, variablesHash);\n                        }\n                        \n                        //run expression:\n                        if( runExpression(expression, rule.condition, \"rule:\" + rule.id, flag, variablesHash) ){\n                            ruleEffective = true;\n                        }\n                    } else {\n                        $log.warn(\"Rule id:'\" + rule.id + \"'' and name:'\" + rule.name + \"' had no condition specified. Please check rule configuration.\");\n                    }\n\n                    angular.forEach(rule.programRuleActions, function(action){\n                        //In case the effect-hash is not populated, add entries\n                        if(angular.isUndefined( $rootScope.ruleeffects[ruleEffectKey][action.id] )){\n                            $rootScope.ruleeffects[ruleEffectKey][action.id] =  {\n                                id:action.id,\n                                location:action.location,\n                                action:action.programRuleActionType,\n                                dataElement:action.dataElement,\n                                trackedEntityAttribute:action.trackedEntityAttribute,\n                                programStage: action.programStage,\n                                programIndicator: action.programIndicator,\n                                programStageSection: action.programStageSection && action.programStageSection.id ? action.programStageSection.id : null,\n                                content:action.content,\n                                data:action.data,\n                                ineffect:undefined\n                            };\n                        }\n\n                        //In case the rule is effective and contains specific data,\n                        //the effect be refreshed from the variables list.\n                        //If the rule is not effective we can skip this step\n                        if(ruleEffective && action.data)\n                        {\n                            //Preserve old data for comparison:\n                            var oldData = $rootScope.ruleeffects[ruleEffectKey][action.id].data;\n\n                            //The key data might be containing a dollar sign denoting that the key data is a variable.\n                            //To make a lookup in variables hash, we must make a lookup without the dollar sign in the variable name\n                            //The first strategy is to make a direct lookup. In case the \"data\" expression is more complex, we have to do more replacement and evaluation.\n\n                            var nameWithoutBrackets = action.data.replace('#{','').replace('}','');\n                            if(angular.isDefined(variablesHash[nameWithoutBrackets]))\n                            {\n                                //The variable exists, and is replaced with its corresponding value\n                                $rootScope.ruleeffects[ruleEffectKey][action.id].data =\n                                    variablesHash[nameWithoutBrackets].variableValue;\n                            }\n                            else if(action.data.indexOf('{') !== -1 || action.data.indexOf('d2:') !== -1)\n                            {\n                                //Since the value couldnt be looked up directly, and contains a curly brace or a dhis function call,\n                                //the expression was more complex than replacing a single variable value.\n                                //Now we will have to make a thorough replacement and separate evaluation to find the correct value:\n                                $rootScope.ruleeffects[ruleEffectKey][action.id].data = replaceVariables(action.data, variablesHash);\n                                //In a scenario where the data contains a complex expression, evaluate the expression to compile(calculate) the result:\n                                $rootScope.ruleeffects[ruleEffectKey][action.id].data = runExpression($rootScope.ruleeffects[ruleEffectKey][action.id].data, action.data, \"action:\" + action.id, flag, variablesHash);\n                            }\n\n                            if(oldData !== $rootScope.ruleeffects[ruleEffectKey][action.id].data) {\n                                updatedEffectsExits = true;\n                            }\n                        }\n\n                        //Update the rule effectiveness if it changed in this evaluation;\n                        if($rootScope.ruleeffects[ruleEffectKey][action.id].ineffect !== ruleEffective)\n                        {\n                            //There is a change in the rule outcome, we need to update the effect object.\n                            updatedEffectsExits = true;\n                            $rootScope.ruleeffects[ruleEffectKey][action.id].ineffect = ruleEffective;\n                        }\n\n                        //In case the rule is of type CREATEEVENT, run event creation:\n                        if($rootScope.ruleeffects[ruleEffectKey][action.id].action === \"CREATEEVENT\" && $rootScope.ruleeffects[ruleEffectKey][action.id].ineffect){\n                            if(evs && evs.byStage){\n                                if($rootScope.ruleeffects[ruleEffectKey][action.id].programStage) {\n                                    var createdNow = performCreateEventAction($rootScope.ruleeffects[ruleEffectKey][action.id], selectedEntity, selectedEnrollment, evs.byStage[$rootScope.ruleeffects[ruleEffectKey][action.id].programStage.id]);\n                                    eventsCreated += createdNow;\n                                } else {\n                                    $log.warn(\"No programstage defined for CREATEEVENT action: \" + action.id);\n                                }\n                            } else {\n                                $log.warn(\"Events to evaluate for CREATEEVENT action: \" + action.id + \". Could it have been triggered at the wrong time or during registration?\");\n                            }\n                        }\n                        //In case the rule is of type \"assign variable\" and the rule is effective,\n                        //the variable data result needs to be applied to the correct variable:\n                        else if($rootScope.ruleeffects[ruleEffectKey][action.id].action === \"ASSIGN\" && $rootScope.ruleeffects[ruleEffectKey][action.id].ineffect){\n                            //from earlier evaluation, the data portion of the ruleeffect now contains the value of the variable to be assigned.\n                            //the content portion of the ruleeffect defines the name for the variable, when the qualidisers are removed:\n                            var variabletoassign = $rootScope.ruleeffects[ruleEffectKey][action.id].content ?\n                                $rootScope.ruleeffects[ruleEffectKey][action.id].content.replace(\"#{\",\"\").replace(\"A{\",\"\").replace(\"}\",\"\") : null;\n\n                            if(variabletoassign && !angular.isDefined(variablesHash[variabletoassign])){\n                                //If a variable is mentioned in the content of the rule, but does not exist in the variables hash, show a warning:\n                                $log.warn(\"Variable \" + variabletoassign + \" was not defined.\");\n                            }\n\n                            if(variablesHash[variabletoassign]){\n                                var updatedValue = $rootScope.ruleeffects[ruleEffectKey][action.id].data;\n                                \n                                var valueType = determineValueType(updatedValue);\n                                \n                                if($rootScope.ruleeffects[ruleEffectKey][action.id].dataElement) {\n                                    updatedValue = VariableService.getDataElementValueOrCodeForValue(variablesHash[variabletoassign].useCodeForOptionSet, updatedValue, $rootScope.ruleeffects[ruleEffectKey][action.id].dataElement.id, allDataElements, optionSets);\n                                }\n                                updatedValue = VariableService.processValue(updatedValue, valueType);\n\n                                variablesHash[variabletoassign] = {\n                                    variableValue:updatedValue,\n                                    variableType:valueType,\n                                    hasValue:true,\n                                    variableEventDate:'',\n                                    variablePrefix:variablesHash[variabletoassign].variablePrefix ? variablesHash[variabletoassign].variablePrefix : '#',\n                                    allValues:[updatedValue]\n                                };\n                                \n                                if(variablesHash[variabletoassign].variableValue !== updatedValue) {\n                                    //If the variable was actually updated, we assume that there is an updated ruleeffect somewhere:\n                                    updatedEffectsExits = true;\n                                }\n                            }\n                        }\n                    });\n                });\n\n                //Broadcast rules finished if there was any actual changes to the event.\n                if(updatedEffectsExits){\n                    $rootScope.$broadcast(\"ruleeffectsupdated\", { event: ruleEffectKey, callerId:flag.callerId, eventsCreated:eventsCreated });\n                }\n            }\n\n            return true;\n        }\n    };\n    \n    var internalProcessEventGrid = function( eventGrid ){\n    \tvar events = [];\n    \tif( eventGrid && eventGrid.rows && eventGrid.headers ){    \t\t\n    \t\tangular.forEach(eventGrid.rows, function(row) {\n    \t\t\tvar ev = {};\n    \t\t\tvar i = 0;\n        \t\tangular.forEach(eventGrid.headers, function(h){\n        \t\t\tev[h] = row[i];\n        \t\t\ti++;\n        \t\t});                            \n            });\n    \t}\n    \treturn events;\n    };\n\n    var internalGetOrLoadScope = function(currentEvent,programStageId,orgUnitId) {        \n        if(crossEventRulesExist) {\n            //If crossEventRulesExist, we need to get a scope that contains more than the current event.\n            if(lastEventId !== currentEvent.event \n                    || lastEventDate !== currentEvent.eventDate \n                    || !eventScopeExceptCurrent) {\n                //The scope might need updates, as the parameters of the event has changed\n\n                lastEventId = currentEvent.event;\n                lastEventDate = currentEvent.eventDate;\n\n                \n                var pager = {pageSize: NUMBER_OF_EVENTS_IN_SCOPE};                \n                var ordering = {id:\"eventDate\",direction:\"desc\"};\n                \n                return DHIS2EventFactory.getByStage(orgUnitId, programStageId, null, pager, true, null, null, ordering).then(function(events) {                \t\n                \tvar allEventsWithPossibleDuplicates = internalProcessEventGrid( events );                \t\n                    var filterUrl = '&dueDateStart=' + DateUtils.formatFromUserToApi(lastEventDate) + '&dueDateEnd=' + DateUtils.formatFromUserToApi(lastEventDate); \n                    return DHIS2EventFactory.getByStage(orgUnitId, programStageId, null, pager, true, null, filterUrl, ordering).then(function(events) {\n                    \tallEventsWithPossibleDuplicates = allEventsWithPossibleDuplicates.concat( internalProcessEventGrid( events ) );\n                        eventScopeExceptCurrent = [];\n                        var eventIdDictionary = {};\n                        angular.forEach(allEventsWithPossibleDuplicates, function(eventInScope) {\n                            if(currentEvent.event !== eventInScope.event \n                                    && !eventIdDictionary[eventInScope.event]) {\n                                //Add event and update dictionary to avoid duplicates:                                \n                                eventIdDictionary[eventInScope.event] = true;\n                            }\n                        });\n\n                        //make a sorted list of all events to pass to rules execution service:\n                        var allEventsInScope = eventScopeExceptCurrent.concat([currentEvent]);\n                        allEventsInScope = orderByFilter(allEventsInScope, '-eventDate').reverse();\n                        var byStage = {};\n                        byStage[currentEvent.programStage] = allEventsInScope;\n                        return {all: allEventsInScope, byStage:byStage};\n                    });\n                });   \n            }\n            else\n            {\n                //make a sorted list of all events to pass to rules execution service:\n                var allEvents = eventScopeExceptCurrent.concat([currentEvent]);\n                allEvents = orderByFilter(allEvents, '-eventDate').reverse();\n                var byStage = {};\n                byStage[currentEvent.programStage] = allEvents;\n                return $q.when({all: allEvents, byStage:byStage});\n            }\n        }\n        else\n        {\n            //return a scope containing only the current event\n            var byStage = {};\n            byStage[currentEvent.programStage] = [currentEvent];\n            return $q.when({all: [currentEvent], byStage:byStage});\n        }\n    };\n    var internalGetOrLoadRules = function(programId) {\n        //If no rules is stored in memory, or this service is being called in the context of a different program, get the rules again:\n        if(allProgramRules === false || lastProgramId !== programId)\n        {\n            return RulesFactory.loadRules(programId).then(function(rules){                    \n                allProgramRules = rules;\n                lastProgramId = programId;\n\n                //Check if any of the rules is using any source type thar requires a bigger event scope\n                crossEventRulesExist = false;\n                if(rules.programVariables && rules.programVariables.length) {\n                    for(var i = 0; i < rules.programVariables.length; i ++) {\n                        if( rules.programVariables[i].programRuleVariableSourceType ===\n                                \"DATAELEMENT_NEWEST_EVENT_PROGRAM\" ||\n                            rules.programVariables[i].programRuleVariableSourceType ===\n                                \"DATAELEMENT_NEWEST_EVENT_PROGRAM_STAGE\" ||\n                            rules.programVariables[i].programRuleVariableSourceType ===\n                                \"DATAELEMENT_PREVIOUS_EVENT\")\n                        {\n                            crossEventRulesExist = true;\n                        }\n                    }\n                }\n\n                return rules;\n            });  \n        }\n        else\n        {\n            return $q.when(allProgramRules);\n        }\n    };\n    return {\n        executeRules: function(allProgramRules, executingEvent, evs, allDataElements, allTrackedEntityAttributes, selectedEntity, selectedEnrollment, optionSets, flags) {\n            internalExecuteRules(allProgramRules, executingEvent, evs, allDataElements, allTrackedEntityAttributes, selectedEntity, selectedEnrollment, optionSets, flags);\n        },\n        loadAndExecuteRulesScope: function(currentEvent, programId, programStageId, programStageDataElements, allTrackedEntityAttributes, optionSets, orgUnitId, flags){\n            internalGetOrLoadRules(programId).then(function(rules) {\n                internalGetOrLoadScope(currentEvent,programStageId,orgUnitId).then(function(scope) {\n                    internalExecuteRules(rules, currentEvent, scope, programStageDataElements, allTrackedEntityAttributes, null, null, optionSets, flags);\n                });\n            });\n        },\n        processRuleEffectsForTrackedEntityAttributes: function(context, currentTei, teiOriginalValues, attributesById, optionSets ) {\n            var hiddenFields = {};\n            var assignedFields = {};\n            var hiddenSections = {};\n            var warningMessages = [];\n            \n            angular.forEach($rootScope.ruleeffects[context], function (effect) {\n                if (effect.ineffect) {\n                    if (effect.action === \"HIDEFIELD\" && effect.trackedEntityAttribute) {\n                        if (currentTei[effect.trackedEntityAttribute.id]) {\n                            //If a field is going to be hidden, but contains a value, we need to take action;\n                            if (effect.content) {\n                                //TODO: Alerts is going to be replaced with a proper display mecanism.\n                                alert(effect.content);\n                            }\n                            else {\n                                //TODO: Alerts is going to be replaced with a proper display mecanism.\n                                alert(attributesById[effect.trackedEntityAttribute.id].displayName + \" - was blanked out and hidden by your last action\");\n                            }\n\n                            //Blank out the value:\n                            currentTei[effect.trackedEntityAttribute.id] = \"\";\n                        }\n\n                        hiddenFields[effect.trackedEntityAttribute.id] = true;\n                    } else if (effect.action === \"SHOWERROR\" && effect.trackedEntityAttribute) {\n                        if(effect.ineffect) {\n                            var headerText =  $translate.instant('validation_error');\n                            var bodyText = effect.content + (effect.data ? effect.data : \"\");\n\n                            NotificationService.showNotifcationDialog(headerText, bodyText);\n                            if( effect.trackedEntityAttribute ) {\n                                currentTei[effect.trackedEntityAttribute.id] = teiOriginalValues[effect.trackedEntityAttribute.id];\n                            }\n                        }\n                    } else if (effect.action === \"SHOWWARNING\" && effect.trackedEntityAttribute) {\n                        if(effect.ineffect) {\n                            var message = effect.content + (angular.isDefined(effect.data) ? effect.data : \"\");\n                            warningMessages.push(message);\n\n                            if( effect.trackedEntityAttribute ) {\n                                warningMessages[effect.trackedEntityAttribute.id] = message;\n                            }\n                        }\n                    }\n                    else if (effect.action === \"ASSIGN\" && effect.trackedEntityAttribute) {\n                        var processedValue = $filter('trimquotes')(effect.data);\n\n                        if(attributesById[effect.trackedEntityAttribute.id]\n                                && attributesById[effect.trackedEntityAttribute.id].optionSet) {\n                            processedValue = OptionSetService.getName(\n                                    optionSets[attributesById[effect.trackedEntityAttribute.id].optionSet.id].options, processedValue)\n                        }\n\n                        processedValue = processedValue === \"true\" ? true : processedValue;\n                        processedValue = processedValue === \"false\" ? false : processedValue;\n\n                        //For \"ASSIGN\" actions where we have a dataelement, we save the calculated value to the dataelement:\n                        currentTei[effect.trackedEntityAttribute.id] = processedValue;\n                        assignedFields[effect.trackedEntityAttribute.id] = true;\n                    }\n                }\n            });\n            return {currentTei: currentTei, hiddenFields: hiddenFields, hiddenSections: hiddenSections, warningMessages: warningMessages, assignedFields: assignedFields};\n        },\n        processRuleEffectsForEvent: function(eventId, currentEvent, currentEventOriginalValues, prStDes, optionSets ) {\n            var hiddenFields = {};\n            var assignedFields = {};\n            var hiddenSections = {};\n            var warningMessages = [];\n            \n            angular.forEach($rootScope.ruleeffects[eventId], function (effect) {\n                if (effect.ineffect) {\n                    if (effect.action === \"HIDEFIELD\" && effect.dataElement) {\n                        if(currentEvent[effect.dataElement.id]) {\n                            //If a field is going to be hidden, but contains a value, we need to take action;\n                            if(effect.content) {\n                                //TODO: Alerts is going to be replaced with a proper display mecanism.\n                                alert(effect.content);\n                            }\n                            else {\n                                //TODO: Alerts is going to be replaced with a proper display mecanism.\n                                alert(prStDes[effect.dataElement.id].dataElement.displayFormName + \" - was blanked out and hidden by your last action\");\n                            }\n\n                        }\n                        currentEvent[effect.dataElement.id] = \"\";\n                        hiddenFields[effect.dataElement.id] = true;\n                    }\n                    else if(effect.action === \"HIDESECTION\") {\n                        if(effect.programStageSection){\n                            hiddenSections[effect.programStageSection] = effect.programStageSection;\n                        }\n                    }\n                    else if(effect.action === \"SHOWERROR\" && effect.dataElement.id){\n                        var headerTxt =  $translate.instant('validation_error');\n                        var bodyTxt = effect.content + (effect.data ? effect.data : \"\");\n                        NotificationService.showNotifcationDialog(headerTxt, bodyTxt);\n\n                        currentEvent[effect.dataElement.id] = currentEventOriginalValues[effect.dataElement.id];\n                    }\n                    else if(effect.action === \"SHOWWARNING\"){\n                        warningMessages.push(effect.content + (effect.data ? effect.data : \"\"));\n                    }\n                    else if (effect.action === \"ASSIGN\" && effect.dataElement) {\n                        var processedValue = $filter('trimquotes')(effect.data);\n\n                        if(prStDes[effect.dataElement.id] \n                                && prStDes[effect.dataElement.id].dataElement.optionSet) {\n                            processedValue = OptionSetService.getName(\n                                    optionSets[prStDes[effect.dataElement.id].dataElement.optionSet.id].options, processedValue)\n                        }\n\n                        processedValue = processedValue === \"true\" ? true : processedValue;\n                        processedValue = processedValue === \"false\" ? false : processedValue;\n\n                        currentEvent[effect.dataElement.id] = processedValue;\n                        assignedFields[effect.dataElement.id] = true;\n                    }\n                }\n            });\n        \n            return {currentEvent: currentEvent, hiddenFields: hiddenFields, hiddenSections: hiddenSections, warningMessages: warningMessages, assignedFields: assignedFields};\n        },\n        processRuleEffectAttribute: function(context, selectedTei, tei, currentEvent, currentEventOriginialValue, affectedEvent, attributesById, prStDes, hiddenFields, hiddenSections, warningMessages, assignedFields, optionSets){\n            //Function used from registration controller to process effects for the tracked entity instance and for the events in the same operation\n            var teiAttributesEffects = this.processRuleEffectsForTrackedEntityAttributes(context, selectedTei, tei, attributesById, optionSets );\n            teiAttributesEffects.selectedTei = teiAttributesEffects.currentTei;\n            \n            if(context === \"SINGLE_EVENT\" && currentEvent && prStDes ) {\n                var eventEffects = this.processRuleEffectsForEvent(\"SINGLE_EVENT\", currentEvent, currentEventOriginialValue, prStDes, optionSets);\n                teiAttributesEffects.warningMessages = angular.extend(teiAttributesEffects.warningMessages,eventEffects.warningMessages);\n                teiAttributesEffects.hiddenFields = angular.extend(teiAttributesEffects.hiddenFields,eventEffects.hiddenFields);\n                teiAttributesEffects.hiddenSections = angular.extend(teiAttributesEffects.hiddenSections,eventEffects.hiddenSections);\n                teiAttributesEffects.assignedFields = angular.extend(teiAttributesEffects.assignedFields,eventEffects.assignedFields);\n                teiAttributesEffects.currentEvent = eventEffects.currentEvent;\n            }\n            \n            return teiAttributesEffects;\n        }\n    };\n})\n\n/* service for dealing with events */\n.service('DHIS2EventService', function(DateUtils){\n    return {\n        //for simplicity of grid display, events were changed from\n        //event.datavalues = [{dataElement: dataElement, value: value}] to\n        //event[dataElement] = value\n        //now they are changed back for the purpose of storage.\n        reconstructEvent: function(event, programStageDataElements){\n            var e = {};\n\n            e.event         = event.event;\n            e.status        = event.status;\n            e.program       = event.program;\n            e.programStage  = event.programStage;\n            e.orgUnit       = event.orgUnit;\n            e.eventDate     = event.eventDate;\n\n            var dvs = [];\n            angular.forEach(programStageDataElements, function(prStDe){\n                if(event.hasOwnProperty(prStDe.dataElement.id)){\n                    dvs.push({dataElement: prStDe.dataElement.id, value: event[prStDe.dataElement.id]});\n                }\n            });\n\n            e.dataValues = dvs;\n\n            if(event.coordinate){\n                e.coordinate = {latitude: event.coordinate.latitude ? event.coordinate.latitude : '',\n                    longitude: event.coordinate.longitude ? event.coordinate.longitude : ''};\n            }\n\n            return e;\n        },\n        refreshList: function(eventList, currentEvent){\n            if(!eventList || !eventList.length){\n                return;\n            }\n            var continueLoop = true;\n            for(var i=0; i< eventList.length && continueLoop; i++){\n                if(eventList[i].event === currentEvent.event ){\n                    eventList[i] = currentEvent;\n                    continueLoop = false;\n                }\n            }\n            return eventList;\n        },\n        getEventExpiryStatus : function (event, program, selectedOrgUnit) {\n            var completedDate, today, daysAfterCompletion;\n\n            if ((event.orgUnit !== selectedOrgUnit) || ( program.completeEventsExpiryDays === 0) ||\n                !event.status) {\n                return false;\n            }\n\n            completedDate = moment(event.completedDate,'YYYY-MM-DD');\n            today = moment(DateUtils.getToday(),'YYYY-MM-DD');\n            daysAfterCompletion = today.diff(completedDate, 'days');\n            if (daysAfterCompletion < program.completeEventsExpiryDays) {\n                return false;\n            }\n            return true;\n        }\n    };\n})\n\n/* current selections */\n.service('CurrentSelection', function(){\n    this.currentSelection = {};\n    this.relationshipInfo = {};\n    this.optionSets = null;\n    this.attributesById = null;\n    this.ouLevels = null;\n    this.sortedTeiIds = [];\n    this.selectedTeiEvents = null;\n    this.relationshipOwner = {};\n    this.selectedTeiEvents = [];\n    this.fileNames = {};\n    this.orgUnitNames = {};\n    this.location = null;\n    this.advancedSearchOptions = null;\n\tthis.trackedEntities = null;\n\n    this.set = function(currentSelection){\n        this.currentSelection = currentSelection;\n    };\n    this.get = function(){\n        return this.currentSelection;\n    };\n\n    this.setRelationshipInfo = function(relationshipInfo){\n        this.relationshipInfo = relationshipInfo;\n    };\n    this.getRelationshipInfo = function(){\n        return this.relationshipInfo;\n    };\n\n    this.setOptionSets = function(optionSets){\n        this.optionSets = optionSets;\n    };\n    this.getOptionSets = function(){\n        return this.optionSets;\n    };\n\n    this.setAttributesById = function(attributesById){\n        this.attributesById = attributesById;\n    };\n    this.getAttributesById = function(){\n        return this.attributesById;\n    };\n\n    this.setOuLevels = function(ouLevels){\n        this.ouLevels = ouLevels;\n    };\n    this.getOuLevels = function(){\n        return this.ouLevels;\n    };\n\n    this.setSortedTeiIds = function(sortedTeiIds){\n        this.sortedTeiIds = sortedTeiIds;\n    };\n    this.getSortedTeiIds = function(){\n        return this.sortedTeiIds;\n    };\n\n    this.setSelectedTeiEvents = function(selectedTeiEvents){\n        this.selectedTeiEvents = selectedTeiEvents;\n    };\n    this.getSelectedTeiEvents = function(){\n        return this.selectedTeiEvents;\n    };\n\n    this.setRelationshipOwner = function(relationshipOwner){\n        this.relationshipOwner = relationshipOwner;\n    };\n    this.getRelationshipOwner = function(){\n        return this.relationshipOwner;\n    };\n\n    this.setFileNames = function(fileNames){\n        this.fileNames = fileNames;\n    };\n    this.getFileNames = function(){\n        return this.fileNames;\n    };\n    \n    this.setOrgUnitNames = function(orgUnitNames){\n        this.orgUnitNames = orgUnitNames;\n    };\n    this.getOrgUnitNames = function(){\n        return this.orgUnitNames;\n    };\n    \n    this.setLocation = function(location){\n        this.location = location;\n    };\n    this.getLocation = function(){\n        return this.location;\n    };\n    \n    this.setAdvancedSearchOptions = function (searchOptions) {\n        this.advancedSearchOptions = searchOptions;\n    };\n    this.getAdvancedSearchOptions = function () {\n        return this.advancedSearchOptions;\n    };\n\n    this.setTrackedEntities = function (trackedEntities) {\n        this.trackedEntities = trackedEntities;\n    };\n    this.getTrackedEntities = function () {\n        return this.trackedEntities;\n    };\n\n    this.setSortColumn = function (sortColumn) {\n        if (this.advancedSearchOptions) {\n            this.advancedSearchOptions.sortColumn = sortColumn;\n        }\n    };\n\n    this.setColumnReverse = function (reverseSortStatus) {\n        if (this.advancedSearchOptions) {\n            this.advancedSearchOptions.reverse = reverseSortStatus;\n        }\n    };\n\n    this.setGridColumns = function (gridColumns) {\n        if (this.advancedSearchOptions) {\n            this.advancedSearchOptions.gridColumns = gridColumns;\n        }\n    }\n})\n\n.service('AuditHistoryDataService', function( $http, $translate, NotificationService, DHIS2URL ) {\n    this.getAuditHistoryData = function(dataId, dataType ) {\n        var url=\"\";\n        if (dataType === \"attribute\") {\n            url=\"/audits/trackedEntityAttributeValue?tei=\"+dataId+\"&skipPaging=true\";\n            \n        } else {\n            url=\"/audits/trackedEntityDataValue?psi=\"+dataId+\"&skipPaging=true\";\n        }\n\n        var promise = $http.get(DHIS2URL + url).then(function( response ) {\n            return response.data;\n        }, function( response ) {\n            if( response && response.data && response.data.status === 'ERROR' ) {\n                var headerText = response.data.status;\n                var bodyText = response.data.message ? response.data.message : $translate.instant('unable_to_fetch_data_from_server');\n                NotificationService.showNotifcationDialog(headerText, bodyText);\n            }\n        });\n        return promise;\n    }\n})\n\n\n\n/* Factory for fetching OrgUnit */\n.factory('OrgUnitFactory', function($http, DHIS2URL, $q, $window, $translate, SessionStorageService, DateUtils, CurrentSelection) {\n    var orgUnit, orgUnitPromise, rootOrgUnitPromise,orgUnitTreePromise;\n    var indexedDB = $window.indexedDB;\n    var db = null;\n    function openStore(){\n        var deferred = $q.defer();\n        var request = indexedDB.open(\"dhis2ou\");\n\n        request.onsuccess = function(e) {\n            db = e.target.result;\n            deferred.resolve();\n        };\n\n        request.onerror = function(){\n            deferred.reject();\n        };\n\n        return deferred.promise;\n    }\n    return {\n        getChildren: function(uid){\n            if( orgUnit !== uid ){\n                orgUnitPromise = $http.get( DHIS2URL + '/organisationUnits/'+ uid + '.json?fields=id,path,children[id,displayName,level,children[id]]&paging=false' ).then(function(response){\n                    orgUnit = uid;\n                    return response.data;\n                });\n            }\n            return orgUnitPromise;\n        },\n        get: function(uid){\n            if( orgUnit !== uid ){\n                orgUnitPromise = $http.get( DHIS2URL + '/organisationUnits/'+ uid + '.json?fields=id,displayName,level,path' ).then(function(response){\n                    orgUnit = uid;\n                    return response.data;\n                });\n            }\n            return orgUnitPromise;\n        },\n        getViewTreeRoot: function(){\n            var def = $q.defer();            \n            var settings = SessionStorageService.get('USER_PROFILE');            \n            if( settings && settings.organisationUnits ){\n                var ous = {};\n                ous.organisationUnits = settings && settings.dataViewOrganisationUnits && settings.dataViewOrganisationUnits.length > 0 ? settings.dataViewOrganisationUnits : settings && settings.organisationUnits ? settings.organisationUnits : [];                \n                def.resolve( ous );\n            }\n            else{\n                var url = DHIS2URL + '/me.json?fields=organisationUnits[id,displayName,level,path,children[id,displayName,level,children[id]]],dataViewOrganisationUnits[id,displayName,level,path,children[id,displayName,level,children[id]]]&paging=false';\n                $http.get( url ).then(function(response){\n                    response.data.organisationUnits = response.data.dataViewOrganisationUnits && response.data.dataViewOrganisationUnits.length > 0 ? response.data.dataViewOrganisationUnits : response.data.organisationUnits;\n                    delete response.data.dataViewOrganisationUnits;\n                    def.resolve( response.data );\n                });\n            }            \n            return def.promise;\n        },\n        getSearchTreeRoot: function(){\n            var def = $q.defer();            \n            var settings = SessionStorageService.get('USER_PROFILE');            \n            if( settings && settings.organisationUnits ){\n                var ous = {};\n                ous.organisationUnits = settings && settings.teiSearchOrganisationUnits && settings.teiSearchOrganisationUnits.length > 0 ? settings.teiSearchOrganisationUnits : settings && settings.organisationUnits ? settings.organisationUnits : [];\n                def.resolve( ous );\n            }\n            else{\n                var url = DHIS2URL + '/me.json?fields=organisationUnits[id,displayName,level,path,children[id,displayName,level,children[id]]],teiSearchOrganisationUnits[id,displayName,level,path,children[id,displayName,level,children[id]]]&paging=false';\n                $http.get( url ).then(function(response){\n                    response.data.organisationUnits = response.data.teiSearchOrganisationUnits && response.data.teiSearchOrganisationUnits.length > 0 ? response.data.teiSearchOrganisationUnits : response.data.organisationUnits;\n                    delete response.data.teiSearchOrganisationUnits;\n                    def.resolve( response.data );\n                });\n            }            \n            return def.promise;\n        },\n        getOrgUnits: function(uid,fieldUrl){\n            var url = DHIS2URL + '/organisationUnits.json?filter=id:eq:'+uid+'&'+fieldUrl+'&paging=false';\n            orgUnitTreePromise = $http.get(url).then(function(response){\n                return response.data;\n            });\n            return orgUnitTreePromise;\n        },\n        getOrgUnit: function(uid) {\n            var def = $q.defer();\n            var selectedOrgUnit = CurrentSelection.get()[\"orgUnit\"];//SessionStorageService.get('SELECTED_OU');\n            if (selectedOrgUnit && selectedOrgUnit.id === uid ) {\n                def.resolve( selectedOrgUnit );\n            }\n            else if(uid){\n                this.get(uid).then(function (response) {\n                    def.resolve( response ? response : null );\n                });\n            }\n            return def.promise;\n        },\n        getOrgUnitReportDateRange: function(orgUnit) {\n            var reportDateRange = { maxDate: DateUtils.getToday(), minDate: ''};\n            var cdate = orgUnit.cdate ? orgUnit.cdate : orgUnit.closedDate ? DateUtils.getDateFromUTCString(orgUnit.closedDate) : null;\n            var odate = orgUnit.odate ? orgUnit.odate : orgUnit.openingDate ? DateUtils.getDateFromUTCString(orgUnit.openingDate) : null;\n            if (odate) {\n                /*If the orgunit has an opening date, then it is taken as the min-date otherwise the min-date is open*/\n                reportDateRange.minDate = DateUtils.formatFromApiToUser(odate);\n            }\n            if (cdate) {\n                /*If closed date of the org-unit is later than today then today's date is taken as the max-date otherwise\n                * the closed date of the org-unit is taken as the max-date*/\n                if (DateUtils.isBeforeToday(cdate)) {\n                    reportDateRange.maxDate = DateUtils.formatFromApiToUser(cdate);\n                }\n            }\n            return reportDateRange;\n        },\n        getFromStoreOrServer: function(uid){\n            var deferred = $q.defer();\n            var orgUnitFactory = this;\n            if (db === null) {\n                openStore().then(getOu, function () {\n                    deferred.reject(\"DB not opened\");\n                });\n            }\n            else {                \n                getOu();                \n            }\n\n            function getOu() {\n                var tx = db.transaction([\"ou\"]);\n                var store = tx.objectStore(\"ou\");\n                var query = store.get(uid);\n\n                query.onsuccess = function(e){\n                    if(e.target.result){\n                        e.target.result.closedStatus = getOrgUnitClosedStatus(e.target.result);\n                        e.target.result.reportDateRange = orgUnitFactory.getOrgUnitReportDateRange(e.target.result);\n                        e.target.result.id = uid;\n                        e.target.result.displayName = e.target.result.n;\n                        delete(e.target.result.n);\n                        deferred.resolve(e.target.result);\n                    }\n                    else{\n                        var t = db.transaction([\"ouPartial\"]);\n                        var s = t.objectStore(\"ouPartial\");\n                        var q = s.get(uid);\n                        q.onsuccess = function(e){\n                            if( e.target.result ){\n                                e.target.result.closedStatus = getOrgUnitClosedStatus(e.target.result);\n                                e.target.result.reportDateRange = orgUnitFactory.getOrgUnitReportDateRange(e.target.result);\n                                e.target.result.id = uid;\n                                e.target.result.displayName = e.target.result.n;\n                                delete(e.target.result.n);\n                                deferred.resolve(e.target.result);\n                            }\n                            else{\n                                $http.get( DHIS2URL + '/organisationUnits/'+ uid + '.json?fields=id,displayName,closedDate,openingDate' ).then(function(response){\n                                    if( response && response.data ){\n                                        deferred.resolve({\n                                            id: response.data.id,\n                                            displayName: response.data.displayName,\n                                            cdate: response.data.closedDate,\n                                            odate: response.data.openingDate,\n                                            closedStatus: getOrgUnitClosedStatus(response.data),\n                                            reportDateRange: orgUnitFactory.getOrgUnitReportDateRange(response.data)\n                                        });\n                                    }\n                                });\n                            }\n                        };\n                        q.onerror = function(e){                            \n                            deferred.reject();\n                        };\n                    }\n                };\n                query.onerror = function(e){\n                    deferred.reject();\n                };\n            }\n\n\n            function getOrgUnitClosedStatus(ou){\n                var closed = false;\n                if( ou ){\n                    if( ou.cdate ){\n                        closed = DateUtils.isBeforeToday( ou.cdate ) ? true : false;\n                    }\n                    if(!closed && ou.odate ){\n                        closed = DateUtils.isAfterToday( ou.odate ) ? true : false;\n                    }\n                }\n                if(closed) {\n                    setHeaderDelayMessage($translate.instant(\"orgunit_closed\"));\n                } else {\n                    hideHeaderMessage();\n                }\n                return closed;\n            }\n            return deferred.promise;\n        }\n    };\n});\n\n\n// WEBPACK FOOTER //\n// ../d2-tracker/lib/dhis2.angular.services.js","/* global moment, angular, directive, dhis2, selection */\n\n'use strict';\n\n/* Directives */\n\nvar d2Directives = angular.module('d2Directives', [])\n\n\n.directive('selectedOrgUnit', function ($timeout, $location) {\n    return {\n        restrict: 'A',\n        link: function (scope, element, attrs) {\n            var orgUnitFromUrl;\n            $(\"#orgUnitTree\").one(\"ouwtLoaded\", function (event, ids, names) {\n                if (dhis2.tc && dhis2.tc.metaDataCached) {\n                    $timeout(function () {\n                        scope.treeLoaded = true;\n                        scope.$apply();\n                    });\n                    selection.responseReceived();\n                }\n                else {\n                    console.log('Finished loading orgunit tree');\n                    orgUnitFromUrl = ($location.search()).ou;\n                    $(\"#orgUnitTree\").addClass(\"disable-clicks\"); //Disable ou selection until meta-data has downloaded\n                    $timeout(function () {\n                        scope.treeLoaded = true;\n                        scope.$apply();\n                    });\n                    downloadMetaData();\n                }\n            });\n\n            //listen to user selection, and inform angular\n            selection.setListenerFunction(setSelectedOu, true);\n            function setSelectedOu(ids, names) {\n                var ou = {id: ids[0], displayName: names[0]};\n                if(orgUnitFromUrl && ou.id !== orgUnitFromUrl) {\n                    selection.setOrgUnitFromURL(orgUnitFromUrl);\n                    orgUnitFromUrl = null;\n                } else {\n                    $timeout(function () {\n                        scope.selectedOrgUnit = ou;\n                        scope.$apply();\n                    });\n                }\n            }\n        }\n    };\n})\n\n.directive('d2SetFocus', function ($timeout) {\n\n    return {\n        scope: { trigger: '@d2SetFocus' },\n        link: function(scope, element) {\n            scope.$watch('trigger', function(value) {\n                if(value === \"true\") {\n                    $timeout(function() {\n                        element[0].focus();\n                    });\n                }\n            });\n        }\n    };\n})\n\n.directive('d2LeftBar', function () {\n\n    return {\n        restrict: 'E',\n        templateUrl: 'views/left-bar.html',\n        link: function (scope, element, attrs) {\n\n            $(\"#searchIcon\").click(function () {\n                $(\"#searchSpan\").toggle();\n                $(\"#searchField\").focus();\n            });\n\n            $(\"#searchField\").autocomplete({\n                source: \"../dhis-web-commons/ouwt/getOrganisationUnitsByName.action\",\n                select: function (event, ui) {\n                    $(\"#searchField\").val(ui.item.value);\n                    selection.findByName();\n                }\n            });\n        }\n    };\n})\n\n.directive('blurOrChange', function () {\n\n    return function (scope, elem, attrs) {\n        elem.calendarsPicker({\n            onSelect: function () {\n                scope.$apply(attrs.blurOrChange);\n                $(this).change();\n            }\n        }).change(function () {\n            scope.$apply(attrs.blurOrChange);\n        });\n    };\n})\n\n.directive('d2Enter', function () {\n    return function (scope, element, attrs) {\n        element.bind(\"keydown keypress\", function (event) {\n            if (event.which === 13) {\n                scope.$apply(function () {\n                    scope.$eval(attrs.d2Enter);\n                });\n                event.preventDefault();\n            }\n        });\n    };\n})\n\n.directive('d2PopOver', function ($compile, $templateCache, $translate) {\n\n    return {\n        restrict: 'EA',\n        scope: {\n            content: '=',\n            program: '=',\n            title: '@details',\n            template: \"@template\",\n            placement: \"@placement\",\n            trigger: \"@trigger\"\n        },\n        link: function (scope, element) {\n            var content, program;\n            if (scope.content) {\n                content = $templateCache.get(scope.template);\n                content = $compile(content)(scope);\n                if( scope.program ){\n                    program = $templateCache.get(scope.template);\n                    program = $compile(program)(scope);\n                }\n                var options = {\n                    content: content,\n                    program: program,\n                    placement: scope.placement ? scope.placement : 'auto',\n                    trigger: scope.trigger ? scope.trigger : 'hover',\n                    html: true,\n                    title: $translate.instant('_details')\n                };\n                element.popover(options);\n\n                $('body').on('click', function (e) {\n                    if (!element[0].contains(e.target)) {\n                        element.popover('hide');\n                    }\n                });\n            }\n        }\n    };\n})\n\n.directive('d2Sortable', function ($timeout) {\n\n    return {\n        restrict: 'A',\n        link: function (scope, element, attrs) {\n            element.sortable({\n                connectWith: \".connectedSortable\",\n                placeholder: \"ui-state-highlight\",\n                tolerance: \"pointer\",\n                handle: '.handle',\n                change: function (event, ui) {\n                    getSortedItems(ui);\n                },\n                receive: function (event, ui) {\n                    getSortedItems(ui);\n                }\n            });\n\n            var getSortedItems = function (ui) {\n                var biggerWidgets = $(\"#biggerWidget\").sortable(\"toArray\");\n                var smallerWidgets = $(\"#smallerWidget\").sortable(\"toArray\");\n                var movedIsIdentifeid = false;\n\n                //look for the moved item in the bigger block\n                for (var i = 0; i < biggerWidgets.length && !movedIsIdentifeid; i++) {\n                    if (biggerWidgets[i] === \"\") {\n                        biggerWidgets[i] = ui.item[0].id;\n                        movedIsIdentifeid = true;\n                    }\n                }\n\n                //look for the moved item in the smaller block\n                for (var i = 0; i < smallerWidgets.length && !movedIsIdentifeid; i++) {\n                    if (smallerWidgets[i] === \"\") {\n                        smallerWidgets[i] = ui.item[0].id;\n                        movedIsIdentifeid = true;\n                    }\n                }\n                var layout = {smallerWidgets: smallerWidgets, biggerWidgets: biggerWidgets};\n                scope.applyWidgetsOrderChange( layout );\n            };\n        }\n    };\n})\n\n.directive('serversidePaginator', function factory() {\n\n    return {\n        restrict: 'E',\n        controller: function ($scope, Paginator) {\n            $scope.paginator = Paginator;\n        },\n        templateUrl: './templates/serverside-pagination.html'\n    };\n})\n\n.directive('d2CustomDataEntryForm', function ($compile) {\n    return{\n        restrict: 'E',\n        link: function (scope, elm, attrs) {\n            scope.$watch('customDataEntryForm', function () {\n                if (angular.isObject(scope.customDataEntryForm)) {\n                    elm.html(scope.customDataEntryForm.htmlCode);\n                    $compile(elm.contents())(scope);\n                }\n            });\n        }\n    };\n})\n\n.directive('d2CustomRegistrationForm', function ($compile) {\n    return{\n        restrict: 'E',\n        link: function (scope, elm, attrs) {\n            scope.$watch('customRegistrationForm', function () {\n                if (angular.isObject(scope.customRegistrationForm)) {\n                    elm.html(scope.customRegistrationForm.htmlCode);\n                    $compile(elm.contents())(scope);\n                }\n            });\n        }\n    };\n})\n\n/* TODO: this directive access an element #contextMenu somewhere in the document. Looks like it has to be rewritten */\n.directive('d2ContextMenu', function () {\n\n    return {\n        restrict: 'A',\n        link: function (scope, element, attrs) {\n            var contextMenu = $(\"#contextMenu\");\n\n            element.click(function (e) {\n                var menuHeight = contextMenu.height();\n                var menuWidth = contextMenu.width();\n                var winHeight = $(window).height();\n                var winWidth = $(window).width();\n\n                var pageX = e.pageX;\n                var pageY = e.pageY;\n\n                contextMenu.show();\n\n                if ((menuWidth + pageX) > winWidth) {\n                    pageX -= menuWidth;\n                }\n\n                if ((menuHeight + pageY) > winHeight) {\n                    pageY -= menuHeight;\n\n                    if (pageY < 0) {\n                        pageY = e.pageY;\n                    }\n                }\n\n                contextMenu.css({\n                    left: pageX,\n                    top: pageY\n                });\n\n                return false;\n            });\n\n            contextMenu.on(\"click\", \"a\", function () {\n                contextMenu.hide();\n            });\n\n            $(document).click(function () {\n                contextMenu.hide();\n            });\n        }\n    };\n})\n\n.directive('d2Date', function (CalendarService, $parse) {\n    return {\n        restrict: 'A',\n        require: 'ngModel',\n        link: function (scope, element, attrs, ctrl) {\n            var calendarSetting = CalendarService.getSetting();\n            var dateFormat = 'yyyy-mm-dd';\n            if (calendarSetting.keyDateFormat === 'dd-MM-yyyy') {\n                dateFormat = 'dd-mm-yyyy';\n            }\n\n            var minDate = $parse(attrs.minDate)(scope);\n            var maxDate = $parse(attrs.maxDate)(scope);\n            var calendar = $.calendars.instance(calendarSetting.keyCalendar);\n\n            var initializeDatePicker = function( sDate, eDate ){\n                element.calendarsPicker({\n                    changeMonth: true,\n                    dateFormat: dateFormat,\n                    yearRange: '-120:+30',\n                    minDate: sDate,\n                    maxDate: eDate,\n                    calendar: calendar,\n                    duration: \"fast\",\n                    showAnim: \"\",\n                    renderer: $.calendars.picker.themeRollerRenderer,\n                    onSelect: function () {\n                        $(this).change();\n                    },\n                    onClose:function(){\n                        $(this).blur();\n                    }\n                }).change(function () {\n                    ctrl.$setViewValue(this.value);\n                    this.focus();\n                    scope.$apply();\n                });\n            };\n\n            initializeDatePicker(minDate, maxDate);\n\n            scope.$watch(attrs.minDate, function(value){\n                element.calendarsPicker('destroy');\n                initializeDatePicker( value, $parse(attrs.maxDate)(scope));\n            });\n\n            scope.$watch(attrs.maxDate, function(value){\n                element.calendarsPicker('destroy');\n                initializeDatePicker( $parse(attrs.minDate)(scope), value);\n            });\n        }\n    };\n})\n\n.directive('d2FileInput', function($translate, DHIS2EventService, DHIS2EventFactory, FileService, NotificationService){\n\n    return {\n        restrict: \"A\",\n        scope: {\n            d2FileInputList: '=',\n            d2FileInput: '=',\n            d2FileInputName: '=',\n            d2FileInputCurrentName: '=',\n            d2FileInputPs: '='\n        },\n        link: function (scope, element, attrs) {\n\n            var de = attrs.inputFieldId;\n\n            var updateModel = function () {\n\n                var update = scope.d2FileInput.event &&  scope.d2FileInput.event !== 'SINGLE_EVENT' ? true : false;\n\n                FileService.upload(element[0].files[0]).then(function(data){\n\n                    if(data && data.status === 'OK' && data.response && data.response.fileResource && data.response.fileResource.id && data.response.fileResource.name){\n                        scope.d2FileInput[de] = data.response.fileResource.id;\n                        scope.d2FileInputCurrentName[de] = data.response.fileResource.name;\n                        if(!scope.d2FileInputName[scope.d2FileInput.event]){\n                            scope.d2FileInputName[scope.d2FileInput.event] = {};\n                        }\n                        scope.d2FileInputName[scope.d2FileInput.event][de] = data.response.fileResource.name;\n                        if( update ){\n                            var updatedSingleValueEvent = {event: scope.d2FileInput.event, dataValues: [{value: data.response.fileResource.id, dataElement:  de}]};\n                            var updatedFullValueEvent = DHIS2EventService.reconstructEvent(scope.d2FileInput, scope.d2FileInputPs.programStageDataElements);\n                            DHIS2EventFactory.updateForSingleValue(updatedSingleValueEvent, updatedFullValueEvent).then(function(data){\n                                scope.d2FileInputList = DHIS2EventService.refreshList(scope.d2FileInputList, scope.d2FileInput);\n                            });\n                        }\n                    }\n                    else{\n                        NotificationService.showNotifcationDialog($translate.instant(\"error\"),\n                            $translate.instant(\"file_upload_failed\"));\n                    }\n\n                });\n            };\n            element.bind('change', updateModel);\n        }\n    };\n})\n\n.directive('d2FileInputDelete', function($parse, $timeout, $translate, FileService, NotificationService){\n\n    return {\n        restrict: \"A\",\n        link: function (scope, element, attrs) {\n            var valueGetter = $parse(attrs.d2FileInputDelete);\n            var nameGetter = $parse(attrs.d2FileInputName);\n            var nameSetter = nameGetter.assign;\n\n            if(valueGetter(scope)) {\n                FileService.get(valueGetter(scope)).then(function(data){\n                    if(data && data.name && data.id){\n                        $timeout(function(){\n                            nameSetter(scope, data.name);\n                            scope.$apply();\n                        });\n                    }\n                    else{\n                        NotificationService.showNotifcationDialog($translate.instant(\"error\"),\n                            $translate.instant(\"file_missing\"));\n                    }\n                });\n            }\n        }\n    };\n})\n\n.directive('d2Audit', function (CurrentSelection, MetaDataFactory ) {\n    return {\n        restrict: 'E',\n        template: '<span class=\"hideInPrint audit-icon\" title=\"{{\\'audit_history\\' | translate}}\" data-ng-click=\"showAuditHistory()\">' +\n        '<i class=\"glyphicon glyphicon-user\"\"></i>' +\n        '</span>',\n        scope: {\n            eventId: '@',\n            type: '@',\n            nameIdMap: '='\n        },\n        controller: function ($scope, $modal) {\n            $scope.showAuditHistory = function () {\n\n                var openModal = function( ops ){\n                    $modal.open({\n                        templateUrl: \"./templates/audit-history.html\",\n                        controller: \"AuditHistoryController\",\n                        resolve: {\n                            eventId: function () {\n                                return $scope.eventId;\n                            },\n                            dataType: function () {\n                                return $scope.type;\n                            },\n                            nameIdMap: function () {\n                                return $scope.nameIdMap;\n                            },\n                            optionSets: function(){\n                                return ops;\n                            }\n                        }\n                    });\n                };\n\n                var optionSets = CurrentSelection.getOptionSets();\n                if(!optionSets){\n                    optionSets = [];\n                    MetaDataFactory.getAll('optionSets').then(function(optionSets){\n                        angular.forEach(optionSets, function(optionSet){\n                            optionSets[optionSet.id] = optionSet;\n                        });\n                        CurrentSelection.setOptionSets(optionSets);\n                        openModal(optionSets);\n                    });\n                }\n                else{\n                    openModal(optionSets);\n                }\n            };\n        }\n    };\n})\n\n.directive('d2RadioButton', function (){\n    return {\n        restrict: 'E',\n        templateUrl: './templates/radio-button.html',\n        scope: {\n            required: '=dhRequired',\n            value: '=dhValue',\n            disabled: '=dhDisabled',\n            name: '@dhName',\n            customOnClick: '&dhClick',\n            currentElement: '=dhCurrentElement',\n            event: '=dhEvent',\n            id: '=dhId'\n        },\n        controller: [\n            '$scope',\n            '$element',\n            '$attrs',\n            '$q',\n            'CommonUtils',\n            function($scope, $element, $attrs, $q, CommonUtils){\n\n                $scope.status = \"\";\n                $scope.clickedButton = \"\";\n\n                $scope.valueClicked = function (buttonValue){\n\n                    $scope.clickedButton = buttonValue;\n\n                    var originalValue = $scope.value;\n                    var tempValue = buttonValue;\n                    if($scope.value === buttonValue){\n                        tempValue = \"\";\n                    }\n\n                    if(angular.isDefined($scope.customOnClick)){\n                        var promise = $scope.customOnClick({value: tempValue});\n                        if(angular.isDefined(promise) && angular.isDefined(promise.then)){\n                            promise.then(function(status){\n                                if(angular.isUndefined(status) || status !== \"notSaved\"){\n                                    $scope.status = \"saved\";\n                                }\n                                $scope.value = tempValue;\n                            }, function(){\n                                $scope.status = \"error\";\n                                $scope.value = originalValue;\n                            });\n                        }\n                        else if(angular.isDefined(promise)){\n                            if(promise === false){\n                                $scope.value = originalValue;\n                            }\n                            else {\n                                $scope.value = tempValue;\n                            }\n                        }\n                        else{\n                            $scope.value = tempValue;\n                        }\n                    }\n                    else{\n                        $scope.value = tempValue;\n                    }\n                };\n\n                $scope.getDisabledValue = function(inValue){\n                    return CommonUtils.displayBooleanAsYesNo(inValue);\n                };\n\n                $scope.getDisabledIcon = function(inValue){\n                    if(inValue === true || inValue === \"true\"){\n                        return \"fa fa-check\";\n                    }\n                    else if(inValue === false || inValue === \"false\"){\n                        return \"fa fa-times\";\n                    }\n                    return '';\n                }\n\n            }],\n        link: function (scope, element, attrs) {\n\n            scope.radioButtonColor = function(buttonValue){\n\n                if(scope.value !== \"\"){\n                    if(scope.status === \"saved\"){\n                        if(angular.isUndefined(scope.currentElement) || (scope.currentElement.id === scope.id && scope.currentElement.event === scope.event)){\n                            if(scope.clickedButton === buttonValue){\n                                return 'radio-save-success';\n                            }\n                        }\n                        //different solution with text chosen\n                        /*else if(scope.status === \"error\"){\n                         if(scope.clickedButton === buttonValue){\n                         return 'radio-save-error';\n                         }\n                         }*/\n                    }\n                }\n                return 'radio-white';\n            };\n\n            scope.errorStatus = function(){\n\n                if(scope.status === 'error'){\n                    if(angular.isUndefined(scope.currentElement) || (scope.currentElement.id === scope.id && scope.currentElement.event === scope.event)){\n                        return true;\n                    }\n                }\n                return false;\n            };\n\n            scope.radioButtonImage = function(buttonValue){\n\n                if(angular.isDefined(scope.value)){\n                    if(scope.value === buttonValue && buttonValue === \"true\"){\n                        return 'fa fa-stack-1x fa-check';\n                    }\n                    else if(scope.value === buttonValue && buttonValue === \"false\"){\n                        return 'fa fa-stack-1x fa-times';\n                    }\n                }\n                return 'fa fa-stack-1x';\n            };\n        }\n    };\n})\n\n.directive('d2Radio', function(  DateUtils ){\n    return {\n        restrict: 'EA',            \n        templateUrl: \"./templates/radio-input.html\",\n        scope: {            \n            id: '=',\n            name: '@d2Name',\n            d2Object: '=',\n            d2ValueSaved: '=',\n            d2Disabled: '=',\n            d2Required: '=',\n            d2Options: '=',\n            d2CallbackFunction: '&d2Function'\n        },\n        link: function (scope, element, attrs) {\n            \n        },\n        controller: function($scope){\n            \n            $scope.$watch('d2Object',function(newObj, oldObj){\n                if( angular.isObject(newObj) ){\n                    $scope.d2Object = newObj;\n                    $scope.model = {radio: $scope.d2Object[$scope.id] ? $scope.d2Object[$scope.id] : null};\n                }                \n            });\n\n            $scope.model = {radio: $scope.d2Object[$scope.id] ? $scope.d2Object[$scope.id] : null};\n            \n            $scope.saveValue = function( value ){\n                $scope.model.radio = value;\n                if( $scope.model.radio === $scope.d2Object[$scope.id] ){\n                    $scope.model.radio = null;\n                }\n                \n                $scope.d2Object[$scope.id] = $scope.model.radio;\n                if( angular.isDefined( $scope.d2CallbackFunction ) ){\n                    $scope.d2CallbackFunction({value: $scope.model.radio});\n                }\n            };\n        }\n    };\n})\n\n.directive('dhis2Deselect', function ($document) {\n    return {\n        restrict: 'A',\n        scope: {\n            onDeselected: '&dhOnDeselected',\n            id: '@dhId',\n            preSelected: '=dhPreSelected',\n            abortDeselect: '&dhAbortDeselect'\n        },\n        controller: [\n            '$scope',\n            '$element',\n            '$attrs',\n            '$q',\n            function($scope, $element, $attrs, $q){\n\n                $scope.documentEventListenerSet = false;\n                $scope.elementClicked = false;\n\n                $element.on('click', function(event) {\n\n                    $scope.elementClicked = true;\n                    if($scope.documentEventListenerSet === false){\n                        $document.on('click', $scope.documentClick);\n                        $scope.documentEventListenerSet = true;\n                    }\n                });\n\n                $scope.documentClick = function(event){\n                    var modalPresent = $(\".modal-backdrop\").length > 0;\n                    var calendarPresent = $(\".calendars-popup\").length > 0;\n                    var calendarPresentInEvent = $(event.target).parents(\".calendars-popup\").length > 0;\n                    if($scope.abortDeselect()){\n                        $document.off('click', $scope.documentClick);\n                        $scope.documentEventListenerSet = false;\n                    }else if($scope.elementClicked === false &&\n                        modalPresent === false &&\n                        calendarPresent === false &&\n                        calendarPresentInEvent === false){\n                        $scope.onDeselected({id:$scope.id});\n                        $scope.$apply();\n                        $document.off('click', $scope.documentClick);\n                        $scope.documentEventListenerSet = false;\n                    }\n                    $scope.elementClicked = false;\n                };\n\n                if(angular.isDefined($scope.preSelected) && $scope.preSelected === true){\n                    $document.on('click', $scope.documentClick);\n                    $scope.documentEventListenerSet = true;\n                }\n\n            }],\n        link: function (scope, element, attrs) {\n        }\n    };\n})\n\n.directive('d2OrgUnitTree', function(OrgUnitFactory){\n    return {\n        restrict: 'EA',            \n        templateUrl: \"./templates/orgunit-input.html\",\n        scope: {            \n            selectedOrgUnitId: '@',\n            id: '@',\n            d2Object: '=',\n            d2Disabled: '=',\n            d2Required: '=',\n            d2CallbackFunction: '&d2Function',\n            d2OrgunitNames: '='\n        },\n        link: function (scope, element, attrs) {\n        },\n        controller: function($scope, $modal){\n            \n            if( !$scope.d2OrgUnitNames ){\n                $scope.d2OrgUnitNames = {};\n            }\n\n            $scope.$watch('d2Object',function(newObj, oldObj){\n                if( angular.isObject(newObj) ){\n                    $scope.d2Object = newObj;\n                    fetchOu();\n                }\n            });\n            \n            function fetchOu(){\n                if( $scope.id && $scope.d2Object[$scope.id] ){                \n                    OrgUnitFactory.getFromStoreOrServer($scope.d2Object[$scope.id]).then(function (response) {\n                        if(response && response.n) {\n                            $scope.d2OrgunitNames[$scope.d2Object[$scope.id]] = response.n;\n                        }\n                    });\n                }\n            }\n            \n            fetchOu();\n\n            $scope.showOrgUnitTree = function( dataElementId ){\n                \n                var modalInstance = $modal.open({\n                    templateUrl: \"./templates/orgunit-tree.html\",\n                    controller: 'OrgUnitTreeController',\n                    resolve: {\n                        orgUnitId: function(){\n                            return $scope.d2Object[dataElementId] ? $scope.d2Object[dataElementId] : $scope.selectedOrgUnitId;\n                        },\n                        orgUnitNames: function(){\n                            return $scope.d2OrgunitNames;\n                        }\n                    }\n                });\n\n                modalInstance.result.then(function ( res ) {\n                    if( res && res.selected && res.selected.id ){\n                        $scope.d2Object[dataElementId] = res.selected.id;\n                        $scope.d2OrgunitNames = res.names;\n                        if( angular.isDefined( $scope.d2CallbackFunction ) ){\n                            $scope.d2CallbackFunction($scope.d2Object, dataElementId);\n                        }                            \n                    }                    \n                }, function () {\n                });\n            };\n            \n            $scope.removeSelectedOrgUnit = function( dataElementId ){\n                delete $scope.d2Object[dataElementId];\n                if( angular.isDefined( $scope.d2CallbackFunction ) ){\n                    $scope.d2CallbackFunction($scope.d2Object, dataElementId);\n                }\n            };\n        }\n        \n    };\n})\n\n.directive('d2Map', function(){\n    return {\n        restrict: 'E',            \n        templateUrl: \"./templates/coordinate-input.html\",\n        scope: {\n            id: '@',            \n            d2Object: '=',            \n            d2CallbackFunction: '&d2Function',\n            d2CallbackFunctionParamText: '=d2FunctionParamText',\n            d2CallbackFunctionParamCoordinate: '=d2FunctionParamCoordinate',\n            d2Disabled: '=',\n            d2Required: '=',\n            d2LatSaved: '=',\n            d2LngSaved: '=',\n            d2CoordinateFormat: '='\n        },\n        controller: function($scope, $modal, $filter, $translate, DHIS2COORDINATESIZE, NotificationService){\n\n            $scope.$watch('d2Object',function(newObj, oldObj){\n                if( angular.isObject(newObj) ){\n                    $scope.d2Object = newObj;\n                    $scope.coordinateObject = angular.copy( $scope.d2Object );\n                    processCoordinate();\n                }\n            });\n\n            $scope.coordinateObject = angular.copy( $scope.d2Object );\n            \n            function processCoordinate(){\n            \tif( $scope.d2CoordinateFormat === 'TEXT' ){        \n                    if( $scope.d2Object[$scope.id] && $scope.d2Object[$scope.id] !== ''){                        \n                        var coordinatePattern = /^\\[-?\\d+\\.?\\d+\\,-?\\d+\\.?\\d+\\]$/;\n                        if( !coordinatePattern.test( $scope.d2Object[$scope.id] ) ){\n                            NotificationService.showNotifcationDialog($translate.instant('error'), $translate.instant('invalid_coordinate_format') + \":  \" + $scope.d2Object[$scope.id] );\n                        }\n                        \n                    \tvar coordinates = $scope.d2Object[$scope.id].slice(1,-1).split( \",\");                        \n                    \tif( !dhis2.validation.isNumber( coordinates[0] ) || !dhis2.validation.isNumber( coordinates[0] ) ){\n                            NotificationService.showNotifcationDialog($translate.instant('error'), $translate.instant('invalid_coordinate_format') + \":  \" + $scope.d2Object[$scope.id] );\n                    \t}\n                        $scope.coordinateObject.coordinate = {latitude: parseFloat(coordinates[1]), longitude: parseFloat(coordinates[0])};\n                    }\n                    else{\n                        $scope.coordinateObject.coordinate = {};\n                    }\n                }            \n                if( !$scope.coordinateObject.coordinate ){\n                    $scope.coordinateObject.coordinate = {};\n                }\n            };\n            \n            processCoordinate();\n            \n            $scope.showMap = function(){                \n                \n            \tprocessCoordinate();            \t\n                            \n                var modalInstance = $modal.open({\n                    templateUrl: './templates/map.html',\n                    controller: 'MapController',\n                    windowClass: 'modal-map-window',\n                    resolve: {\n                        location: function () {\n                            return {lat: $scope.coordinateObject.coordinate.latitude, lng:  $scope.coordinateObject.coordinate.longitude};\n                        }\n                    }\n                });\n                \n                modalInstance.result.then(function (location) {                    \n                    if(angular.isObject(location)){\n                    \t\n                    \tif( dhis2.validation.isNumber( location.lat ) ){\n                    \t\tlocation.lat = parseFloat( $filter('number')(location.lat, DHIS2COORDINATESIZE) );\n                    \t}\n                    \t\n                    \tif( dhis2.validation.isNumber( location.lng ) ){\n                    \t\tlocation.lng = parseFloat( $filter('number')(location.lng, DHIS2COORDINATESIZE) );\n                    \t}\n                    \t\n                        $scope.coordinateObject.coordinate.latitude = location.lat;\n                        $scope.coordinateObject.coordinate.longitude = location.lng;                        \n\n                        if( $scope.d2CoordinateFormat === 'TEXT' ){                        \n                            $scope.d2Object[$scope.id] = '[' + location.lng + ',' + location.lat + ']';\n                            if( angular.isDefined( $scope.d2CallbackFunction ) ){\n                                $scope.d2CallbackFunction( {arg1: $scope.d2CallbackFunctionParamText} );\n                            }\n                        }\n                        else{\n                            $scope.d2Object.coordinate.latitude = location.lat;\n                            $scope.d2Object.coordinate.longitude = location.lng;\n                            if( angular.isDefined( $scope.d2CallbackFunction ) ){\n                                $scope.d2CallbackFunction( {arg1: $scope.d2CallbackFunctionParamCoordinate} );\n                            }\n                        }                                                \n                    }\n                }, function () {\n                });\n            };\n            \n            $scope.coordinateInteracted = function (field, form) {        \n                var status = false;\n                if (field) {\n                    if(angular.isDefined(form)){\n                        status = form.$submitted || field.$dirty;\n                    }\n                    else {\n                        status = $scope.coordinateForm.$submitted || field.$dirty;\n                    }            \n                }\n                return status;\n            };\n            \n            $scope.saveD2Coordinate = function(){\n                \n                var saveCoordinate = function( format, param ){\n                    if( !$scope.coordinateObject.coordinate.longitude && !$scope.coordinateObject.coordinate.latitude ){\n                        if( format === 'COORDINATE' ){\n                            $scope.d2Object.coordinate = {latitude: \"\", longitude: \"\"};\n                        }\n                        else{\n                            $scope.d2Object[$scope.id] = '';\n                        }\n                        $scope.d2CallbackFunction( {arg1: param} );                            \n                    }\n                    else{\n                        if( $scope.coordinateObject.coordinate.longitude && $scope.coordinateObject.coordinate.latitude ){\n                            $scope.d2CallbackFunction( {arg1: param} );\n                        }\n                    }                    \n                };\n                \n                if( angular.isDefined( $scope.d2CallbackFunction ) ){\n                \t\n                \tif( dhis2.validation.isNumber( $scope.coordinateObject.coordinate.latitude ) ){\n                \t\t$scope.coordinateObject.coordinate.latitude = parseFloat( $filter('number')($scope.coordinateObject.coordinate.latitude, DHIS2COORDINATESIZE) );\n                \t}\n                \t\n                \tif( dhis2.validation.isNumber( $scope.coordinateObject.coordinate.longitude ) ){\n                \t\t$scope.coordinateObject.coordinate.longitude = parseFloat( $filter('number')($scope.coordinateObject.coordinate.longitude, DHIS2COORDINATESIZE) );\n                \t}\n                \t\n                    if( $scope.d2CoordinateFormat === 'TEXT' ){                    \n                        $scope.d2Object[$scope.id] = '[' + $scope.coordinateObject.coordinate.longitude + ',' + $scope.coordinateObject.coordinate.latitude + ']';                        \n                        saveCoordinate( 'TEXT',  $scope.prStDe);\n                    }\n                    else{\n                        $scope.d2Object.coordinate.latitude = $scope.coordinateObject.coordinate.latitude;\n                        $scope.d2Object.coordinate.longitude = $scope.coordinateObject.coordinate.longitude;\n                        \n                        saveCoordinate( 'COORDINATE',  $scope.d2CallbackFunctionParam );                        \n                    }\n                }\n            };    \n        },\n        link: function (scope, element, attrs) {\n            \n        }\n    };\n})\n\n.directive('d2Age', function( CalendarService, DateUtils ){\n    return {\n        restrict: 'EA',            \n        templateUrl: \"./templates/age-input.html\",\n        scope: {\n            id: '@',\n            d2Object: '=',\n            d2AgeSaved: '=',\n            d2Disabled: '=',\n            d2Required: '=',\n            d2CallbackFunction: '&d2Function'\n        },\n        link: function (scope, element, attrs) {\n            \n        },\n        controller: function($scope){            \n            \n            $scope.age = {};\n            \n            if( $scope.id && $scope.d2Object && $scope.d2Object[$scope.id] ){\n                $scope.age.dob = $scope.d2Object[$scope.id];\n                formatAge();\n            }\n            \n            function formatAge(){\n                if( $scope.age && $scope.age.dob !== \"\" ){\n                    var _age = DateUtils.getAge( $scope.age.dob );                    \n                    $scope.age.years = _age.years;\n                    $scope.age.months = _age.months;\n                    $scope.age.days = _age.days;\n                }\n            }\n            \n            $scope.$watch('age.dob', function( newValue, oldValue ){\n                if( newValue !== oldValue ){\n                    $scope.d2Object[$scope.id] = $scope.age.dob;\n                    if( angular.isDefined( $scope.d2CallbackFunction ) ){\n                        $scope.d2CallbackFunction($scope.d2Object, $scope.id);\n                    }\n                }\n            });\n            \n            $scope.saveDOB = function(){                \n                formatAge();                \n            };\n            \n            $scope.saveAge = function(){\n                var dob = moment().subtract({days: $scope.age.days ? $scope.age.days : 0, months: $scope.age.months ? $scope.age.months : 0, years: $scope.age.years ? $scope.age.years : 0});\n                $scope.age.dob = DateUtils.format( dob );\n                formatAge();\n            };\n            \n            $scope.removeAge = function(){\n                $scope.age = {};\n            };\n            \n            $scope.ageInteracted = function (field, form) {        \n                var status = false;\n                if (field) {\n                    if(angular.isDefined(form)){\n                        status = form.$submitted || field.$dirty;\n                    }\n                    else {\n                        status = $scope.ageForm.$submitted || field.$dirty;\n                    }            \n                }\n                return status;\n            };\n        }\n    };\n});\n\n\n// WEBPACK FOOTER //\n// ../d2-tracker/lib/dhis2.angular.directives.js","angular.module(\"d2Directives\")\n.directive('d2NumberValidator', function() {\n    return {\n        require: 'ngModel',\n        restrict: 'A',\n        link: function (scope, element, attrs, ngModel) {\n            \n            function setValidity(numberType, isRequired){\n                if(numberType === 'NUMBER'){\n                    ngModel.$validators.number = function(value) {\n                    \tvalue = value === 0 ? value.toString(): value; \n                        return value === 'null' || !value ? !isRequired : dhis2.validation.isNumber(value);\n                    };\n                }\n                else if(numberType === 'INTEGER_POSITIVE'){\n                    ngModel.$validators.posInt = function(value) {\n                    \tvalue = value === 0 ? value.toString(): value; \n                        return value === 'null' || !value ? !isRequired : dhis2.validation.isPositiveInt(value);\n                    };\n                }\n                else if(numberType === 'INTEGER_NEGATIVE'){\n                    ngModel.$validators.negInt = function(value) {\n                    \tvalue = value === 0 ? value.toString(): value;\n                        return value === 'null' || !value ? !isRequired : dhis2.validation.isNegativeInt(value);\n                    };\n                }\n                else if(numberType === 'INTEGER_ZERO_OR_POSITIVE'){\n                    ngModel.$validators.zeroPositiveInt = function(value) {\n                    \tvalue = value === 0 ? value.toString(): value; \n                        return value === 'null' || !value ? !isRequired : dhis2.validation.isZeroOrPositiveInt(value);\n                    };\n                }\n                else if(numberType === 'INTEGER'){\n                    ngModel.$validators.integer = function(value) {\n                    \tvalue = value === 0 ? value.toString(): value;\n                        return value === 'null' || !value ? !isRequired : dhis2.validation.isInt(value);\n                    };\n                }\n                if(numberType === 'PERCENTAGE'){\n                    ngModel.$validators.percentValue = function(value) {\n                        if (value < 0 || value > 100) {\n                            return false;\n                        }\n                        value = value === 0 ? value.toString(): value;\n                        return value === 'null' || !value ? !isRequired : dhis2.validation.isNumber(value);\n                    };\n                }\n            }\n\n            var numberType = attrs.numberType;\n            var isRequired = attrs.ngRequired === 'true';            \n            setValidity(numberType, isRequired);\n        }\n    };\n})\n\n.directive(\"d2DateValidator\", function(DateUtils, CalendarService, $parse) {\n    return {\n        restrict: \"A\",         \n        require: \"ngModel\",         \n        link: function(scope, element, attrs, ngModel) {\n        \t\n            var calendarSetting = CalendarService.getSetting();\n            var isRequired = attrs.ngRequired === 'true';\n        \t\n            ngModel.$validators.dateValidator = function(value) {\n                if(!value){\n                    return !isRequired;\n                }                \n                var convertedDate = DateUtils.format(angular.copy(value));\n                var isValid = value === convertedDate;\n                return isValid;\n            };\n            \n            ngModel.$validators.futureDateValidator = function(value) {\n                if(!value){\n                    return !isRequired;\n                }\n                var maxDate = $parse(attrs.maxDate)(scope);\n                var convertedDate = DateUtils.format(angular.copy(value));\n                var isValid = value === convertedDate;\n                if(isValid){\n                    isValid = maxDate === 0 ? !moment(convertedDate, calendarSetting.momentFormat).isAfter(moment(DateUtils.getToday(), calendarSetting.momentFormat)) : isValid;\n                }\n                return isValid;\n            };\n        }\n    };\n})\n\n.directive(\"d2CustomCoordinateValidator\", function() {\n    return {\n        restrict: \"A\",         \n        require: \"ngModel\",         \n        link: function(scope, element, attrs, ngModel) {\n            \n            var isRequired = attrs.ngRequired === 'true';\n            \n            ngModel.$validators.customCoordinateValidator = function(value) {\n                if(!value){\n                    return !isRequired;\n                }\n                \n                var coordinate = value.split(\",\");\n                \n                if( !coordinate || coordinate.length !== 2 ){\n                    return false;\n                }\n\n                if( !dhis2.validation.isNumber(coordinate[0]) ){\n                    return false;\n                }\n                \n                if( !dhis2.validation.isNumber(coordinate[1]) ){\n                    return false;\n                }\n                \n                return coordinate[0] >= -180 && coordinate[0] <= 180 && coordinate[1] >= -90 && coordinate[1] <= 90;\n            };           \n        }\n    };\n})\n\n.directive(\"d2CoordinateValidator\", function() {\n    return {\n        restrict: \"A\",         \n        require: \"ngModel\",         \n        link: function(scope, element, attrs, ngModel) {\n            \n            var isRequired = attrs.ngRequired === 'true';\n            \n            if(attrs.name === 'latitude'){\n                ngModel.$validators.latitudeValidator = function(value) {\n                    if(!value){\n                        return !isRequired;\n                    }\n\n                    if(!dhis2.validation.isNumber(value)){\n                        return false;\n                    }\n                    return value >= -90 && value <= 90;\n                };\n            }\n            \n            if(attrs.name === 'longitude'){\n                ngModel.$validators.longitudeValidator = function(value) {\n                    if(!value){\n                        return !isRequired;\n                    }\n\n                    if(!dhis2.validation.isNumber(value)){\n                        return false;\n                    }\n                    return value >= -180 && value <= 180;\n                };\n            }            \n        }\n    };\n})\n\n.directive(\"d2OptionValidator\", function($translate, NotificationService) {\n    return {\n        restrict: \"A\",         \n        require: \"ngModel\",         \n        link: function(scope, element, attrs, ngModel) {\n        \t\n            var isRequired = attrs.ngRequired === 'true';\n            \n            ngModel.$validators.optionValidator = function(value) {               \n                \n                var res = !value ? !isRequired : true;\n                \n                if(!res){\n                    var headerText = $translate.instant(\"validation_error\");\n                    var bodyText = $translate.instant(\"option_required\");\n                    NotificationService.showNotifcationDialog(headerText, bodyText);\n                }\n                return res;\n            };\n        }\n    };\n})\n\n.directive(\"d2AttributeValidator\", function($q, TEIService, SessionStorageService) {\n    return {\n        restrict: \"A\",         \n        require: \"ngModel\",\n        link: function(scope, element, attrs, ngModel) {            \n            \n            function uniqunessValidatior(attributeData){\n                \n                ngModel.$asyncValidators.uniqunessValidator = function (modelValue, viewValue) {\n                    var pager = {pageSize: 1, page: 1, toolBarDisplay: 5};\n                    var deferred = $q.defer(), currentValue = modelValue || viewValue, programUrl = null, ouMode = 'ALL';\n                    \n                    if (currentValue) {\n                        \n                        attributeData.value = currentValue;                        \n                        var attUrl = 'filter=' + attributeData.id + ':EQ:' + attributeData.value;\n                        var ouId = SessionStorageService.get('ouSelected');\n                        \n                        if(attrs.selectedProgram && attributeData.programScope){\n                            programUrl = 'program=' + attrs.selectedProgram;\n                        }\n                        \n                        if(attributeData.orgUnitScope){\n                            ouMode = 'SELECTED';\n                        }                        \n\n                        TEIService.search(ouId, ouMode, null, programUrl, attUrl, pager, true).then(function(data) {\n                            if(attrs.selectedTeiId){\n                                if(data && data.rows && data.rows.length && data.rows[0] && data.rows[0].length && data.rows[0][0] !== attrs.selectedTeiId){\n                                    deferred.reject();\n                                }\n                            }\n                            else{\n                                if (data.rows.length > 0) {    \n                                    deferred.reject();\n                                }\n                            }                            \n                            deferred.resolve();\n                        });\n                    }\n                    else {\n                        deferred.resolve();\n                    }\n\n                    return deferred.promise;\n                };\n            }                      \n            \n            scope.$watch(attrs.ngDisabled, function(value){\n                var attributeData = scope.$eval(attrs.attributeData);\n                if(!value){\n                    if( attributeData && attributeData.unique && !value ){\n                        uniqunessValidatior(attributeData);\n                    }\n                }              \n            });     \n        }\n    };\n});\n\n\n// WEBPACK FOOTER //\n// ../d2-tracker/lib/dhis2.angular.validations.js","'use strict';\n\n/* Filters */\n\nvar d2Filters = angular.module('d2Filters', [])\n\n.filter('gridFilter', function($filter, CalendarService){\n    \n    return function(data, filters, filterTypes){\n\n        if(!data ){\n            return;\n        }\n        \n        if(!filters){\n            return data;\n        }        \n        else{            \n            \n            var dateFilter = {}, \n                textFilter = {}, \n                numberFilter = {},\n                filteredData = data;\n            \n            for(var key in filters){\n                \n                if(filterTypes[key] === 'DATE'){\n                    if(filters[key].start || filters[key].end){\n                        dateFilter[key] = filters[key];\n                    }\n                }\n                else if(filterTypes[key] === 'NUMBER' || \n                \t\t\tfilterTypes[key] === 'INTEGER' ||\n                \t\t\tfilterTypes[key] === 'INTEGER_POSITIVE' || \n                \t\t\tfilterTypes[key] === 'INTEGER_NEGATIVE' || \n                \t\t\tfilterTypes[key] === 'INTEGER_ZERO_OR_POSITIVE'){\n                    if(filters[key].start || filters[key].end){\n                        numberFilter[key] = filters[key];\n                    }\n                }\n                else{\n                    textFilter[key] = filters[key];\n                }\n            }\n            \n            filteredData = $filter('filter')(filteredData, textFilter); \n            filteredData = $filter('filter')(filteredData, dateFilter, dateComparator);            \n            filteredData = $filter('filter')(filteredData, numberFilter, numberComparator);\n                        \n            return filteredData;\n        } \n    }; \n    \n    function dateComparator(data,filter){\n    \tvar calendarSetting = CalendarService.getSetting(); \n        var start = moment(filter.start, calendarSetting.momentFormat);\n        var end = moment(filter.end, calendarSetting.momentFormat);  \n        var date = moment(data, calendarSetting.momentFormat); \n        \n        if(filter.start && filter.end){\n            return ( Date.parse(date) <= Date.parse(end) ) && (Date.parse(date) >= Date.parse(start));\n        }        \n        return ( Date.parse(date) <= Date.parse(end) ) || (Date.parse(date) >= Date.parse(start));\n    }\n    \n    function numberComparator(data,filter){\n        var start = filter.start;\n        var end = filter.end;\n        \n        if(filter.start && filter.end){\n            return ( data <= end ) && ( data >= start );\n        }        \n        return ( data <= end ) || ( data >= start );\n    }\n})\n\n.filter('paginate', function(Paginator) {\n    return function(input, rowsPerPage) {\n        if (!input) {\n            return input;\n        }\n\n        if (rowsPerPage) {\n            Paginator.rowsPerPage = rowsPerPage;\n        }       \n        \n        Paginator.itemCount = input.length;\n\n        return input.slice(parseInt(Paginator.page * Paginator.rowsPerPage), parseInt((Paginator.page + 1) * Paginator.rowsPerPage + 1) - 1);\n    };\n})\n\n/* trim away all single and double quotes in the start and end of a string*/\n.filter('trimquotes', function() {\n    return function(input) {\n        if (!input || (typeof input !== 'string' && !(input instanceof String))) {\n            return input;\n        }\n        \n        var beingTrimmed = input;\n        var trimmingComplete = false;\n        //Trim until no more quotes can be removed.\n        while(!trimmingComplete) {\n            var beforeTrimming = beingTrimmed;\n            beingTrimmed = input.replace(/^'/,\"\").replace(/'$/,\"\");\n            beingTrimmed = beingTrimmed.replace(/^\"/,\"\").replace(/\"$/,\"\");\n            \n            if(beforeTrimming.length === beingTrimmed.length) {\n                trimmingComplete = true;\n            }\n        }\n        \n        \n        return beingTrimmed;\n    };\n})\n\n/* filter out confidential attributes from a list */\n.filter('nonConfidential', function() {\n  return function( items ) {\n    var filtered = [];\n    angular.forEach(items, function(item) {\n      if(!item.confidential) {\n        filtered.push(item);\n      }\n    });\n    return filtered;\n  };\n})\n\n/* trim away the qualifiers before and after a variable name */\n.filter('trimvariablequalifiers', function() {\n    return function(input) {\n        if (!input || (typeof input !== 'string' && !(input instanceof String))) {\n            return input;\n        }\n        \n        var trimmed = input.replace(/^[#VCAvca]{/,\"\").replace(/}$/,\"\");\n        \n        return trimmed;\n    };\n})\n\n.filter('forLoop', function() {\n    return function(input, start, end) {\n        input = new Array(end - start);\n        for (var i = 0; start < end; start++, i++) {\n            input[i] = start;\n        }\n        return input;\n    };\n})\n\n.filter('parseAge', function(DateUtils){\n    return function(input){        \n        if( DateUtils.isValid( input ) ){            \n            var age = DateUtils.getAge( input );\n            return '[' + age.years + 'y, ' + age.months + 'm, ' + age.days + 'd]';\n        }\n        return input;\n    };\n})\n\n\n\n\n// WEBPACK FOOTER //\n// ../d2-tracker/lib/dhis2.angular.filters.js","'use strict';\n\n/* Controllers */\nvar d2Controllers = angular.module('d2Controllers', [])\n\n//Controller for column show/hide\n.controller('ColumnDisplayController', \n    function($scope, \n            $modalInstance,\n            hiddenGridColumns,\n            gridColumns,\n            gridColumnDomainKey,\n            gridColumnKey,\n            gridColumnsInUserStore,\n            GridColumnService){\n    \n    $scope.gridColumns = gridColumns;\n    $scope.hiddenGridColumns = hiddenGridColumns;\n    \n    $scope.close = function () {\n        $modalInstance.close($scope.gridColumns);\n    };\n    \n    $scope.showHideColumns = function(gridColumn){\n       \n        if(gridColumn.show){                \n            $scope.hiddenGridColumns--;            \n        }\n        else{\n            $scope.hiddenGridColumns++;            \n        }\n        \n        if(gridColumnKey) {\n            gridColumnsInUserStore[gridColumnKey] = angular.copy($scope.gridColumns);\n        }\n        GridColumnService.set(gridColumnsInUserStore, gridColumnDomainKey);\n    };    \n})\n\n//controller for dealing with google map\n.controller('MapController',\n        function($scope, \n                $modalInstance,                \n                $translate,\n                $http,\n                $window,\n                $q,\n                CommonUtils,\n                leafletData,\n                CurrentSelection,\n                DHIS2URL,\n                NotificationService,\n                location) {\n    \n    $scope.tilesDictionary = {\n        openstreetmap: {\n            url: \"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n            options: {\n                attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n            }\n        },\n        googlemap: {\n            layers: {\n                baselayers: {\n                    googleRoadmap: {\n                        name: 'Google Streets',\n                        layerType: 'ROADMAP',\n                        type: 'google'\n                    },\n                    googleHybrid: {\n                        name: 'Google Hybrid',\n                        layerType: 'HYBRID',\n                        type: 'google'\n                    },\n                    googleTerrain: {\n                        name: 'Google Terrain',\n                        layerType: 'TERRAIN',\n                        type: 'google'\n                    }\n                }\n            }\n        }\n    };\n    \n    $scope.tilesDictionaryKeys = ['openstreetmap', 'googlemap'];    \n    \n    $scope.selectedTileKey = 'openstreetmap';\n    \n    $scope.location = location;\n    \n    var currentLevel = 0, ouLevels = CurrentSelection.getOuLevels();\n    \n    $scope.maxZoom = 8;\n    \n    $scope.center = {lat: 8.88, lng: -11.55, zoom: $scope.maxZoom};    \n    \n    var systemSetting = CommonUtils.getSystemSetting();\n    \n    if( !systemSetting.keyGoogleMapsApiKey || systemSetting.keyGoogleMapsApiKey === '' ){\n        NotificationService.showNotifcationDialog($translate.instant(\"warning\"), $translate.instant(\"missing_google_maps_api_key\"));\n        systemSetting.keyGoogleMapsApiKey = 'AIzaSyBjlDmwuON9lJbPMDlh_LI3zGpGtpK9erc';\n    }\n    \n    if( !systemSetting.keyMapzenSearchApiKey || systemSetting.keyMapzenSearchApiKey === '' ){\n        NotificationService.showNotifcationDialog($translate.instant(\"warning\"), $translate.instant(\"missing_mapzen_search_api_key\"));\n        systemSetting.keyMapzenSearchApiKey = 'search-Se1CFzK';\n    }    \n    \n    var setCoordinateLabel = '<i class=\"fa fa-map-marker fa-2x\"></i><span class=\"small-horizontal-spacing\">' + $translate.instant('set_coordinate') + '</span>';\n    var zoomInLabel = '<i class=\"fa fa-search-plus fa-2x\"></i><span class=\"small-horizontal-spacing\">' + $translate.instant('zoom_in') + '</span>';\n    var zoomOutLabel = '<i class=\"fa fa-search-minus fa-2x\"></i><span class=\"small-horizontal-spacing\">' + $translate.instant('zoom_out') + '</span>';\n    var centerMapLabel = '<i class=\"fa fa-crosshairs fa-2x\"></i><span class=\"small-horizontal-spacing\">' + $translate.instant('center_map') + '</span>';\n    \n    var contextmenuItems = [{\n                        text: setCoordinateLabel,\n                        callback: setCoordinate,\n                        index: 0\n                    },\n                    {\n                        separator: true,\n                        index: 1\n                    },\n                    {\n                        text: zoomInLabel,\n                        callback: zoomIn,\n                        index: 2\n                    },\n                    {\n                        text: zoomOutLabel,\n                        callback: zoomOut,\n                        index: 3\n                    },\n                    {\n                        separator: true,\n                        index: 4\n                    },\n                    {\n                        text: centerMapLabel,\n                        callback: centerMap,\n                        index: 5\n                    }];\n                        \n    $scope.mapDefaults = {map: {\n                            contextmenu: true,\n                            contextmenuWidth: 180,\n                            contextmenuItems: contextmenuItems\n                        }};\n    \n    var geojsonMarkerOptions = {\n\t\t\t    radius: 15,\n\t\t\t    fillColor: '#ff7800',\n\t\t\t    color: '#000',\n\t\t\t    weight: 1,\n\t\t\t    opacity: 1,\n\t\t\t    fillOpacity: 0.8\n\t\t\t};\n                        \n    var style = {fillColor: \"green\",\n                    weight: 1,\n                    opacity: 0.8,\n                    color: 'black',\n                    fillOpacity: 0\n                };\n\n    $scope.marker = $scope.location && $scope.location.lat && $scope.location.lng ? {m1: {lat: $scope.location.lat, lng: $scope.location.lng, draggable: true}} : {};\n    \n    function pointToLayer( feature, latlng ){\n        return L.circleMarker(latlng, geojsonMarkerOptions);\n    };\n    \n    function onEachFeature(feature, layer) {\n        \n        layer.on(\"mouseover\",function(e){            \n            $(\"#polygon-label\").text( feature.properties.name );\n        });\n        layer.on(\"mouseout\",function(e){\n            $(\"#polygon-label\").text('');\n        });        \n        \n        if( layer._layers ){\n            layer.eachLayer(function (l) {\n                l.bindContextMenu({\n                    contextmenu: true,\n                    contextmenuWidth: 180,                \n                    contextmenuItems: [{\n                                    text: setCoordinateLabel,\n                                    callback: function(e){\n                                        setCoordinate(e, feature);\n                                    },\n                                    index: 0\n                                },\n                                {\n                                    separator: true,\n                                    index: 1\n                                },\n                                {\n                                    text: zoomInLabel,\n                                    callback: function(e){\n                                        zoomIn(e, feature);\n                                    },\n                                    index: 2\n                                },\n                                {\n                                    text: zoomOutLabel,\n                                    callback: function(e){\n                                        zoomOut(e, feature);\n                                    },\n                                    index: 3,\n                                    disabled: currentLevel < 1\n                                },\n                                {\n                                    separator: true,\n                                    index: 4\n                                },\n                                {\n                                    text: centerMapLabel,\n                                    callback: function(e){\n                                        centerMap(e, feature);\n                                    },\n                                    index: 5\n                                }]\n                });\n            });\n        }\n        else{\n            layer.bindContextMenu({\n                    contextmenu: true,\n                    contextmenuWidth: 180,\n                    contextmenuInheritItems: false,\n                    contextmenuItems: [{\n                                    text: setCoordinateLabel,\n                                    callback: function(e){\n                                        setCoordinate(e, feature, layer);\n                                    },\n                                    index: 0\n                                },\n                                {\n                                    separator: true,\n                                    index: 1\n                                },\n                                {\n                                    text: zoomInLabel,\n                                    callback: function(e){\n                                        zoomIn(e, feature);\n                                    },\n                                    disabled: true,\n                                    index: 2\n                                },\n                                {\n                                    text: zoomOutLabel,\n                                    callback: function(e){\n                                        zoomOut(e, feature);\n                                    },\n                                    index: 3\n                                },\n                                {\n                                    separator: true,\n                                    index: 4\n                                },\n                                {\n                                    text: centerMapLabel,\n                                    callback: function(e){\n                                        centerMap(e, feature);\n                                    },\n                                    index: 5\n                                }]\n                });\n        }        \n    }    \n            \n    function getGeoJsonByOuLevel(initialize, event, mode) {                    \n        var url = null, parent = null;\n        if (initialize) {\n            currentLevel = 0;\n            url = DHIS2URL + '/organisationUnits.geojson?level=' + ouLevels[currentLevel].level;\n        }\n        else {\n            if (mode === 'IN') {\n                currentLevel++;\n                parent = event.id;\n            }\n            if (mode === 'OUT') {\n                currentLevel--;                \n                var parents = event.properties.parentGraph.substring(1, event.properties.parentGraph.length - 1).split('/');\n                parent = parents[parents.length - 2];\n            }\n            \n            if( ouLevels[currentLevel] && ouLevels[currentLevel].level && parent && !initialize ){\n                url = url = DHIS2URL + '/organisationUnits.geojson?level=' + ouLevels[currentLevel].level + '&parent=' + parent;\n            }\n        }\n\n        if( url ){\n            \n            $http.get(url).success(function (data) {\n\n                $scope.currentGeojson = {data: data, style: style, onEachFeature: onEachFeature, pointToLayer: pointToLayer};\n                \n                leafletData.getMap().then(function( map ){\n                    var latlngs = [];\n                    angular.forEach($scope.currentGeojson.data.features, function(feature){                \n                        if( feature.geometry.type === \"Point\"){\n                            //latlngs.push( L.latLng( $scope.currentGeojson.data.features[0].geometry.coordinates) );\n                            //isPoints = true;\n                        }\n                        else{\n                            for (var i in feature.geometry.coordinates) {                        \n                                var coord = feature.geometry.coordinates[i];                    \n                                for (var j in coord) {\n                                    var points = coord[j];\n                                    for (var k in points) {\n                                        latlngs.push(L.GeoJSON.coordsToLatLng(points[k]));\n                                    }\n                                }\n                            }                        \n                        }\n                    });\n                    \n                    if( $scope.location && $scope.location.lat && $scope.location.lng ){\n                        map.setView([$scope.location.lat, $scope.location.lng], $scope.maxZoom);\n                    } \n                    else{\n                        if( latlngs.length > 0 ){                            \n                            map.fitBounds(latlngs, {maxZoom: $scope.maxZoom});\n                        }\n                    }\n                });\n            });\n        }\n    }\n    \n    function zoomMap(event, mode) {\n        if(ouLevels && ouLevels.length > 0){\n            getGeoJsonByOuLevel(false, event, mode);\n        }                    \n    }\n    \n    function setCoordinate(e, feature, layer){\n        if( feature && feature.geometry && feature.geometry.type === 'Point'){\n            var m = feature.geometry.coordinates;            \n            $scope.marker = {m1: {lat: m[1], lng: m[0], draggable: true}};\n        }\n        else{\n            $scope.marker = {m1: {lat: e.latlng.lat, lng: e.latlng.lng, draggable: true}};\n        }\n        \n        $scope.location = {lat: $scope.marker.m1.lat, lng: $scope.marker.m1.lng};\n    };\n    \n    function zoomIn(e, feature){\n        $scope.maxZoom += 2; \n        if( feature && feature.id ){            \n            zoomMap( feature, 'IN');\n        }\n        else{            \n            $scope.center = angular.copy(e.latlng);            \n            $scope.center.zoom = $scope.maxZoom;\n        }        \n    };\n    \n    function zoomOut(e, feature){\n        $scope.maxZoom -= 2;\n        if( feature && feature.id ){             \n            zoomMap( feature, 'OUT');\n        }\n        else{\n            $scope.center = angular.copy(e.latlng);            \n            $scope.center.zoom = $scope.maxZoom;\n        }\n    };\n    \n    function centerMap(e, feature){\n        $scope.maxZoom += 2;\n        $scope.center.lat = e.latlng.lat;\n        $scope.center.lng = e.latlng.lng;\n    };\n    \n    function integrateMapzen(){\n        \n        leafletData.getMap($scope.selectedTileKey).then(function( map ){\n                        \n            if( $scope.marker && $scope.marker.m1 && $scope.marker.m1.lat && $scope.marker.m1.lng ){\n                map.setView([$scope.marker.m1.lat, $scope.marker.m1.lng], $scope.maxZoom);\n            }\n            \n            $scope.geocoder = L.control.geocoder(systemSetting.keyMapzenSearchApiKey,{\n                markers: {\n                    draggable: true\n                }\n            }).addTo(map);            \n            \n            $scope.geocoder.on('select', function (e) {\n                $scope.marker = {m1: {lat: e.latlng.lat, lng: e.latlng.lng, draggable: true}};\n                $scope.location = {lat: e.latlng.lat, lng: e.latlng.lng};\n\n                $scope.geocoder.marker.on('dragend', function(e){                \n                    var c = e.target.getLatLng();\n                    $scope.marker = {m1: {lat: c.lat, lng: c.lng, draggable: true}};\n                    $scope.location = {lat: c.lat, lng: c.lng};\n                });\n            });\n        });\n    }\n    \n    function loadGoogleMapApi() {\n        \n        var deferred = $q.defer();\n        $window.initMap = function() {\n            deferred.resolve();\n        };\n        \n        var script = document.createElement('script'); \n        script.src = 'https://maps.google.com/maps/api/js?callback=initMap&key=' + systemSetting.keyGoogleMapsApiKey;\n        document.body.appendChild(script);\n        return deferred.promise;\n    }\n    \n    getGeoJsonByOuLevel(true);\n    \n    integrateMapzen();\n            \n    $scope.setTile = function( tileKey ){        \n        if( tileKey === $scope.selectedTileKey ){\n            return;\n        }        \n        if( tileKey ){\n            if( tileKey === 'openstreetmap' ){\n                $scope.googleMapLayers = null;\n                $scope.selectedTileKey = tileKey;\n                integrateMapzen();\n            }\n            else if( tileKey === 'googlemap' ){\n                if ($window.google && $window.google.maps) {\n                    $scope.selectedTileKey = tileKey;\n                    integrateMapzen();\n                    \n                }else {\n                    loadGoogleMapApi().then(function () {\n                        $scope.selectedTileKey = tileKey;\n                        integrateMapzen();\n                    }, function () {\n                        console.log('Google map loading failed.');\n                    });\n                }\n            }            \n        }\n    };        \n    \n    $scope.close = function () {\n        $modalInstance.close();\n    };\n    \n    $scope.captureCoordinate = function(){\n        if( $scope.location && $scope.location.lng && $scope.location.lat ){\n            $modalInstance.close( $scope.location );\n    \t}\n    \telse{\n            //notify user\n            NotificationService.showNotifcationDialog($translate.instant(\"error\"), $translate.instant(\"nothing_captured\"));\n            return;\n    \t}\n    };\n    \n    function setLocation( args ){\n        if( args ){\n            $scope.marker.m1.lng = args.model.lng;\n            $scope.marker.m1.lat = args.model.lat;\n\n            $scope.location = {lng: args.model.lng, lat: args.model.lat};\n        }\n    }\n    \n    $scope.$on('leafletDirectiveMarker.googlemap.dragend', function (e, args) {\n        setLocation( args );\n    });\n    \n    $scope.$on('leafletDirectiveMarker.openstreetmap.dragend', function (e, args) {\n        setLocation( args );\n    });\n})\n\n//Controller for audit history\n.controller('AuditHistoryController', \n    function ($scope, \n            $modalInstance,\n            $translate,\n            AuditHistoryDataService, \n            DateUtils, \n            eventId, \n            dataType, \n            nameIdMap,\n            optionSets,\n            CommonUtils) {\n\n\n    $scope.model = {type: dataType, \n    \t\t\t\tname: dataType === 'dataElement' ? $translate.instant('data_element') : $translate.instant('attribute'),\n    \t\t\t\tsearchPlaceholder: dataType === 'dataElement' ? $translate.instant('search_by_data_element') : $translate.instant('search_by_attribute'),\n                    auditColumns: ['name', 'auditType', 'value', 'modifiedBy', 'created'], itemList:[], uniqueRows:[]};\n\n    $scope.close = function () {\n        $modalInstance.close();\n    };\n    $scope.model.showStatus=\"waiting\";\n    AuditHistoryDataService.getAuditHistoryData(eventId, dataType).then(function (data) {\n\n        $scope.model.itemList = [];\n        $scope.model.uniqueRows = [];\n        \n        var reponseData = data.trackedEntityDataValueAudits ? data.trackedEntityDataValueAudits :\n            data.trackedEntityAttributeValueAudits ? data.trackedEntityAttributeValueAudits : null;\n\n        if (reponseData) {\n            for (var index = 0; index < reponseData.length; index++) {                \n                var dataValue = reponseData[index];                \n                var audit = {}, obj = {};\n                if (dataType === \"attribute\") {\n                    if (nameIdMap[dataValue.trackedEntityAttribute.id]) {\n                        obj = nameIdMap[dataValue.trackedEntityAttribute.id];\n                        audit.name = obj.displayName;\n                        audit.valueType = obj.valueType;\n                    }\n                } else if (dataType === \"dataElement\") {\n                    if (nameIdMap[dataValue.dataElement.id] && nameIdMap[dataValue.dataElement.id].dataElement) {\n                        obj = nameIdMap[dataValue.dataElement.id].dataElement;\n                        audit.name = obj.displayFormName;\n                        audit.valueType = obj.valueType;\n                    }\n                }\n                \n                dataValue.value = CommonUtils.formatDataValue(null, dataValue.value, obj, optionSets, 'USER');\n                audit.auditType = dataValue.auditType;                \n                audit.value = dataValue.value;\n                audit.modifiedBy = dataValue.modifiedBy;\n                audit.created = DateUtils.formatToHrsMinsSecs(dataValue.created);                \n                \n                $scope.model.itemList.push(audit);\n                if( $scope.model.uniqueRows.indexOf(audit.name) === -1){\n                \t$scope.model.uniqueRows.push(audit.name);\n                }\n                \n                if($scope.model.uniqueRows.length > 0){\n                \t$scope.model.uniqueRows = $scope.model.uniqueRows.sort();\n                }\n            }\n        }\n        if ($scope.model.itemList.length === 0) {\n            $scope.model.showStatus=\"data_unavailable\";\n        } else {\n            $scope.model.showStatus=\"data_available\";\n        }\n    },function(){\n        $scope.model.showStatus=\"data_unavailable\";\n    });\n})\n\n.controller('OrgUnitTreeController', function($scope, $modalInstance, OrgUnitFactory, orgUnitId, orgUnitNames) {\n    \n    $scope.model = {selectedOrgUnitId: orgUnitId ? orgUnitId : null};\n    $scope.orgUnitNames = orgUnitNames;\n\n    function expandOrgUnit( orgUnit, ou ){\n        if( ou.path.indexOf( orgUnit.path ) !== -1 ){\n            orgUnit.show = true;\n        }\n\n        orgUnit.hasChildren = orgUnit.children && orgUnit.children.length > 0 ? true : false;\n        if( orgUnit.hasChildren ){\n            for( var i=0; i< orgUnit.children.length; i++){\n                if( ou.path.indexOf( orgUnit.children[i].path ) !== -1 ){\n                    orgUnit.children[i].show = true;\n                    expandOrgUnit( orgUnit.children[i], ou );\n                }\n            }\n        }\n        return orgUnit;\n    };\n\n    function attachOrgUnit( orgUnits, orgUnit ){\n        for( var i=0; i< orgUnits.length; i++){\n            if( orgUnits[i].id === orgUnit.id ){\n                orgUnits[i] = orgUnit;\n                orgUnits[i].show = true;\n                orgUnits[i].hasChildren = orgUnits[i].children && orgUnits[i].children.length > 0 ? true : false;\n                return;\n            }\n            if( orgUnits[i].children && orgUnits[i].children.length > 0 ){\n                attachOrgUnit(orgUnits[i].children, orgUnit);\n            }\n        }\n        return orgUnits;\n    };\n\n    //Get orgunits for the logged in user\n    OrgUnitFactory.getViewTreeRoot().then(function(response) {\n        $scope.orgUnits = response.organisationUnits;\n        var selectedOuFetched = false;\n        var levelsFetched = 0;\n        angular.forEach($scope.orgUnits, function(ou){\n            ou.show = true;\n            levelsFetched = ou.level;\n            if( orgUnitId && orgUnitId === ou.id ){\n                selectedOuFetched = true;\n            }\n            angular.forEach(ou.children, function(o){\n                levelsFetched = o.level;\n                o.hasChildren = o.children && o.children.length > 0 ? true : false;\n                if( orgUnitId && !selectedOuFetched && orgUnitId === ou.id ){\n                    selectedOuFetched = true;\n                }\n            });\n        });\n\n        levelsFetched = levelsFetched > 0 ? levelsFetched - 1 : levelsFetched;\n\n        if( orgUnitId && !selectedOuFetched ){\n            var parents = null;\n            OrgUnitFactory.get( orgUnitId ).then(function( ou ){\n                if( ou && ou.path ){\n                    parents = ou.path.substring(1, ou.path.length);\n                    parents = parents.split(\"/\");\n                    if( parents && parents.length > 0 ){\n                        var url = \"fields=id,displayName,path,level,\";\n                        for( var i=levelsFetched; i<ou.level; i++){\n                            url = url + \"children[id,displayName,level,path,\";\n                        }\n\n                        url = url.substring(0, url.length-1);\n                        for( var i=levelsFetched; i<ou.level; i++){\n                            url = url + \"]\";\n                        }\n\n                        OrgUnitFactory.getOrgUnits(parents[levelsFetched], url).then(function(response){\n                            if( response && response.organisationUnits && response.organisationUnits[0] ){\n                                response.organisationUnits[0].show = true;\n                                response.organisationUnits[0].hasChildren = response.organisationUnits[0].children && response.organisationUnits[0].children.length > 0 ? true : false;\n                                response.organisationUnits[0] = expandOrgUnit(response.organisationUnits[0], ou );\n                                $scope.orgUnits = attachOrgUnit( $scope.orgUnits, response.organisationUnits[0] );\n                            }\n                        });\n                    }\n                }\n            });\n        }\n    });\n\n\n    //expand/collapse of search orgunit tree\n    $scope.expandCollapse = function(orgUnit) {\n        if( orgUnit.hasChildren ){\n            //Get children for the selected orgUnit\n            OrgUnitFactory.getChildren(orgUnit.id).then(function(ou) {\n                orgUnit.show = !orgUnit.show;\n                orgUnit.hasChildren = false;\n                orgUnit.children = ou.children;\n                angular.forEach(orgUnit.children, function(ou){\n                    ou.hasChildren = ou.children && ou.children.length > 0 ? true : false;\n                });\n            });\n        }\n        else{\n            orgUnit.show = !orgUnit.show;\n        }\n    };\n\n    $scope.setSelectedOrgUnit = function( orgUnit ){\n    \t$scope.model.selectedOrgUnit = {id: orgUnit.id, displayName: orgUnit.displayName};\n        $scope.model.selectedOrgUnitId = orgUnit.id;\n        $scope.orgUnitNames[orgUnit.id] = orgUnit.displayName;\n    };\n\n    $scope.select = function () {\n        $modalInstance.close( {selected: $scope.model.selectedOrgUnit, names: $scope.orgUnitNames} );\n    };\n\n    $scope.close = function(){        \n        $modalInstance.close();\n    };\n});\n\n\n\n// WEBPACK FOOTER //\n// ../d2-tracker/lib/dhis2.angular.controllers.js","angular.module('d2Templates', []).run(['$templateCache', function($templateCache) {$templateCache.put('./templates/age-input.html','<div ng-form=\"ageForm\">\\n    <div class=\"input-group\" style=\"width: 100%;\">\\n        <input type=\"text\" \\n               popover=\"{{\\'dob\\'| translate}}\"\\n               popover-trigger=\"focus\"\\n               d2-date name=\"dob\" \\n               d2-date-validator\\n               ng-model=\"age.dob\"\\n               blur-or-change=\"saveDOB()\"\\n               ng-required=\"d2Required\"\\n               ng-disabled=\"d2Disabled\"\\n               placeholder=\"{{\\'dob\\'| translate}}\" \\n               title=\"{{\\'dob\\'| translate}}\" \\n               class=\"form-control no-right-radius\"\\n               ng-class=\"{\\'input-success\\': d2AgeSaved}\"/>\\n        <span class=\"input-group-btn empty-span\"></span>\\n        <input type=\"number\" \\n               name=\"years\" \\n               popover=\"{{\\'years\\'| translate}}\"\\n               popover-trigger=\"focus\"\\n               ng-model=\"age.years\" \\n               ng-model-options=\"{updateOn: \\'blur\\'}\"\\n               ng-change=\"saveAge()\"\\n               ng-disabled=\"d2Disabled\"\\n               d2-number-validator\\n               number-type=\"INTEGER_ZERO_OR_POSITIVE\"\\n               placeholder=\"{{\\'years\\'| translate}}\"\\n               title=\"{{\\'years\\'| translate}}\" \\n               class=\"form-control no-right-radius no-left-radius\"\\n               ng-class=\"{\\'input-success\\': d2AgeSaved}\"/>\\n        <span class=\"input-group-btn empty-span\"></span>\\n        <input type=\"number\" \\n               name=\"months\" \\n               popover=\"{{\\'months\\'| translate}}\"\\n               popover-trigger=\"focus\"\\n               ng-model=\"age.months\" \\n               ng-model-options=\"{updateOn: \\'blur\\'}\"\\n               ng-change=\"saveAge()\"\\n               ng-disabled=\"d2Disabled\"\\n               d2-number-validator\\n               number-type=\"INTEGER_ZERO_OR_POSITIVE\"\\n               placeholder=\"{{\\'months\\'| translate}}\"\\n               title=\"{{\\'months\\'| translate}}\" \\n               class=\"form-control no-right-radius no-left-radius\"\\n               ng-class=\"{\\'input-success\\': d2AgeSaved}\"/>\\n        <span class=\"input-group-btn empty-span\"></span>\\n        <input type=\"number\" \\n               name=\"days\" \\n               popover=\"{{\\'days\\'| translate}}\"\\n               popover-trigger=\"focus\"\\n               ng-model=\"age.days\" \\n               ng-model-options=\"{updateOn: \\'blur\\'}\"\\n               ng-change=\"saveAge()\"\\n               ng-disabled=\"d2Disabled\"\\n               d2-number-validator\\n               number-type=\"INTEGER_ZERO_OR_POSITIVE\"\\n               placeholder=\"{{\\'days\\'| translate}}\"\\n               title=\"{{\\'days\\'| translate}}\" \\n               class=\"form-control no-left-radius no-right-radius\"\\n               ng-class=\"{\\'input-success\\': d2AgeSaved}\"/>\\n        <span class=\"input-group-btn\"> \\n            <button class=\"btn btn-danger hideInPrint trim\" type=\"button\" title=\"{{\\'remove\\'| translate}}\" ng-click=\"removeAge()\" ng-disabled=\"!age.dob || d2Disabled\"> \\n                <i class=\"fa fa-trash-o\"></i> \\n            </button>\\n        </span>\\n    </div>\\n    <div ng-messages=\"ageForm.years.$error\" ng-if=\"ageInteracted(ageForm.years)\" class=\"required\" ng-messages-include=\"./templates/error-messages.html\"></div>\\n    <div ng-messages=\"ageForm.months.$error\" ng-if=\"ageInteracted(ageForm.months)\" class=\"required\" ng-messages-include=\"./templates/error-messages.html\"></div>\\n    <div ng-messages=\"ageForm.months.$error\" ng-if=\"ageInteracted(ageForm.days)\" class=\"required\" ng-messages-include=\"./templates/error-messages.html\"></div>\\n</div>');\n$templateCache.put('./templates/audit-history.html','<div class=\"modal-header\">\\n    <h2>{{\\'audit_history\\'| translate}}</h2>\\n</div>\\n<div class=\"modal-body page\" ng-class=\"{\\'waiting-box\\':model.showStatus === \\'waiting\\'}\">\\n    <div ng-if=\"model.showStatus === \\'data_available\\'\">\\n        <span class=\"row\">\\n            <input class=\"form-control col-md-7\" ng-model=\"model.searchText\" placeholder=\"{{model.searchPlaceholder}}\" type=\"search\" />\\n        </span>\\n        <div class=\"scroll\">\\n            <table class=\"listTable dhis2-table-striped-border\">\\n                <thead>\\n                    <tr>\\n                        <th ng-repeat=\"col in model.auditColumns\">\\n                            <span ng-switch=\"col\">\\n                                <span ng-switch-when=\"name\">\\n                                    {{model.name}}\\n                                </span>\\n                                <span ng-switch-default>\\n                                \\t{{col | translate}}\\n                                </span>                                    \\n                            </span>\\n                        </th>\\n                    </tr>\\n                </thead>\\n                <tbody ng-repeat=\"row in model.uniqueRows\">\\n                    <tr ng-repeat=\"item in model.itemList | orderBy: \\'created\\':reverse | filter: {name: row} | filter: {name: model.searchText}\" ng-init=\"rowIndex = $index\">\\n                        <td ng-repeat=\"col in model.auditColumns\"\\n                            rowspan=\"{{(model.itemList | filter: {name: row} | filter: model.searchText).length}}\"\\n                            ng-if=\"col === \\'name\\' && rowIndex === 0\">\\n                            {{item[col]}}\\n                        </td>\\n                        <td class=\"wrap-text\" ng-repeat=\"col in model.auditColumns\" ng-if=\"col !== \\'name\\'\">\\n                        \\t<span ng-if=\"col === \\'value\\'\">\\n                        \\t\\t<span ng-switch=\"item.valueType\">\\n\\t\\t\\t\\t                    <span ng-switch-when=\"BOOLEAN\">\\n\\t\\t\\t\\t                        <span ng-if=\"item[col] === \\'true\\'\">{{\\'yes\\'| translate}}</span>\\n\\t\\t\\t\\t                        <span ng-if=\"item[col] === \\'false\\'\">{{ \\'no\\' | translate}}</span>\\n\\t\\t\\t\\t                    </span>\\n\\t\\t\\t\\t                    <span ng-switch-when=\"TRUE_ONLY\">\\n\\t\\t\\t\\t                        <span ng-if=\"item[col]\">\\n\\t\\t\\t\\t                            <i class=\"fa fa-check\"></i>\\n\\t\\t\\t\\t                        </span>\\n\\t\\t\\t\\t                    </span>\\n\\t\\t\\t\\t                    <span ng-switch-default>{{item[col]}}</span>\\n\\t\\t\\t\\t                </span>\\n                        \\t</span>\\n                        \\t<span ng-if=\"col !== \\'value\\'\">\\n                        \\t\\t{{item[col]}}\\n                        \\t</span>\\n                        \\t                            \\n                        </td>\\n                    </tr>\\n                </tbody>\\n            </table>\\n        </div>\\n    </div>\\n    <div ng-if=\"model.showStatus === \\'data_unavailable\\'\">\\n        <div class=\"alert alert-warning\">{{\\'audit_history_unavailable\\'| translate}}</div>\\n    </div>\\n    <div ng-if=\"model.showStatus === \\'waiting\\'\">\\n        <i class=\"fa fa-spinner fa-spin audit-spinner\"></i>\\n        <div class=\"loading-audit-data\">{{\\'loading-audit-data\\' | translate}}</div>\\n    </div>\\n</div>\\n<div class=\"modal-footer\" ng-if=\"model.showStatus !== \\'waiting\\'\">\\n    <button type=\"button\" class=\"btn btn-default\" data-ng-click=\"close()\">{{\\'close\\'| translate}}</button>\\n</div>');\n$templateCache.put('./templates/coordinate-input.html','<div  ng-form=\"coordinateForm\">\\n    <div class=\"input-group\">\\n        <input type=\"number\" \\n               ng-model=\"coordinateObject.coordinate.latitude\" \\n               placeholder=\"{{\\'latitude\\'| translate}}\"\\n               ng-class=\"{\\'input-success\\': d2LatSaved}\"\\n               name=\"latitude\" \\n               d2-coordinate-validator\\n               ng-required=\"d2Required\"\\n               ng-disabled=\"d2Disabled\"\\n               ng-blur=\"saveD2Coordinate()\"\\n               class=\"form-control no-right-radius\"/>\\n        <span class=\"input-group-btn empty-span\"></span>\\n        <input type=\"number\" \\n               ng-model=\"coordinateObject.coordinate.longitude\" \\n               placeholder=\"{{\\'longitude\\'| translate}}\"\\n               ng-class=\"{\\'input-success\\': d2LngSaved}\"\\n               name=\"longitude\" \\n               d2-coordinate-validator\\n               ng-required=\"d2Required\"\\n               ng-disabled=\"d2Disabled\"\\n               ng-blur=\"saveD2Coordinate()\"\\n               class=\"form-control no-left-radius no-right-radius\"/>\\n        <span class=\"input-group-btn hideInPrint\">\\n            <button class=\"btn btn-grp trim hideInPrint\" \\n                    type=\"button\"\\n                    ng-disabled=\"{{d2Disabled}}\"\\n                    title=\"{{\\'get_from_map\\'| translate}}\"\\n                    ng-click=\"showMap(coordinateObject)\"> \\n                <i class=\"fa fa-map-marker\"></i>                             \\n            </button>\\n        </span>    \\n    </div>\\n    <div ng-messages=\"coordinateForm.latitude.$error\" ng-if=\"coordinateInteracted(coordinateForm.latitude)\" class=\"required\" ng-messages-include=\"./templates/error-messages.html\"></div>\\n    <div ng-messages=\"coordinateForm.longitude.$error\" ng-if=\"coordinateInteracted(coordinateForm.longitude)\" class=\"required\" ng-messages-include=\"./templates/error-messages.html\"></div>\\n</div>');\n$templateCache.put('./templates/custom-dataentry-form.html','<d2-custom-data-entry-form custom-data-entry-form=\"customDataEntryForm\"></d2-custom-data-entry-form>');\n$templateCache.put('./templates/custom-registration-form.html','<d2-custom-registration-form custom-registration-form=\"customRegistrationForm\"></d2-custom-registration-form>');\n$templateCache.put('./templates/error-messages.html','<span ng-message=\"required\">{{\\'required\\' | translate}}</span>\\n<span ng-message=\"number\">{{\\'value_must_be_number\\' | translate}}</span>\\n<span ng-message=\"percentValue\">{{\\'value_must_be_valid_percentValue\\' | translate}}</span>\\n<span ng-message=\"posInt\">{{\\'value_must_be_posInt\\' | translate}}</span>\\n<span ng-message=\"negInt\">{{\\'value_must_be_negInt\\' | translate}}</span>\\n<span ng-message=\"zeroPositiveInt\">{{\\'value_must_be_zeroPositiveInt\\' | translate}}</span>\\n<span ng-message=\"integer\">{{\\'value_must_be_int\\' | translate}}</span>\\n<span ng-message=\"dateValidator\">{{\\'date_required\\' | translate}} ({{dhis2CalendarFormat.keyDateFormat}})</span>\\n<span ng-message=\"futureDateValidator\">{{\\'future_date_not_allowed\\' | translate}}</span>\\n<span ng-message=\"optionValidator\">{{\\'option_required\\' | translate}}</span>\\n<span ng-message=\"latitudeValidator\">{{\\'latitude_required\\' | translate}}</span>\\n<span ng-message=\"longitudeValidator\">{{\\'longitude_required\\' | translate}}</span>\\n<span ng-message=\"customCoordinateValidator\">{{\\'latitude_longitude_required\\' | translate}}</span>\\n<span ng-message=\"uniqunessValidator\">{{\\'value_not_unique\\' | translate}}</span>\\n<span ng-message=\"email\">{{\\'value_must_be_email\\' | translate}}</span>\\n');\n$templateCache.put('./templates/map.html','<div class=\"modal-header\">\\n    <h2>\\n        {{\\'point_and_click_for_coordinate\\'| translate}}        \\n    </h2>\\n    <div class=\"align-center\">\\n        <span id=\\'polygon-label\\'></span>\\n    </div>\\n</div>\\n<div class=\"modal-body map-area\">\\n    <span ng-switch=\"selectedTileKey\">        \\n        <span ng-switch-when=\"openstreetmap\">\\n            <leaflet id=\"openstreetmap\" lf-center=\"center\" geojson=\"currentGeojson\" defaults=\"mapDefaults\" markers=\"marker\" tiles=\"tilesDictionary[selectedTileKey]\"></leaflet>\\n        </span>\\n        <span ng-switch-when=\"googlemap\">\\n            <leaflet id=\"googlemap\" lf-center=\"center\" geojson=\"currentGeojson\" defaults=\"mapDefaults\" markers=\"marker\" layers=\"tilesDictionary[selectedTileKey].layers\"></leaflet>\\n        </span>\\n    </span>\\n</div>\\n<div class=\"modal-footer\">\\n    \\n    <div class=\"pull-left\">\\n        <ul class=\"nav nav-pills\">\\n            <li ng-class=\"{true: \\'active\\'} [selectedTileKey === key]\" ng-repeat=\"key in tilesDictionaryKeys\">\\n                <a href ng-click=\"setTile(key)\">{{key | translate}}</a>\\n            </li>\\n        </ul>\\n    </div>\\n    \\n    <button class=\"btn btn-primary\" data-ng-click=\"captureCoordinate()\">{{\\'capture\\'| translate}}</button>\\n    <button class=\"btn btn-default\" data-ng-click=\"close()\">{{\\'cancel\\'| translate}}</button>        \\n</div>');\n$templateCache.put('./templates/orgunit-input.html','<div class=\"input-group\">    \\n    <input type=\"text\" name=\"foo\" ng-disabled=\"true\" class=\"form-control\" placeholder=\"{{\\'please_select\\' | translate}}\" ng-model=\"d2OrgunitNames[d2Object[id]]\" ng-disabled=\"{{d2Disabled}}\" ng-required=\"{{d2Required}}\"> \\n    <span class=\"input-group-btn\"> \\n        <button class=\"btn btn-danger hideInPrint trim\" type=\"button\" title=\"{{\\'remove\\' | translate}}\" ng-disabled=\"d2Disabled\" ng-click=\"removeSelectedOrgUnit(id)\" ng-if=\"d2Object[id]\"> \\n            <i class=\"fa fa-trash-o\"></i> \\n        </button> \\n        <button class=\"btn btn-default hideInPrint trim\" type=\"button\" title=\"{{\\'get_from_tree\\' | translate}}\" ng-disabled=\"d2Disabled\" ng-click=\"showOrgUnitTree(id)\"> \\n            <i class=\"fa fa-plus-square-o\"></i> \\n        </button> \\n    </span> \\n</div>');\n$templateCache.put('./templates/orgunit-tree.html','<div class=\"modal-header page\">\\n    <h3>{{\\'org_unit\\'| translate}}</h3>\\n</div>\\n<div class=\"modal-body page\">\\n    <div class=\"org-unit-tree\" data-stop-propagation=\"true\">\\n        <script type=\"text/ng-template\" id=\"orgUnitTree.html\">\\n            <span class=\"org-unit-tree-button\" ng-click=\"expandCollapse(orgUnit)\" ng-show=\"orgUnit.show && orgUnit.children.length > 0\"><i class=\"fa fa-minus-square-o\"></i></span>\\n            <span class=\"org-unit-tree-button\" ng-click=\"expandCollapse(orgUnit)\" ng-show=\"(!orgUnit.show && orgUnit.children.length > 0) || (!orgUnit.show && orgUnit.hasChildren)\"><i class=\"fa fa-plus-square-o\"></i></span>\\n            <span class=\"org-unit-tree-button\" ng-click=\"setSelectedOrgUnit(orgUnit)\" ng-class=\"{\\'selected-org-unit\\' : orgUnit.id === model.selectedOrgUnitId}\">{{orgUnit.displayName}}</span>\\n            <ul class=\"tree\" id=\"tree\" ng-show=\"orgUnit.show\">\\n                <li ng-repeat=\"orgUnit in orgUnit.children | orderBy:\\'displayName\\'\" ng-include=\"\\'orgUnitTree.html\\'\"></li>\\n            </ul>\\n        </script>\\n        <ul class=\"tree\" id=\"tree\">\\n            <li ng-repeat=\"orgUnit in orgUnits | orderBy:\\'displayName\\'\" ng-include=\"\\'orgUnitTree.html\\'\"></li>\\n        </ul>\\n    </div>\\n</div>\\n<div class=\"modal-footer page\">\\n    <button class=\"btn btn-primary\" data-ng-click=\"select()\">{{\\'select\\'| translate}}</button>\\n    <button class=\"btn btn-default\" data-ng-click=\"close()\">{{\\'close\\'| translate}}</button>\\n</div>');\n$templateCache.put('./templates/radio-button.html','<!--\\nCopyright (c) 2015, UiO\\nAll rights reserved.\\n\\nRedistribution and use in source and binary forms, with or without\\nmodification, are permitted provided that the following conditions are met:\\n\\n* Redistributions of source code must retain the above copyright notice, this\\n  list of conditions and the following disclaimer.\\n* Redistributions in binary form must reproduce the above copyright notice,\\n  this list of conditions and the following disclaimer in the documentation\\n  and/or other materials provided with the distribution.\\n\\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\\nAND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\\nARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\\nLIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\\nCONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\\nSUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\\nINTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\\nCONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\\nARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\\nPOSSIBILITY OF SUCH DAMAGE.\\n-->\\n \\n\\n<div tabindex=\"0\" ng-if=\"!disabled\" class=\"custom-radio-group custom-radio-container\">\\n    <span ng-click=\"valueClicked(\\'true\\')\" class=\"cursor-pointer\">\\n        <span class=\"fa-stack\">                                                                                                        \\n            <span class=\\'fa fa-stack-1x fa-circle radio-default fa-stack-custom-large\\' ng-class=\\'radioButtonColor(\"true\")\\'></span>        \\n            <span class=\"fa fa-stack-1x fa-circle-thin fa-stack-custom-large\"></span>\\n            <span class=\"fa-stack-custom-small\" ng-class=\"radioButtonImage(\\'true\\')\"></span>\\n        </span>\\n        <span class=\"custom-radio-text\">\\n            {{\\'Yes\\' | translate }}\\n        </span>\\n    </span>\\n    &nbsp;&nbsp;    \\n    <span ng-click=\"valueClicked(\\'false\\')\" class=\"cursor-pointer\">\\n        <span class=\"fa-stack\">                                                                                                        \\n            <span class=\\'fa fa-stack-1x fa-circle fa-stack-custom-large\\' ng-class=\\'radioButtonColor(\"false\")\\'></span>                                                    \\n            <span class=\"fa fa-stack-1x fa-circle-thin fa-stack-custom-large\"></span>\\n            <span class=\"fa-stack-custom-small\" ng-class=\"radioButtonImage(\\'false\\')\"></span>\\n        </span>\\n        <span class=\"custom-radio-text\">\\n            {{\\'No\\' | translate }}\\n        </span>        \\n    </span>\\n    <div ng-if=\"status === \\'error\\'\" class=\"custom-radio-error input-error\"><span>{{\\'save failed\\' | translate}}</span></div>\\n    \\n    \\n    <div ng-show=\"false\">\\n        <label class=\"radio-inline\">                                                    \\n            <input class=\"radio-display-none\" ng-required=\"required\" style=\\'margin-top: 1px\\' type=\"radio\" ng-model=\"value\" ng-disabled=\"disabled\" name=\"{{name}}\" value=\"true\">                                                    \\n        </label>                                                \\n        <label class=\"radio-inline\">\\n            <input class=\"radio-display-none\" ng-required=\"required\" style=\\'margin-top: 1px\\' type=\"radio\" ng-model=\"value\" ng-disabled=\"disabled\" name=\"{{name}}\" value=\"false\">\\n        </label>\\n    </div>\\n</div>\\n<div ng-if=\"disabled\" class=\"custom-radio-container\">\\n    <span class=\"fa-icon-width\" ng-class=\"getDisabledIcon(value)\"></span>\\n    <span>{{getDisabledValue(value) | translate}}</span>         \\n</div>');\n$templateCache.put('./templates/radio-input.html','<span ng-repeat=\"option in d2Options\" \\n      class=\"col-sm-12 form-control cursor-pointer\" \\n      ng-disabled=\"d2Disabled\"\\n      ng-class=\"{\\'input-success\\': d2ValueSaved && model.radio === option.displayName}\"\\n      ng-click=\"saveValue(option.displayName)\">\\n    <span class=\"fa fa-circle-thin fa-stack-custom-large\" ng-if=\"option.displayName !== model.radio\"></span> \\n    <span class=\"fa fa-dot-circle-o fa-stack-custom-large\" ng-if=\"option.displayName === model.radio\"></span> \\n    {{option.displayName}}\\n</span>\\n\\n\\n<span ng-show=\"false\">\\n    <label ng-repeat=\"option in d2Options\" class=\"radio-display-none\">\\n    <input type=\"radio\" \\n           name=\"{{name}}\"\\n           ng-required=\"d2Required\"\\n           ng-disabled=\"d2Disabled\"\\n           ng-model=\"model.radio\"\\n           value=\"{{option.displayName}}\"> {{option.displayName}}\\n    </label>    \\n</span>');\n$templateCache.put('./templates/serverside-pagination.html','<div class=\"paging-container\">\\n    <table style=\"background-color: #ebf0f6;\" width=\\'100%\\'>\\n        <tr>\\n            <td>\\n                {{\\'total_number_of_pages\\'| translate}}: {{pager.pageCount}}\\n            </td>\\n            <td>\\n                <span>{{\\'rows_per_page\\'| translate}}:</span> <input type=\"text\" min=\"1\" style=\"width:50px;\" ng-model=\"pager.pageSize\" d2-enter=\"resetPageSize()\" ng-blur=\"resetPageSize()\"> \\n            </td>\\n            <td>\\n                <span>{{\\'jump_to_page\\'| translate}}:</span> <input type=\"text\" min=\"1\" style=\"width:50px;\" ng-model=\"pager.page\" d2-enter=\"jumpToPage()\" ng-blur=\"jumpToPage()\"> \\n            </td>\\n        </tr>\\n        <tr>\\n            <td colspan=\"3\"><hr/></td>\\n        </tr>\\n        <tr>\\n            <td colspan=\"3\">\\n                <div class=\"paging\">\\n                    <span ng-show=\"pager.page > 1\">\\n                        <a href ng-click=\"getPage(1)\" title=\"{{\\'first\\'| translate}}\"> \\n                            &laquo;&laquo;\\n                        </a>\\n                        <a href ng-click=\"getPage(pager.page - 1)\" title=\"{{\\'previous\\'| translate}}\"> \\n                            &laquo;\\n                        </a>                    \\n                    </span>\\n                    <span ng-hide=\"pager.page > 1\">\\n                        <span title=\"{{\\'first\\'| translate}}\">&laquo;&laquo;</span>\\n                        <span title=\"{{\\'previous\\'| translate}}\">&laquo;</span>\\n                    </span>\\n                    <a href ng-click=\"getPage(i+1)\" title=\"{{\\'page\\'| translate}} {{i + 1}}\" ng-repeat=\"i in []| forLoop:paginator.lowerLimit():pager.pageCount | limitTo : pager.toolBarDisplay\" ng-class=\"pager.page == i + 1 && \\'active\\'\">\\n                        {{i + 1}}\\n                    </a>\\n\\n                    <span ng-show=\"pager.page < pager.pageCount\">\\n                        <a href ng-click=\"getPage(pager.page + 1)\" title=\"{{\\'next\\'| translate}}\" > \\n                            &raquo;\\n                        </a>\\n                        <a href ng-click=\"getPage(pager.pageCount)\" title=\"{{\\'last\\'| translate}}\"> \\n                            &raquo;&raquo;\\n                        </a>\\n                    </span>\\n                    <span ng-hide=\"pager.page < pager.pageCount\">\\n                        <span class=\"next\" title=\"{{\\'next\\'| translate}}\">&raquo; </span>\\n                        <span class=\"last\" title=\"{{\\'last\\'| translate}}\">&raquo;&raquo;</span>\\n                    </span>\\n                </div>\\n            </td>\\n        </tr>\\n    </table>   \\n</div>');}]);\n\n\n// WEBPACK FOOTER //\n// ../d2-tracker/lib/dhis2.angular.templates.js","/*\n Leaflet, a JavaScript library for mobile-friendly interactive maps. http://leafletjs.com\n (c) 2010-2013, Vladimir Agafonkin\n (c) 2010-2011, CloudMade\n*/\n(function (window, document, undefined) {\r\nvar oldL = window.L,\r\n    L = {};\r\n\r\nL.version = '0.7.7';\r\n\r\n// define Leaflet for Node module pattern loaders, including Browserify\r\nif (typeof module === 'object' && typeof module.exports === 'object') {\r\n\tmodule.exports = L;\r\n\r\n// define Leaflet as an AMD module\r\n} else if (typeof define === 'function' && define.amd) {\r\n\tdefine(L);\r\n}\r\n\r\n// define Leaflet as a global L variable, saving the original L to restore later if needed\r\n\r\nL.noConflict = function () {\r\n\twindow.L = oldL;\r\n\treturn this;\r\n};\r\n\r\nwindow.L = L;\r\n\n\n/*\r\n * L.Util contains various utility functions used throughout Leaflet code.\r\n */\r\n\r\nL.Util = {\r\n\textend: function (dest) { // (Object[, Object, ...]) ->\r\n\t\tvar sources = Array.prototype.slice.call(arguments, 1),\r\n\t\t    i, j, len, src;\r\n\r\n\t\tfor (j = 0, len = sources.length; j < len; j++) {\r\n\t\t\tsrc = sources[j] || {};\r\n\t\t\tfor (i in src) {\r\n\t\t\t\tif (src.hasOwnProperty(i)) {\r\n\t\t\t\t\tdest[i] = src[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn dest;\r\n\t},\r\n\r\n\tbind: function (fn, obj) { // (Function, Object) -> Function\r\n\t\tvar args = arguments.length > 2 ? Array.prototype.slice.call(arguments, 2) : null;\r\n\t\treturn function () {\r\n\t\t\treturn fn.apply(obj, args || arguments);\r\n\t\t};\r\n\t},\r\n\r\n\tstamp: (function () {\r\n\t\tvar lastId = 0,\r\n\t\t    key = '_leaflet_id';\r\n\t\treturn function (obj) {\r\n\t\t\tobj[key] = obj[key] || ++lastId;\r\n\t\t\treturn obj[key];\r\n\t\t};\r\n\t}()),\r\n\r\n\tinvokeEach: function (obj, method, context) {\r\n\t\tvar i, args;\r\n\r\n\t\tif (typeof obj === 'object') {\r\n\t\t\targs = Array.prototype.slice.call(arguments, 3);\r\n\r\n\t\t\tfor (i in obj) {\r\n\t\t\t\tmethod.apply(context, [i, obj[i]].concat(args));\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t},\r\n\r\n\tlimitExecByInterval: function (fn, time, context) {\r\n\t\tvar lock, execOnUnlock;\r\n\r\n\t\treturn function wrapperFn() {\r\n\t\t\tvar args = arguments;\r\n\r\n\t\t\tif (lock) {\r\n\t\t\t\texecOnUnlock = true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlock = true;\r\n\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tlock = false;\r\n\r\n\t\t\t\tif (execOnUnlock) {\r\n\t\t\t\t\twrapperFn.apply(context, args);\r\n\t\t\t\t\texecOnUnlock = false;\r\n\t\t\t\t}\r\n\t\t\t}, time);\r\n\r\n\t\t\tfn.apply(context, args);\r\n\t\t};\r\n\t},\r\n\r\n\tfalseFn: function () {\r\n\t\treturn false;\r\n\t},\r\n\r\n\tformatNum: function (num, digits) {\r\n\t\tvar pow = Math.pow(10, digits || 5);\r\n\t\treturn Math.round(num * pow) / pow;\r\n\t},\r\n\r\n\ttrim: function (str) {\r\n\t\treturn str.trim ? str.trim() : str.replace(/^\\s+|\\s+$/g, '');\r\n\t},\r\n\r\n\tsplitWords: function (str) {\r\n\t\treturn L.Util.trim(str).split(/\\s+/);\r\n\t},\r\n\r\n\tsetOptions: function (obj, options) {\r\n\t\tobj.options = L.extend({}, obj.options, options);\r\n\t\treturn obj.options;\r\n\t},\r\n\r\n\tgetParamString: function (obj, existingUrl, uppercase) {\r\n\t\tvar params = [];\r\n\t\tfor (var i in obj) {\r\n\t\t\tparams.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));\r\n\t\t}\r\n\t\treturn ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');\r\n\t},\r\n\ttemplate: function (str, data) {\r\n\t\treturn str.replace(/\\{ *([\\w_]+) *\\}/g, function (str, key) {\r\n\t\t\tvar value = data[key];\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tthrow new Error('No value provided for variable ' + str);\r\n\t\t\t} else if (typeof value === 'function') {\r\n\t\t\t\tvalue = value(data);\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t});\r\n\t},\r\n\r\n\tisArray: Array.isArray || function (obj) {\r\n\t\treturn (Object.prototype.toString.call(obj) === '[object Array]');\r\n\t},\r\n\r\n\temptyImageUrl: 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='\r\n};\r\n\r\n(function () {\r\n\r\n\t// inspired by http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n\r\n\tfunction getPrefixed(name) {\r\n\t\tvar i, fn,\r\n\t\t    prefixes = ['webkit', 'moz', 'o', 'ms'];\r\n\r\n\t\tfor (i = 0; i < prefixes.length && !fn; i++) {\r\n\t\t\tfn = window[prefixes[i] + name];\r\n\t\t}\r\n\r\n\t\treturn fn;\r\n\t}\r\n\r\n\tvar lastTime = 0;\r\n\r\n\tfunction timeoutDefer(fn) {\r\n\t\tvar time = +new Date(),\r\n\t\t    timeToCall = Math.max(0, 16 - (time - lastTime));\r\n\r\n\t\tlastTime = time + timeToCall;\r\n\t\treturn window.setTimeout(fn, timeToCall);\r\n\t}\r\n\r\n\tvar requestFn = window.requestAnimationFrame ||\r\n\t        getPrefixed('RequestAnimationFrame') || timeoutDefer;\r\n\r\n\tvar cancelFn = window.cancelAnimationFrame ||\r\n\t        getPrefixed('CancelAnimationFrame') ||\r\n\t        getPrefixed('CancelRequestAnimationFrame') ||\r\n\t        function (id) { window.clearTimeout(id); };\r\n\r\n\r\n\tL.Util.requestAnimFrame = function (fn, context, immediate, element) {\r\n\t\tfn = L.bind(fn, context);\r\n\r\n\t\tif (immediate && requestFn === timeoutDefer) {\r\n\t\t\tfn();\r\n\t\t} else {\r\n\t\t\treturn requestFn.call(window, fn, element);\r\n\t\t}\r\n\t};\r\n\r\n\tL.Util.cancelAnimFrame = function (id) {\r\n\t\tif (id) {\r\n\t\t\tcancelFn.call(window, id);\r\n\t\t}\r\n\t};\r\n\r\n}());\r\n\r\n// shortcuts for most used utility functions\r\nL.extend = L.Util.extend;\r\nL.bind = L.Util.bind;\r\nL.stamp = L.Util.stamp;\r\nL.setOptions = L.Util.setOptions;\r\n\n\n/*\r\n * L.Class powers the OOP facilities of the library.\r\n * Thanks to John Resig and Dean Edwards for inspiration!\r\n */\r\n\r\nL.Class = function () {};\r\n\r\nL.Class.extend = function (props) {\r\n\r\n\t// extended class with the new prototype\r\n\tvar NewClass = function () {\r\n\r\n\t\t// call the constructor\r\n\t\tif (this.initialize) {\r\n\t\t\tthis.initialize.apply(this, arguments);\r\n\t\t}\r\n\r\n\t\t// call all constructor hooks\r\n\t\tif (this._initHooks) {\r\n\t\t\tthis.callInitHooks();\r\n\t\t}\r\n\t};\r\n\r\n\t// instantiate class without calling constructor\r\n\tvar F = function () {};\r\n\tF.prototype = this.prototype;\r\n\r\n\tvar proto = new F();\r\n\tproto.constructor = NewClass;\r\n\r\n\tNewClass.prototype = proto;\r\n\r\n\t//inherit parent's statics\r\n\tfor (var i in this) {\r\n\t\tif (this.hasOwnProperty(i) && i !== 'prototype') {\r\n\t\t\tNewClass[i] = this[i];\r\n\t\t}\r\n\t}\r\n\r\n\t// mix static properties into the class\r\n\tif (props.statics) {\r\n\t\tL.extend(NewClass, props.statics);\r\n\t\tdelete props.statics;\r\n\t}\r\n\r\n\t// mix includes into the prototype\r\n\tif (props.includes) {\r\n\t\tL.Util.extend.apply(null, [proto].concat(props.includes));\r\n\t\tdelete props.includes;\r\n\t}\r\n\r\n\t// merge options\r\n\tif (props.options && proto.options) {\r\n\t\tprops.options = L.extend({}, proto.options, props.options);\r\n\t}\r\n\r\n\t// mix given properties into the prototype\r\n\tL.extend(proto, props);\r\n\r\n\tproto._initHooks = [];\r\n\r\n\tvar parent = this;\r\n\t// jshint camelcase: false\r\n\tNewClass.__super__ = parent.prototype;\r\n\r\n\t// add method for calling all hooks\r\n\tproto.callInitHooks = function () {\r\n\r\n\t\tif (this._initHooksCalled) { return; }\r\n\r\n\t\tif (parent.prototype.callInitHooks) {\r\n\t\t\tparent.prototype.callInitHooks.call(this);\r\n\t\t}\r\n\r\n\t\tthis._initHooksCalled = true;\r\n\r\n\t\tfor (var i = 0, len = proto._initHooks.length; i < len; i++) {\r\n\t\t\tproto._initHooks[i].call(this);\r\n\t\t}\r\n\t};\r\n\r\n\treturn NewClass;\r\n};\r\n\r\n\r\n// method for adding properties to prototype\r\nL.Class.include = function (props) {\r\n\tL.extend(this.prototype, props);\r\n};\r\n\r\n// merge new default options to the Class\r\nL.Class.mergeOptions = function (options) {\r\n\tL.extend(this.prototype.options, options);\r\n};\r\n\r\n// add a constructor hook\r\nL.Class.addInitHook = function (fn) { // (Function) || (String, args...)\r\n\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\r\n\tvar init = typeof fn === 'function' ? fn : function () {\r\n\t\tthis[fn].apply(this, args);\r\n\t};\r\n\r\n\tthis.prototype._initHooks = this.prototype._initHooks || [];\r\n\tthis.prototype._initHooks.push(init);\r\n};\r\n\n\n/*\r\n * L.Mixin.Events is used to add custom events functionality to Leaflet classes.\r\n */\r\n\r\nvar eventsKey = '_leaflet_events';\r\n\r\nL.Mixin = {};\r\n\r\nL.Mixin.Events = {\r\n\r\n\taddEventListener: function (types, fn, context) { // (String, Function[, Object]) or (Object[, Object])\r\n\r\n\t\t// types can be a map of types/handlers\r\n\t\tif (L.Util.invokeEach(types, this.addEventListener, this, fn, context)) { return this; }\r\n\r\n\t\tvar events = this[eventsKey] = this[eventsKey] || {},\r\n\t\t    contextId = context && context !== this && L.stamp(context),\r\n\t\t    i, len, event, type, indexKey, indexLenKey, typeIndex;\r\n\r\n\t\t// types can be a string of space-separated words\r\n\t\ttypes = L.Util.splitWords(types);\r\n\r\n\t\tfor (i = 0, len = types.length; i < len; i++) {\r\n\t\t\tevent = {\r\n\t\t\t\taction: fn,\r\n\t\t\t\tcontext: context || this\r\n\t\t\t};\r\n\t\t\ttype = types[i];\r\n\r\n\t\t\tif (contextId) {\r\n\t\t\t\t// store listeners of a particular context in a separate hash (if it has an id)\r\n\t\t\t\t// gives a major performance boost when removing thousands of map layers\r\n\r\n\t\t\t\tindexKey = type + '_idx';\r\n\t\t\t\tindexLenKey = indexKey + '_len';\r\n\r\n\t\t\t\ttypeIndex = events[indexKey] = events[indexKey] || {};\r\n\r\n\t\t\t\tif (!typeIndex[contextId]) {\r\n\t\t\t\t\ttypeIndex[contextId] = [];\r\n\r\n\t\t\t\t\t// keep track of the number of keys in the index to quickly check if it's empty\r\n\t\t\t\t\tevents[indexLenKey] = (events[indexLenKey] || 0) + 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttypeIndex[contextId].push(event);\r\n\r\n\r\n\t\t\t} else {\r\n\t\t\t\tevents[type] = events[type] || [];\r\n\t\t\t\tevents[type].push(event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\thasEventListeners: function (type) { // (String) -> Boolean\r\n\t\tvar events = this[eventsKey];\r\n\t\treturn !!events && ((type in events && events[type].length > 0) ||\r\n\t\t                    (type + '_idx' in events && events[type + '_idx_len'] > 0));\r\n\t},\r\n\r\n\tremoveEventListener: function (types, fn, context) { // ([String, Function, Object]) or (Object[, Object])\r\n\r\n\t\tif (!this[eventsKey]) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (!types) {\r\n\t\t\treturn this.clearAllEventListeners();\r\n\t\t}\r\n\r\n\t\tif (L.Util.invokeEach(types, this.removeEventListener, this, fn, context)) { return this; }\r\n\r\n\t\tvar events = this[eventsKey],\r\n\t\t    contextId = context && context !== this && L.stamp(context),\r\n\t\t    i, len, type, listeners, j, indexKey, indexLenKey, typeIndex, removed;\r\n\r\n\t\ttypes = L.Util.splitWords(types);\r\n\r\n\t\tfor (i = 0, len = types.length; i < len; i++) {\r\n\t\t\ttype = types[i];\r\n\t\t\tindexKey = type + '_idx';\r\n\t\t\tindexLenKey = indexKey + '_len';\r\n\r\n\t\t\ttypeIndex = events[indexKey];\r\n\r\n\t\t\tif (!fn) {\r\n\t\t\t\t// clear all listeners for a type if function isn't specified\r\n\t\t\t\tdelete events[type];\r\n\t\t\t\tdelete events[indexKey];\r\n\t\t\t\tdelete events[indexLenKey];\r\n\r\n\t\t\t} else {\r\n\t\t\t\tlisteners = contextId && typeIndex ? typeIndex[contextId] : events[type];\r\n\r\n\t\t\t\tif (listeners) {\r\n\t\t\t\t\tfor (j = listeners.length - 1; j >= 0; j--) {\r\n\t\t\t\t\t\tif ((listeners[j].action === fn) && (!context || (listeners[j].context === context))) {\r\n\t\t\t\t\t\t\tremoved = listeners.splice(j, 1);\r\n\t\t\t\t\t\t\t// set the old action to a no-op, because it is possible\r\n\t\t\t\t\t\t\t// that the listener is being iterated over as part of a dispatch\r\n\t\t\t\t\t\t\tremoved[0].action = L.Util.falseFn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (context && typeIndex && (listeners.length === 0)) {\r\n\t\t\t\t\t\tdelete typeIndex[contextId];\r\n\t\t\t\t\t\tevents[indexLenKey]--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclearAllEventListeners: function () {\r\n\t\tdelete this[eventsKey];\r\n\t\treturn this;\r\n\t},\r\n\r\n\tfireEvent: function (type, data) { // (String[, Object])\r\n\t\tif (!this.hasEventListeners(type)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar event = L.Util.extend({}, data, { type: type, target: this });\r\n\r\n\t\tvar events = this[eventsKey],\r\n\t\t    listeners, i, len, typeIndex, contextId;\r\n\r\n\t\tif (events[type]) {\r\n\t\t\t// make sure adding/removing listeners inside other listeners won't cause infinite loop\r\n\t\t\tlisteners = events[type].slice();\r\n\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tlisteners[i].action.call(listeners[i].context, event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// fire event for the context-indexed listeners as well\r\n\t\ttypeIndex = events[type + '_idx'];\r\n\r\n\t\tfor (contextId in typeIndex) {\r\n\t\t\tlisteners = typeIndex[contextId].slice();\r\n\r\n\t\t\tif (listeners) {\r\n\t\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\t\tlisteners[i].action.call(listeners[i].context, event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddOneTimeEventListener: function (types, fn, context) {\r\n\r\n\t\tif (L.Util.invokeEach(types, this.addOneTimeEventListener, this, fn, context)) { return this; }\r\n\r\n\t\tvar handler = L.bind(function () {\r\n\t\t\tthis\r\n\t\t\t    .removeEventListener(types, fn, context)\r\n\t\t\t    .removeEventListener(types, handler, context);\r\n\t\t}, this);\r\n\r\n\t\treturn this\r\n\t\t    .addEventListener(types, fn, context)\r\n\t\t    .addEventListener(types, handler, context);\r\n\t}\r\n};\r\n\r\nL.Mixin.Events.on = L.Mixin.Events.addEventListener;\r\nL.Mixin.Events.off = L.Mixin.Events.removeEventListener;\r\nL.Mixin.Events.once = L.Mixin.Events.addOneTimeEventListener;\r\nL.Mixin.Events.fire = L.Mixin.Events.fireEvent;\r\n\n\n/*\r\n * L.Browser handles different browser and feature detections for internal Leaflet use.\r\n */\r\n\r\n(function () {\r\n\r\n\tvar ie = 'ActiveXObject' in window,\r\n\t\tielt9 = ie && !document.addEventListener,\r\n\r\n\t    // terrible browser detection to work around Safari / iOS / Android browser bugs\r\n\t    ua = navigator.userAgent.toLowerCase(),\r\n\t    webkit = ua.indexOf('webkit') !== -1,\r\n\t    chrome = ua.indexOf('chrome') !== -1,\r\n\t    phantomjs = ua.indexOf('phantom') !== -1,\r\n\t    android = ua.indexOf('android') !== -1,\r\n\t    android23 = ua.search('android [23]') !== -1,\r\n\t\tgecko = ua.indexOf('gecko') !== -1,\r\n\r\n\t    mobile = typeof orientation !== undefined + '',\r\n\t    msPointer = !window.PointerEvent && window.MSPointerEvent,\r\n\t\tpointer = (window.PointerEvent && window.navigator.pointerEnabled) ||\r\n\t\t\t\t  msPointer,\r\n\t    retina = ('devicePixelRatio' in window && window.devicePixelRatio > 1) ||\r\n\t             ('matchMedia' in window && window.matchMedia('(min-resolution:144dpi)') &&\r\n\t              window.matchMedia('(min-resolution:144dpi)').matches),\r\n\r\n\t    doc = document.documentElement,\r\n\t    ie3d = ie && ('transition' in doc.style),\r\n\t    webkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()) && !android23,\r\n\t    gecko3d = 'MozPerspective' in doc.style,\r\n\t    opera3d = 'OTransition' in doc.style,\r\n\t    any3d = !window.L_DISABLE_3D && (ie3d || webkit3d || gecko3d || opera3d) && !phantomjs;\r\n\r\n\tvar touch = !window.L_NO_TOUCH && !phantomjs && (pointer || 'ontouchstart' in window ||\r\n\t\t(window.DocumentTouch && document instanceof window.DocumentTouch));\r\n\r\n\tL.Browser = {\r\n\t\tie: ie,\r\n\t\tielt9: ielt9,\r\n\t\twebkit: webkit,\r\n\t\tgecko: gecko && !webkit && !window.opera && !ie,\r\n\r\n\t\tandroid: android,\r\n\t\tandroid23: android23,\r\n\r\n\t\tchrome: chrome,\r\n\r\n\t\tie3d: ie3d,\r\n\t\twebkit3d: webkit3d,\r\n\t\tgecko3d: gecko3d,\r\n\t\topera3d: opera3d,\r\n\t\tany3d: any3d,\r\n\r\n\t\tmobile: mobile,\r\n\t\tmobileWebkit: mobile && webkit,\r\n\t\tmobileWebkit3d: mobile && webkit3d,\r\n\t\tmobileOpera: mobile && window.opera,\r\n\r\n\t\ttouch: touch,\r\n\t\tmsPointer: msPointer,\r\n\t\tpointer: pointer,\r\n\r\n\t\tretina: retina\r\n\t};\r\n\r\n}());\r\n\n\n/*\r\n * L.Point represents a point with x and y coordinates.\r\n */\r\n\r\nL.Point = function (/*Number*/ x, /*Number*/ y, /*Boolean*/ round) {\r\n\tthis.x = (round ? Math.round(x) : x);\r\n\tthis.y = (round ? Math.round(y) : y);\r\n};\r\n\r\nL.Point.prototype = {\r\n\r\n\tclone: function () {\r\n\t\treturn new L.Point(this.x, this.y);\r\n\t},\r\n\r\n\t// non-destructive, returns a new point\r\n\tadd: function (point) {\r\n\t\treturn this.clone()._add(L.point(point));\r\n\t},\r\n\r\n\t// destructive, used directly for performance in situations where it's safe to modify existing point\r\n\t_add: function (point) {\r\n\t\tthis.x += point.x;\r\n\t\tthis.y += point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsubtract: function (point) {\r\n\t\treturn this.clone()._subtract(L.point(point));\r\n\t},\r\n\r\n\t_subtract: function (point) {\r\n\t\tthis.x -= point.x;\r\n\t\tthis.y -= point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdivideBy: function (num) {\r\n\t\treturn this.clone()._divideBy(num);\r\n\t},\r\n\r\n\t_divideBy: function (num) {\r\n\t\tthis.x /= num;\r\n\t\tthis.y /= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tmultiplyBy: function (num) {\r\n\t\treturn this.clone()._multiplyBy(num);\r\n\t},\r\n\r\n\t_multiplyBy: function (num) {\r\n\t\tthis.x *= num;\r\n\t\tthis.y *= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tround: function () {\r\n\t\treturn this.clone()._round();\r\n\t},\r\n\r\n\t_round: function () {\r\n\t\tthis.x = Math.round(this.x);\r\n\t\tthis.y = Math.round(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tfloor: function () {\r\n\t\treturn this.clone()._floor();\r\n\t},\r\n\r\n\t_floor: function () {\r\n\t\tthis.x = Math.floor(this.x);\r\n\t\tthis.y = Math.floor(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdistanceTo: function (point) {\r\n\t\tpoint = L.point(point);\r\n\r\n\t\tvar x = point.x - this.x,\r\n\t\t    y = point.y - this.y;\r\n\r\n\t\treturn Math.sqrt(x * x + y * y);\r\n\t},\r\n\r\n\tequals: function (point) {\r\n\t\tpoint = L.point(point);\r\n\r\n\t\treturn point.x === this.x &&\r\n\t\t       point.y === this.y;\r\n\t},\r\n\r\n\tcontains: function (point) {\r\n\t\tpoint = L.point(point);\r\n\r\n\t\treturn Math.abs(point.x) <= Math.abs(this.x) &&\r\n\t\t       Math.abs(point.y) <= Math.abs(this.y);\r\n\t},\r\n\r\n\ttoString: function () {\r\n\t\treturn 'Point(' +\r\n\t\t        L.Util.formatNum(this.x) + ', ' +\r\n\t\t        L.Util.formatNum(this.y) + ')';\r\n\t}\r\n};\r\n\r\nL.point = function (x, y, round) {\r\n\tif (x instanceof L.Point) {\r\n\t\treturn x;\r\n\t}\r\n\tif (L.Util.isArray(x)) {\r\n\t\treturn new L.Point(x[0], x[1]);\r\n\t}\r\n\tif (x === undefined || x === null) {\r\n\t\treturn x;\r\n\t}\r\n\treturn new L.Point(x, y, round);\r\n};\r\n\n\n/*\r\n * L.Bounds represents a rectangular area on the screen in pixel coordinates.\r\n */\r\n\r\nL.Bounds = function (a, b) { //(Point, Point) or Point[]\r\n\tif (!a) { return; }\r\n\r\n\tvar points = b ? [a, b] : a;\r\n\r\n\tfor (var i = 0, len = points.length; i < len; i++) {\r\n\t\tthis.extend(points[i]);\r\n\t}\r\n};\r\n\r\nL.Bounds.prototype = {\r\n\t// extend the bounds to contain the given point\r\n\textend: function (point) { // (Point)\r\n\t\tpoint = L.point(point);\r\n\r\n\t\tif (!this.min && !this.max) {\r\n\t\t\tthis.min = point.clone();\r\n\t\t\tthis.max = point.clone();\r\n\t\t} else {\r\n\t\t\tthis.min.x = Math.min(point.x, this.min.x);\r\n\t\t\tthis.max.x = Math.max(point.x, this.max.x);\r\n\t\t\tthis.min.y = Math.min(point.y, this.min.y);\r\n\t\t\tthis.max.y = Math.max(point.y, this.max.y);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetCenter: function (round) { // (Boolean) -> Point\r\n\t\treturn new L.Point(\r\n\t\t        (this.min.x + this.max.x) / 2,\r\n\t\t        (this.min.y + this.max.y) / 2, round);\r\n\t},\r\n\r\n\tgetBottomLeft: function () { // -> Point\r\n\t\treturn new L.Point(this.min.x, this.max.y);\r\n\t},\r\n\r\n\tgetTopRight: function () { // -> Point\r\n\t\treturn new L.Point(this.max.x, this.min.y);\r\n\t},\r\n\r\n\tgetSize: function () {\r\n\t\treturn this.max.subtract(this.min);\r\n\t},\r\n\r\n\tcontains: function (obj) { // (Bounds) or (Point) -> Boolean\r\n\t\tvar min, max;\r\n\r\n\t\tif (typeof obj[0] === 'number' || obj instanceof L.Point) {\r\n\t\t\tobj = L.point(obj);\r\n\t\t} else {\r\n\t\t\tobj = L.bounds(obj);\r\n\t\t}\r\n\r\n\t\tif (obj instanceof L.Bounds) {\r\n\t\t\tmin = obj.min;\r\n\t\t\tmax = obj.max;\r\n\t\t} else {\r\n\t\t\tmin = max = obj;\r\n\t\t}\r\n\r\n\t\treturn (min.x >= this.min.x) &&\r\n\t\t       (max.x <= this.max.x) &&\r\n\t\t       (min.y >= this.min.y) &&\r\n\t\t       (max.y <= this.max.y);\r\n\t},\r\n\r\n\tintersects: function (bounds) { // (Bounds) -> Boolean\r\n\t\tbounds = L.bounds(bounds);\r\n\r\n\t\tvar min = this.min,\r\n\t\t    max = this.max,\r\n\t\t    min2 = bounds.min,\r\n\t\t    max2 = bounds.max,\r\n\t\t    xIntersects = (max2.x >= min.x) && (min2.x <= max.x),\r\n\t\t    yIntersects = (max2.y >= min.y) && (min2.y <= max.y);\r\n\r\n\t\treturn xIntersects && yIntersects;\r\n\t},\r\n\r\n\tisValid: function () {\r\n\t\treturn !!(this.min && this.max);\r\n\t}\r\n};\r\n\r\nL.bounds = function (a, b) { // (Bounds) or (Point, Point) or (Point[])\r\n\tif (!a || a instanceof L.Bounds) {\r\n\t\treturn a;\r\n\t}\r\n\treturn new L.Bounds(a, b);\r\n};\r\n\n\n/*\r\n * L.Transformation is an utility class to perform simple point transformations through a 2d-matrix.\r\n */\r\n\r\nL.Transformation = function (a, b, c, d) {\r\n\tthis._a = a;\r\n\tthis._b = b;\r\n\tthis._c = c;\r\n\tthis._d = d;\r\n};\r\n\r\nL.Transformation.prototype = {\r\n\ttransform: function (point, scale) { // (Point, Number) -> Point\r\n\t\treturn this._transform(point.clone(), scale);\r\n\t},\r\n\r\n\t// destructive transform (faster)\r\n\t_transform: function (point, scale) {\r\n\t\tscale = scale || 1;\r\n\t\tpoint.x = scale * (this._a * point.x + this._b);\r\n\t\tpoint.y = scale * (this._c * point.y + this._d);\r\n\t\treturn point;\r\n\t},\r\n\r\n\tuntransform: function (point, scale) {\r\n\t\tscale = scale || 1;\r\n\t\treturn new L.Point(\r\n\t\t        (point.x / scale - this._b) / this._a,\r\n\t\t        (point.y / scale - this._d) / this._c);\r\n\t}\r\n};\r\n\n\n/*\r\n * L.DomUtil contains various utility functions for working with DOM.\r\n */\r\n\r\nL.DomUtil = {\r\n\tget: function (id) {\r\n\t\treturn (typeof id === 'string' ? document.getElementById(id) : id);\r\n\t},\r\n\r\n\tgetStyle: function (el, style) {\r\n\r\n\t\tvar value = el.style[style];\r\n\r\n\t\tif (!value && el.currentStyle) {\r\n\t\t\tvalue = el.currentStyle[style];\r\n\t\t}\r\n\r\n\t\tif ((!value || value === 'auto') && document.defaultView) {\r\n\t\t\tvar css = document.defaultView.getComputedStyle(el, null);\r\n\t\t\tvalue = css ? css[style] : null;\r\n\t\t}\r\n\r\n\t\treturn value === 'auto' ? null : value;\r\n\t},\r\n\r\n\tgetViewportOffset: function (element) {\r\n\r\n\t\tvar top = 0,\r\n\t\t    left = 0,\r\n\t\t    el = element,\r\n\t\t    docBody = document.body,\r\n\t\t    docEl = document.documentElement,\r\n\t\t    pos;\r\n\r\n\t\tdo {\r\n\t\t\ttop  += el.offsetTop  || 0;\r\n\t\t\tleft += el.offsetLeft || 0;\r\n\r\n\t\t\t//add borders\r\n\t\t\ttop += parseInt(L.DomUtil.getStyle(el, 'borderTopWidth'), 10) || 0;\r\n\t\t\tleft += parseInt(L.DomUtil.getStyle(el, 'borderLeftWidth'), 10) || 0;\r\n\r\n\t\t\tpos = L.DomUtil.getStyle(el, 'position');\r\n\r\n\t\t\tif (el.offsetParent === docBody && pos === 'absolute') { break; }\r\n\r\n\t\t\tif (pos === 'fixed') {\r\n\t\t\t\ttop  += docBody.scrollTop  || docEl.scrollTop  || 0;\r\n\t\t\t\tleft += docBody.scrollLeft || docEl.scrollLeft || 0;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (pos === 'relative' && !el.offsetLeft) {\r\n\t\t\t\tvar width = L.DomUtil.getStyle(el, 'width'),\r\n\t\t\t\t    maxWidth = L.DomUtil.getStyle(el, 'max-width'),\r\n\t\t\t\t    r = el.getBoundingClientRect();\r\n\r\n\t\t\t\tif (width !== 'none' || maxWidth !== 'none') {\r\n\t\t\t\t\tleft += r.left + el.clientLeft;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//calculate full y offset since we're breaking out of the loop\r\n\t\t\t\ttop += r.top + (docBody.scrollTop  || docEl.scrollTop  || 0);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tel = el.offsetParent;\r\n\r\n\t\t} while (el);\r\n\r\n\t\tel = element;\r\n\r\n\t\tdo {\r\n\t\t\tif (el === docBody) { break; }\r\n\r\n\t\t\ttop  -= el.scrollTop  || 0;\r\n\t\t\tleft -= el.scrollLeft || 0;\r\n\r\n\t\t\tel = el.parentNode;\r\n\t\t} while (el);\r\n\r\n\t\treturn new L.Point(left, top);\r\n\t},\r\n\r\n\tdocumentIsLtr: function () {\r\n\t\tif (!L.DomUtil._docIsLtrCached) {\r\n\t\t\tL.DomUtil._docIsLtrCached = true;\r\n\t\t\tL.DomUtil._docIsLtr = L.DomUtil.getStyle(document.body, 'direction') === 'ltr';\r\n\t\t}\r\n\t\treturn L.DomUtil._docIsLtr;\r\n\t},\r\n\r\n\tcreate: function (tagName, className, container) {\r\n\r\n\t\tvar el = document.createElement(tagName);\r\n\t\tel.className = className;\r\n\r\n\t\tif (container) {\r\n\t\t\tcontainer.appendChild(el);\r\n\t\t}\r\n\r\n\t\treturn el;\r\n\t},\r\n\r\n\thasClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\treturn el.classList.contains(name);\r\n\t\t}\r\n\t\tvar className = L.DomUtil._getClass(el);\r\n\t\treturn className.length > 0 && new RegExp('(^|\\\\s)' + name + '(\\\\s|$)').test(className);\r\n\t},\r\n\r\n\taddClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\tvar classes = L.Util.splitWords(name);\r\n\t\t\tfor (var i = 0, len = classes.length; i < len; i++) {\r\n\t\t\t\tel.classList.add(classes[i]);\r\n\t\t\t}\r\n\t\t} else if (!L.DomUtil.hasClass(el, name)) {\r\n\t\t\tvar className = L.DomUtil._getClass(el);\r\n\t\t\tL.DomUtil._setClass(el, (className ? className + ' ' : '') + name);\r\n\t\t}\r\n\t},\r\n\r\n\tremoveClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\tel.classList.remove(name);\r\n\t\t} else {\r\n\t\t\tL.DomUtil._setClass(el, L.Util.trim((' ' + L.DomUtil._getClass(el) + ' ').replace(' ' + name + ' ', ' ')));\r\n\t\t}\r\n\t},\r\n\r\n\t_setClass: function (el, name) {\r\n\t\tif (el.className.baseVal === undefined) {\r\n\t\t\tel.className = name;\r\n\t\t} else {\r\n\t\t\t// in case of SVG element\r\n\t\t\tel.className.baseVal = name;\r\n\t\t}\r\n\t},\r\n\r\n\t_getClass: function (el) {\r\n\t\treturn el.className.baseVal === undefined ? el.className : el.className.baseVal;\r\n\t},\r\n\r\n\tsetOpacity: function (el, value) {\r\n\r\n\t\tif ('opacity' in el.style) {\r\n\t\t\tel.style.opacity = value;\r\n\r\n\t\t} else if ('filter' in el.style) {\r\n\r\n\t\t\tvar filter = false,\r\n\t\t\t    filterName = 'DXImageTransform.Microsoft.Alpha';\r\n\r\n\t\t\t// filters collection throws an error if we try to retrieve a filter that doesn't exist\r\n\t\t\ttry {\r\n\t\t\t\tfilter = el.filters.item(filterName);\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// don't set opacity to 1 if we haven't already set an opacity,\r\n\t\t\t\t// it isn't needed and breaks transparent pngs.\r\n\t\t\t\tif (value === 1) { return; }\r\n\t\t\t}\r\n\r\n\t\t\tvalue = Math.round(value * 100);\r\n\r\n\t\t\tif (filter) {\r\n\t\t\t\tfilter.Enabled = (value !== 100);\r\n\t\t\t\tfilter.Opacity = value;\r\n\t\t\t} else {\r\n\t\t\t\tel.style.filter += ' progid:' + filterName + '(opacity=' + value + ')';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\ttestProp: function (props) {\r\n\r\n\t\tvar style = document.documentElement.style;\r\n\r\n\t\tfor (var i = 0; i < props.length; i++) {\r\n\t\t\tif (props[i] in style) {\r\n\t\t\t\treturn props[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tgetTranslateString: function (point) {\r\n\t\t// on WebKit browsers (Chrome/Safari/iOS Safari/Android) using translate3d instead of translate\r\n\t\t// makes animation smoother as it ensures HW accel is used. Firefox 13 doesn't care\r\n\t\t// (same speed either way), Opera 12 doesn't support translate3d\r\n\r\n\t\tvar is3d = L.Browser.webkit3d,\r\n\t\t    open = 'translate' + (is3d ? '3d' : '') + '(',\r\n\t\t    close = (is3d ? ',0' : '') + ')';\r\n\r\n\t\treturn open + point.x + 'px,' + point.y + 'px' + close;\r\n\t},\r\n\r\n\tgetScaleString: function (scale, origin) {\r\n\r\n\t\tvar preTranslateStr = L.DomUtil.getTranslateString(origin.add(origin.multiplyBy(-1 * scale))),\r\n\t\t    scaleStr = ' scale(' + scale + ') ';\r\n\r\n\t\treturn preTranslateStr + scaleStr;\r\n\t},\r\n\r\n\tsetPosition: function (el, point, disable3D) { // (HTMLElement, Point[, Boolean])\r\n\r\n\t\t// jshint camelcase: false\r\n\t\tel._leaflet_pos = point;\r\n\r\n\t\tif (!disable3D && L.Browser.any3d) {\r\n\t\t\tel.style[L.DomUtil.TRANSFORM] =  L.DomUtil.getTranslateString(point);\r\n\t\t} else {\r\n\t\t\tel.style.left = point.x + 'px';\r\n\t\t\tel.style.top = point.y + 'px';\r\n\t\t}\r\n\t},\r\n\r\n\tgetPosition: function (el) {\r\n\t\t// this method is only used for elements previously positioned using setPosition,\r\n\t\t// so it's safe to cache the position for performance\r\n\r\n\t\t// jshint camelcase: false\r\n\t\treturn el._leaflet_pos;\r\n\t}\r\n};\r\n\r\n\r\n// prefix style property names\r\n\r\nL.DomUtil.TRANSFORM = L.DomUtil.testProp(\r\n        ['transform', 'WebkitTransform', 'OTransform', 'MozTransform', 'msTransform']);\r\n\r\n// webkitTransition comes first because some browser versions that drop vendor prefix don't do\r\n// the same for the transitionend event, in particular the Android 4.1 stock browser\r\n\r\nL.DomUtil.TRANSITION = L.DomUtil.testProp(\r\n        ['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);\r\n\r\nL.DomUtil.TRANSITION_END =\r\n        L.DomUtil.TRANSITION === 'webkitTransition' || L.DomUtil.TRANSITION === 'OTransition' ?\r\n        L.DomUtil.TRANSITION + 'End' : 'transitionend';\r\n\r\n(function () {\r\n    if ('onselectstart' in document) {\r\n        L.extend(L.DomUtil, {\r\n            disableTextSelection: function () {\r\n                L.DomEvent.on(window, 'selectstart', L.DomEvent.preventDefault);\r\n            },\r\n\r\n            enableTextSelection: function () {\r\n                L.DomEvent.off(window, 'selectstart', L.DomEvent.preventDefault);\r\n            }\r\n        });\r\n    } else {\r\n        var userSelectProperty = L.DomUtil.testProp(\r\n            ['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);\r\n\r\n        L.extend(L.DomUtil, {\r\n            disableTextSelection: function () {\r\n                if (userSelectProperty) {\r\n                    var style = document.documentElement.style;\r\n                    this._userSelect = style[userSelectProperty];\r\n                    style[userSelectProperty] = 'none';\r\n                }\r\n            },\r\n\r\n            enableTextSelection: function () {\r\n                if (userSelectProperty) {\r\n                    document.documentElement.style[userSelectProperty] = this._userSelect;\r\n                    delete this._userSelect;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\tL.extend(L.DomUtil, {\r\n\t\tdisableImageDrag: function () {\r\n\t\t\tL.DomEvent.on(window, 'dragstart', L.DomEvent.preventDefault);\r\n\t\t},\r\n\r\n\t\tenableImageDrag: function () {\r\n\t\t\tL.DomEvent.off(window, 'dragstart', L.DomEvent.preventDefault);\r\n\t\t}\r\n\t});\r\n})();\r\n\n\n/*\r\n * L.LatLng represents a geographical point with latitude and longitude coordinates.\r\n */\r\n\r\nL.LatLng = function (lat, lng, alt) { // (Number, Number, Number)\r\n\tlat = parseFloat(lat);\r\n\tlng = parseFloat(lng);\r\n\r\n\tif (isNaN(lat) || isNaN(lng)) {\r\n\t\tthrow new Error('Invalid LatLng object: (' + lat + ', ' + lng + ')');\r\n\t}\r\n\r\n\tthis.lat = lat;\r\n\tthis.lng = lng;\r\n\r\n\tif (alt !== undefined) {\r\n\t\tthis.alt = parseFloat(alt);\r\n\t}\r\n};\r\n\r\nL.extend(L.LatLng, {\r\n\tDEG_TO_RAD: Math.PI / 180,\r\n\tRAD_TO_DEG: 180 / Math.PI,\r\n\tMAX_MARGIN: 1.0E-9 // max margin of error for the \"equals\" check\r\n});\r\n\r\nL.LatLng.prototype = {\r\n\tequals: function (obj) { // (LatLng) -> Boolean\r\n\t\tif (!obj) { return false; }\r\n\r\n\t\tobj = L.latLng(obj);\r\n\r\n\t\tvar margin = Math.max(\r\n\t\t        Math.abs(this.lat - obj.lat),\r\n\t\t        Math.abs(this.lng - obj.lng));\r\n\r\n\t\treturn margin <= L.LatLng.MAX_MARGIN;\r\n\t},\r\n\r\n\ttoString: function (precision) { // (Number) -> String\r\n\t\treturn 'LatLng(' +\r\n\t\t        L.Util.formatNum(this.lat, precision) + ', ' +\r\n\t\t        L.Util.formatNum(this.lng, precision) + ')';\r\n\t},\r\n\r\n\t// Haversine distance formula, see http://en.wikipedia.org/wiki/Haversine_formula\r\n\t// TODO move to projection code, LatLng shouldn't know about Earth\r\n\tdistanceTo: function (other) { // (LatLng) -> Number\r\n\t\tother = L.latLng(other);\r\n\r\n\t\tvar R = 6378137, // earth radius in meters\r\n\t\t    d2r = L.LatLng.DEG_TO_RAD,\r\n\t\t    dLat = (other.lat - this.lat) * d2r,\r\n\t\t    dLon = (other.lng - this.lng) * d2r,\r\n\t\t    lat1 = this.lat * d2r,\r\n\t\t    lat2 = other.lat * d2r,\r\n\t\t    sin1 = Math.sin(dLat / 2),\r\n\t\t    sin2 = Math.sin(dLon / 2);\r\n\r\n\t\tvar a = sin1 * sin1 + sin2 * sin2 * Math.cos(lat1) * Math.cos(lat2);\r\n\r\n\t\treturn R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\t},\r\n\r\n\twrap: function (a, b) { // (Number, Number) -> LatLng\r\n\t\tvar lng = this.lng;\r\n\r\n\t\ta = a || -180;\r\n\t\tb = b ||  180;\r\n\r\n\t\tlng = (lng + b) % (b - a) + (lng < a || lng === b ? b : a);\r\n\r\n\t\treturn new L.LatLng(this.lat, lng);\r\n\t}\r\n};\r\n\r\nL.latLng = function (a, b) { // (LatLng) or ([Number, Number]) or (Number, Number)\r\n\tif (a instanceof L.LatLng) {\r\n\t\treturn a;\r\n\t}\r\n\tif (L.Util.isArray(a)) {\r\n\t\tif (typeof a[0] === 'number' || typeof a[0] === 'string') {\r\n\t\t\treturn new L.LatLng(a[0], a[1], a[2]);\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\tif (a === undefined || a === null) {\r\n\t\treturn a;\r\n\t}\r\n\tif (typeof a === 'object' && 'lat' in a) {\r\n\t\treturn new L.LatLng(a.lat, 'lng' in a ? a.lng : a.lon);\r\n\t}\r\n\tif (b === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\treturn new L.LatLng(a, b);\r\n};\r\n\r\n\n\n/*\r\n * L.LatLngBounds represents a rectangular area on the map in geographical coordinates.\r\n */\r\n\r\nL.LatLngBounds = function (southWest, northEast) { // (LatLng, LatLng) or (LatLng[])\r\n\tif (!southWest) { return; }\r\n\r\n\tvar latlngs = northEast ? [southWest, northEast] : southWest;\r\n\r\n\tfor (var i = 0, len = latlngs.length; i < len; i++) {\r\n\t\tthis.extend(latlngs[i]);\r\n\t}\r\n};\r\n\r\nL.LatLngBounds.prototype = {\r\n\t// extend the bounds to contain the given point or bounds\r\n\textend: function (obj) { // (LatLng) or (LatLngBounds)\r\n\t\tif (!obj) { return this; }\r\n\r\n\t\tvar latLng = L.latLng(obj);\r\n\t\tif (latLng !== null) {\r\n\t\t\tobj = latLng;\r\n\t\t} else {\r\n\t\t\tobj = L.latLngBounds(obj);\r\n\t\t}\r\n\r\n\t\tif (obj instanceof L.LatLng) {\r\n\t\t\tif (!this._southWest && !this._northEast) {\r\n\t\t\t\tthis._southWest = new L.LatLng(obj.lat, obj.lng);\r\n\t\t\t\tthis._northEast = new L.LatLng(obj.lat, obj.lng);\r\n\t\t\t} else {\r\n\t\t\t\tthis._southWest.lat = Math.min(obj.lat, this._southWest.lat);\r\n\t\t\t\tthis._southWest.lng = Math.min(obj.lng, this._southWest.lng);\r\n\r\n\t\t\t\tthis._northEast.lat = Math.max(obj.lat, this._northEast.lat);\r\n\t\t\t\tthis._northEast.lng = Math.max(obj.lng, this._northEast.lng);\r\n\t\t\t}\r\n\t\t} else if (obj instanceof L.LatLngBounds) {\r\n\t\t\tthis.extend(obj._southWest);\r\n\t\t\tthis.extend(obj._northEast);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// extend the bounds by a percentage\r\n\tpad: function (bufferRatio) { // (Number) -> LatLngBounds\r\n\t\tvar sw = this._southWest,\r\n\t\t    ne = this._northEast,\r\n\t\t    heightBuffer = Math.abs(sw.lat - ne.lat) * bufferRatio,\r\n\t\t    widthBuffer = Math.abs(sw.lng - ne.lng) * bufferRatio;\r\n\r\n\t\treturn new L.LatLngBounds(\r\n\t\t        new L.LatLng(sw.lat - heightBuffer, sw.lng - widthBuffer),\r\n\t\t        new L.LatLng(ne.lat + heightBuffer, ne.lng + widthBuffer));\r\n\t},\r\n\r\n\tgetCenter: function () { // -> LatLng\r\n\t\treturn new L.LatLng(\r\n\t\t        (this._southWest.lat + this._northEast.lat) / 2,\r\n\t\t        (this._southWest.lng + this._northEast.lng) / 2);\r\n\t},\r\n\r\n\tgetSouthWest: function () {\r\n\t\treturn this._southWest;\r\n\t},\r\n\r\n\tgetNorthEast: function () {\r\n\t\treturn this._northEast;\r\n\t},\r\n\r\n\tgetNorthWest: function () {\r\n\t\treturn new L.LatLng(this.getNorth(), this.getWest());\r\n\t},\r\n\r\n\tgetSouthEast: function () {\r\n\t\treturn new L.LatLng(this.getSouth(), this.getEast());\r\n\t},\r\n\r\n\tgetWest: function () {\r\n\t\treturn this._southWest.lng;\r\n\t},\r\n\r\n\tgetSouth: function () {\r\n\t\treturn this._southWest.lat;\r\n\t},\r\n\r\n\tgetEast: function () {\r\n\t\treturn this._northEast.lng;\r\n\t},\r\n\r\n\tgetNorth: function () {\r\n\t\treturn this._northEast.lat;\r\n\t},\r\n\r\n\tcontains: function (obj) { // (LatLngBounds) or (LatLng) -> Boolean\r\n\t\tif (typeof obj[0] === 'number' || obj instanceof L.LatLng) {\r\n\t\t\tobj = L.latLng(obj);\r\n\t\t} else {\r\n\t\t\tobj = L.latLngBounds(obj);\r\n\t\t}\r\n\r\n\t\tvar sw = this._southWest,\r\n\t\t    ne = this._northEast,\r\n\t\t    sw2, ne2;\r\n\r\n\t\tif (obj instanceof L.LatLngBounds) {\r\n\t\t\tsw2 = obj.getSouthWest();\r\n\t\t\tne2 = obj.getNorthEast();\r\n\t\t} else {\r\n\t\t\tsw2 = ne2 = obj;\r\n\t\t}\r\n\r\n\t\treturn (sw2.lat >= sw.lat) && (ne2.lat <= ne.lat) &&\r\n\t\t       (sw2.lng >= sw.lng) && (ne2.lng <= ne.lng);\r\n\t},\r\n\r\n\tintersects: function (bounds) { // (LatLngBounds)\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\tvar sw = this._southWest,\r\n\t\t    ne = this._northEast,\r\n\t\t    sw2 = bounds.getSouthWest(),\r\n\t\t    ne2 = bounds.getNorthEast(),\r\n\r\n\t\t    latIntersects = (ne2.lat >= sw.lat) && (sw2.lat <= ne.lat),\r\n\t\t    lngIntersects = (ne2.lng >= sw.lng) && (sw2.lng <= ne.lng);\r\n\r\n\t\treturn latIntersects && lngIntersects;\r\n\t},\r\n\r\n\ttoBBoxString: function () {\r\n\t\treturn [this.getWest(), this.getSouth(), this.getEast(), this.getNorth()].join(',');\r\n\t},\r\n\r\n\tequals: function (bounds) { // (LatLngBounds)\r\n\t\tif (!bounds) { return false; }\r\n\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\treturn this._southWest.equals(bounds.getSouthWest()) &&\r\n\t\t       this._northEast.equals(bounds.getNorthEast());\r\n\t},\r\n\r\n\tisValid: function () {\r\n\t\treturn !!(this._southWest && this._northEast);\r\n\t}\r\n};\r\n\r\n//TODO International date line?\r\n\r\nL.latLngBounds = function (a, b) { // (LatLngBounds) or (LatLng, LatLng)\r\n\tif (!a || a instanceof L.LatLngBounds) {\r\n\t\treturn a;\r\n\t}\r\n\treturn new L.LatLngBounds(a, b);\r\n};\r\n\n\n/*\r\n * L.Projection contains various geographical projections used by CRS classes.\r\n */\r\n\r\nL.Projection = {};\r\n\n\n/*\r\n * Spherical Mercator is the most popular map projection, used by EPSG:3857 CRS used by default.\r\n */\r\n\r\nL.Projection.SphericalMercator = {\r\n\tMAX_LATITUDE: 85.0511287798,\r\n\r\n\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\tvar d = L.LatLng.DEG_TO_RAD,\r\n\t\t    max = this.MAX_LATITUDE,\r\n\t\t    lat = Math.max(Math.min(max, latlng.lat), -max),\r\n\t\t    x = latlng.lng * d,\r\n\t\t    y = lat * d;\r\n\r\n\t\ty = Math.log(Math.tan((Math.PI / 4) + (y / 2)));\r\n\r\n\t\treturn new L.Point(x, y);\r\n\t},\r\n\r\n\tunproject: function (point) { // (Point, Boolean) -> LatLng\r\n\t\tvar d = L.LatLng.RAD_TO_DEG,\r\n\t\t    lng = point.x * d,\r\n\t\t    lat = (2 * Math.atan(Math.exp(point.y)) - (Math.PI / 2)) * d;\r\n\r\n\t\treturn new L.LatLng(lat, lng);\r\n\t}\r\n};\r\n\n\n/*\r\n * Simple equirectangular (Plate Carree) projection, used by CRS like EPSG:4326 and Simple.\r\n */\r\n\r\nL.Projection.LonLat = {\r\n\tproject: function (latlng) {\r\n\t\treturn new L.Point(latlng.lng, latlng.lat);\r\n\t},\r\n\r\n\tunproject: function (point) {\r\n\t\treturn new L.LatLng(point.y, point.x);\r\n\t}\r\n};\r\n\n\n/*\r\n * L.CRS is a base object for all defined CRS (Coordinate Reference Systems) in Leaflet.\r\n */\r\n\r\nL.CRS = {\r\n\tlatLngToPoint: function (latlng, zoom) { // (LatLng, Number) -> Point\r\n\t\tvar projectedPoint = this.projection.project(latlng),\r\n\t\t    scale = this.scale(zoom);\r\n\r\n\t\treturn this.transformation._transform(projectedPoint, scale);\r\n\t},\r\n\r\n\tpointToLatLng: function (point, zoom) { // (Point, Number[, Boolean]) -> LatLng\r\n\t\tvar scale = this.scale(zoom),\r\n\t\t    untransformedPoint = this.transformation.untransform(point, scale);\r\n\r\n\t\treturn this.projection.unproject(untransformedPoint);\r\n\t},\r\n\r\n\tproject: function (latlng) {\r\n\t\treturn this.projection.project(latlng);\r\n\t},\r\n\r\n\tscale: function (zoom) {\r\n\t\treturn 256 * Math.pow(2, zoom);\r\n\t},\r\n\r\n\tgetSize: function (zoom) {\r\n\t\tvar s = this.scale(zoom);\r\n\t\treturn L.point(s, s);\r\n\t}\r\n};\r\n\n\n/*\n * A simple CRS that can be used for flat non-Earth maps like panoramas or game maps.\n */\n\nL.CRS.Simple = L.extend({}, L.CRS, {\n\tprojection: L.Projection.LonLat,\n\ttransformation: new L.Transformation(1, 0, -1, 0),\n\n\tscale: function (zoom) {\n\t\treturn Math.pow(2, zoom);\n\t}\n});\n\n\n/*\r\n * L.CRS.EPSG3857 (Spherical Mercator) is the most common CRS for web mapping\r\n * and is used by Leaflet by default.\r\n */\r\n\r\nL.CRS.EPSG3857 = L.extend({}, L.CRS, {\r\n\tcode: 'EPSG:3857',\r\n\r\n\tprojection: L.Projection.SphericalMercator,\r\n\ttransformation: new L.Transformation(0.5 / Math.PI, 0.5, -0.5 / Math.PI, 0.5),\r\n\r\n\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\tvar projectedPoint = this.projection.project(latlng),\r\n\t\t    earthRadius = 6378137;\r\n\t\treturn projectedPoint.multiplyBy(earthRadius);\r\n\t}\r\n});\r\n\r\nL.CRS.EPSG900913 = L.extend({}, L.CRS.EPSG3857, {\r\n\tcode: 'EPSG:900913'\r\n});\r\n\n\n/*\r\n * L.CRS.EPSG4326 is a CRS popular among advanced GIS specialists.\r\n */\r\n\r\nL.CRS.EPSG4326 = L.extend({}, L.CRS, {\r\n\tcode: 'EPSG:4326',\r\n\r\n\tprojection: L.Projection.LonLat,\r\n\ttransformation: new L.Transformation(1 / 360, 0.5, -1 / 360, 0.5)\r\n});\r\n\n\n/*\r\n * L.Map is the central class of the API - it is used to create a map.\r\n */\r\n\r\nL.Map = L.Class.extend({\r\n\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tcrs: L.CRS.EPSG3857,\r\n\r\n\t\t/*\r\n\t\tcenter: LatLng,\r\n\t\tzoom: Number,\r\n\t\tlayers: Array,\r\n\t\t*/\r\n\r\n\t\tfadeAnimation: L.DomUtil.TRANSITION && !L.Browser.android23,\r\n\t\ttrackResize: true,\r\n\t\tmarkerZoomAnimation: L.DomUtil.TRANSITION && L.Browser.any3d\r\n\t},\r\n\r\n\tinitialize: function (id, options) { // (HTMLElement or String, Object)\r\n\t\toptions = L.setOptions(this, options);\r\n\r\n\r\n\t\tthis._initContainer(id);\r\n\t\tthis._initLayout();\r\n\r\n\t\t// hack for https://github.com/Leaflet/Leaflet/issues/1980\r\n\t\tthis._onResize = L.bind(this._onResize, this);\r\n\r\n\t\tthis._initEvents();\r\n\r\n\t\tif (options.maxBounds) {\r\n\t\t\tthis.setMaxBounds(options.maxBounds);\r\n\t\t}\r\n\r\n\t\tif (options.center && options.zoom !== undefined) {\r\n\t\t\tthis.setView(L.latLng(options.center), options.zoom, {reset: true});\r\n\t\t}\r\n\r\n\t\tthis._handlers = [];\r\n\r\n\t\tthis._layers = {};\r\n\t\tthis._zoomBoundLayers = {};\r\n\t\tthis._tileLayersNum = 0;\r\n\r\n\t\tthis.callInitHooks();\r\n\r\n\t\tthis._addLayers(options.layers);\r\n\t},\r\n\r\n\r\n\t// public methods that modify map state\r\n\r\n\t// replaced by animation-powered implementation in Map.PanAnimation.js\r\n\tsetView: function (center, zoom) {\r\n\t\tzoom = zoom === undefined ? this.getZoom() : zoom;\r\n\t\tthis._resetView(L.latLng(center), this._limitZoom(zoom));\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetZoom: function (zoom, options) {\r\n\t\tif (!this._loaded) {\r\n\t\t\tthis._zoom = this._limitZoom(zoom);\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\treturn this.setView(this.getCenter(), zoom, {zoom: options});\r\n\t},\r\n\r\n\tzoomIn: function (delta, options) {\r\n\t\treturn this.setZoom(this._zoom + (delta || 1), options);\r\n\t},\r\n\r\n\tzoomOut: function (delta, options) {\r\n\t\treturn this.setZoom(this._zoom - (delta || 1), options);\r\n\t},\r\n\r\n\tsetZoomAround: function (latlng, zoom, options) {\r\n\t\tvar scale = this.getZoomScale(zoom),\r\n\t\t    viewHalf = this.getSize().divideBy(2),\r\n\t\t    containerPoint = latlng instanceof L.Point ? latlng : this.latLngToContainerPoint(latlng),\r\n\r\n\t\t    centerOffset = containerPoint.subtract(viewHalf).multiplyBy(1 - 1 / scale),\r\n\t\t    newCenter = this.containerPointToLatLng(viewHalf.add(centerOffset));\r\n\r\n\t\treturn this.setView(newCenter, zoom, {zoom: options});\r\n\t},\r\n\r\n\tfitBounds: function (bounds, options) {\r\n\r\n\t\toptions = options || {};\r\n\t\tbounds = bounds.getBounds ? bounds.getBounds() : L.latLngBounds(bounds);\r\n\r\n\t\tvar paddingTL = L.point(options.paddingTopLeft || options.padding || [0, 0]),\r\n\t\t    paddingBR = L.point(options.paddingBottomRight || options.padding || [0, 0]),\r\n\r\n\t\t    zoom = this.getBoundsZoom(bounds, false, paddingTL.add(paddingBR));\r\n\r\n\t\tzoom = (options.maxZoom) ? Math.min(options.maxZoom, zoom) : zoom;\r\n\r\n\t\tvar paddingOffset = paddingBR.subtract(paddingTL).divideBy(2),\r\n\r\n\t\t    swPoint = this.project(bounds.getSouthWest(), zoom),\r\n\t\t    nePoint = this.project(bounds.getNorthEast(), zoom),\r\n\t\t    center = this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset), zoom);\r\n\r\n\t\treturn this.setView(center, zoom, options);\r\n\t},\r\n\r\n\tfitWorld: function (options) {\r\n\t\treturn this.fitBounds([[-90, -180], [90, 180]], options);\r\n\t},\r\n\r\n\tpanTo: function (center, options) { // (LatLng)\r\n\t\treturn this.setView(center, this._zoom, {pan: options});\r\n\t},\r\n\r\n\tpanBy: function (offset) { // (Point)\r\n\t\t// replaced with animated panBy in Map.PanAnimation.js\r\n\t\tthis.fire('movestart');\r\n\r\n\t\tthis._rawPanBy(L.point(offset));\r\n\r\n\t\tthis.fire('move');\r\n\t\treturn this.fire('moveend');\r\n\t},\r\n\r\n\tsetMaxBounds: function (bounds) {\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\tthis.options.maxBounds = bounds;\r\n\r\n\t\tif (!bounds) {\r\n\t\t\treturn this.off('moveend', this._panInsideMaxBounds, this);\r\n\t\t}\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tthis._panInsideMaxBounds();\r\n\t\t}\r\n\r\n\t\treturn this.on('moveend', this._panInsideMaxBounds, this);\r\n\t},\r\n\r\n\tpanInsideBounds: function (bounds, options) {\r\n\t\tvar center = this.getCenter(),\r\n\t\t\tnewCenter = this._limitCenter(center, this._zoom, bounds);\r\n\r\n\t\tif (center.equals(newCenter)) { return this; }\r\n\r\n\t\treturn this.panTo(newCenter, options);\r\n\t},\r\n\r\n\taddLayer: function (layer) {\r\n\t\t// TODO method is too big, refactor\r\n\r\n\t\tvar id = L.stamp(layer);\r\n\r\n\t\tif (this._layers[id]) { return this; }\r\n\r\n\t\tthis._layers[id] = layer;\r\n\r\n\t\t// TODO getMaxZoom, getMinZoom in ILayer (instead of options)\r\n\t\tif (layer.options && (!isNaN(layer.options.maxZoom) || !isNaN(layer.options.minZoom))) {\r\n\t\t\tthis._zoomBoundLayers[id] = layer;\r\n\t\t\tthis._updateZoomLevels();\r\n\t\t}\r\n\r\n\t\t// TODO looks ugly, refactor!!!\r\n\t\tif (this.options.zoomAnimation && L.TileLayer && (layer instanceof L.TileLayer)) {\r\n\t\t\tthis._tileLayersNum++;\r\n\t\t\tthis._tileLayersToLoad++;\r\n\t\t\tlayer.on('load', this._onTileLayerLoad, this);\r\n\t\t}\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tthis._layerAdd(layer);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tvar id = L.stamp(layer);\r\n\r\n\t\tif (!this._layers[id]) { return this; }\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tlayer.onRemove(this);\r\n\t\t}\r\n\r\n\t\tdelete this._layers[id];\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tthis.fire('layerremove', {layer: layer});\r\n\t\t}\r\n\r\n\t\tif (this._zoomBoundLayers[id]) {\r\n\t\t\tdelete this._zoomBoundLayers[id];\r\n\t\t\tthis._updateZoomLevels();\r\n\t\t}\r\n\r\n\t\t// TODO looks ugly, refactor\r\n\t\tif (this.options.zoomAnimation && L.TileLayer && (layer instanceof L.TileLayer)) {\r\n\t\t\tthis._tileLayersNum--;\r\n\t\t\tthis._tileLayersToLoad--;\r\n\t\t\tlayer.off('load', this._onTileLayerLoad, this);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\thasLayer: function (layer) {\r\n\t\tif (!layer) { return false; }\r\n\r\n\t\treturn (L.stamp(layer) in this._layers);\r\n\t},\r\n\r\n\teachLayer: function (method, context) {\r\n\t\tfor (var i in this._layers) {\r\n\t\t\tmethod.call(context, this._layers[i]);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tinvalidateSize: function (options) {\r\n\t\tif (!this._loaded) { return this; }\r\n\r\n\t\toptions = L.extend({\r\n\t\t\tanimate: false,\r\n\t\t\tpan: true\r\n\t\t}, options === true ? {animate: true} : options);\r\n\r\n\t\tvar oldSize = this.getSize();\r\n\t\tthis._sizeChanged = true;\r\n\t\tthis._initialCenter = null;\r\n\r\n\t\tvar newSize = this.getSize(),\r\n\t\t    oldCenter = oldSize.divideBy(2).round(),\r\n\t\t    newCenter = newSize.divideBy(2).round(),\r\n\t\t    offset = oldCenter.subtract(newCenter);\r\n\r\n\t\tif (!offset.x && !offset.y) { return this; }\r\n\r\n\t\tif (options.animate && options.pan) {\r\n\t\t\tthis.panBy(offset);\r\n\r\n\t\t} else {\r\n\t\t\tif (options.pan) {\r\n\t\t\t\tthis._rawPanBy(offset);\r\n\t\t\t}\r\n\r\n\t\t\tthis.fire('move');\r\n\r\n\t\t\tif (options.debounceMoveend) {\r\n\t\t\t\tclearTimeout(this._sizeTimer);\r\n\t\t\t\tthis._sizeTimer = setTimeout(L.bind(this.fire, this, 'moveend'), 200);\r\n\t\t\t} else {\r\n\t\t\t\tthis.fire('moveend');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.fire('resize', {\r\n\t\t\toldSize: oldSize,\r\n\t\t\tnewSize: newSize\r\n\t\t});\r\n\t},\r\n\r\n\t// TODO handler.addTo\r\n\taddHandler: function (name, HandlerClass) {\r\n\t\tif (!HandlerClass) { return this; }\r\n\r\n\t\tvar handler = this[name] = new HandlerClass(this);\r\n\r\n\t\tthis._handlers.push(handler);\r\n\r\n\t\tif (this.options[name]) {\r\n\t\t\thandler.enable();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremove: function () {\r\n\t\tif (this._loaded) {\r\n\t\t\tthis.fire('unload');\r\n\t\t}\r\n\r\n\t\tthis._initEvents('off');\r\n\r\n\t\ttry {\r\n\t\t\t// throws error in IE6-8\r\n\t\t\tdelete this._container._leaflet;\r\n\t\t} catch (e) {\r\n\t\t\tthis._container._leaflet = undefined;\r\n\t\t}\r\n\r\n\t\tthis._clearPanes();\r\n\t\tif (this._clearControlPos) {\r\n\t\t\tthis._clearControlPos();\r\n\t\t}\r\n\r\n\t\tthis._clearHandlers();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\r\n\t// public methods for getting map state\r\n\r\n\tgetCenter: function () { // (Boolean) -> LatLng\r\n\t\tthis._checkIfLoaded();\r\n\r\n\t\tif (this._initialCenter && !this._moved()) {\r\n\t\t\treturn this._initialCenter;\r\n\t\t}\r\n\t\treturn this.layerPointToLatLng(this._getCenterLayerPoint());\r\n\t},\r\n\r\n\tgetZoom: function () {\r\n\t\treturn this._zoom;\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\tvar bounds = this.getPixelBounds(),\r\n\t\t    sw = this.unproject(bounds.getBottomLeft()),\r\n\t\t    ne = this.unproject(bounds.getTopRight());\r\n\r\n\t\treturn new L.LatLngBounds(sw, ne);\r\n\t},\r\n\r\n\tgetMinZoom: function () {\r\n\t\treturn this.options.minZoom === undefined ?\r\n\t\t\t(this._layersMinZoom === undefined ? 0 : this._layersMinZoom) :\r\n\t\t\tthis.options.minZoom;\r\n\t},\r\n\r\n\tgetMaxZoom: function () {\r\n\t\treturn this.options.maxZoom === undefined ?\r\n\t\t\t(this._layersMaxZoom === undefined ? Infinity : this._layersMaxZoom) :\r\n\t\t\tthis.options.maxZoom;\r\n\t},\r\n\r\n\tgetBoundsZoom: function (bounds, inside, padding) { // (LatLngBounds[, Boolean, Point]) -> Number\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\tvar zoom = this.getMinZoom() - (inside ? 1 : 0),\r\n\t\t    maxZoom = this.getMaxZoom(),\r\n\t\t    size = this.getSize(),\r\n\r\n\t\t    nw = bounds.getNorthWest(),\r\n\t\t    se = bounds.getSouthEast(),\r\n\r\n\t\t    zoomNotFound = true,\r\n\t\t    boundsSize;\r\n\r\n\t\tpadding = L.point(padding || [0, 0]);\r\n\r\n\t\tdo {\r\n\t\t\tzoom++;\r\n\t\t\tboundsSize = this.project(se, zoom).subtract(this.project(nw, zoom)).add(padding);\r\n\t\t\tzoomNotFound = !inside ? size.contains(boundsSize) : boundsSize.x < size.x || boundsSize.y < size.y;\r\n\r\n\t\t} while (zoomNotFound && zoom <= maxZoom);\r\n\r\n\t\tif (zoomNotFound && inside) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn inside ? zoom : zoom - 1;\r\n\t},\r\n\r\n\tgetSize: function () {\r\n\t\tif (!this._size || this._sizeChanged) {\r\n\t\t\tthis._size = new L.Point(\r\n\t\t\t\tthis._container.clientWidth,\r\n\t\t\t\tthis._container.clientHeight);\r\n\r\n\t\t\tthis._sizeChanged = false;\r\n\t\t}\r\n\t\treturn this._size.clone();\r\n\t},\r\n\r\n\tgetPixelBounds: function () {\r\n\t\tvar topLeftPoint = this._getTopLeftPoint();\r\n\t\treturn new L.Bounds(topLeftPoint, topLeftPoint.add(this.getSize()));\r\n\t},\r\n\r\n\tgetPixelOrigin: function () {\r\n\t\tthis._checkIfLoaded();\r\n\t\treturn this._initialTopLeftPoint;\r\n\t},\r\n\r\n\tgetPanes: function () {\r\n\t\treturn this._panes;\r\n\t},\r\n\r\n\tgetContainer: function () {\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\r\n\t// TODO replace with universal implementation after refactoring projections\r\n\r\n\tgetZoomScale: function (toZoom) {\r\n\t\tvar crs = this.options.crs;\r\n\t\treturn crs.scale(toZoom) / crs.scale(this._zoom);\r\n\t},\r\n\r\n\tgetScaleZoom: function (scale) {\r\n\t\treturn this._zoom + (Math.log(scale) / Math.LN2);\r\n\t},\r\n\r\n\r\n\t// conversion methods\r\n\r\n\tproject: function (latlng, zoom) { // (LatLng[, Number]) -> Point\r\n\t\tzoom = zoom === undefined ? this._zoom : zoom;\r\n\t\treturn this.options.crs.latLngToPoint(L.latLng(latlng), zoom);\r\n\t},\r\n\r\n\tunproject: function (point, zoom) { // (Point[, Number]) -> LatLng\r\n\t\tzoom = zoom === undefined ? this._zoom : zoom;\r\n\t\treturn this.options.crs.pointToLatLng(L.point(point), zoom);\r\n\t},\r\n\r\n\tlayerPointToLatLng: function (point) { // (Point)\r\n\t\tvar projectedPoint = L.point(point).add(this.getPixelOrigin());\r\n\t\treturn this.unproject(projectedPoint);\r\n\t},\r\n\r\n\tlatLngToLayerPoint: function (latlng) { // (LatLng)\r\n\t\tvar projectedPoint = this.project(L.latLng(latlng))._round();\r\n\t\treturn projectedPoint._subtract(this.getPixelOrigin());\r\n\t},\r\n\r\n\tcontainerPointToLayerPoint: function (point) { // (Point)\r\n\t\treturn L.point(point).subtract(this._getMapPanePos());\r\n\t},\r\n\r\n\tlayerPointToContainerPoint: function (point) { // (Point)\r\n\t\treturn L.point(point).add(this._getMapPanePos());\r\n\t},\r\n\r\n\tcontainerPointToLatLng: function (point) {\r\n\t\tvar layerPoint = this.containerPointToLayerPoint(L.point(point));\r\n\t\treturn this.layerPointToLatLng(layerPoint);\r\n\t},\r\n\r\n\tlatLngToContainerPoint: function (latlng) {\r\n\t\treturn this.layerPointToContainerPoint(this.latLngToLayerPoint(L.latLng(latlng)));\r\n\t},\r\n\r\n\tmouseEventToContainerPoint: function (e) { // (MouseEvent)\r\n\t\treturn L.DomEvent.getMousePosition(e, this._container);\r\n\t},\r\n\r\n\tmouseEventToLayerPoint: function (e) { // (MouseEvent)\r\n\t\treturn this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e));\r\n\t},\r\n\r\n\tmouseEventToLatLng: function (e) { // (MouseEvent)\r\n\t\treturn this.layerPointToLatLng(this.mouseEventToLayerPoint(e));\r\n\t},\r\n\r\n\r\n\t// map initialization methods\r\n\r\n\t_initContainer: function (id) {\r\n\t\tvar container = this._container = L.DomUtil.get(id);\r\n\r\n\t\tif (!container) {\r\n\t\t\tthrow new Error('Map container not found.');\r\n\t\t} else if (container._leaflet) {\r\n\t\t\tthrow new Error('Map container is already initialized.');\r\n\t\t}\r\n\r\n\t\tcontainer._leaflet = true;\r\n\t},\r\n\r\n\t_initLayout: function () {\r\n\t\tvar container = this._container;\r\n\r\n\t\tL.DomUtil.addClass(container, 'leaflet-container' +\r\n\t\t\t(L.Browser.touch ? ' leaflet-touch' : '') +\r\n\t\t\t(L.Browser.retina ? ' leaflet-retina' : '') +\r\n\t\t\t(L.Browser.ielt9 ? ' leaflet-oldie' : '') +\r\n\t\t\t(this.options.fadeAnimation ? ' leaflet-fade-anim' : ''));\r\n\r\n\t\tvar position = L.DomUtil.getStyle(container, 'position');\r\n\r\n\t\tif (position !== 'absolute' && position !== 'relative' && position !== 'fixed') {\r\n\t\t\tcontainer.style.position = 'relative';\r\n\t\t}\r\n\r\n\t\tthis._initPanes();\r\n\r\n\t\tif (this._initControlPos) {\r\n\t\t\tthis._initControlPos();\r\n\t\t}\r\n\t},\r\n\r\n\t_initPanes: function () {\r\n\t\tvar panes = this._panes = {};\r\n\r\n\t\tthis._mapPane = panes.mapPane = this._createPane('leaflet-map-pane', this._container);\r\n\r\n\t\tthis._tilePane = panes.tilePane = this._createPane('leaflet-tile-pane', this._mapPane);\r\n\t\tpanes.objectsPane = this._createPane('leaflet-objects-pane', this._mapPane);\r\n\t\tpanes.shadowPane = this._createPane('leaflet-shadow-pane');\r\n\t\tpanes.overlayPane = this._createPane('leaflet-overlay-pane');\r\n\t\tpanes.markerPane = this._createPane('leaflet-marker-pane');\r\n\t\tpanes.popupPane = this._createPane('leaflet-popup-pane');\r\n\r\n\t\tvar zoomHide = ' leaflet-zoom-hide';\r\n\r\n\t\tif (!this.options.markerZoomAnimation) {\r\n\t\t\tL.DomUtil.addClass(panes.markerPane, zoomHide);\r\n\t\t\tL.DomUtil.addClass(panes.shadowPane, zoomHide);\r\n\t\t\tL.DomUtil.addClass(panes.popupPane, zoomHide);\r\n\t\t}\r\n\t},\r\n\r\n\t_createPane: function (className, container) {\r\n\t\treturn L.DomUtil.create('div', className, container || this._panes.objectsPane);\r\n\t},\r\n\r\n\t_clearPanes: function () {\r\n\t\tthis._container.removeChild(this._mapPane);\r\n\t},\r\n\r\n\t_addLayers: function (layers) {\r\n\t\tlayers = layers ? (L.Util.isArray(layers) ? layers : [layers]) : [];\r\n\r\n\t\tfor (var i = 0, len = layers.length; i < len; i++) {\r\n\t\t\tthis.addLayer(layers[i]);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// private methods that modify map state\r\n\r\n\t_resetView: function (center, zoom, preserveMapOffset, afterZoomAnim) {\r\n\r\n\t\tvar zoomChanged = (this._zoom !== zoom);\r\n\r\n\t\tif (!afterZoomAnim) {\r\n\t\t\tthis.fire('movestart');\r\n\r\n\t\t\tif (zoomChanged) {\r\n\t\t\t\tthis.fire('zoomstart');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._zoom = zoom;\r\n\t\tthis._initialCenter = center;\r\n\r\n\t\tthis._initialTopLeftPoint = this._getNewTopLeftPoint(center);\r\n\r\n\t\tif (!preserveMapOffset) {\r\n\t\t\tL.DomUtil.setPosition(this._mapPane, new L.Point(0, 0));\r\n\t\t} else {\r\n\t\t\tthis._initialTopLeftPoint._add(this._getMapPanePos());\r\n\t\t}\r\n\r\n\t\tthis._tileLayersToLoad = this._tileLayersNum;\r\n\r\n\t\tvar loading = !this._loaded;\r\n\t\tthis._loaded = true;\r\n\r\n\t\tthis.fire('viewreset', {hard: !preserveMapOffset});\r\n\r\n\t\tif (loading) {\r\n\t\t\tthis.fire('load');\r\n\t\t\tthis.eachLayer(this._layerAdd, this);\r\n\t\t}\r\n\r\n\t\tthis.fire('move');\r\n\r\n\t\tif (zoomChanged || afterZoomAnim) {\r\n\t\t\tthis.fire('zoomend');\r\n\t\t}\r\n\r\n\t\tthis.fire('moveend', {hard: !preserveMapOffset});\r\n\t},\r\n\r\n\t_rawPanBy: function (offset) {\r\n\t\tL.DomUtil.setPosition(this._mapPane, this._getMapPanePos().subtract(offset));\r\n\t},\r\n\r\n\t_getZoomSpan: function () {\r\n\t\treturn this.getMaxZoom() - this.getMinZoom();\r\n\t},\r\n\r\n\t_updateZoomLevels: function () {\r\n\t\tvar i,\r\n\t\t\tminZoom = Infinity,\r\n\t\t\tmaxZoom = -Infinity,\r\n\t\t\toldZoomSpan = this._getZoomSpan();\r\n\r\n\t\tfor (i in this._zoomBoundLayers) {\r\n\t\t\tvar layer = this._zoomBoundLayers[i];\r\n\t\t\tif (!isNaN(layer.options.minZoom)) {\r\n\t\t\t\tminZoom = Math.min(minZoom, layer.options.minZoom);\r\n\t\t\t}\r\n\t\t\tif (!isNaN(layer.options.maxZoom)) {\r\n\t\t\t\tmaxZoom = Math.max(maxZoom, layer.options.maxZoom);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (i === undefined) { // we have no tilelayers\r\n\t\t\tthis._layersMaxZoom = this._layersMinZoom = undefined;\r\n\t\t} else {\r\n\t\t\tthis._layersMaxZoom = maxZoom;\r\n\t\t\tthis._layersMinZoom = minZoom;\r\n\t\t}\r\n\r\n\t\tif (oldZoomSpan !== this._getZoomSpan()) {\r\n\t\t\tthis.fire('zoomlevelschange');\r\n\t\t}\r\n\t},\r\n\r\n\t_panInsideMaxBounds: function () {\r\n\t\tthis.panInsideBounds(this.options.maxBounds);\r\n\t},\r\n\r\n\t_checkIfLoaded: function () {\r\n\t\tif (!this._loaded) {\r\n\t\t\tthrow new Error('Set map center and zoom first.');\r\n\t\t}\r\n\t},\r\n\r\n\t// map events\r\n\r\n\t_initEvents: function (onOff) {\r\n\t\tif (!L.DomEvent) { return; }\r\n\r\n\t\tonOff = onOff || 'on';\r\n\r\n\t\tL.DomEvent[onOff](this._container, 'click', this._onMouseClick, this);\r\n\r\n\t\tvar events = ['dblclick', 'mousedown', 'mouseup', 'mouseenter',\r\n\t\t              'mouseleave', 'mousemove', 'contextmenu'],\r\n\t\t    i, len;\r\n\r\n\t\tfor (i = 0, len = events.length; i < len; i++) {\r\n\t\t\tL.DomEvent[onOff](this._container, events[i], this._fireMouseEvent, this);\r\n\t\t}\r\n\r\n\t\tif (this.options.trackResize) {\r\n\t\t\tL.DomEvent[onOff](window, 'resize', this._onResize, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_onResize: function () {\r\n\t\tL.Util.cancelAnimFrame(this._resizeRequest);\r\n\t\tthis._resizeRequest = L.Util.requestAnimFrame(\r\n\t\t        function () { this.invalidateSize({debounceMoveend: true}); }, this, false, this._container);\r\n\t},\r\n\r\n\t_onMouseClick: function (e) {\r\n\t\tif (!this._loaded || (!e._simulated &&\r\n\t\t        ((this.dragging && this.dragging.moved()) ||\r\n\t\t         (this.boxZoom  && this.boxZoom.moved()))) ||\r\n\t\t            L.DomEvent._skipped(e)) { return; }\r\n\r\n\t\tthis.fire('preclick');\r\n\t\tthis._fireMouseEvent(e);\r\n\t},\r\n\r\n\t_fireMouseEvent: function (e) {\r\n\t\tif (!this._loaded || L.DomEvent._skipped(e)) { return; }\r\n\r\n\t\tvar type = e.type;\r\n\r\n\t\ttype = (type === 'mouseenter' ? 'mouseover' : (type === 'mouseleave' ? 'mouseout' : type));\r\n\r\n\t\tif (!this.hasEventListeners(type)) { return; }\r\n\r\n\t\tif (type === 'contextmenu') {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\r\n\t\tvar containerPoint = this.mouseEventToContainerPoint(e),\r\n\t\t    layerPoint = this.containerPointToLayerPoint(containerPoint),\r\n\t\t    latlng = this.layerPointToLatLng(layerPoint);\r\n\r\n\t\tthis.fire(type, {\r\n\t\t\tlatlng: latlng,\r\n\t\t\tlayerPoint: layerPoint,\r\n\t\t\tcontainerPoint: containerPoint,\r\n\t\t\toriginalEvent: e\r\n\t\t});\r\n\t},\r\n\r\n\t_onTileLayerLoad: function () {\r\n\t\tthis._tileLayersToLoad--;\r\n\t\tif (this._tileLayersNum && !this._tileLayersToLoad) {\r\n\t\t\tthis.fire('tilelayersload');\r\n\t\t}\r\n\t},\r\n\r\n\t_clearHandlers: function () {\r\n\t\tfor (var i = 0, len = this._handlers.length; i < len; i++) {\r\n\t\t\tthis._handlers[i].disable();\r\n\t\t}\r\n\t},\r\n\r\n\twhenReady: function (callback, context) {\r\n\t\tif (this._loaded) {\r\n\t\t\tcallback.call(context || this, this);\r\n\t\t} else {\r\n\t\t\tthis.on('load', callback, context);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_layerAdd: function (layer) {\r\n\t\tlayer.onAdd(this);\r\n\t\tthis.fire('layeradd', {layer: layer});\r\n\t},\r\n\r\n\r\n\t// private methods for getting map state\r\n\r\n\t_getMapPanePos: function () {\r\n\t\treturn L.DomUtil.getPosition(this._mapPane);\r\n\t},\r\n\r\n\t_moved: function () {\r\n\t\tvar pos = this._getMapPanePos();\r\n\t\treturn pos && !pos.equals([0, 0]);\r\n\t},\r\n\r\n\t_getTopLeftPoint: function () {\r\n\t\treturn this.getPixelOrigin().subtract(this._getMapPanePos());\r\n\t},\r\n\r\n\t_getNewTopLeftPoint: function (center, zoom) {\r\n\t\tvar viewHalf = this.getSize()._divideBy(2);\r\n\t\t// TODO round on display, not calculation to increase precision?\r\n\t\treturn this.project(center, zoom)._subtract(viewHalf)._round();\r\n\t},\r\n\r\n\t_latLngToNewLayerPoint: function (latlng, newZoom, newCenter) {\r\n\t\tvar topLeft = this._getNewTopLeftPoint(newCenter, newZoom).add(this._getMapPanePos());\r\n\t\treturn this.project(latlng, newZoom)._subtract(topLeft);\r\n\t},\r\n\r\n\t// layer point of the current center\r\n\t_getCenterLayerPoint: function () {\r\n\t\treturn this.containerPointToLayerPoint(this.getSize()._divideBy(2));\r\n\t},\r\n\r\n\t// offset of the specified place to the current center in pixels\r\n\t_getCenterOffset: function (latlng) {\r\n\t\treturn this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint());\r\n\t},\r\n\r\n\t// adjust center for view to get inside bounds\r\n\t_limitCenter: function (center, zoom, bounds) {\r\n\r\n\t\tif (!bounds) { return center; }\r\n\r\n\t\tvar centerPoint = this.project(center, zoom),\r\n\t\t    viewHalf = this.getSize().divideBy(2),\r\n\t\t    viewBounds = new L.Bounds(centerPoint.subtract(viewHalf), centerPoint.add(viewHalf)),\r\n\t\t    offset = this._getBoundsOffset(viewBounds, bounds, zoom);\r\n\r\n\t\treturn this.unproject(centerPoint.add(offset), zoom);\r\n\t},\r\n\r\n\t// adjust offset for view to get inside bounds\r\n\t_limitOffset: function (offset, bounds) {\r\n\t\tif (!bounds) { return offset; }\r\n\r\n\t\tvar viewBounds = this.getPixelBounds(),\r\n\t\t    newBounds = new L.Bounds(viewBounds.min.add(offset), viewBounds.max.add(offset));\r\n\r\n\t\treturn offset.add(this._getBoundsOffset(newBounds, bounds));\r\n\t},\r\n\r\n\t// returns offset needed for pxBounds to get inside maxBounds at a specified zoom\r\n\t_getBoundsOffset: function (pxBounds, maxBounds, zoom) {\r\n\t\tvar nwOffset = this.project(maxBounds.getNorthWest(), zoom).subtract(pxBounds.min),\r\n\t\t    seOffset = this.project(maxBounds.getSouthEast(), zoom).subtract(pxBounds.max),\r\n\r\n\t\t    dx = this._rebound(nwOffset.x, -seOffset.x),\r\n\t\t    dy = this._rebound(nwOffset.y, -seOffset.y);\r\n\r\n\t\treturn new L.Point(dx, dy);\r\n\t},\r\n\r\n\t_rebound: function (left, right) {\r\n\t\treturn left + right > 0 ?\r\n\t\t\tMath.round(left - right) / 2 :\r\n\t\t\tMath.max(0, Math.ceil(left)) - Math.max(0, Math.floor(right));\r\n\t},\r\n\r\n\t_limitZoom: function (zoom) {\r\n\t\tvar min = this.getMinZoom(),\r\n\t\t    max = this.getMaxZoom();\r\n\r\n\t\treturn Math.max(min, Math.min(max, zoom));\r\n\t}\r\n});\r\n\r\nL.map = function (id, options) {\r\n\treturn new L.Map(id, options);\r\n};\r\n\n\n/*\r\n * Mercator projection that takes into account that the Earth is not a perfect sphere.\r\n * Less popular than spherical mercator; used by projections like EPSG:3395.\r\n */\r\n\r\nL.Projection.Mercator = {\r\n\tMAX_LATITUDE: 85.0840591556,\r\n\r\n\tR_MINOR: 6356752.314245179,\r\n\tR_MAJOR: 6378137,\r\n\r\n\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\tvar d = L.LatLng.DEG_TO_RAD,\r\n\t\t    max = this.MAX_LATITUDE,\r\n\t\t    lat = Math.max(Math.min(max, latlng.lat), -max),\r\n\t\t    r = this.R_MAJOR,\r\n\t\t    r2 = this.R_MINOR,\r\n\t\t    x = latlng.lng * d * r,\r\n\t\t    y = lat * d,\r\n\t\t    tmp = r2 / r,\r\n\t\t    eccent = Math.sqrt(1.0 - tmp * tmp),\r\n\t\t    con = eccent * Math.sin(y);\r\n\r\n\t\tcon = Math.pow((1 - con) / (1 + con), eccent * 0.5);\r\n\r\n\t\tvar ts = Math.tan(0.5 * ((Math.PI * 0.5) - y)) / con;\r\n\t\ty = -r * Math.log(ts);\r\n\r\n\t\treturn new L.Point(x, y);\r\n\t},\r\n\r\n\tunproject: function (point) { // (Point, Boolean) -> LatLng\r\n\t\tvar d = L.LatLng.RAD_TO_DEG,\r\n\t\t    r = this.R_MAJOR,\r\n\t\t    r2 = this.R_MINOR,\r\n\t\t    lng = point.x * d / r,\r\n\t\t    tmp = r2 / r,\r\n\t\t    eccent = Math.sqrt(1 - (tmp * tmp)),\r\n\t\t    ts = Math.exp(- point.y / r),\r\n\t\t    phi = (Math.PI / 2) - 2 * Math.atan(ts),\r\n\t\t    numIter = 15,\r\n\t\t    tol = 1e-7,\r\n\t\t    i = numIter,\r\n\t\t    dphi = 0.1,\r\n\t\t    con;\r\n\r\n\t\twhile ((Math.abs(dphi) > tol) && (--i > 0)) {\r\n\t\t\tcon = eccent * Math.sin(phi);\r\n\t\t\tdphi = (Math.PI / 2) - 2 * Math.atan(ts *\r\n\t\t\t            Math.pow((1.0 - con) / (1.0 + con), 0.5 * eccent)) - phi;\r\n\t\t\tphi += dphi;\r\n\t\t}\r\n\r\n\t\treturn new L.LatLng(phi * d, lng);\r\n\t}\r\n};\r\n\n\n\r\nL.CRS.EPSG3395 = L.extend({}, L.CRS, {\r\n\tcode: 'EPSG:3395',\r\n\r\n\tprojection: L.Projection.Mercator,\r\n\r\n\ttransformation: (function () {\r\n\t\tvar m = L.Projection.Mercator,\r\n\t\t    r = m.R_MAJOR,\r\n\t\t    scale = 0.5 / (Math.PI * r);\r\n\r\n\t\treturn new L.Transformation(scale, 0.5, -scale, 0.5);\r\n\t}())\r\n});\r\n\n\n/*\r\n * L.TileLayer is used for standard xyz-numbered tile layers.\r\n */\r\n\r\nL.TileLayer = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tminZoom: 0,\r\n\t\tmaxZoom: 18,\r\n\t\ttileSize: 256,\r\n\t\tsubdomains: 'abc',\r\n\t\terrorTileUrl: '',\r\n\t\tattribution: '',\r\n\t\tzoomOffset: 0,\r\n\t\topacity: 1,\r\n\t\t/*\r\n\t\tmaxNativeZoom: null,\r\n\t\tzIndex: null,\r\n\t\ttms: false,\r\n\t\tcontinuousWorld: false,\r\n\t\tnoWrap: false,\r\n\t\tzoomReverse: false,\r\n\t\tdetectRetina: false,\r\n\t\treuseTiles: false,\r\n\t\tbounds: false,\r\n\t\t*/\r\n\t\tunloadInvisibleTiles: L.Browser.mobile,\r\n\t\tupdateWhenIdle: L.Browser.mobile\r\n\t},\r\n\r\n\tinitialize: function (url, options) {\r\n\t\toptions = L.setOptions(this, options);\r\n\r\n\t\t// detecting retina displays, adjusting tileSize and zoom levels\r\n\t\tif (options.detectRetina && L.Browser.retina && options.maxZoom > 0) {\r\n\r\n\t\t\toptions.tileSize = Math.floor(options.tileSize / 2);\r\n\t\t\toptions.zoomOffset++;\r\n\r\n\t\t\tif (options.minZoom > 0) {\r\n\t\t\t\toptions.minZoom--;\r\n\t\t\t}\r\n\t\t\tthis.options.maxZoom--;\r\n\t\t}\r\n\r\n\t\tif (options.bounds) {\r\n\t\t\toptions.bounds = L.latLngBounds(options.bounds);\r\n\t\t}\r\n\r\n\t\tthis._url = url;\r\n\r\n\t\tvar subdomains = this.options.subdomains;\r\n\r\n\t\tif (typeof subdomains === 'string') {\r\n\t\t\tthis.options.subdomains = subdomains.split('');\r\n\t\t}\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\t\tthis._animated = map._zoomAnimated;\r\n\r\n\t\t// create a container div for tiles\r\n\t\tthis._initContainer();\r\n\r\n\t\t// set up events\r\n\t\tmap.on({\r\n\t\t\t'viewreset': this._reset,\r\n\t\t\t'moveend': this._update\r\n\t\t}, this);\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tmap.on({\r\n\t\t\t\t'zoomanim': this._animateZoom,\r\n\t\t\t\t'zoomend': this._endZoomAnim\r\n\t\t\t}, this);\r\n\t\t}\r\n\r\n\t\tif (!this.options.updateWhenIdle) {\r\n\t\t\tthis._limitedUpdate = L.Util.limitExecByInterval(this._update, 150, this);\r\n\t\t\tmap.on('move', this._limitedUpdate, this);\r\n\t\t}\r\n\r\n\t\tthis._reset();\r\n\t\tthis._update();\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tthis._container.parentNode.removeChild(this._container);\r\n\r\n\t\tmap.off({\r\n\t\t\t'viewreset': this._reset,\r\n\t\t\t'moveend': this._update\r\n\t\t}, this);\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tmap.off({\r\n\t\t\t\t'zoomanim': this._animateZoom,\r\n\t\t\t\t'zoomend': this._endZoomAnim\r\n\t\t\t}, this);\r\n\t\t}\r\n\r\n\t\tif (!this.options.updateWhenIdle) {\r\n\t\t\tmap.off('move', this._limitedUpdate, this);\r\n\t\t}\r\n\r\n\t\tthis._container = null;\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\tbringToFront: function () {\r\n\t\tvar pane = this._map._panes.tilePane;\r\n\r\n\t\tif (this._container) {\r\n\t\t\tpane.appendChild(this._container);\r\n\t\t\tthis._setAutoZIndex(pane, Math.max);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\tvar pane = this._map._panes.tilePane;\r\n\r\n\t\tif (this._container) {\r\n\t\t\tpane.insertBefore(this._container, pane.firstChild);\r\n\t\t\tthis._setAutoZIndex(pane, Math.min);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetAttribution: function () {\r\n\t\treturn this.options.attribution;\r\n\t},\r\n\r\n\tgetContainer: function () {\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\tsetOpacity: function (opacity) {\r\n\t\tthis.options.opacity = opacity;\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._updateOpacity();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetZIndex: function (zIndex) {\r\n\t\tthis.options.zIndex = zIndex;\r\n\t\tthis._updateZIndex();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetUrl: function (url, noRedraw) {\r\n\t\tthis._url = url;\r\n\r\n\t\tif (!noRedraw) {\r\n\t\t\tthis.redraw();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._reset({hard: true});\r\n\t\t\tthis._update();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_updateZIndex: function () {\r\n\t\tif (this._container && this.options.zIndex !== undefined) {\r\n\t\t\tthis._container.style.zIndex = this.options.zIndex;\r\n\t\t}\r\n\t},\r\n\r\n\t_setAutoZIndex: function (pane, compare) {\r\n\r\n\t\tvar layers = pane.children,\r\n\t\t    edgeZIndex = -compare(Infinity, -Infinity), // -Infinity for max, Infinity for min\r\n\t\t    zIndex, i, len;\r\n\r\n\t\tfor (i = 0, len = layers.length; i < len; i++) {\r\n\r\n\t\t\tif (layers[i] !== this._container) {\r\n\t\t\t\tzIndex = parseInt(layers[i].style.zIndex, 10);\r\n\r\n\t\t\t\tif (!isNaN(zIndex)) {\r\n\t\t\t\t\tedgeZIndex = compare(edgeZIndex, zIndex);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.options.zIndex = this._container.style.zIndex =\r\n\t\t        (isFinite(edgeZIndex) ? edgeZIndex : 0) + compare(1, -1);\r\n\t},\r\n\r\n\t_updateOpacity: function () {\r\n\t\tvar i,\r\n\t\t    tiles = this._tiles;\r\n\r\n\t\tif (L.Browser.ielt9) {\r\n\t\t\tfor (i in tiles) {\r\n\t\t\t\tL.DomUtil.setOpacity(tiles[i], this.options.opacity);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tL.DomUtil.setOpacity(this._container, this.options.opacity);\r\n\t\t}\r\n\t},\r\n\r\n\t_initContainer: function () {\r\n\t\tvar tilePane = this._map._panes.tilePane;\r\n\r\n\t\tif (!this._container) {\r\n\t\t\tthis._container = L.DomUtil.create('div', 'leaflet-layer');\r\n\r\n\t\t\tthis._updateZIndex();\r\n\r\n\t\t\tif (this._animated) {\r\n\t\t\t\tvar className = 'leaflet-tile-container';\r\n\r\n\t\t\t\tthis._bgBuffer = L.DomUtil.create('div', className, this._container);\r\n\t\t\t\tthis._tileContainer = L.DomUtil.create('div', className, this._container);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis._tileContainer = this._container;\r\n\t\t\t}\r\n\r\n\t\t\ttilePane.appendChild(this._container);\r\n\r\n\t\t\tif (this.options.opacity < 1) {\r\n\t\t\t\tthis._updateOpacity();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_reset: function (e) {\r\n\t\tfor (var key in this._tiles) {\r\n\t\t\tthis.fire('tileunload', {tile: this._tiles[key]});\r\n\t\t}\r\n\r\n\t\tthis._tiles = {};\r\n\t\tthis._tilesToLoad = 0;\r\n\r\n\t\tif (this.options.reuseTiles) {\r\n\t\t\tthis._unusedTiles = [];\r\n\t\t}\r\n\r\n\t\tthis._tileContainer.innerHTML = '';\r\n\r\n\t\tif (this._animated && e && e.hard) {\r\n\t\t\tthis._clearBgBuffer();\r\n\t\t}\r\n\r\n\t\tthis._initContainer();\r\n\t},\r\n\r\n\t_getTileSize: function () {\r\n\t\tvar map = this._map,\r\n\t\t    zoom = map.getZoom() + this.options.zoomOffset,\r\n\t\t    zoomN = this.options.maxNativeZoom,\r\n\t\t    tileSize = this.options.tileSize;\r\n\r\n\t\tif (zoomN && zoom > zoomN) {\r\n\t\t\ttileSize = Math.round(map.getZoomScale(zoom) / map.getZoomScale(zoomN) * tileSize);\r\n\t\t}\r\n\r\n\t\treturn tileSize;\r\n\t},\r\n\r\n\t_update: function () {\r\n\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tvar map = this._map,\r\n\t\t    bounds = map.getPixelBounds(),\r\n\t\t    zoom = map.getZoom(),\r\n\t\t    tileSize = this._getTileSize();\r\n\r\n\t\tif (zoom > this.options.maxZoom || zoom < this.options.minZoom) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar tileBounds = L.bounds(\r\n\t\t        bounds.min.divideBy(tileSize)._floor(),\r\n\t\t        bounds.max.divideBy(tileSize)._floor());\r\n\r\n\t\tthis._addTilesFromCenterOut(tileBounds);\r\n\r\n\t\tif (this.options.unloadInvisibleTiles || this.options.reuseTiles) {\r\n\t\t\tthis._removeOtherTiles(tileBounds);\r\n\t\t}\r\n\t},\r\n\r\n\t_addTilesFromCenterOut: function (bounds) {\r\n\t\tvar queue = [],\r\n\t\t    center = bounds.getCenter();\r\n\r\n\t\tvar j, i, point;\r\n\r\n\t\tfor (j = bounds.min.y; j <= bounds.max.y; j++) {\r\n\t\t\tfor (i = bounds.min.x; i <= bounds.max.x; i++) {\r\n\t\t\t\tpoint = new L.Point(i, j);\r\n\r\n\t\t\t\tif (this._tileShouldBeLoaded(point)) {\r\n\t\t\t\t\tqueue.push(point);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar tilesToLoad = queue.length;\r\n\r\n\t\tif (tilesToLoad === 0) { return; }\r\n\r\n\t\t// load tiles in order of their distance to center\r\n\t\tqueue.sort(function (a, b) {\r\n\t\t\treturn a.distanceTo(center) - b.distanceTo(center);\r\n\t\t});\r\n\r\n\t\tvar fragment = document.createDocumentFragment();\r\n\r\n\t\t// if its the first batch of tiles to load\r\n\t\tif (!this._tilesToLoad) {\r\n\t\t\tthis.fire('loading');\r\n\t\t}\r\n\r\n\t\tthis._tilesToLoad += tilesToLoad;\r\n\r\n\t\tfor (i = 0; i < tilesToLoad; i++) {\r\n\t\t\tthis._addTile(queue[i], fragment);\r\n\t\t}\r\n\r\n\t\tthis._tileContainer.appendChild(fragment);\r\n\t},\r\n\r\n\t_tileShouldBeLoaded: function (tilePoint) {\r\n\t\tif ((tilePoint.x + ':' + tilePoint.y) in this._tiles) {\r\n\t\t\treturn false; // already loaded\r\n\t\t}\r\n\r\n\t\tvar options = this.options;\r\n\r\n\t\tif (!options.continuousWorld) {\r\n\t\t\tvar limit = this._getWrapTileNum();\r\n\r\n\t\t\t// don't load if exceeds world bounds\r\n\t\t\tif ((options.noWrap && (tilePoint.x < 0 || tilePoint.x >= limit.x)) ||\r\n\t\t\t\ttilePoint.y < 0 || tilePoint.y >= limit.y) { return false; }\r\n\t\t}\r\n\r\n\t\tif (options.bounds) {\r\n\t\t\tvar tileSize = this._getTileSize(),\r\n\t\t\t    nwPoint = tilePoint.multiplyBy(tileSize),\r\n\t\t\t    sePoint = nwPoint.add([tileSize, tileSize]),\r\n\t\t\t    nw = this._map.unproject(nwPoint),\r\n\t\t\t    se = this._map.unproject(sePoint);\r\n\r\n\t\t\t// TODO temporary hack, will be removed after refactoring projections\r\n\t\t\t// https://github.com/Leaflet/Leaflet/issues/1618\r\n\t\t\tif (!options.continuousWorld && !options.noWrap) {\r\n\t\t\t\tnw = nw.wrap();\r\n\t\t\t\tse = se.wrap();\r\n\t\t\t}\r\n\r\n\t\t\tif (!options.bounds.intersects([nw, se])) { return false; }\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_removeOtherTiles: function (bounds) {\r\n\t\tvar kArr, x, y, key;\r\n\r\n\t\tfor (key in this._tiles) {\r\n\t\t\tkArr = key.split(':');\r\n\t\t\tx = parseInt(kArr[0], 10);\r\n\t\t\ty = parseInt(kArr[1], 10);\r\n\r\n\t\t\t// remove tile if it's out of bounds\r\n\t\t\tif (x < bounds.min.x || x > bounds.max.x || y < bounds.min.y || y > bounds.max.y) {\r\n\t\t\t\tthis._removeTile(key);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_removeTile: function (key) {\r\n\t\tvar tile = this._tiles[key];\r\n\r\n\t\tthis.fire('tileunload', {tile: tile, url: tile.src});\r\n\r\n\t\tif (this.options.reuseTiles) {\r\n\t\t\tL.DomUtil.removeClass(tile, 'leaflet-tile-loaded');\r\n\t\t\tthis._unusedTiles.push(tile);\r\n\r\n\t\t} else if (tile.parentNode === this._tileContainer) {\r\n\t\t\tthis._tileContainer.removeChild(tile);\r\n\t\t}\r\n\r\n\t\t// for https://github.com/CloudMade/Leaflet/issues/137\r\n\t\tif (!L.Browser.android) {\r\n\t\t\ttile.onload = null;\r\n\t\t\ttile.src = L.Util.emptyImageUrl;\r\n\t\t}\r\n\r\n\t\tdelete this._tiles[key];\r\n\t},\r\n\r\n\t_addTile: function (tilePoint, container) {\r\n\t\tvar tilePos = this._getTilePos(tilePoint);\r\n\r\n\t\t// get unused tile - or create a new tile\r\n\t\tvar tile = this._getTile();\r\n\r\n\t\t/*\r\n\t\tChrome 20 layouts much faster with top/left (verify with timeline, frames)\r\n\t\tAndroid 4 browser has display issues with top/left and requires transform instead\r\n\t\t(other browsers don't currently care) - see debug/hacks/jitter.html for an example\r\n\t\t*/\r\n\t\tL.DomUtil.setPosition(tile, tilePos, L.Browser.chrome);\r\n\r\n\t\tthis._tiles[tilePoint.x + ':' + tilePoint.y] = tile;\r\n\r\n\t\tthis._loadTile(tile, tilePoint);\r\n\r\n\t\tif (tile.parentNode !== this._tileContainer) {\r\n\t\t\tcontainer.appendChild(tile);\r\n\t\t}\r\n\t},\r\n\r\n\t_getZoomForUrl: function () {\r\n\r\n\t\tvar options = this.options,\r\n\t\t    zoom = this._map.getZoom();\r\n\r\n\t\tif (options.zoomReverse) {\r\n\t\t\tzoom = options.maxZoom - zoom;\r\n\t\t}\r\n\r\n\t\tzoom += options.zoomOffset;\r\n\r\n\t\treturn options.maxNativeZoom ? Math.min(zoom, options.maxNativeZoom) : zoom;\r\n\t},\r\n\r\n\t_getTilePos: function (tilePoint) {\r\n\t\tvar origin = this._map.getPixelOrigin(),\r\n\t\t    tileSize = this._getTileSize();\r\n\r\n\t\treturn tilePoint.multiplyBy(tileSize).subtract(origin);\r\n\t},\r\n\r\n\t// image-specific code (override to implement e.g. Canvas or SVG tile layer)\r\n\r\n\tgetTileUrl: function (tilePoint) {\r\n\t\treturn L.Util.template(this._url, L.extend({\r\n\t\t\ts: this._getSubdomain(tilePoint),\r\n\t\t\tz: tilePoint.z,\r\n\t\t\tx: tilePoint.x,\r\n\t\t\ty: tilePoint.y\r\n\t\t}, this.options));\r\n\t},\r\n\r\n\t_getWrapTileNum: function () {\r\n\t\tvar crs = this._map.options.crs,\r\n\t\t    size = crs.getSize(this._map.getZoom());\r\n\t\treturn size.divideBy(this._getTileSize())._floor();\r\n\t},\r\n\r\n\t_adjustTilePoint: function (tilePoint) {\r\n\r\n\t\tvar limit = this._getWrapTileNum();\r\n\r\n\t\t// wrap tile coordinates\r\n\t\tif (!this.options.continuousWorld && !this.options.noWrap) {\r\n\t\t\ttilePoint.x = ((tilePoint.x % limit.x) + limit.x) % limit.x;\r\n\t\t}\r\n\r\n\t\tif (this.options.tms) {\r\n\t\t\ttilePoint.y = limit.y - tilePoint.y - 1;\r\n\t\t}\r\n\r\n\t\ttilePoint.z = this._getZoomForUrl();\r\n\t},\r\n\r\n\t_getSubdomain: function (tilePoint) {\r\n\t\tvar index = Math.abs(tilePoint.x + tilePoint.y) % this.options.subdomains.length;\r\n\t\treturn this.options.subdomains[index];\r\n\t},\r\n\r\n\t_getTile: function () {\r\n\t\tif (this.options.reuseTiles && this._unusedTiles.length > 0) {\r\n\t\t\tvar tile = this._unusedTiles.pop();\r\n\t\t\tthis._resetTile(tile);\r\n\t\t\treturn tile;\r\n\t\t}\r\n\t\treturn this._createTile();\r\n\t},\r\n\r\n\t// Override if data stored on a tile needs to be cleaned up before reuse\r\n\t_resetTile: function (/*tile*/) {},\r\n\r\n\t_createTile: function () {\r\n\t\tvar tile = L.DomUtil.create('img', 'leaflet-tile');\r\n\t\ttile.style.width = tile.style.height = this._getTileSize() + 'px';\r\n\t\ttile.galleryimg = 'no';\r\n\r\n\t\ttile.onselectstart = tile.onmousemove = L.Util.falseFn;\r\n\r\n\t\tif (L.Browser.ielt9 && this.options.opacity !== undefined) {\r\n\t\t\tL.DomUtil.setOpacity(tile, this.options.opacity);\r\n\t\t}\r\n\t\t// without this hack, tiles disappear after zoom on Chrome for Android\r\n\t\t// https://github.com/Leaflet/Leaflet/issues/2078\r\n\t\tif (L.Browser.mobileWebkit3d) {\r\n\t\t\ttile.style.WebkitBackfaceVisibility = 'hidden';\r\n\t\t}\r\n\t\treturn tile;\r\n\t},\r\n\r\n\t_loadTile: function (tile, tilePoint) {\r\n\t\ttile._layer  = this;\r\n\t\ttile.onload  = this._tileOnLoad;\r\n\t\ttile.onerror = this._tileOnError;\r\n\r\n\t\tthis._adjustTilePoint(tilePoint);\r\n\t\ttile.src     = this.getTileUrl(tilePoint);\r\n\r\n\t\tthis.fire('tileloadstart', {\r\n\t\t\ttile: tile,\r\n\t\t\turl: tile.src\r\n\t\t});\r\n\t},\r\n\r\n\t_tileLoaded: function () {\r\n\t\tthis._tilesToLoad--;\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tL.DomUtil.addClass(this._tileContainer, 'leaflet-zoom-animated');\r\n\t\t}\r\n\r\n\t\tif (!this._tilesToLoad) {\r\n\t\t\tthis.fire('load');\r\n\r\n\t\t\tif (this._animated) {\r\n\t\t\t\t// clear scaled tiles after all new tiles are loaded (for performance)\r\n\t\t\t\tclearTimeout(this._clearBgBufferTimer);\r\n\t\t\t\tthis._clearBgBufferTimer = setTimeout(L.bind(this._clearBgBuffer, this), 500);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_tileOnLoad: function () {\r\n\t\tvar layer = this._layer;\r\n\r\n\t\t//Only if we are loading an actual image\r\n\t\tif (this.src !== L.Util.emptyImageUrl) {\r\n\t\t\tL.DomUtil.addClass(this, 'leaflet-tile-loaded');\r\n\r\n\t\t\tlayer.fire('tileload', {\r\n\t\t\t\ttile: this,\r\n\t\t\t\turl: this.src\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tlayer._tileLoaded();\r\n\t},\r\n\r\n\t_tileOnError: function () {\r\n\t\tvar layer = this._layer;\r\n\r\n\t\tlayer.fire('tileerror', {\r\n\t\t\ttile: this,\r\n\t\t\turl: this.src\r\n\t\t});\r\n\r\n\t\tvar newUrl = layer.options.errorTileUrl;\r\n\t\tif (newUrl) {\r\n\t\t\tthis.src = newUrl;\r\n\t\t}\r\n\r\n\t\tlayer._tileLoaded();\r\n\t}\r\n});\r\n\r\nL.tileLayer = function (url, options) {\r\n\treturn new L.TileLayer(url, options);\r\n};\r\n\n\n/*\r\n * L.TileLayer.WMS is used for putting WMS tile layers on the map.\r\n */\r\n\r\nL.TileLayer.WMS = L.TileLayer.extend({\r\n\r\n\tdefaultWmsParams: {\r\n\t\tservice: 'WMS',\r\n\t\trequest: 'GetMap',\r\n\t\tversion: '1.1.1',\r\n\t\tlayers: '',\r\n\t\tstyles: '',\r\n\t\tformat: 'image/jpeg',\r\n\t\ttransparent: false\r\n\t},\r\n\r\n\tinitialize: function (url, options) { // (String, Object)\r\n\r\n\t\tthis._url = url;\r\n\r\n\t\tvar wmsParams = L.extend({}, this.defaultWmsParams),\r\n\t\t    tileSize = options.tileSize || this.options.tileSize;\r\n\r\n\t\tif (options.detectRetina && L.Browser.retina) {\r\n\t\t\twmsParams.width = wmsParams.height = tileSize * 2;\r\n\t\t} else {\r\n\t\t\twmsParams.width = wmsParams.height = tileSize;\r\n\t\t}\r\n\r\n\t\tfor (var i in options) {\r\n\t\t\t// all keys that are not TileLayer options go to WMS params\r\n\t\t\tif (!this.options.hasOwnProperty(i) && i !== 'crs') {\r\n\t\t\t\twmsParams[i] = options[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.wmsParams = wmsParams;\r\n\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\r\n\t\tthis._crs = this.options.crs || map.options.crs;\r\n\r\n\t\tthis._wmsVersion = parseFloat(this.wmsParams.version);\r\n\r\n\t\tvar projectionKey = this._wmsVersion >= 1.3 ? 'crs' : 'srs';\r\n\t\tthis.wmsParams[projectionKey] = this._crs.code;\r\n\r\n\t\tL.TileLayer.prototype.onAdd.call(this, map);\r\n\t},\r\n\r\n\tgetTileUrl: function (tilePoint) { // (Point, Number) -> String\r\n\r\n\t\tvar map = this._map,\r\n\t\t    tileSize = this.options.tileSize,\r\n\r\n\t\t    nwPoint = tilePoint.multiplyBy(tileSize),\r\n\t\t    sePoint = nwPoint.add([tileSize, tileSize]),\r\n\r\n\t\t    nw = this._crs.project(map.unproject(nwPoint, tilePoint.z)),\r\n\t\t    se = this._crs.project(map.unproject(sePoint, tilePoint.z)),\r\n\t\t    bbox = this._wmsVersion >= 1.3 && this._crs === L.CRS.EPSG4326 ?\r\n\t\t        [se.y, nw.x, nw.y, se.x].join(',') :\r\n\t\t        [nw.x, se.y, se.x, nw.y].join(','),\r\n\r\n\t\t    url = L.Util.template(this._url, {s: this._getSubdomain(tilePoint)});\r\n\r\n\t\treturn url + L.Util.getParamString(this.wmsParams, url, true) + '&BBOX=' + bbox;\r\n\t},\r\n\r\n\tsetParams: function (params, noRedraw) {\r\n\r\n\t\tL.extend(this.wmsParams, params);\r\n\r\n\t\tif (!noRedraw) {\r\n\t\t\tthis.redraw();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\nL.tileLayer.wms = function (url, options) {\r\n\treturn new L.TileLayer.WMS(url, options);\r\n};\r\n\n\n/*\r\n * L.TileLayer.Canvas is a class that you can use as a base for creating\r\n * dynamically drawn Canvas-based tile layers.\r\n */\r\n\r\nL.TileLayer.Canvas = L.TileLayer.extend({\r\n\toptions: {\r\n\t\tasync: false\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._reset({hard: true});\r\n\t\t\tthis._update();\r\n\t\t}\r\n\r\n\t\tfor (var i in this._tiles) {\r\n\t\t\tthis._redrawTile(this._tiles[i]);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_redrawTile: function (tile) {\r\n\t\tthis.drawTile(tile, tile._tilePoint, this._map._zoom);\r\n\t},\r\n\r\n\t_createTile: function () {\r\n\t\tvar tile = L.DomUtil.create('canvas', 'leaflet-tile');\r\n\t\ttile.width = tile.height = this.options.tileSize;\r\n\t\ttile.onselectstart = tile.onmousemove = L.Util.falseFn;\r\n\t\treturn tile;\r\n\t},\r\n\r\n\t_loadTile: function (tile, tilePoint) {\r\n\t\ttile._layer = this;\r\n\t\ttile._tilePoint = tilePoint;\r\n\r\n\t\tthis._redrawTile(tile);\r\n\r\n\t\tif (!this.options.async) {\r\n\t\t\tthis.tileDrawn(tile);\r\n\t\t}\r\n\t},\r\n\r\n\tdrawTile: function (/*tile, tilePoint*/) {\r\n\t\t// override with rendering code\r\n\t},\r\n\r\n\ttileDrawn: function (tile) {\r\n\t\tthis._tileOnLoad.call(tile);\r\n\t}\r\n});\r\n\r\n\r\nL.tileLayer.canvas = function (options) {\r\n\treturn new L.TileLayer.Canvas(options);\r\n};\r\n\n\n/*\r\n * L.ImageOverlay is used to overlay images over the map (to specific geographical bounds).\r\n */\r\n\r\nL.ImageOverlay = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\topacity: 1\r\n\t},\r\n\r\n\tinitialize: function (url, bounds, options) { // (String, LatLngBounds, Object)\r\n\t\tthis._url = url;\r\n\t\tthis._bounds = L.latLngBounds(bounds);\r\n\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tif (!this._image) {\r\n\t\t\tthis._initImage();\r\n\t\t}\r\n\r\n\t\tmap._panes.overlayPane.appendChild(this._image);\r\n\r\n\t\tmap.on('viewreset', this._reset, this);\r\n\r\n\t\tif (map.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\tmap.on('zoomanim', this._animateZoom, this);\r\n\t\t}\r\n\r\n\t\tthis._reset();\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap.getPanes().overlayPane.removeChild(this._image);\r\n\r\n\t\tmap.off('viewreset', this._reset, this);\r\n\r\n\t\tif (map.options.zoomAnimation) {\r\n\t\t\tmap.off('zoomanim', this._animateZoom, this);\r\n\t\t}\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetOpacity: function (opacity) {\r\n\t\tthis.options.opacity = opacity;\r\n\t\tthis._updateOpacity();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// TODO remove bringToFront/bringToBack duplication from TileLayer/Path\r\n\tbringToFront: function () {\r\n\t\tif (this._image) {\r\n\t\t\tthis._map._panes.overlayPane.appendChild(this._image);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\tvar pane = this._map._panes.overlayPane;\r\n\t\tif (this._image) {\r\n\t\t\tpane.insertBefore(this._image, pane.firstChild);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetUrl: function (url) {\r\n\t\tthis._url = url;\r\n\t\tthis._image.src = this._url;\r\n\t},\r\n\r\n\tgetAttribution: function () {\r\n\t\treturn this.options.attribution;\r\n\t},\r\n\r\n\t_initImage: function () {\r\n\t\tthis._image = L.DomUtil.create('img', 'leaflet-image-layer');\r\n\r\n\t\tif (this._map.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\tL.DomUtil.addClass(this._image, 'leaflet-zoom-animated');\r\n\t\t} else {\r\n\t\t\tL.DomUtil.addClass(this._image, 'leaflet-zoom-hide');\r\n\t\t}\r\n\r\n\t\tthis._updateOpacity();\r\n\r\n\t\t//TODO createImage util method to remove duplication\r\n\t\tL.extend(this._image, {\r\n\t\t\tgalleryimg: 'no',\r\n\t\t\tonselectstart: L.Util.falseFn,\r\n\t\t\tonmousemove: L.Util.falseFn,\r\n\t\t\tonload: L.bind(this._onImageLoad, this),\r\n\t\t\tsrc: this._url\r\n\t\t});\r\n\t},\r\n\r\n\t_animateZoom: function (e) {\r\n\t\tvar map = this._map,\r\n\t\t    image = this._image,\r\n\t\t    scale = map.getZoomScale(e.zoom),\r\n\t\t    nw = this._bounds.getNorthWest(),\r\n\t\t    se = this._bounds.getSouthEast(),\r\n\r\n\t\t    topLeft = map._latLngToNewLayerPoint(nw, e.zoom, e.center),\r\n\t\t    size = map._latLngToNewLayerPoint(se, e.zoom, e.center)._subtract(topLeft),\r\n\t\t    origin = topLeft._add(size._multiplyBy((1 / 2) * (1 - 1 / scale)));\r\n\r\n\t\timage.style[L.DomUtil.TRANSFORM] =\r\n\t\t        L.DomUtil.getTranslateString(origin) + ' scale(' + scale + ') ';\r\n\t},\r\n\r\n\t_reset: function () {\r\n\t\tvar image   = this._image,\r\n\t\t    topLeft = this._map.latLngToLayerPoint(this._bounds.getNorthWest()),\r\n\t\t    size = this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(topLeft);\r\n\r\n\t\tL.DomUtil.setPosition(image, topLeft);\r\n\r\n\t\timage.style.width  = size.x + 'px';\r\n\t\timage.style.height = size.y + 'px';\r\n\t},\r\n\r\n\t_onImageLoad: function () {\r\n\t\tthis.fire('load');\r\n\t},\r\n\r\n\t_updateOpacity: function () {\r\n\t\tL.DomUtil.setOpacity(this._image, this.options.opacity);\r\n\t}\r\n});\r\n\r\nL.imageOverlay = function (url, bounds, options) {\r\n\treturn new L.ImageOverlay(url, bounds, options);\r\n};\r\n\n\n/*\r\n * L.Icon is an image-based icon class that you can use with L.Marker for custom markers.\r\n */\r\n\r\nL.Icon = L.Class.extend({\r\n\toptions: {\r\n\t\t/*\r\n\t\ticonUrl: (String) (required)\r\n\t\ticonRetinaUrl: (String) (optional, used for retina devices if detected)\r\n\t\ticonSize: (Point) (can be set through CSS)\r\n\t\ticonAnchor: (Point) (centered by default, can be set in CSS with negative margins)\r\n\t\tpopupAnchor: (Point) (if not specified, popup opens in the anchor point)\r\n\t\tshadowUrl: (String) (no shadow by default)\r\n\t\tshadowRetinaUrl: (String) (optional, used for retina devices if detected)\r\n\t\tshadowSize: (Point)\r\n\t\tshadowAnchor: (Point)\r\n\t\t*/\r\n\t\tclassName: ''\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tcreateIcon: function (oldIcon) {\r\n\t\treturn this._createIcon('icon', oldIcon);\r\n\t},\r\n\r\n\tcreateShadow: function (oldIcon) {\r\n\t\treturn this._createIcon('shadow', oldIcon);\r\n\t},\r\n\r\n\t_createIcon: function (name, oldIcon) {\r\n\t\tvar src = this._getIconUrl(name);\r\n\r\n\t\tif (!src) {\r\n\t\t\tif (name === 'icon') {\r\n\t\t\t\tthrow new Error('iconUrl not set in Icon options (see the docs).');\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar img;\r\n\t\tif (!oldIcon || oldIcon.tagName !== 'IMG') {\r\n\t\t\timg = this._createImg(src);\r\n\t\t} else {\r\n\t\t\timg = this._createImg(src, oldIcon);\r\n\t\t}\r\n\t\tthis._setIconStyles(img, name);\r\n\r\n\t\treturn img;\r\n\t},\r\n\r\n\t_setIconStyles: function (img, name) {\r\n\t\tvar options = this.options,\r\n\t\t    size = L.point(options[name + 'Size']),\r\n\t\t    anchor;\r\n\r\n\t\tif (name === 'shadow') {\r\n\t\t\tanchor = L.point(options.shadowAnchor || options.iconAnchor);\r\n\t\t} else {\r\n\t\t\tanchor = L.point(options.iconAnchor);\r\n\t\t}\r\n\r\n\t\tif (!anchor && size) {\r\n\t\t\tanchor = size.divideBy(2, true);\r\n\t\t}\r\n\r\n\t\timg.className = 'leaflet-marker-' + name + ' ' + options.className;\r\n\r\n\t\tif (anchor) {\r\n\t\t\timg.style.marginLeft = (-anchor.x) + 'px';\r\n\t\t\timg.style.marginTop  = (-anchor.y) + 'px';\r\n\t\t}\r\n\r\n\t\tif (size) {\r\n\t\t\timg.style.width  = size.x + 'px';\r\n\t\t\timg.style.height = size.y + 'px';\r\n\t\t}\r\n\t},\r\n\r\n\t_createImg: function (src, el) {\r\n\t\tel = el || document.createElement('img');\r\n\t\tel.src = src;\r\n\t\treturn el;\r\n\t},\r\n\r\n\t_getIconUrl: function (name) {\r\n\t\tif (L.Browser.retina && this.options[name + 'RetinaUrl']) {\r\n\t\t\treturn this.options[name + 'RetinaUrl'];\r\n\t\t}\r\n\t\treturn this.options[name + 'Url'];\r\n\t}\r\n});\r\n\r\nL.icon = function (options) {\r\n\treturn new L.Icon(options);\r\n};\r\n\n\n/*\n * L.Icon.Default is the blue marker icon used by default in Leaflet.\n */\n\nL.Icon.Default = L.Icon.extend({\n\n\toptions: {\n\t\ticonSize: [25, 41],\n\t\ticonAnchor: [12, 41],\n\t\tpopupAnchor: [1, -34],\n\n\t\tshadowSize: [41, 41]\n\t},\n\n\t_getIconUrl: function (name) {\n\t\tvar key = name + 'Url';\n\n\t\tif (this.options[key]) {\n\t\t\treturn this.options[key];\n\t\t}\n\n\t\tif (L.Browser.retina && name === 'icon') {\n\t\t\tname += '-2x';\n\t\t}\n\n\t\tvar path = L.Icon.Default.imagePath;\n\n\t\tif (!path) {\n\t\t\tthrow new Error('Couldn\\'t autodetect L.Icon.Default.imagePath, set it manually.');\n\t\t}\n\n\t\treturn path + '/marker-' + name + '.png';\n\t}\n});\n\nL.Icon.Default.imagePath = (function () {\n\tvar scripts = document.getElementsByTagName('script'),\n\t    leafletRe = /[\\/^]leaflet[\\-\\._]?([\\w\\-\\._]*)\\.js\\??/;\n\n\tvar i, len, src, matches, path;\n\n\tfor (i = 0, len = scripts.length; i < len; i++) {\n\t\tsrc = scripts[i].src;\n\t\tmatches = src.match(leafletRe);\n\n\t\tif (matches) {\n\t\t\tpath = src.split(leafletRe)[0];\n\t\t\treturn (path ? path + '/' : '') + 'images';\n\t\t}\n\t}\n}());\n\n\n/*\r\n * L.Marker is used to display clickable/draggable icons on the map.\r\n */\r\n\r\nL.Marker = L.Class.extend({\r\n\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\ticon: new L.Icon.Default(),\r\n\t\ttitle: '',\r\n\t\talt: '',\r\n\t\tclickable: true,\r\n\t\tdraggable: false,\r\n\t\tkeyboard: true,\r\n\t\tzIndexOffset: 0,\r\n\t\topacity: 1,\r\n\t\triseOnHover: false,\r\n\t\triseOffset: 250\r\n\t},\r\n\r\n\tinitialize: function (latlng, options) {\r\n\t\tL.setOptions(this, options);\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tmap.on('viewreset', this.update, this);\r\n\r\n\t\tthis._initIcon();\r\n\t\tthis.update();\r\n\t\tthis.fire('add');\r\n\r\n\t\tif (map.options.zoomAnimation && map.options.markerZoomAnimation) {\r\n\t\t\tmap.on('zoomanim', this._animateZoom, this);\r\n\t\t}\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tif (this.dragging) {\r\n\t\t\tthis.dragging.disable();\r\n\t\t}\r\n\r\n\t\tthis._removeIcon();\r\n\t\tthis._removeShadow();\r\n\r\n\t\tthis.fire('remove');\r\n\r\n\t\tmap.off({\r\n\t\t\t'viewreset': this.update,\r\n\t\t\t'zoomanim': this._animateZoom\r\n\t\t}, this);\r\n\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\tgetLatLng: function () {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\r\n\t\tthis.update();\r\n\r\n\t\treturn this.fire('move', { latlng: this._latlng });\r\n\t},\r\n\r\n\tsetZIndexOffset: function (offset) {\r\n\t\tthis.options.zIndexOffset = offset;\r\n\t\tthis.update();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetIcon: function (icon) {\r\n\r\n\t\tthis.options.icon = icon;\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._initIcon();\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tif (this._popup) {\r\n\t\t\tthis.bindPopup(this._popup);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdate: function () {\r\n\t\tif (this._icon) {\r\n\t\t\tthis._setPos(this._map.latLngToLayerPoint(this._latlng).round());\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_initIcon: function () {\r\n\t\tvar options = this.options,\r\n\t\t    map = this._map,\r\n\t\t    animation = (map.options.zoomAnimation && map.options.markerZoomAnimation),\r\n\t\t    classToAdd = animation ? 'leaflet-zoom-animated' : 'leaflet-zoom-hide';\r\n\r\n\t\tvar icon = options.icon.createIcon(this._icon),\r\n\t\t\taddIcon = false;\r\n\r\n\t\t// if we're not reusing the icon, remove the old one and init new one\r\n\t\tif (icon !== this._icon) {\r\n\t\t\tif (this._icon) {\r\n\t\t\t\tthis._removeIcon();\r\n\t\t\t}\r\n\t\t\taddIcon = true;\r\n\r\n\t\t\tif (options.title) {\r\n\t\t\t\ticon.title = options.title;\r\n\t\t\t}\r\n\r\n\t\t\tif (options.alt) {\r\n\t\t\t\ticon.alt = options.alt;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tL.DomUtil.addClass(icon, classToAdd);\r\n\r\n\t\tif (options.keyboard) {\r\n\t\t\ticon.tabIndex = '0';\r\n\t\t}\r\n\r\n\t\tthis._icon = icon;\r\n\r\n\t\tthis._initInteraction();\r\n\r\n\t\tif (options.riseOnHover) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.on(icon, 'mouseover', this._bringToFront, this)\r\n\t\t\t\t.on(icon, 'mouseout', this._resetZIndex, this);\r\n\t\t}\r\n\r\n\t\tvar newShadow = options.icon.createShadow(this._shadow),\r\n\t\t\taddShadow = false;\r\n\r\n\t\tif (newShadow !== this._shadow) {\r\n\t\t\tthis._removeShadow();\r\n\t\t\taddShadow = true;\r\n\t\t}\r\n\r\n\t\tif (newShadow) {\r\n\t\t\tL.DomUtil.addClass(newShadow, classToAdd);\r\n\t\t}\r\n\t\tthis._shadow = newShadow;\r\n\r\n\r\n\t\tif (options.opacity < 1) {\r\n\t\t\tthis._updateOpacity();\r\n\t\t}\r\n\r\n\r\n\t\tvar panes = this._map._panes;\r\n\r\n\t\tif (addIcon) {\r\n\t\t\tpanes.markerPane.appendChild(this._icon);\r\n\t\t}\r\n\r\n\t\tif (newShadow && addShadow) {\r\n\t\t\tpanes.shadowPane.appendChild(this._shadow);\r\n\t\t}\r\n\t},\r\n\r\n\t_removeIcon: function () {\r\n\t\tif (this.options.riseOnHover) {\r\n\t\t\tL.DomEvent\r\n\t\t\t    .off(this._icon, 'mouseover', this._bringToFront)\r\n\t\t\t    .off(this._icon, 'mouseout', this._resetZIndex);\r\n\t\t}\r\n\r\n\t\tthis._map._panes.markerPane.removeChild(this._icon);\r\n\r\n\t\tthis._icon = null;\r\n\t},\r\n\r\n\t_removeShadow: function () {\r\n\t\tif (this._shadow) {\r\n\t\t\tthis._map._panes.shadowPane.removeChild(this._shadow);\r\n\t\t}\r\n\t\tthis._shadow = null;\r\n\t},\r\n\r\n\t_setPos: function (pos) {\r\n\t\tL.DomUtil.setPosition(this._icon, pos);\r\n\r\n\t\tif (this._shadow) {\r\n\t\t\tL.DomUtil.setPosition(this._shadow, pos);\r\n\t\t}\r\n\r\n\t\tthis._zIndex = pos.y + this.options.zIndexOffset;\r\n\r\n\t\tthis._resetZIndex();\r\n\t},\r\n\r\n\t_updateZIndex: function (offset) {\r\n\t\tthis._icon.style.zIndex = this._zIndex + offset;\r\n\t},\r\n\r\n\t_animateZoom: function (opt) {\r\n\t\tvar pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center).round();\r\n\r\n\t\tthis._setPos(pos);\r\n\t},\r\n\r\n\t_initInteraction: function () {\r\n\r\n\t\tif (!this.options.clickable) { return; }\r\n\r\n\t\t// TODO refactor into something shared with Map/Path/etc. to DRY it up\r\n\r\n\t\tvar icon = this._icon,\r\n\t\t    events = ['dblclick', 'mousedown', 'mouseover', 'mouseout', 'contextmenu'];\r\n\r\n\t\tL.DomUtil.addClass(icon, 'leaflet-clickable');\r\n\t\tL.DomEvent.on(icon, 'click', this._onMouseClick, this);\r\n\t\tL.DomEvent.on(icon, 'keypress', this._onKeyPress, this);\r\n\r\n\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\tL.DomEvent.on(icon, events[i], this._fireMouseEvent, this);\r\n\t\t}\r\n\r\n\t\tif (L.Handler.MarkerDrag) {\r\n\t\t\tthis.dragging = new L.Handler.MarkerDrag(this);\r\n\r\n\t\t\tif (this.options.draggable) {\r\n\t\t\t\tthis.dragging.enable();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseClick: function (e) {\r\n\t\tvar wasDragged = this.dragging && this.dragging.moved();\r\n\r\n\t\tif (this.hasEventListeners(e.type) || wasDragged) {\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t}\r\n\r\n\t\tif (wasDragged) { return; }\r\n\r\n\t\tif ((!this.dragging || !this.dragging._enabled) && this._map.dragging && this._map.dragging.moved()) { return; }\r\n\r\n\t\tthis.fire(e.type, {\r\n\t\t\toriginalEvent: e,\r\n\t\t\tlatlng: this._latlng\r\n\t\t});\r\n\t},\r\n\r\n\t_onKeyPress: function (e) {\r\n\t\tif (e.keyCode === 13) {\r\n\t\t\tthis.fire('click', {\r\n\t\t\t\toriginalEvent: e,\r\n\t\t\t\tlatlng: this._latlng\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t_fireMouseEvent: function (e) {\r\n\r\n\t\tthis.fire(e.type, {\r\n\t\t\toriginalEvent: e,\r\n\t\t\tlatlng: this._latlng\r\n\t\t});\r\n\r\n\t\t// TODO proper custom event propagation\r\n\t\t// this line will always be called if marker is in a FeatureGroup\r\n\t\tif (e.type === 'contextmenu' && this.hasEventListeners(e.type)) {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\t\tif (e.type !== 'mousedown') {\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t} else {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\t},\r\n\r\n\tsetOpacity: function (opacity) {\r\n\t\tthis.options.opacity = opacity;\r\n\t\tif (this._map) {\r\n\t\t\tthis._updateOpacity();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_updateOpacity: function () {\r\n\t\tL.DomUtil.setOpacity(this._icon, this.options.opacity);\r\n\t\tif (this._shadow) {\r\n\t\t\tL.DomUtil.setOpacity(this._shadow, this.options.opacity);\r\n\t\t}\r\n\t},\r\n\r\n\t_bringToFront: function () {\r\n\t\tthis._updateZIndex(this.options.riseOffset);\r\n\t},\r\n\r\n\t_resetZIndex: function () {\r\n\t\tthis._updateZIndex(0);\r\n\t}\r\n});\r\n\r\nL.marker = function (latlng, options) {\r\n\treturn new L.Marker(latlng, options);\r\n};\r\n\n\n/*\n * L.DivIcon is a lightweight HTML-based icon class (as opposed to the image-based L.Icon)\n * to use with L.Marker.\n */\n\nL.DivIcon = L.Icon.extend({\n\toptions: {\n\t\ticonSize: [12, 12], // also can be set through CSS\n\t\t/*\n\t\ticonAnchor: (Point)\n\t\tpopupAnchor: (Point)\n\t\thtml: (String)\n\t\tbgPos: (Point)\n\t\t*/\n\t\tclassName: 'leaflet-div-icon',\n\t\thtml: false\n\t},\n\n\tcreateIcon: function (oldIcon) {\n\t\tvar div = (oldIcon && oldIcon.tagName === 'DIV') ? oldIcon : document.createElement('div'),\n\t\t    options = this.options;\n\n\t\tif (options.html !== false) {\n\t\t\tdiv.innerHTML = options.html;\n\t\t} else {\n\t\t\tdiv.innerHTML = '';\n\t\t}\n\n\t\tif (options.bgPos) {\n\t\t\tdiv.style.backgroundPosition =\n\t\t\t        (-options.bgPos.x) + 'px ' + (-options.bgPos.y) + 'px';\n\t\t}\n\n\t\tthis._setIconStyles(div, 'icon');\n\t\treturn div;\n\t},\n\n\tcreateShadow: function () {\n\t\treturn null;\n\t}\n});\n\nL.divIcon = function (options) {\n\treturn new L.DivIcon(options);\n};\n\n\n/*\r\n * L.Popup is used for displaying popups on the map.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tclosePopupOnClick: true\r\n});\r\n\r\nL.Popup = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tminWidth: 50,\r\n\t\tmaxWidth: 300,\r\n\t\t// maxHeight: null,\r\n\t\tautoPan: true,\r\n\t\tcloseButton: true,\r\n\t\toffset: [0, 7],\r\n\t\tautoPanPadding: [5, 5],\r\n\t\t// autoPanPaddingTopLeft: null,\r\n\t\t// autoPanPaddingBottomRight: null,\r\n\t\tkeepInView: false,\r\n\t\tclassName: '',\r\n\t\tzoomAnimation: true\r\n\t},\r\n\r\n\tinitialize: function (options, source) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._source = source;\r\n\t\tthis._animated = L.Browser.any3d && this.options.zoomAnimation;\r\n\t\tthis._isOpen = false;\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tif (!this._container) {\r\n\t\t\tthis._initLayout();\r\n\t\t}\r\n\r\n\t\tvar animFade = map.options.fadeAnimation;\r\n\r\n\t\tif (animFade) {\r\n\t\t\tL.DomUtil.setOpacity(this._container, 0);\r\n\t\t}\r\n\t\tmap._panes.popupPane.appendChild(this._container);\r\n\r\n\t\tmap.on(this._getEvents(), this);\r\n\r\n\t\tthis.update();\r\n\r\n\t\tif (animFade) {\r\n\t\t\tL.DomUtil.setOpacity(this._container, 1);\r\n\t\t}\r\n\r\n\t\tthis.fire('open');\r\n\r\n\t\tmap.fire('popupopen', {popup: this});\r\n\r\n\t\tif (this._source) {\r\n\t\t\tthis._source.fire('popupopen', {popup: this});\r\n\t\t}\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\topenOn: function (map) {\r\n\t\tmap.openPopup(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap._panes.popupPane.removeChild(this._container);\r\n\r\n\t\tL.Util.falseFn(this._container.offsetWidth); // force reflow\r\n\r\n\t\tmap.off(this._getEvents(), this);\r\n\r\n\t\tif (map.options.fadeAnimation) {\r\n\t\t\tL.DomUtil.setOpacity(this._container, 0);\r\n\t\t}\r\n\r\n\t\tthis._map = null;\r\n\r\n\t\tthis.fire('close');\r\n\r\n\t\tmap.fire('popupclose', {popup: this});\r\n\r\n\t\tif (this._source) {\r\n\t\t\tthis._source.fire('popupclose', {popup: this});\r\n\t\t}\r\n\t},\r\n\r\n\tgetLatLng: function () {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t\tif (this._map) {\r\n\t\t\tthis._updatePosition();\r\n\t\t\tthis._adjustPan();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetContent: function () {\r\n\t\treturn this._content;\r\n\t},\r\n\r\n\tsetContent: function (content) {\r\n\t\tthis._content = content;\r\n\t\tthis.update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdate: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tthis._container.style.visibility = 'hidden';\r\n\r\n\t\tthis._updateContent();\r\n\t\tthis._updateLayout();\r\n\t\tthis._updatePosition();\r\n\r\n\t\tthis._container.style.visibility = '';\r\n\r\n\t\tthis._adjustPan();\r\n\t},\r\n\r\n\t_getEvents: function () {\r\n\t\tvar events = {\r\n\t\t\tviewreset: this._updatePosition\r\n\t\t};\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tevents.zoomanim = this._zoomAnimation;\r\n\t\t}\r\n\t\tif ('closeOnClick' in this.options ? this.options.closeOnClick : this._map.options.closePopupOnClick) {\r\n\t\t\tevents.preclick = this._close;\r\n\t\t}\r\n\t\tif (this.options.keepInView) {\r\n\t\t\tevents.moveend = this._adjustPan;\r\n\t\t}\r\n\r\n\t\treturn events;\r\n\t},\r\n\r\n\t_close: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.closePopup(this);\r\n\t\t}\r\n\t},\r\n\r\n\t_initLayout: function () {\r\n\t\tvar prefix = 'leaflet-popup',\r\n\t\t\tcontainerClass = prefix + ' ' + this.options.className + ' leaflet-zoom-' +\r\n\t\t\t        (this._animated ? 'animated' : 'hide'),\r\n\t\t\tcontainer = this._container = L.DomUtil.create('div', containerClass),\r\n\t\t\tcloseButton;\r\n\r\n\t\tif (this.options.closeButton) {\r\n\t\t\tcloseButton = this._closeButton =\r\n\t\t\t        L.DomUtil.create('a', prefix + '-close-button', container);\r\n\t\t\tcloseButton.href = '#close';\r\n\t\t\tcloseButton.innerHTML = '&#215;';\r\n\t\t\tL.DomEvent.disableClickPropagation(closeButton);\r\n\r\n\t\t\tL.DomEvent.on(closeButton, 'click', this._onCloseButtonClick, this);\r\n\t\t}\r\n\r\n\t\tvar wrapper = this._wrapper =\r\n\t\t        L.DomUtil.create('div', prefix + '-content-wrapper', container);\r\n\t\tL.DomEvent.disableClickPropagation(wrapper);\r\n\r\n\t\tthis._contentNode = L.DomUtil.create('div', prefix + '-content', wrapper);\r\n\r\n\t\tL.DomEvent.disableScrollPropagation(this._contentNode);\r\n\t\tL.DomEvent.on(wrapper, 'contextmenu', L.DomEvent.stopPropagation);\r\n\r\n\t\tthis._tipContainer = L.DomUtil.create('div', prefix + '-tip-container', container);\r\n\t\tthis._tip = L.DomUtil.create('div', prefix + '-tip', this._tipContainer);\r\n\t},\r\n\r\n\t_updateContent: function () {\r\n\t\tif (!this._content) { return; }\r\n\r\n\t\tif (typeof this._content === 'string') {\r\n\t\t\tthis._contentNode.innerHTML = this._content;\r\n\t\t} else {\r\n\t\t\twhile (this._contentNode.hasChildNodes()) {\r\n\t\t\t\tthis._contentNode.removeChild(this._contentNode.firstChild);\r\n\t\t\t}\r\n\t\t\tthis._contentNode.appendChild(this._content);\r\n\t\t}\r\n\t\tthis.fire('contentupdate');\r\n\t},\r\n\r\n\t_updateLayout: function () {\r\n\t\tvar container = this._contentNode,\r\n\t\t    style = container.style;\r\n\r\n\t\tstyle.width = '';\r\n\t\tstyle.whiteSpace = 'nowrap';\r\n\r\n\t\tvar width = container.offsetWidth;\r\n\t\twidth = Math.min(width, this.options.maxWidth);\r\n\t\twidth = Math.max(width, this.options.minWidth);\r\n\r\n\t\tstyle.width = (width + 1) + 'px';\r\n\t\tstyle.whiteSpace = '';\r\n\r\n\t\tstyle.height = '';\r\n\r\n\t\tvar height = container.offsetHeight,\r\n\t\t    maxHeight = this.options.maxHeight,\r\n\t\t    scrolledClass = 'leaflet-popup-scrolled';\r\n\r\n\t\tif (maxHeight && height > maxHeight) {\r\n\t\t\tstyle.height = maxHeight + 'px';\r\n\t\t\tL.DomUtil.addClass(container, scrolledClass);\r\n\t\t} else {\r\n\t\t\tL.DomUtil.removeClass(container, scrolledClass);\r\n\t\t}\r\n\r\n\t\tthis._containerWidth = this._container.offsetWidth;\r\n\t},\r\n\r\n\t_updatePosition: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tvar pos = this._map.latLngToLayerPoint(this._latlng),\r\n\t\t    animated = this._animated,\r\n\t\t    offset = L.point(this.options.offset);\r\n\r\n\t\tif (animated) {\r\n\t\t\tL.DomUtil.setPosition(this._container, pos);\r\n\t\t}\r\n\r\n\t\tthis._containerBottom = -offset.y - (animated ? 0 : pos.y);\r\n\t\tthis._containerLeft = -Math.round(this._containerWidth / 2) + offset.x + (animated ? 0 : pos.x);\r\n\r\n\t\t// bottom position the popup in case the height of the popup changes (images loading etc)\r\n\t\tthis._container.style.bottom = this._containerBottom + 'px';\r\n\t\tthis._container.style.left = this._containerLeft + 'px';\r\n\t},\r\n\r\n\t_zoomAnimation: function (opt) {\r\n\t\tvar pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center);\r\n\r\n\t\tL.DomUtil.setPosition(this._container, pos);\r\n\t},\r\n\r\n\t_adjustPan: function () {\r\n\t\tif (!this.options.autoPan) { return; }\r\n\r\n\t\tvar map = this._map,\r\n\t\t    containerHeight = this._container.offsetHeight,\r\n\t\t    containerWidth = this._containerWidth,\r\n\r\n\t\t    layerPos = new L.Point(this._containerLeft, -containerHeight - this._containerBottom);\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tlayerPos._add(L.DomUtil.getPosition(this._container));\r\n\t\t}\r\n\r\n\t\tvar containerPos = map.layerPointToContainerPoint(layerPos),\r\n\t\t    padding = L.point(this.options.autoPanPadding),\r\n\t\t    paddingTL = L.point(this.options.autoPanPaddingTopLeft || padding),\r\n\t\t    paddingBR = L.point(this.options.autoPanPaddingBottomRight || padding),\r\n\t\t    size = map.getSize(),\r\n\t\t    dx = 0,\r\n\t\t    dy = 0;\r\n\r\n\t\tif (containerPos.x + containerWidth + paddingBR.x > size.x) { // right\r\n\t\t\tdx = containerPos.x + containerWidth - size.x + paddingBR.x;\r\n\t\t}\r\n\t\tif (containerPos.x - dx - paddingTL.x < 0) { // left\r\n\t\t\tdx = containerPos.x - paddingTL.x;\r\n\t\t}\r\n\t\tif (containerPos.y + containerHeight + paddingBR.y > size.y) { // bottom\r\n\t\t\tdy = containerPos.y + containerHeight - size.y + paddingBR.y;\r\n\t\t}\r\n\t\tif (containerPos.y - dy - paddingTL.y < 0) { // top\r\n\t\t\tdy = containerPos.y - paddingTL.y;\r\n\t\t}\r\n\r\n\t\tif (dx || dy) {\r\n\t\t\tmap\r\n\t\t\t    .fire('autopanstart')\r\n\t\t\t    .panBy([dx, dy]);\r\n\t\t}\r\n\t},\r\n\r\n\t_onCloseButtonClick: function (e) {\r\n\t\tthis._close();\r\n\t\tL.DomEvent.stop(e);\r\n\t}\r\n});\r\n\r\nL.popup = function (options, source) {\r\n\treturn new L.Popup(options, source);\r\n};\r\n\r\n\r\nL.Map.include({\r\n\topenPopup: function (popup, latlng, options) { // (Popup) or (String || HTMLElement, LatLng[, Object])\r\n\t\tthis.closePopup();\r\n\r\n\t\tif (!(popup instanceof L.Popup)) {\r\n\t\t\tvar content = popup;\r\n\r\n\t\t\tpopup = new L.Popup(options)\r\n\t\t\t    .setLatLng(latlng)\r\n\t\t\t    .setContent(content);\r\n\t\t}\r\n\t\tpopup._isOpen = true;\r\n\r\n\t\tthis._popup = popup;\r\n\t\treturn this.addLayer(popup);\r\n\t},\r\n\r\n\tclosePopup: function (popup) {\r\n\t\tif (!popup || popup === this._popup) {\r\n\t\t\tpopup = this._popup;\r\n\t\t\tthis._popup = null;\r\n\t\t}\r\n\t\tif (popup) {\r\n\t\t\tthis.removeLayer(popup);\r\n\t\t\tpopup._isOpen = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n});\r\n\n\n/*\r\n * Popup extension to L.Marker, adding popup-related methods.\r\n */\r\n\r\nL.Marker.include({\r\n\topenPopup: function () {\r\n\t\tif (this._popup && this._map && !this._map.hasLayer(this._popup)) {\r\n\t\t\tthis._popup.setLatLng(this._latlng);\r\n\t\t\tthis._map.openPopup(this._popup);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclosePopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup._close();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\ttogglePopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tif (this._popup._isOpen) {\r\n\t\t\t\tthis.closePopup();\r\n\t\t\t} else {\r\n\t\t\t\tthis.openPopup();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbindPopup: function (content, options) {\r\n\t\tvar anchor = L.point(this.options.icon.options.popupAnchor || [0, 0]);\r\n\r\n\t\tanchor = anchor.add(L.Popup.prototype.options.offset);\r\n\r\n\t\tif (options && options.offset) {\r\n\t\t\tanchor = anchor.add(options.offset);\r\n\t\t}\r\n\r\n\t\toptions = L.extend({offset: anchor}, options);\r\n\r\n\t\tif (!this._popupHandlersAdded) {\r\n\t\t\tthis\r\n\t\t\t    .on('click', this.togglePopup, this)\r\n\t\t\t    .on('remove', this.closePopup, this)\r\n\t\t\t    .on('move', this._movePopup, this);\r\n\t\t\tthis._popupHandlersAdded = true;\r\n\t\t}\r\n\r\n\t\tif (content instanceof L.Popup) {\r\n\t\t\tL.setOptions(content, options);\r\n\t\t\tthis._popup = content;\r\n\t\t\tcontent._source = this;\r\n\t\t} else {\r\n\t\t\tthis._popup = new L.Popup(options, this)\r\n\t\t\t\t.setContent(content);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetPopupContent: function (content) {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup.setContent(content);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tunbindPopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup = null;\r\n\t\t\tthis\r\n\t\t\t    .off('click', this.togglePopup, this)\r\n\t\t\t    .off('remove', this.closePopup, this)\r\n\t\t\t    .off('move', this._movePopup, this);\r\n\t\t\tthis._popupHandlersAdded = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetPopup: function () {\r\n\t\treturn this._popup;\r\n\t},\r\n\r\n\t_movePopup: function (e) {\r\n\t\tthis._popup.setLatLng(e.latlng);\r\n\t}\r\n});\r\n\n\n/*\r\n * L.LayerGroup is a class to combine several layers into one so that\r\n * you can manipulate the group (e.g. add/remove it) as one layer.\r\n */\r\n\r\nL.LayerGroup = L.Class.extend({\r\n\tinitialize: function (layers) {\r\n\t\tthis._layers = {};\r\n\r\n\t\tvar i, len;\r\n\r\n\t\tif (layers) {\r\n\t\t\tfor (i = 0, len = layers.length; i < len; i++) {\r\n\t\t\t\tthis.addLayer(layers[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\taddLayer: function (layer) {\r\n\t\tvar id = this.getLayerId(layer);\r\n\r\n\t\tthis._layers[id] = layer;\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.addLayer(layer);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tvar id = layer in this._layers ? layer : this.getLayerId(layer);\r\n\r\n\t\tif (this._map && this._layers[id]) {\r\n\t\t\tthis._map.removeLayer(this._layers[id]);\r\n\t\t}\r\n\r\n\t\tdelete this._layers[id];\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\thasLayer: function (layer) {\r\n\t\tif (!layer) { return false; }\r\n\r\n\t\treturn (layer in this._layers || this.getLayerId(layer) in this._layers);\r\n\t},\r\n\r\n\tclearLayers: function () {\r\n\t\tthis.eachLayer(this.removeLayer, this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tinvoke: function (methodName) {\r\n\t\tvar args = Array.prototype.slice.call(arguments, 1),\r\n\t\t    i, layer;\r\n\r\n\t\tfor (i in this._layers) {\r\n\t\t\tlayer = this._layers[i];\r\n\r\n\t\t\tif (layer[methodName]) {\r\n\t\t\t\tlayer[methodName].apply(layer, args);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\t\tthis.eachLayer(map.addLayer, map);\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tthis.eachLayer(map.removeLayer, map);\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\teachLayer: function (method, context) {\r\n\t\tfor (var i in this._layers) {\r\n\t\t\tmethod.call(context, this._layers[i]);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetLayer: function (id) {\r\n\t\treturn this._layers[id];\r\n\t},\r\n\r\n\tgetLayers: function () {\r\n\t\tvar layers = [];\r\n\r\n\t\tfor (var i in this._layers) {\r\n\t\t\tlayers.push(this._layers[i]);\r\n\t\t}\r\n\t\treturn layers;\r\n\t},\r\n\r\n\tsetZIndex: function (zIndex) {\r\n\t\treturn this.invoke('setZIndex', zIndex);\r\n\t},\r\n\r\n\tgetLayerId: function (layer) {\r\n\t\treturn L.stamp(layer);\r\n\t}\r\n});\r\n\r\nL.layerGroup = function (layers) {\r\n\treturn new L.LayerGroup(layers);\r\n};\r\n\n\n/*\r\n * L.FeatureGroup extends L.LayerGroup by introducing mouse events and additional methods\r\n * shared between a group of interactive layers (like vectors or markers).\r\n */\r\n\r\nL.FeatureGroup = L.LayerGroup.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\tstatics: {\r\n\t\tEVENTS: 'click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose'\r\n\t},\r\n\r\n\taddLayer: function (layer) {\r\n\t\tif (this.hasLayer(layer)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif ('on' in layer) {\r\n\t\t\tlayer.on(L.FeatureGroup.EVENTS, this._propagateEvent, this);\r\n\t\t}\r\n\r\n\t\tL.LayerGroup.prototype.addLayer.call(this, layer);\r\n\r\n\t\tif (this._popupContent && layer.bindPopup) {\r\n\t\t\tlayer.bindPopup(this._popupContent, this._popupOptions);\r\n\t\t}\r\n\r\n\t\treturn this.fire('layeradd', {layer: layer});\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tif (!this.hasLayer(layer)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tif (layer in this._layers) {\r\n\t\t\tlayer = this._layers[layer];\r\n\t\t}\r\n\r\n\t\tif ('off' in layer) {\r\n\t\t\tlayer.off(L.FeatureGroup.EVENTS, this._propagateEvent, this);\r\n\t\t}\r\n\r\n\t\tL.LayerGroup.prototype.removeLayer.call(this, layer);\r\n\r\n\t\tif (this._popupContent) {\r\n\t\t\tthis.invoke('unbindPopup');\r\n\t\t}\r\n\r\n\t\treturn this.fire('layerremove', {layer: layer});\r\n\t},\r\n\r\n\tbindPopup: function (content, options) {\r\n\t\tthis._popupContent = content;\r\n\t\tthis._popupOptions = options;\r\n\t\treturn this.invoke('bindPopup', content, options);\r\n\t},\r\n\r\n\topenPopup: function (latlng) {\r\n\t\t// open popup on the first layer\r\n\t\tfor (var id in this._layers) {\r\n\t\t\tthis._layers[id].openPopup(latlng);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\treturn this.invoke('setStyle', style);\r\n\t},\r\n\r\n\tbringToFront: function () {\r\n\t\treturn this.invoke('bringToFront');\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\treturn this.invoke('bringToBack');\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\tvar bounds = new L.LatLngBounds();\r\n\r\n\t\tthis.eachLayer(function (layer) {\r\n\t\t\tbounds.extend(layer instanceof L.Marker ? layer.getLatLng() : layer.getBounds());\r\n\t\t});\r\n\r\n\t\treturn bounds;\r\n\t},\r\n\r\n\t_propagateEvent: function (e) {\r\n\t\te = L.extend({\r\n\t\t\tlayer: e.target,\r\n\t\t\ttarget: this\r\n\t\t}, e);\r\n\t\tthis.fire(e.type, e);\r\n\t}\r\n});\r\n\r\nL.featureGroup = function (layers) {\r\n\treturn new L.FeatureGroup(layers);\r\n};\r\n\n\n/*\r\n * L.Path is a base class for rendering vector paths on a map. Inherited by Polyline, Circle, etc.\r\n */\r\n\r\nL.Path = L.Class.extend({\r\n\tincludes: [L.Mixin.Events],\r\n\r\n\tstatics: {\r\n\t\t// how much to extend the clip area around the map view\r\n\t\t// (relative to its size, e.g. 0.5 is half the screen in each direction)\r\n\t\t// set it so that SVG element doesn't exceed 1280px (vectors flicker on dragend if it is)\r\n\t\tCLIP_PADDING: (function () {\r\n\t\t\tvar max = L.Browser.mobile ? 1280 : 2000,\r\n\t\t\t    target = (max / Math.max(window.outerWidth, window.outerHeight) - 1) / 2;\r\n\t\t\treturn Math.max(0, Math.min(0.5, target));\r\n\t\t})()\r\n\t},\r\n\r\n\toptions: {\r\n\t\tstroke: true,\r\n\t\tcolor: '#0033ff',\r\n\t\tdashArray: null,\r\n\t\tlineCap: null,\r\n\t\tlineJoin: null,\r\n\t\tweight: 5,\r\n\t\topacity: 0.5,\r\n\r\n\t\tfill: false,\r\n\t\tfillColor: null, //same as color by default\r\n\t\tfillOpacity: 0.2,\r\n\r\n\t\tclickable: true\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tif (!this._container) {\r\n\t\t\tthis._initElements();\r\n\t\t\tthis._initEvents();\r\n\t\t}\r\n\r\n\t\tthis.projectLatlngs();\r\n\t\tthis._updatePath();\r\n\r\n\t\tif (this._container) {\r\n\t\t\tthis._map._pathRoot.appendChild(this._container);\r\n\t\t}\r\n\r\n\t\tthis.fire('add');\r\n\r\n\t\tmap.on({\r\n\t\t\t'viewreset': this.projectLatlngs,\r\n\t\t\t'moveend': this._updatePath\r\n\t\t}, this);\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap._pathRoot.removeChild(this._container);\r\n\r\n\t\t// Need to fire remove event before we set _map to null as the event hooks might need the object\r\n\t\tthis.fire('remove');\r\n\t\tthis._map = null;\r\n\r\n\t\tif (L.Browser.vml) {\r\n\t\t\tthis._container = null;\r\n\t\t\tthis._stroke = null;\r\n\t\t\tthis._fill = null;\r\n\t\t}\r\n\r\n\t\tmap.off({\r\n\t\t\t'viewreset': this.projectLatlngs,\r\n\t\t\t'moveend': this._updatePath\r\n\t\t}, this);\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\t// do all projection stuff here\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\tL.setOptions(this, style);\r\n\r\n\t\tif (this._container) {\r\n\t\t\tthis._updateStyle();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis.projectLatlngs();\r\n\t\t\tthis._updatePath();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\nL.Map.include({\r\n\t_updatePathViewport: function () {\r\n\t\tvar p = L.Path.CLIP_PADDING,\r\n\t\t    size = this.getSize(),\r\n\t\t    panePos = L.DomUtil.getPosition(this._mapPane),\r\n\t\t    min = panePos.multiplyBy(-1)._subtract(size.multiplyBy(p)._round()),\r\n\t\t    max = min.add(size.multiplyBy(1 + p * 2)._round());\r\n\r\n\t\tthis._pathViewport = new L.Bounds(min, max);\r\n\t}\r\n});\r\n\n\n/*\r\n * Extends L.Path with SVG-specific rendering code.\r\n */\r\n\r\nL.Path.SVG_NS = 'http://www.w3.org/2000/svg';\r\n\r\nL.Browser.svg = !!(document.createElementNS && document.createElementNS(L.Path.SVG_NS, 'svg').createSVGRect);\r\n\r\nL.Path = L.Path.extend({\r\n\tstatics: {\r\n\t\tSVG: L.Browser.svg\r\n\t},\r\n\r\n\tbringToFront: function () {\r\n\t\tvar root = this._map._pathRoot,\r\n\t\t    path = this._container;\r\n\r\n\t\tif (path && root.lastChild !== path) {\r\n\t\t\troot.appendChild(path);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\tvar root = this._map._pathRoot,\r\n\t\t    path = this._container,\r\n\t\t    first = root.firstChild;\r\n\r\n\t\tif (path && first !== path) {\r\n\t\t\troot.insertBefore(path, first);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetPathString: function () {\r\n\t\t// form path string here\r\n\t},\r\n\r\n\t_createElement: function (name) {\r\n\t\treturn document.createElementNS(L.Path.SVG_NS, name);\r\n\t},\r\n\r\n\t_initElements: function () {\r\n\t\tthis._map._initPathRoot();\r\n\t\tthis._initPath();\r\n\t\tthis._initStyle();\r\n\t},\r\n\r\n\t_initPath: function () {\r\n\t\tthis._container = this._createElement('g');\r\n\r\n\t\tthis._path = this._createElement('path');\r\n\r\n\t\tif (this.options.className) {\r\n\t\t\tL.DomUtil.addClass(this._path, this.options.className);\r\n\t\t}\r\n\r\n\t\tthis._container.appendChild(this._path);\r\n\t},\r\n\r\n\t_initStyle: function () {\r\n\t\tif (this.options.stroke) {\r\n\t\t\tthis._path.setAttribute('stroke-linejoin', 'round');\r\n\t\t\tthis._path.setAttribute('stroke-linecap', 'round');\r\n\t\t}\r\n\t\tif (this.options.fill) {\r\n\t\t\tthis._path.setAttribute('fill-rule', 'evenodd');\r\n\t\t}\r\n\t\tif (this.options.pointerEvents) {\r\n\t\t\tthis._path.setAttribute('pointer-events', this.options.pointerEvents);\r\n\t\t}\r\n\t\tif (!this.options.clickable && !this.options.pointerEvents) {\r\n\t\t\tthis._path.setAttribute('pointer-events', 'none');\r\n\t\t}\r\n\t\tthis._updateStyle();\r\n\t},\r\n\r\n\t_updateStyle: function () {\r\n\t\tif (this.options.stroke) {\r\n\t\t\tthis._path.setAttribute('stroke', this.options.color);\r\n\t\t\tthis._path.setAttribute('stroke-opacity', this.options.opacity);\r\n\t\t\tthis._path.setAttribute('stroke-width', this.options.weight);\r\n\t\t\tif (this.options.dashArray) {\r\n\t\t\t\tthis._path.setAttribute('stroke-dasharray', this.options.dashArray);\r\n\t\t\t} else {\r\n\t\t\t\tthis._path.removeAttribute('stroke-dasharray');\r\n\t\t\t}\r\n\t\t\tif (this.options.lineCap) {\r\n\t\t\t\tthis._path.setAttribute('stroke-linecap', this.options.lineCap);\r\n\t\t\t}\r\n\t\t\tif (this.options.lineJoin) {\r\n\t\t\t\tthis._path.setAttribute('stroke-linejoin', this.options.lineJoin);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._path.setAttribute('stroke', 'none');\r\n\t\t}\r\n\t\tif (this.options.fill) {\r\n\t\t\tthis._path.setAttribute('fill', this.options.fillColor || this.options.color);\r\n\t\t\tthis._path.setAttribute('fill-opacity', this.options.fillOpacity);\r\n\t\t} else {\r\n\t\t\tthis._path.setAttribute('fill', 'none');\r\n\t\t}\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tvar str = this.getPathString();\r\n\t\tif (!str) {\r\n\t\t\t// fix webkit empty string parsing bug\r\n\t\t\tstr = 'M0 0';\r\n\t\t}\r\n\t\tthis._path.setAttribute('d', str);\r\n\t},\r\n\r\n\t// TODO remove duplication with L.Map\r\n\t_initEvents: function () {\r\n\t\tif (this.options.clickable) {\r\n\t\t\tif (L.Browser.svg || !L.Browser.vml) {\r\n\t\t\t\tL.DomUtil.addClass(this._path, 'leaflet-clickable');\r\n\t\t\t}\r\n\r\n\t\t\tL.DomEvent.on(this._container, 'click', this._onMouseClick, this);\r\n\r\n\t\t\tvar events = ['dblclick', 'mousedown', 'mouseover',\r\n\t\t\t              'mouseout', 'mousemove', 'contextmenu'];\r\n\t\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\t\tL.DomEvent.on(this._container, events[i], this._fireMouseEvent, this);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseClick: function (e) {\r\n\t\tif (this._map.dragging && this._map.dragging.moved()) { return; }\r\n\r\n\t\tthis._fireMouseEvent(e);\r\n\t},\r\n\r\n\t_fireMouseEvent: function (e) {\r\n\t\tif (!this._map || !this.hasEventListeners(e.type)) { return; }\r\n\r\n\t\tvar map = this._map,\r\n\t\t    containerPoint = map.mouseEventToContainerPoint(e),\r\n\t\t    layerPoint = map.containerPointToLayerPoint(containerPoint),\r\n\t\t    latlng = map.layerPointToLatLng(layerPoint);\r\n\r\n\t\tthis.fire(e.type, {\r\n\t\t\tlatlng: latlng,\r\n\t\t\tlayerPoint: layerPoint,\r\n\t\t\tcontainerPoint: containerPoint,\r\n\t\t\toriginalEvent: e\r\n\t\t});\r\n\r\n\t\tif (e.type === 'contextmenu') {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\t\tif (e.type !== 'mousemove') {\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.include({\r\n\t_initPathRoot: function () {\r\n\t\tif (!this._pathRoot) {\r\n\t\t\tthis._pathRoot = L.Path.prototype._createElement('svg');\r\n\t\t\tthis._panes.overlayPane.appendChild(this._pathRoot);\r\n\r\n\t\t\tif (this.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\t\tL.DomUtil.addClass(this._pathRoot, 'leaflet-zoom-animated');\r\n\r\n\t\t\t\tthis.on({\r\n\t\t\t\t\t'zoomanim': this._animatePathZoom,\r\n\t\t\t\t\t'zoomend': this._endPathZoom\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tL.DomUtil.addClass(this._pathRoot, 'leaflet-zoom-hide');\r\n\t\t\t}\r\n\r\n\t\t\tthis.on('moveend', this._updateSvgViewport);\r\n\t\t\tthis._updateSvgViewport();\r\n\t\t}\r\n\t},\r\n\r\n\t_animatePathZoom: function (e) {\r\n\t\tvar scale = this.getZoomScale(e.zoom),\r\n\t\t    offset = this._getCenterOffset(e.center)._multiplyBy(-scale)._add(this._pathViewport.min);\r\n\r\n\t\tthis._pathRoot.style[L.DomUtil.TRANSFORM] =\r\n\t\t        L.DomUtil.getTranslateString(offset) + ' scale(' + scale + ') ';\r\n\r\n\t\tthis._pathZooming = true;\r\n\t},\r\n\r\n\t_endPathZoom: function () {\r\n\t\tthis._pathZooming = false;\r\n\t},\r\n\r\n\t_updateSvgViewport: function () {\r\n\r\n\t\tif (this._pathZooming) {\r\n\t\t\t// Do not update SVGs while a zoom animation is going on otherwise the animation will break.\r\n\t\t\t// When the zoom animation ends we will be updated again anyway\r\n\t\t\t// This fixes the case where you do a momentum move and zoom while the move is still ongoing.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._updatePathViewport();\r\n\r\n\t\tvar vp = this._pathViewport,\r\n\t\t    min = vp.min,\r\n\t\t    max = vp.max,\r\n\t\t    width = max.x - min.x,\r\n\t\t    height = max.y - min.y,\r\n\t\t    root = this._pathRoot,\r\n\t\t    pane = this._panes.overlayPane;\r\n\r\n\t\t// Hack to make flicker on drag end on mobile webkit less irritating\r\n\t\tif (L.Browser.mobileWebkit) {\r\n\t\t\tpane.removeChild(root);\r\n\t\t}\r\n\r\n\t\tL.DomUtil.setPosition(root, min);\r\n\t\troot.setAttribute('width', width);\r\n\t\troot.setAttribute('height', height);\r\n\t\troot.setAttribute('viewBox', [min.x, min.y, width, height].join(' '));\r\n\r\n\t\tif (L.Browser.mobileWebkit) {\r\n\t\t\tpane.appendChild(root);\r\n\t\t}\r\n\t}\r\n});\r\n\n\n/*\r\n * Popup extension to L.Path (polylines, polygons, circles), adding popup-related methods.\r\n */\r\n\r\nL.Path.include({\r\n\r\n\tbindPopup: function (content, options) {\r\n\r\n\t\tif (content instanceof L.Popup) {\r\n\t\t\tthis._popup = content;\r\n\t\t} else {\r\n\t\t\tif (!this._popup || options) {\r\n\t\t\t\tthis._popup = new L.Popup(options, this);\r\n\t\t\t}\r\n\t\t\tthis._popup.setContent(content);\r\n\t\t}\r\n\r\n\t\tif (!this._popupHandlersAdded) {\r\n\t\t\tthis\r\n\t\t\t    .on('click', this._openPopup, this)\r\n\t\t\t    .on('remove', this.closePopup, this);\r\n\r\n\t\t\tthis._popupHandlersAdded = true;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tunbindPopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup = null;\r\n\t\t\tthis\r\n\t\t\t    .off('click', this._openPopup)\r\n\t\t\t    .off('remove', this.closePopup);\r\n\r\n\t\t\tthis._popupHandlersAdded = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\topenPopup: function (latlng) {\r\n\r\n\t\tif (this._popup) {\r\n\t\t\t// open the popup from one of the path's points if not specified\r\n\t\t\tlatlng = latlng || this._latlng ||\r\n\t\t\t         this._latlngs[Math.floor(this._latlngs.length / 2)];\r\n\r\n\t\t\tthis._openPopup({latlng: latlng});\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclosePopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup._close();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_openPopup: function (e) {\r\n\t\tthis._popup.setLatLng(e.latlng);\r\n\t\tthis._map.openPopup(this._popup);\r\n\t}\r\n});\r\n\n\n/*\r\n * Vector rendering for IE6-8 through VML.\r\n * Thanks to Dmitry Baranovsky and his Raphael library for inspiration!\r\n */\r\n\r\nL.Browser.vml = !L.Browser.svg && (function () {\r\n\ttry {\r\n\t\tvar div = document.createElement('div');\r\n\t\tdiv.innerHTML = '<v:shape adj=\"1\"/>';\r\n\r\n\t\tvar shape = div.firstChild;\r\n\t\tshape.style.behavior = 'url(#default#VML)';\r\n\r\n\t\treturn shape && (typeof shape.adj === 'object');\r\n\r\n\t} catch (e) {\r\n\t\treturn false;\r\n\t}\r\n}());\r\n\r\nL.Path = L.Browser.svg || !L.Browser.vml ? L.Path : L.Path.extend({\r\n\tstatics: {\r\n\t\tVML: true,\r\n\t\tCLIP_PADDING: 0.02\r\n\t},\r\n\r\n\t_createElement: (function () {\r\n\t\ttry {\r\n\t\t\tdocument.namespaces.add('lvml', 'urn:schemas-microsoft-com:vml');\r\n\t\t\treturn function (name) {\r\n\t\t\t\treturn document.createElement('<lvml:' + name + ' class=\"lvml\">');\r\n\t\t\t};\r\n\t\t} catch (e) {\r\n\t\t\treturn function (name) {\r\n\t\t\t\treturn document.createElement(\r\n\t\t\t\t        '<' + name + ' xmlns=\"urn:schemas-microsoft.com:vml\" class=\"lvml\">');\r\n\t\t\t};\r\n\t\t}\r\n\t}()),\r\n\r\n\t_initPath: function () {\r\n\t\tvar container = this._container = this._createElement('shape');\r\n\r\n\t\tL.DomUtil.addClass(container, 'leaflet-vml-shape' +\r\n\t\t\t(this.options.className ? ' ' + this.options.className : ''));\r\n\r\n\t\tif (this.options.clickable) {\r\n\t\t\tL.DomUtil.addClass(container, 'leaflet-clickable');\r\n\t\t}\r\n\r\n\t\tcontainer.coordsize = '1 1';\r\n\r\n\t\tthis._path = this._createElement('path');\r\n\t\tcontainer.appendChild(this._path);\r\n\r\n\t\tthis._map._pathRoot.appendChild(container);\r\n\t},\r\n\r\n\t_initStyle: function () {\r\n\t\tthis._updateStyle();\r\n\t},\r\n\r\n\t_updateStyle: function () {\r\n\t\tvar stroke = this._stroke,\r\n\t\t    fill = this._fill,\r\n\t\t    options = this.options,\r\n\t\t    container = this._container;\r\n\r\n\t\tcontainer.stroked = options.stroke;\r\n\t\tcontainer.filled = options.fill;\r\n\r\n\t\tif (options.stroke) {\r\n\t\t\tif (!stroke) {\r\n\t\t\t\tstroke = this._stroke = this._createElement('stroke');\r\n\t\t\t\tstroke.endcap = 'round';\r\n\t\t\t\tcontainer.appendChild(stroke);\r\n\t\t\t}\r\n\t\t\tstroke.weight = options.weight + 'px';\r\n\t\t\tstroke.color = options.color;\r\n\t\t\tstroke.opacity = options.opacity;\r\n\r\n\t\t\tif (options.dashArray) {\r\n\t\t\t\tstroke.dashStyle = L.Util.isArray(options.dashArray) ?\r\n\t\t\t\t    options.dashArray.join(' ') :\r\n\t\t\t\t    options.dashArray.replace(/( *, *)/g, ' ');\r\n\t\t\t} else {\r\n\t\t\t\tstroke.dashStyle = '';\r\n\t\t\t}\r\n\t\t\tif (options.lineCap) {\r\n\t\t\t\tstroke.endcap = options.lineCap.replace('butt', 'flat');\r\n\t\t\t}\r\n\t\t\tif (options.lineJoin) {\r\n\t\t\t\tstroke.joinstyle = options.lineJoin;\r\n\t\t\t}\r\n\r\n\t\t} else if (stroke) {\r\n\t\t\tcontainer.removeChild(stroke);\r\n\t\t\tthis._stroke = null;\r\n\t\t}\r\n\r\n\t\tif (options.fill) {\r\n\t\t\tif (!fill) {\r\n\t\t\t\tfill = this._fill = this._createElement('fill');\r\n\t\t\t\tcontainer.appendChild(fill);\r\n\t\t\t}\r\n\t\t\tfill.color = options.fillColor || options.color;\r\n\t\t\tfill.opacity = options.fillOpacity;\r\n\r\n\t\t} else if (fill) {\r\n\t\t\tcontainer.removeChild(fill);\r\n\t\t\tthis._fill = null;\r\n\t\t}\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tvar style = this._container.style;\r\n\r\n\t\tstyle.display = 'none';\r\n\t\tthis._path.v = this.getPathString() + ' '; // the space fixes IE empty path string bug\r\n\t\tstyle.display = '';\r\n\t}\r\n});\r\n\r\nL.Map.include(L.Browser.svg || !L.Browser.vml ? {} : {\r\n\t_initPathRoot: function () {\r\n\t\tif (this._pathRoot) { return; }\r\n\r\n\t\tvar root = this._pathRoot = document.createElement('div');\r\n\t\troot.className = 'leaflet-vml-container';\r\n\t\tthis._panes.overlayPane.appendChild(root);\r\n\r\n\t\tthis.on('moveend', this._updatePathViewport);\r\n\t\tthis._updatePathViewport();\r\n\t}\r\n});\r\n\n\n/*\r\n * Vector rendering for all browsers that support canvas.\r\n */\r\n\r\nL.Browser.canvas = (function () {\r\n\treturn !!document.createElement('canvas').getContext;\r\n}());\r\n\r\nL.Path = (L.Path.SVG && !window.L_PREFER_CANVAS) || !L.Browser.canvas ? L.Path : L.Path.extend({\r\n\tstatics: {\r\n\t\t//CLIP_PADDING: 0.02, // not sure if there's a need to set it to a small value\r\n\t\tCANVAS: true,\r\n\t\tSVG: false\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis.projectLatlngs();\r\n\t\t\tthis._requestUpdate();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\tL.setOptions(this, style);\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._updateStyle();\r\n\t\t\tthis._requestUpdate();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap\r\n\t\t    .off('viewreset', this.projectLatlngs, this)\r\n\t\t    .off('moveend', this._updatePath, this);\r\n\r\n\t\tif (this.options.clickable) {\r\n\t\t\tthis._map.off('click', this._onClick, this);\r\n\t\t\tthis._map.off('mousemove', this._onMouseMove, this);\r\n\t\t}\r\n\r\n\t\tthis._requestUpdate();\r\n\t\t\r\n\t\tthis.fire('remove');\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\t_requestUpdate: function () {\r\n\t\tif (this._map && !L.Path._updateRequest) {\r\n\t\t\tL.Path._updateRequest = L.Util.requestAnimFrame(this._fireMapMoveEnd, this._map);\r\n\t\t}\r\n\t},\r\n\r\n\t_fireMapMoveEnd: function () {\r\n\t\tL.Path._updateRequest = null;\r\n\t\tthis.fire('moveend');\r\n\t},\r\n\r\n\t_initElements: function () {\r\n\t\tthis._map._initPathRoot();\r\n\t\tthis._ctx = this._map._canvasCtx;\r\n\t},\r\n\r\n\t_updateStyle: function () {\r\n\t\tvar options = this.options;\r\n\r\n\t\tif (options.stroke) {\r\n\t\t\tthis._ctx.lineWidth = options.weight;\r\n\t\t\tthis._ctx.strokeStyle = options.color;\r\n\t\t}\r\n\t\tif (options.fill) {\r\n\t\t\tthis._ctx.fillStyle = options.fillColor || options.color;\r\n\t\t}\r\n\r\n\t\tif (options.lineCap) {\r\n\t\t\tthis._ctx.lineCap = options.lineCap;\r\n\t\t}\r\n\t\tif (options.lineJoin) {\r\n\t\t\tthis._ctx.lineJoin = options.lineJoin;\r\n\t\t}\r\n\t},\r\n\r\n\t_drawPath: function () {\r\n\t\tvar i, j, len, len2, point, drawMethod;\r\n\r\n\t\tthis._ctx.beginPath();\r\n\r\n\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tfor (j = 0, len2 = this._parts[i].length; j < len2; j++) {\r\n\t\t\t\tpoint = this._parts[i][j];\r\n\t\t\t\tdrawMethod = (j === 0 ? 'move' : 'line') + 'To';\r\n\r\n\t\t\t\tthis._ctx[drawMethod](point.x, point.y);\r\n\t\t\t}\r\n\t\t\t// TODO refactor ugly hack\r\n\t\t\tif (this instanceof L.Polygon) {\r\n\t\t\t\tthis._ctx.closePath();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_checkIfEmpty: function () {\r\n\t\treturn !this._parts.length;\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tif (this._checkIfEmpty()) { return; }\r\n\r\n\t\tvar ctx = this._ctx,\r\n\t\t    options = this.options;\r\n\r\n\t\tthis._drawPath();\r\n\t\tctx.save();\r\n\t\tthis._updateStyle();\r\n\r\n\t\tif (options.fill) {\r\n\t\t\tctx.globalAlpha = options.fillOpacity;\r\n\t\t\tctx.fill(options.fillRule || 'evenodd');\r\n\t\t}\r\n\r\n\t\tif (options.stroke) {\r\n\t\t\tctx.globalAlpha = options.opacity;\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\r\n\t\tctx.restore();\r\n\r\n\t\t// TODO optimization: 1 fill/stroke for all features with equal style instead of 1 for each feature\r\n\t},\r\n\r\n\t_initEvents: function () {\r\n\t\tif (this.options.clickable) {\r\n\t\t\tthis._map.on('mousemove', this._onMouseMove, this);\r\n\t\t\tthis._map.on('click dblclick contextmenu', this._fireMouseEvent, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_fireMouseEvent: function (e) {\r\n\t\tif (this._containsPoint(e.layerPoint)) {\r\n\t\t\tthis.fire(e.type, e);\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseMove: function (e) {\r\n\t\tif (!this._map || this._map._animatingZoom) { return; }\r\n\r\n\t\t// TODO don't do on each move\r\n\t\tif (this._containsPoint(e.layerPoint)) {\r\n\t\t\tthis._ctx.canvas.style.cursor = 'pointer';\r\n\t\t\tthis._mouseInside = true;\r\n\t\t\tthis.fire('mouseover', e);\r\n\r\n\t\t} else if (this._mouseInside) {\r\n\t\t\tthis._ctx.canvas.style.cursor = '';\r\n\t\t\tthis._mouseInside = false;\r\n\t\t\tthis.fire('mouseout', e);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.include((L.Path.SVG && !window.L_PREFER_CANVAS) || !L.Browser.canvas ? {} : {\r\n\t_initPathRoot: function () {\r\n\t\tvar root = this._pathRoot,\r\n\t\t    ctx;\r\n\r\n\t\tif (!root) {\r\n\t\t\troot = this._pathRoot = document.createElement('canvas');\r\n\t\t\troot.style.position = 'absolute';\r\n\t\t\tctx = this._canvasCtx = root.getContext('2d');\r\n\r\n\t\t\tctx.lineCap = 'round';\r\n\t\t\tctx.lineJoin = 'round';\r\n\r\n\t\t\tthis._panes.overlayPane.appendChild(root);\r\n\r\n\t\t\tif (this.options.zoomAnimation) {\r\n\t\t\t\tthis._pathRoot.className = 'leaflet-zoom-animated';\r\n\t\t\t\tthis.on('zoomanim', this._animatePathZoom);\r\n\t\t\t\tthis.on('zoomend', this._endPathZoom);\r\n\t\t\t}\r\n\t\t\tthis.on('moveend', this._updateCanvasViewport);\r\n\t\t\tthis._updateCanvasViewport();\r\n\t\t}\r\n\t},\r\n\r\n\t_updateCanvasViewport: function () {\r\n\t\t// don't redraw while zooming. See _updateSvgViewport for more details\r\n\t\tif (this._pathZooming) { return; }\r\n\t\tthis._updatePathViewport();\r\n\r\n\t\tvar vp = this._pathViewport,\r\n\t\t    min = vp.min,\r\n\t\t    size = vp.max.subtract(min),\r\n\t\t    root = this._pathRoot;\r\n\r\n\t\t//TODO check if this works properly on mobile webkit\r\n\t\tL.DomUtil.setPosition(root, min);\r\n\t\troot.width = size.x;\r\n\t\troot.height = size.y;\r\n\t\troot.getContext('2d').translate(-min.x, -min.y);\r\n\t}\r\n});\r\n\n\n/*\r\n * L.LineUtil contains different utility functions for line segments\r\n * and polylines (clipping, simplification, distances, etc.)\r\n */\r\n\r\n/*jshint bitwise:false */ // allow bitwise operations for this file\r\n\r\nL.LineUtil = {\r\n\r\n\t// Simplify polyline with vertex reduction and Douglas-Peucker simplification.\r\n\t// Improves rendering performance dramatically by lessening the number of points to draw.\r\n\r\n\tsimplify: function (/*Point[]*/ points, /*Number*/ tolerance) {\r\n\t\tif (!tolerance || !points.length) {\r\n\t\t\treturn points.slice();\r\n\t\t}\r\n\r\n\t\tvar sqTolerance = tolerance * tolerance;\r\n\r\n\t\t// stage 1: vertex reduction\r\n\t\tpoints = this._reducePoints(points, sqTolerance);\r\n\r\n\t\t// stage 2: Douglas-Peucker simplification\r\n\t\tpoints = this._simplifyDP(points, sqTolerance);\r\n\r\n\t\treturn points;\r\n\t},\r\n\r\n\t// distance from a point to a segment between two points\r\n\tpointToSegmentDistance:  function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {\r\n\t\treturn Math.sqrt(this._sqClosestPointOnSegment(p, p1, p2, true));\r\n\t},\r\n\r\n\tclosestPointOnSegment: function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {\r\n\t\treturn this._sqClosestPointOnSegment(p, p1, p2);\r\n\t},\r\n\r\n\t// Douglas-Peucker simplification, see http://en.wikipedia.org/wiki/Douglas-Peucker_algorithm\r\n\t_simplifyDP: function (points, sqTolerance) {\r\n\r\n\t\tvar len = points.length,\r\n\t\t    ArrayConstructor = typeof Uint8Array !== undefined + '' ? Uint8Array : Array,\r\n\t\t    markers = new ArrayConstructor(len);\r\n\r\n\t\tmarkers[0] = markers[len - 1] = 1;\r\n\r\n\t\tthis._simplifyDPStep(points, markers, sqTolerance, 0, len - 1);\r\n\r\n\t\tvar i,\r\n\t\t    newPoints = [];\r\n\r\n\t\tfor (i = 0; i < len; i++) {\r\n\t\t\tif (markers[i]) {\r\n\t\t\t\tnewPoints.push(points[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn newPoints;\r\n\t},\r\n\r\n\t_simplifyDPStep: function (points, markers, sqTolerance, first, last) {\r\n\r\n\t\tvar maxSqDist = 0,\r\n\t\t    index, i, sqDist;\r\n\r\n\t\tfor (i = first + 1; i <= last - 1; i++) {\r\n\t\t\tsqDist = this._sqClosestPointOnSegment(points[i], points[first], points[last], true);\r\n\r\n\t\t\tif (sqDist > maxSqDist) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tmaxSqDist = sqDist;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (maxSqDist > sqTolerance) {\r\n\t\t\tmarkers[index] = 1;\r\n\r\n\t\t\tthis._simplifyDPStep(points, markers, sqTolerance, first, index);\r\n\t\t\tthis._simplifyDPStep(points, markers, sqTolerance, index, last);\r\n\t\t}\r\n\t},\r\n\r\n\t// reduce points that are too close to each other to a single point\r\n\t_reducePoints: function (points, sqTolerance) {\r\n\t\tvar reducedPoints = [points[0]];\r\n\r\n\t\tfor (var i = 1, prev = 0, len = points.length; i < len; i++) {\r\n\t\t\tif (this._sqDist(points[i], points[prev]) > sqTolerance) {\r\n\t\t\t\treducedPoints.push(points[i]);\r\n\t\t\t\tprev = i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (prev < len - 1) {\r\n\t\t\treducedPoints.push(points[len - 1]);\r\n\t\t}\r\n\t\treturn reducedPoints;\r\n\t},\r\n\r\n\t// Cohen-Sutherland line clipping algorithm.\r\n\t// Used to avoid rendering parts of a polyline that are not currently visible.\r\n\r\n\tclipSegment: function (a, b, bounds, useLastCode) {\r\n\t\tvar codeA = useLastCode ? this._lastCode : this._getBitCode(a, bounds),\r\n\t\t    codeB = this._getBitCode(b, bounds),\r\n\r\n\t\t    codeOut, p, newCode;\r\n\r\n\t\t// save 2nd code to avoid calculating it on the next segment\r\n\t\tthis._lastCode = codeB;\r\n\r\n\t\twhile (true) {\r\n\t\t\t// if a,b is inside the clip window (trivial accept)\r\n\t\t\tif (!(codeA | codeB)) {\r\n\t\t\t\treturn [a, b];\r\n\t\t\t// if a,b is outside the clip window (trivial reject)\r\n\t\t\t} else if (codeA & codeB) {\r\n\t\t\t\treturn false;\r\n\t\t\t// other cases\r\n\t\t\t} else {\r\n\t\t\t\tcodeOut = codeA || codeB;\r\n\t\t\t\tp = this._getEdgeIntersection(a, b, codeOut, bounds);\r\n\t\t\t\tnewCode = this._getBitCode(p, bounds);\r\n\r\n\t\t\t\tif (codeOut === codeA) {\r\n\t\t\t\t\ta = p;\r\n\t\t\t\t\tcodeA = newCode;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tb = p;\r\n\t\t\t\t\tcodeB = newCode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_getEdgeIntersection: function (a, b, code, bounds) {\r\n\t\tvar dx = b.x - a.x,\r\n\t\t    dy = b.y - a.y,\r\n\t\t    min = bounds.min,\r\n\t\t    max = bounds.max;\r\n\r\n\t\tif (code & 8) { // top\r\n\t\t\treturn new L.Point(a.x + dx * (max.y - a.y) / dy, max.y);\r\n\t\t} else if (code & 4) { // bottom\r\n\t\t\treturn new L.Point(a.x + dx * (min.y - a.y) / dy, min.y);\r\n\t\t} else if (code & 2) { // right\r\n\t\t\treturn new L.Point(max.x, a.y + dy * (max.x - a.x) / dx);\r\n\t\t} else if (code & 1) { // left\r\n\t\t\treturn new L.Point(min.x, a.y + dy * (min.x - a.x) / dx);\r\n\t\t}\r\n\t},\r\n\r\n\t_getBitCode: function (/*Point*/ p, bounds) {\r\n\t\tvar code = 0;\r\n\r\n\t\tif (p.x < bounds.min.x) { // left\r\n\t\t\tcode |= 1;\r\n\t\t} else if (p.x > bounds.max.x) { // right\r\n\t\t\tcode |= 2;\r\n\t\t}\r\n\t\tif (p.y < bounds.min.y) { // bottom\r\n\t\t\tcode |= 4;\r\n\t\t} else if (p.y > bounds.max.y) { // top\r\n\t\t\tcode |= 8;\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t},\r\n\r\n\t// square distance (to avoid unnecessary Math.sqrt calls)\r\n\t_sqDist: function (p1, p2) {\r\n\t\tvar dx = p2.x - p1.x,\r\n\t\t    dy = p2.y - p1.y;\r\n\t\treturn dx * dx + dy * dy;\r\n\t},\r\n\r\n\t// return closest point on segment or distance to that point\r\n\t_sqClosestPointOnSegment: function (p, p1, p2, sqDist) {\r\n\t\tvar x = p1.x,\r\n\t\t    y = p1.y,\r\n\t\t    dx = p2.x - x,\r\n\t\t    dy = p2.y - y,\r\n\t\t    dot = dx * dx + dy * dy,\r\n\t\t    t;\r\n\r\n\t\tif (dot > 0) {\r\n\t\t\tt = ((p.x - x) * dx + (p.y - y) * dy) / dot;\r\n\r\n\t\t\tif (t > 1) {\r\n\t\t\t\tx = p2.x;\r\n\t\t\t\ty = p2.y;\r\n\t\t\t} else if (t > 0) {\r\n\t\t\t\tx += dx * t;\r\n\t\t\t\ty += dy * t;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdx = p.x - x;\r\n\t\tdy = p.y - y;\r\n\r\n\t\treturn sqDist ? dx * dx + dy * dy : new L.Point(x, y);\r\n\t}\r\n};\r\n\n\n/*\r\n * L.Polyline is used to display polylines on a map.\r\n */\r\n\r\nL.Polyline = L.Path.extend({\r\n\tinitialize: function (latlngs, options) {\r\n\t\tL.Path.prototype.initialize.call(this, options);\r\n\r\n\t\tthis._latlngs = this._convertLatLngs(latlngs);\r\n\t},\r\n\r\n\toptions: {\r\n\t\t// how much to simplify the polyline on each zoom level\r\n\t\t// more = better performance and smoother look, less = more accurate\r\n\t\tsmoothFactor: 1.0,\r\n\t\tnoClip: false\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tthis._originalPoints = [];\r\n\r\n\t\tfor (var i = 0, len = this._latlngs.length; i < len; i++) {\r\n\t\t\tthis._originalPoints[i] = this._map.latLngToLayerPoint(this._latlngs[i]);\r\n\t\t}\r\n\t},\r\n\r\n\tgetPathString: function () {\r\n\t\tfor (var i = 0, len = this._parts.length, str = ''; i < len; i++) {\r\n\t\t\tstr += this._getPathPartStr(this._parts[i]);\r\n\t\t}\r\n\t\treturn str;\r\n\t},\r\n\r\n\tgetLatLngs: function () {\r\n\t\treturn this._latlngs;\r\n\t},\r\n\r\n\tsetLatLngs: function (latlngs) {\r\n\t\tthis._latlngs = this._convertLatLngs(latlngs);\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\taddLatLng: function (latlng) {\r\n\t\tthis._latlngs.push(L.latLng(latlng));\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tspliceLatLngs: function () { // (Number index, Number howMany)\r\n\t\tvar removed = [].splice.apply(this._latlngs, arguments);\r\n\t\tthis._convertLatLngs(this._latlngs, true);\r\n\t\tthis.redraw();\r\n\t\treturn removed;\r\n\t},\r\n\r\n\tclosestLayerPoint: function (p) {\r\n\t\tvar minDistance = Infinity, parts = this._parts, p1, p2, minPoint = null;\r\n\r\n\t\tfor (var j = 0, jLen = parts.length; j < jLen; j++) {\r\n\t\t\tvar points = parts[j];\r\n\t\t\tfor (var i = 1, len = points.length; i < len; i++) {\r\n\t\t\t\tp1 = points[i - 1];\r\n\t\t\t\tp2 = points[i];\r\n\t\t\t\tvar sqDist = L.LineUtil._sqClosestPointOnSegment(p, p1, p2, true);\r\n\t\t\t\tif (sqDist < minDistance) {\r\n\t\t\t\t\tminDistance = sqDist;\r\n\t\t\t\t\tminPoint = L.LineUtil._sqClosestPointOnSegment(p, p1, p2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (minPoint) {\r\n\t\t\tminPoint.distance = Math.sqrt(minDistance);\r\n\t\t}\r\n\t\treturn minPoint;\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\treturn new L.LatLngBounds(this.getLatLngs());\r\n\t},\r\n\r\n\t_convertLatLngs: function (latlngs, overwrite) {\r\n\t\tvar i, len, target = overwrite ? latlngs : [];\r\n\r\n\t\tfor (i = 0, len = latlngs.length; i < len; i++) {\r\n\t\t\tif (L.Util.isArray(latlngs[i]) && typeof latlngs[i][0] !== 'number') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\ttarget[i] = L.latLng(latlngs[i]);\r\n\t\t}\r\n\t\treturn target;\r\n\t},\r\n\r\n\t_initEvents: function () {\r\n\t\tL.Path.prototype._initEvents.call(this);\r\n\t},\r\n\r\n\t_getPathPartStr: function (points) {\r\n\t\tvar round = L.Path.VML;\r\n\r\n\t\tfor (var j = 0, len2 = points.length, str = '', p; j < len2; j++) {\r\n\t\t\tp = points[j];\r\n\t\t\tif (round) {\r\n\t\t\t\tp._round();\r\n\t\t\t}\r\n\t\t\tstr += (j ? 'L' : 'M') + p.x + ' ' + p.y;\r\n\t\t}\r\n\t\treturn str;\r\n\t},\r\n\r\n\t_clipPoints: function () {\r\n\t\tvar points = this._originalPoints,\r\n\t\t    len = points.length,\r\n\t\t    i, k, segment;\r\n\r\n\t\tif (this.options.noClip) {\r\n\t\t\tthis._parts = [points];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._parts = [];\r\n\r\n\t\tvar parts = this._parts,\r\n\t\t    vp = this._map._pathViewport,\r\n\t\t    lu = L.LineUtil;\r\n\r\n\t\tfor (i = 0, k = 0; i < len - 1; i++) {\r\n\t\t\tsegment = lu.clipSegment(points[i], points[i + 1], vp, i);\r\n\t\t\tif (!segment) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tparts[k] = parts[k] || [];\r\n\t\t\tparts[k].push(segment[0]);\r\n\r\n\t\t\t// if segment goes out of screen, or it's the last one, it's the end of the line part\r\n\t\t\tif ((segment[1] !== points[i + 1]) || (i === len - 2)) {\r\n\t\t\t\tparts[k].push(segment[1]);\r\n\t\t\t\tk++;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// simplify each clipped part of the polyline\r\n\t_simplifyPoints: function () {\r\n\t\tvar parts = this._parts,\r\n\t\t    lu = L.LineUtil;\r\n\r\n\t\tfor (var i = 0, len = parts.length; i < len; i++) {\r\n\t\t\tparts[i] = lu.simplify(parts[i], this.options.smoothFactor);\r\n\t\t}\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tthis._clipPoints();\r\n\t\tthis._simplifyPoints();\r\n\r\n\t\tL.Path.prototype._updatePath.call(this);\r\n\t}\r\n});\r\n\r\nL.polyline = function (latlngs, options) {\r\n\treturn new L.Polyline(latlngs, options);\r\n};\r\n\n\n/*\r\n * L.PolyUtil contains utility functions for polygons (clipping, etc.).\r\n */\r\n\r\n/*jshint bitwise:false */ // allow bitwise operations here\r\n\r\nL.PolyUtil = {};\r\n\r\n/*\r\n * Sutherland-Hodgeman polygon clipping algorithm.\r\n * Used to avoid rendering parts of a polygon that are not currently visible.\r\n */\r\nL.PolyUtil.clipPolygon = function (points, bounds) {\r\n\tvar clippedPoints,\r\n\t    edges = [1, 4, 2, 8],\r\n\t    i, j, k,\r\n\t    a, b,\r\n\t    len, edge, p,\r\n\t    lu = L.LineUtil;\r\n\r\n\tfor (i = 0, len = points.length; i < len; i++) {\r\n\t\tpoints[i]._code = lu._getBitCode(points[i], bounds);\r\n\t}\r\n\r\n\t// for each edge (left, bottom, right, top)\r\n\tfor (k = 0; k < 4; k++) {\r\n\t\tedge = edges[k];\r\n\t\tclippedPoints = [];\r\n\r\n\t\tfor (i = 0, len = points.length, j = len - 1; i < len; j = i++) {\r\n\t\t\ta = points[i];\r\n\t\t\tb = points[j];\r\n\r\n\t\t\t// if a is inside the clip window\r\n\t\t\tif (!(a._code & edge)) {\r\n\t\t\t\t// if b is outside the clip window (a->b goes out of screen)\r\n\t\t\t\tif (b._code & edge) {\r\n\t\t\t\t\tp = lu._getEdgeIntersection(b, a, edge, bounds);\r\n\t\t\t\t\tp._code = lu._getBitCode(p, bounds);\r\n\t\t\t\t\tclippedPoints.push(p);\r\n\t\t\t\t}\r\n\t\t\t\tclippedPoints.push(a);\r\n\r\n\t\t\t// else if b is inside the clip window (a->b enters the screen)\r\n\t\t\t} else if (!(b._code & edge)) {\r\n\t\t\t\tp = lu._getEdgeIntersection(b, a, edge, bounds);\r\n\t\t\t\tp._code = lu._getBitCode(p, bounds);\r\n\t\t\t\tclippedPoints.push(p);\r\n\t\t\t}\r\n\t\t}\r\n\t\tpoints = clippedPoints;\r\n\t}\r\n\r\n\treturn points;\r\n};\r\n\n\n/*\r\n * L.Polygon is used to display polygons on a map.\r\n */\r\n\r\nL.Polygon = L.Polyline.extend({\r\n\toptions: {\r\n\t\tfill: true\r\n\t},\r\n\r\n\tinitialize: function (latlngs, options) {\r\n\t\tL.Polyline.prototype.initialize.call(this, latlngs, options);\r\n\t\tthis._initWithHoles(latlngs);\r\n\t},\r\n\r\n\t_initWithHoles: function (latlngs) {\r\n\t\tvar i, len, hole;\r\n\t\tif (latlngs && L.Util.isArray(latlngs[0]) && (typeof latlngs[0][0] !== 'number')) {\r\n\t\t\tthis._latlngs = this._convertLatLngs(latlngs[0]);\r\n\t\t\tthis._holes = latlngs.slice(1);\r\n\r\n\t\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\t\thole = this._holes[i] = this._convertLatLngs(this._holes[i]);\r\n\t\t\t\tif (hole[0].equals(hole[hole.length - 1])) {\r\n\t\t\t\t\thole.pop();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// filter out last point if its equal to the first one\r\n\t\tlatlngs = this._latlngs;\r\n\r\n\t\tif (latlngs.length >= 2 && latlngs[0].equals(latlngs[latlngs.length - 1])) {\r\n\t\t\tlatlngs.pop();\r\n\t\t}\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tL.Polyline.prototype.projectLatlngs.call(this);\r\n\r\n\t\t// project polygon holes points\r\n\t\t// TODO move this logic to Polyline to get rid of duplication\r\n\t\tthis._holePoints = [];\r\n\r\n\t\tif (!this._holes) { return; }\r\n\r\n\t\tvar i, j, len, len2;\r\n\r\n\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\tthis._holePoints[i] = [];\r\n\r\n\t\t\tfor (j = 0, len2 = this._holes[i].length; j < len2; j++) {\r\n\t\t\t\tthis._holePoints[i][j] = this._map.latLngToLayerPoint(this._holes[i][j]);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tsetLatLngs: function (latlngs) {\r\n\t\tif (latlngs && L.Util.isArray(latlngs[0]) && (typeof latlngs[0][0] !== 'number')) {\r\n\t\t\tthis._initWithHoles(latlngs);\r\n\t\t\treturn this.redraw();\r\n\t\t} else {\r\n\t\t\treturn L.Polyline.prototype.setLatLngs.call(this, latlngs);\r\n\t\t}\r\n\t},\r\n\r\n\t_clipPoints: function () {\r\n\t\tvar points = this._originalPoints,\r\n\t\t    newParts = [];\r\n\r\n\t\tthis._parts = [points].concat(this._holePoints);\r\n\r\n\t\tif (this.options.noClip) { return; }\r\n\r\n\t\tfor (var i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tvar clipped = L.PolyUtil.clipPolygon(this._parts[i], this._map._pathViewport);\r\n\t\t\tif (clipped.length) {\r\n\t\t\t\tnewParts.push(clipped);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._parts = newParts;\r\n\t},\r\n\r\n\t_getPathPartStr: function (points) {\r\n\t\tvar str = L.Polyline.prototype._getPathPartStr.call(this, points);\r\n\t\treturn str + (L.Browser.svg ? 'z' : 'x');\r\n\t}\r\n});\r\n\r\nL.polygon = function (latlngs, options) {\r\n\treturn new L.Polygon(latlngs, options);\r\n};\r\n\n\n/*\r\n * Contains L.MultiPolyline and L.MultiPolygon layers.\r\n */\r\n\r\n(function () {\r\n\tfunction createMulti(Klass) {\r\n\r\n\t\treturn L.FeatureGroup.extend({\r\n\r\n\t\t\tinitialize: function (latlngs, options) {\r\n\t\t\t\tthis._layers = {};\r\n\t\t\t\tthis._options = options;\r\n\t\t\t\tthis.setLatLngs(latlngs);\r\n\t\t\t},\r\n\r\n\t\t\tsetLatLngs: function (latlngs) {\r\n\t\t\t\tvar i = 0,\r\n\t\t\t\t    len = latlngs.length;\r\n\r\n\t\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\t\tif (i < len) {\r\n\t\t\t\t\t\tlayer.setLatLngs(latlngs[i++]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.removeLayer(layer);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this);\r\n\r\n\t\t\t\twhile (i < len) {\r\n\t\t\t\t\tthis.addLayer(new Klass(latlngs[i++], this._options));\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tgetLatLngs: function () {\r\n\t\t\t\tvar latlngs = [];\r\n\r\n\t\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\t\tlatlngs.push(layer.getLatLngs());\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn latlngs;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tL.MultiPolyline = createMulti(L.Polyline);\r\n\tL.MultiPolygon = createMulti(L.Polygon);\r\n\r\n\tL.multiPolyline = function (latlngs, options) {\r\n\t\treturn new L.MultiPolyline(latlngs, options);\r\n\t};\r\n\r\n\tL.multiPolygon = function (latlngs, options) {\r\n\t\treturn new L.MultiPolygon(latlngs, options);\r\n\t};\r\n}());\r\n\n\n/*\r\n * L.Rectangle extends Polygon and creates a rectangle when passed a LatLngBounds object.\r\n */\r\n\r\nL.Rectangle = L.Polygon.extend({\r\n\tinitialize: function (latLngBounds, options) {\r\n\t\tL.Polygon.prototype.initialize.call(this, this._boundsToLatLngs(latLngBounds), options);\r\n\t},\r\n\r\n\tsetBounds: function (latLngBounds) {\r\n\t\tthis.setLatLngs(this._boundsToLatLngs(latLngBounds));\r\n\t},\r\n\r\n\t_boundsToLatLngs: function (latLngBounds) {\r\n\t\tlatLngBounds = L.latLngBounds(latLngBounds);\r\n\t\treturn [\r\n\t\t\tlatLngBounds.getSouthWest(),\r\n\t\t\tlatLngBounds.getNorthWest(),\r\n\t\t\tlatLngBounds.getNorthEast(),\r\n\t\t\tlatLngBounds.getSouthEast()\r\n\t\t];\r\n\t}\r\n});\r\n\r\nL.rectangle = function (latLngBounds, options) {\r\n\treturn new L.Rectangle(latLngBounds, options);\r\n};\r\n\n\n/*\r\n * L.Circle is a circle overlay (with a certain radius in meters).\r\n */\r\n\r\nL.Circle = L.Path.extend({\r\n\tinitialize: function (latlng, radius, options) {\r\n\t\tL.Path.prototype.initialize.call(this, options);\r\n\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t\tthis._mRadius = radius;\r\n\t},\r\n\r\n\toptions: {\r\n\t\tfill: true\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tsetRadius: function (radius) {\r\n\t\tthis._mRadius = radius;\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tvar lngRadius = this._getLngRadius(),\r\n\t\t    latlng = this._latlng,\r\n\t\t    pointLeft = this._map.latLngToLayerPoint([latlng.lat, latlng.lng - lngRadius]);\r\n\r\n\t\tthis._point = this._map.latLngToLayerPoint(latlng);\r\n\t\tthis._radius = Math.max(this._point.x - pointLeft.x, 1);\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\tvar lngRadius = this._getLngRadius(),\r\n\t\t    latRadius = (this._mRadius / 40075017) * 360,\r\n\t\t    latlng = this._latlng;\r\n\r\n\t\treturn new L.LatLngBounds(\r\n\t\t        [latlng.lat - latRadius, latlng.lng - lngRadius],\r\n\t\t        [latlng.lat + latRadius, latlng.lng + lngRadius]);\r\n\t},\r\n\r\n\tgetLatLng: function () {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\tgetPathString: function () {\r\n\t\tvar p = this._point,\r\n\t\t    r = this._radius;\r\n\r\n\t\tif (this._checkIfEmpty()) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\tif (L.Browser.svg) {\r\n\t\t\treturn 'M' + p.x + ',' + (p.y - r) +\r\n\t\t\t       'A' + r + ',' + r + ',0,1,1,' +\r\n\t\t\t       (p.x - 0.1) + ',' + (p.y - r) + ' z';\r\n\t\t} else {\r\n\t\t\tp._round();\r\n\t\t\tr = Math.round(r);\r\n\t\t\treturn 'AL ' + p.x + ',' + p.y + ' ' + r + ',' + r + ' 0,' + (65535 * 360);\r\n\t\t}\r\n\t},\r\n\r\n\tgetRadius: function () {\r\n\t\treturn this._mRadius;\r\n\t},\r\n\r\n\t// TODO Earth hardcoded, move into projection code!\r\n\r\n\t_getLatRadius: function () {\r\n\t\treturn (this._mRadius / 40075017) * 360;\r\n\t},\r\n\r\n\t_getLngRadius: function () {\r\n\t\treturn this._getLatRadius() / Math.cos(L.LatLng.DEG_TO_RAD * this._latlng.lat);\r\n\t},\r\n\r\n\t_checkIfEmpty: function () {\r\n\t\tif (!this._map) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar vp = this._map._pathViewport,\r\n\t\t    r = this._radius,\r\n\t\t    p = this._point;\r\n\r\n\t\treturn p.x - r > vp.max.x || p.y - r > vp.max.y ||\r\n\t\t       p.x + r < vp.min.x || p.y + r < vp.min.y;\r\n\t}\r\n});\r\n\r\nL.circle = function (latlng, radius, options) {\r\n\treturn new L.Circle(latlng, radius, options);\r\n};\r\n\n\n/*\r\n * L.CircleMarker is a circle overlay with a permanent pixel radius.\r\n */\r\n\r\nL.CircleMarker = L.Circle.extend({\r\n\toptions: {\r\n\t\tradius: 10,\r\n\t\tweight: 2\r\n\t},\r\n\r\n\tinitialize: function (latlng, options) {\r\n\t\tL.Circle.prototype.initialize.call(this, latlng, null, options);\r\n\t\tthis._radius = this.options.radius;\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tthis._point = this._map.latLngToLayerPoint(this._latlng);\r\n\t},\r\n\r\n\t_updateStyle : function () {\r\n\t\tL.Circle.prototype._updateStyle.call(this);\r\n\t\tthis.setRadius(this.options.radius);\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tL.Circle.prototype.setLatLng.call(this, latlng);\r\n\t\tif (this._popup && this._popup._isOpen) {\r\n\t\t\tthis._popup.setLatLng(latlng);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetRadius: function (radius) {\r\n\t\tthis.options.radius = this._radius = radius;\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tgetRadius: function () {\r\n\t\treturn this._radius;\r\n\t}\r\n});\r\n\r\nL.circleMarker = function (latlng, options) {\r\n\treturn new L.CircleMarker(latlng, options);\r\n};\r\n\n\n/*\r\n * Extends L.Polyline to be able to manually detect clicks on Canvas-rendered polylines.\r\n */\r\n\r\nL.Polyline.include(!L.Path.CANVAS ? {} : {\r\n\t_containsPoint: function (p, closed) {\r\n\t\tvar i, j, k, len, len2, dist, part,\r\n\t\t    w = this.options.weight / 2;\r\n\r\n\t\tif (L.Browser.touch) {\r\n\t\t\tw += 10; // polyline click tolerance on touch devices\r\n\t\t}\r\n\r\n\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tpart = this._parts[i];\r\n\t\t\tfor (j = 0, len2 = part.length, k = len2 - 1; j < len2; k = j++) {\r\n\t\t\t\tif (!closed && (j === 0)) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdist = L.LineUtil.pointToSegmentDistance(p, part[k], part[j]);\r\n\r\n\t\t\t\tif (dist <= w) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n});\r\n\n\n/*\r\n * Extends L.Polygon to be able to manually detect clicks on Canvas-rendered polygons.\r\n */\r\n\r\nL.Polygon.include(!L.Path.CANVAS ? {} : {\r\n\t_containsPoint: function (p) {\r\n\t\tvar inside = false,\r\n\t\t    part, p1, p2,\r\n\t\t    i, j, k,\r\n\t\t    len, len2;\r\n\r\n\t\t// TODO optimization: check if within bounds first\r\n\r\n\t\tif (L.Polyline.prototype._containsPoint.call(this, p, true)) {\r\n\t\t\t// click on polygon border\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// ray casting algorithm for detecting if point is in polygon\r\n\r\n\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tpart = this._parts[i];\r\n\r\n\t\t\tfor (j = 0, len2 = part.length, k = len2 - 1; j < len2; k = j++) {\r\n\t\t\t\tp1 = part[j];\r\n\t\t\t\tp2 = part[k];\r\n\r\n\t\t\t\tif (((p1.y > p.y) !== (p2.y > p.y)) &&\r\n\t\t\t\t\t\t(p.x < (p2.x - p1.x) * (p.y - p1.y) / (p2.y - p1.y) + p1.x)) {\r\n\t\t\t\t\tinside = !inside;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn inside;\r\n\t}\r\n});\r\n\n\n/*\r\n * Extends L.Circle with Canvas-specific code.\r\n */\r\n\r\nL.Circle.include(!L.Path.CANVAS ? {} : {\r\n\t_drawPath: function () {\r\n\t\tvar p = this._point;\r\n\t\tthis._ctx.beginPath();\r\n\t\tthis._ctx.arc(p.x, p.y, this._radius, 0, Math.PI * 2, false);\r\n\t},\r\n\r\n\t_containsPoint: function (p) {\r\n\t\tvar center = this._point,\r\n\t\t    w2 = this.options.stroke ? this.options.weight / 2 : 0;\r\n\r\n\t\treturn (p.distanceTo(center) <= this._radius + w2);\r\n\t}\r\n});\r\n\n\n/*\n * CircleMarker canvas specific drawing parts.\n */\n\nL.CircleMarker.include(!L.Path.CANVAS ? {} : {\n\t_updateStyle: function () {\n\t\tL.Path.prototype._updateStyle.call(this);\n\t}\n});\n\n\n/*\r\n * L.GeoJSON turns any GeoJSON data into a Leaflet layer.\r\n */\r\n\r\nL.GeoJSON = L.FeatureGroup.extend({\r\n\r\n\tinitialize: function (geojson, options) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._layers = {};\r\n\r\n\t\tif (geojson) {\r\n\t\t\tthis.addData(geojson);\r\n\t\t}\r\n\t},\r\n\r\n\taddData: function (geojson) {\r\n\t\tvar features = L.Util.isArray(geojson) ? geojson : geojson.features,\r\n\t\t    i, len, feature;\r\n\r\n\t\tif (features) {\r\n\t\t\tfor (i = 0, len = features.length; i < len; i++) {\r\n\t\t\t\t// Only add this if geometry or geometries are set and not null\r\n\t\t\t\tfeature = features[i];\r\n\t\t\t\tif (feature.geometries || feature.geometry || feature.features || feature.coordinates) {\r\n\t\t\t\t\tthis.addData(features[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar options = this.options;\r\n\r\n\t\tif (options.filter && !options.filter(geojson)) { return; }\r\n\r\n\t\tvar layer = L.GeoJSON.geometryToLayer(geojson, options.pointToLayer, options.coordsToLatLng, options);\r\n\t\tlayer.feature = L.GeoJSON.asFeature(geojson);\r\n\r\n\t\tlayer.defaultOptions = layer.options;\r\n\t\tthis.resetStyle(layer);\r\n\r\n\t\tif (options.onEachFeature) {\r\n\t\t\toptions.onEachFeature(geojson, layer);\r\n\t\t}\r\n\r\n\t\treturn this.addLayer(layer);\r\n\t},\r\n\r\n\tresetStyle: function (layer) {\r\n\t\tvar style = this.options.style;\r\n\t\tif (style) {\r\n\t\t\t// reset any custom styles\r\n\t\t\tL.Util.extend(layer.options, layer.defaultOptions);\r\n\r\n\t\t\tthis._setLayerStyle(layer, style);\r\n\t\t}\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\tthis.eachLayer(function (layer) {\r\n\t\t\tthis._setLayerStyle(layer, style);\r\n\t\t}, this);\r\n\t},\r\n\r\n\t_setLayerStyle: function (layer, style) {\r\n\t\tif (typeof style === 'function') {\r\n\t\t\tstyle = style(layer.feature);\r\n\t\t}\r\n\t\tif (layer.setStyle) {\r\n\t\t\tlayer.setStyle(style);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.extend(L.GeoJSON, {\r\n\tgeometryToLayer: function (geojson, pointToLayer, coordsToLatLng, vectorOptions) {\r\n\t\tvar geometry = geojson.type === 'Feature' ? geojson.geometry : geojson,\r\n\t\t    coords = geometry.coordinates,\r\n\t\t    layers = [],\r\n\t\t    latlng, latlngs, i, len;\r\n\r\n\t\tcoordsToLatLng = coordsToLatLng || this.coordsToLatLng;\r\n\r\n\t\tswitch (geometry.type) {\r\n\t\tcase 'Point':\r\n\t\t\tlatlng = coordsToLatLng(coords);\r\n\t\t\treturn pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng);\r\n\r\n\t\tcase 'MultiPoint':\r\n\t\t\tfor (i = 0, len = coords.length; i < len; i++) {\r\n\t\t\t\tlatlng = coordsToLatLng(coords[i]);\r\n\t\t\t\tlayers.push(pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng));\r\n\t\t\t}\r\n\t\t\treturn new L.FeatureGroup(layers);\r\n\r\n\t\tcase 'LineString':\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 0, coordsToLatLng);\r\n\t\t\treturn new L.Polyline(latlngs, vectorOptions);\r\n\r\n\t\tcase 'Polygon':\r\n\t\t\tif (coords.length === 2 && !coords[1].length) {\r\n\t\t\t\tthrow new Error('Invalid GeoJSON object.');\r\n\t\t\t}\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 1, coordsToLatLng);\r\n\t\t\treturn new L.Polygon(latlngs, vectorOptions);\r\n\r\n\t\tcase 'MultiLineString':\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 1, coordsToLatLng);\r\n\t\t\treturn new L.MultiPolyline(latlngs, vectorOptions);\r\n\r\n\t\tcase 'MultiPolygon':\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 2, coordsToLatLng);\r\n\t\t\treturn new L.MultiPolygon(latlngs, vectorOptions);\r\n\r\n\t\tcase 'GeometryCollection':\r\n\t\t\tfor (i = 0, len = geometry.geometries.length; i < len; i++) {\r\n\r\n\t\t\t\tlayers.push(this.geometryToLayer({\r\n\t\t\t\t\tgeometry: geometry.geometries[i],\r\n\t\t\t\t\ttype: 'Feature',\r\n\t\t\t\t\tproperties: geojson.properties\r\n\t\t\t\t}, pointToLayer, coordsToLatLng, vectorOptions));\r\n\t\t\t}\r\n\t\t\treturn new L.FeatureGroup(layers);\r\n\r\n\t\tdefault:\r\n\t\t\tthrow new Error('Invalid GeoJSON object.');\r\n\t\t}\r\n\t},\r\n\r\n\tcoordsToLatLng: function (coords) { // (Array[, Boolean]) -> LatLng\r\n\t\treturn new L.LatLng(coords[1], coords[0], coords[2]);\r\n\t},\r\n\r\n\tcoordsToLatLngs: function (coords, levelsDeep, coordsToLatLng) { // (Array[, Number, Function]) -> Array\r\n\t\tvar latlng, i, len,\r\n\t\t    latlngs = [];\r\n\r\n\t\tfor (i = 0, len = coords.length; i < len; i++) {\r\n\t\t\tlatlng = levelsDeep ?\r\n\t\t\t        this.coordsToLatLngs(coords[i], levelsDeep - 1, coordsToLatLng) :\r\n\t\t\t        (coordsToLatLng || this.coordsToLatLng)(coords[i]);\r\n\r\n\t\t\tlatlngs.push(latlng);\r\n\t\t}\r\n\r\n\t\treturn latlngs;\r\n\t},\r\n\r\n\tlatLngToCoords: function (latlng) {\r\n\t\tvar coords = [latlng.lng, latlng.lat];\r\n\r\n\t\tif (latlng.alt !== undefined) {\r\n\t\t\tcoords.push(latlng.alt);\r\n\t\t}\r\n\t\treturn coords;\r\n\t},\r\n\r\n\tlatLngsToCoords: function (latLngs) {\r\n\t\tvar coords = [];\r\n\r\n\t\tfor (var i = 0, len = latLngs.length; i < len; i++) {\r\n\t\t\tcoords.push(L.GeoJSON.latLngToCoords(latLngs[i]));\r\n\t\t}\r\n\r\n\t\treturn coords;\r\n\t},\r\n\r\n\tgetFeature: function (layer, newGeometry) {\r\n\t\treturn layer.feature ? L.extend({}, layer.feature, {geometry: newGeometry}) : L.GeoJSON.asFeature(newGeometry);\r\n\t},\r\n\r\n\tasFeature: function (geoJSON) {\r\n\t\tif (geoJSON.type === 'Feature') {\r\n\t\t\treturn geoJSON;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttype: 'Feature',\r\n\t\t\tproperties: {},\r\n\t\t\tgeometry: geoJSON\r\n\t\t};\r\n\t}\r\n});\r\n\r\nvar PointToGeoJSON = {\r\n\ttoGeoJSON: function () {\r\n\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\ttype: 'Point',\r\n\t\t\tcoordinates: L.GeoJSON.latLngToCoords(this.getLatLng())\r\n\t\t});\r\n\t}\r\n};\r\n\r\nL.Marker.include(PointToGeoJSON);\r\nL.Circle.include(PointToGeoJSON);\r\nL.CircleMarker.include(PointToGeoJSON);\r\n\r\nL.Polyline.include({\r\n\ttoGeoJSON: function () {\r\n\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\ttype: 'LineString',\r\n\t\t\tcoordinates: L.GeoJSON.latLngsToCoords(this.getLatLngs())\r\n\t\t});\r\n\t}\r\n});\r\n\r\nL.Polygon.include({\r\n\ttoGeoJSON: function () {\r\n\t\tvar coords = [L.GeoJSON.latLngsToCoords(this.getLatLngs())],\r\n\t\t    i, len, hole;\r\n\r\n\t\tcoords[0].push(coords[0][0]);\r\n\r\n\t\tif (this._holes) {\r\n\t\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\t\thole = L.GeoJSON.latLngsToCoords(this._holes[i]);\r\n\t\t\t\thole.push(hole[0]);\r\n\t\t\t\tcoords.push(hole);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\ttype: 'Polygon',\r\n\t\t\tcoordinates: coords\r\n\t\t});\r\n\t}\r\n});\r\n\r\n(function () {\r\n\tfunction multiToGeoJSON(type) {\r\n\t\treturn function () {\r\n\t\t\tvar coords = [];\r\n\r\n\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\tcoords.push(layer.toGeoJSON().geometry.coordinates);\r\n\t\t\t});\r\n\r\n\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\ttype: type,\r\n\t\t\t\tcoordinates: coords\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\r\n\tL.MultiPolyline.include({toGeoJSON: multiToGeoJSON('MultiLineString')});\r\n\tL.MultiPolygon.include({toGeoJSON: multiToGeoJSON('MultiPolygon')});\r\n\r\n\tL.LayerGroup.include({\r\n\t\ttoGeoJSON: function () {\r\n\r\n\t\t\tvar geometry = this.feature && this.feature.geometry,\r\n\t\t\t\tjsons = [],\r\n\t\t\t\tjson;\r\n\r\n\t\t\tif (geometry && geometry.type === 'MultiPoint') {\r\n\t\t\t\treturn multiToGeoJSON('MultiPoint').call(this);\r\n\t\t\t}\r\n\r\n\t\t\tvar isGeometryCollection = geometry && geometry.type === 'GeometryCollection';\r\n\r\n\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\tif (layer.toGeoJSON) {\r\n\t\t\t\t\tjson = layer.toGeoJSON();\r\n\t\t\t\t\tjsons.push(isGeometryCollection ? json.geometry : L.GeoJSON.asFeature(json));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (isGeometryCollection) {\r\n\t\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\t\tgeometries: jsons,\r\n\t\t\t\t\ttype: 'GeometryCollection'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttype: 'FeatureCollection',\r\n\t\t\t\tfeatures: jsons\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n}());\r\n\r\nL.geoJson = function (geojson, options) {\r\n\treturn new L.GeoJSON(geojson, options);\r\n};\r\n\n\n/*\r\n * L.DomEvent contains functions for working with DOM events.\r\n */\r\n\r\nL.DomEvent = {\r\n\t/* inspired by John Resig, Dean Edwards and YUI addEvent implementations */\r\n\taddListener: function (obj, type, fn, context) { // (HTMLElement, String, Function[, Object])\r\n\r\n\t\tvar id = L.stamp(fn),\r\n\t\t    key = '_leaflet_' + type + id,\r\n\t\t    handler, originalHandler, newType;\r\n\r\n\t\tif (obj[key]) { return this; }\r\n\r\n\t\thandler = function (e) {\r\n\t\t\treturn fn.call(context || obj, e || L.DomEvent._getEvent());\r\n\t\t};\r\n\r\n\t\tif (L.Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t\treturn this.addPointerListener(obj, type, handler, id);\r\n\t\t}\r\n\t\tif (L.Browser.touch && (type === 'dblclick') && this.addDoubleTapListener) {\r\n\t\t\tthis.addDoubleTapListener(obj, handler, id);\r\n\t\t}\r\n\r\n\t\tif ('addEventListener' in obj) {\r\n\r\n\t\t\tif (type === 'mousewheel') {\r\n\t\t\t\tobj.addEventListener('DOMMouseScroll', handler, false);\r\n\t\t\t\tobj.addEventListener(type, handler, false);\r\n\r\n\t\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\r\n\t\t\t\toriginalHandler = handler;\r\n\t\t\t\tnewType = (type === 'mouseenter' ? 'mouseover' : 'mouseout');\r\n\r\n\t\t\t\thandler = function (e) {\r\n\t\t\t\t\tif (!L.DomEvent._checkMouse(obj, e)) { return; }\r\n\t\t\t\t\treturn originalHandler(e);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tobj.addEventListener(newType, handler, false);\r\n\r\n\t\t\t} else if (type === 'click' && L.Browser.android) {\r\n\t\t\t\toriginalHandler = handler;\r\n\t\t\t\thandler = function (e) {\r\n\t\t\t\t\treturn L.DomEvent._filterClick(e, originalHandler);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t\t} else {\r\n\t\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t\t}\r\n\r\n\t\t} else if ('attachEvent' in obj) {\r\n\t\t\tobj.attachEvent('on' + type, handler);\r\n\t\t}\r\n\r\n\t\tobj[key] = handler;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveListener: function (obj, type, fn) {  // (HTMLElement, String, Function)\r\n\r\n\t\tvar id = L.stamp(fn),\r\n\t\t    key = '_leaflet_' + type + id,\r\n\t\t    handler = obj[key];\r\n\r\n\t\tif (!handler) { return this; }\r\n\r\n\t\tif (L.Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t\tthis.removePointerListener(obj, type, id);\r\n\t\t} else if (L.Browser.touch && (type === 'dblclick') && this.removeDoubleTapListener) {\r\n\t\t\tthis.removeDoubleTapListener(obj, id);\r\n\r\n\t\t} else if ('removeEventListener' in obj) {\r\n\r\n\t\t\tif (type === 'mousewheel') {\r\n\t\t\t\tobj.removeEventListener('DOMMouseScroll', handler, false);\r\n\t\t\t\tobj.removeEventListener(type, handler, false);\r\n\r\n\t\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\t\t\t\tobj.removeEventListener((type === 'mouseenter' ? 'mouseover' : 'mouseout'), handler, false);\r\n\t\t\t} else {\r\n\t\t\t\tobj.removeEventListener(type, handler, false);\r\n\t\t\t}\r\n\t\t} else if ('detachEvent' in obj) {\r\n\t\t\tobj.detachEvent('on' + type, handler);\r\n\t\t}\r\n\r\n\t\tobj[key] = null;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstopPropagation: function (e) {\r\n\r\n\t\tif (e.stopPropagation) {\r\n\t\t\te.stopPropagation();\r\n\t\t} else {\r\n\t\t\te.cancelBubble = true;\r\n\t\t}\r\n\t\tL.DomEvent._skipped(e);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdisableScrollPropagation: function (el) {\r\n\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\treturn L.DomEvent\r\n\t\t\t.on(el, 'mousewheel', stop)\r\n\t\t\t.on(el, 'MozMousePixelScroll', stop);\r\n\t},\r\n\r\n\tdisableClickPropagation: function (el) {\r\n\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\tL.DomEvent.on(el, L.Draggable.START[i], stop);\r\n\t\t}\r\n\r\n\t\treturn L.DomEvent\r\n\t\t\t.on(el, 'click', L.DomEvent._fakeStop)\r\n\t\t\t.on(el, 'dblclick', stop);\r\n\t},\r\n\r\n\tpreventDefault: function (e) {\r\n\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t} else {\r\n\t\t\te.returnValue = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstop: function (e) {\r\n\t\treturn L.DomEvent\r\n\t\t\t.preventDefault(e)\r\n\t\t\t.stopPropagation(e);\r\n\t},\r\n\r\n\tgetMousePosition: function (e, container) {\r\n\t\tif (!container) {\r\n\t\t\treturn new L.Point(e.clientX, e.clientY);\r\n\t\t}\r\n\r\n\t\tvar rect = container.getBoundingClientRect();\r\n\r\n\t\treturn new L.Point(\r\n\t\t\te.clientX - rect.left - container.clientLeft,\r\n\t\t\te.clientY - rect.top - container.clientTop);\r\n\t},\r\n\r\n\tgetWheelDelta: function (e) {\r\n\r\n\t\tvar delta = 0;\r\n\r\n\t\tif (e.wheelDelta) {\r\n\t\t\tdelta = e.wheelDelta / 120;\r\n\t\t}\r\n\t\tif (e.detail) {\r\n\t\t\tdelta = -e.detail / 3;\r\n\t\t}\r\n\t\treturn delta;\r\n\t},\r\n\r\n\t_skipEvents: {},\r\n\r\n\t_fakeStop: function (e) {\r\n\t\t// fakes stopPropagation by setting a special event flag, checked/reset with L.DomEvent._skipped(e)\r\n\t\tL.DomEvent._skipEvents[e.type] = true;\r\n\t},\r\n\r\n\t_skipped: function (e) {\r\n\t\tvar skipped = this._skipEvents[e.type];\r\n\t\t// reset when checking, as it's only used in map container and propagates outside of the map\r\n\t\tthis._skipEvents[e.type] = false;\r\n\t\treturn skipped;\r\n\t},\r\n\r\n\t// check if element really left/entered the event target (for mouseenter/mouseleave)\r\n\t_checkMouse: function (el, e) {\r\n\r\n\t\tvar related = e.relatedTarget;\r\n\r\n\t\tif (!related) { return true; }\r\n\r\n\t\ttry {\r\n\t\t\twhile (related && (related !== el)) {\r\n\t\t\t\trelated = related.parentNode;\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn (related !== el);\r\n\t},\r\n\r\n\t_getEvent: function () { // evil magic for IE\r\n\t\t/*jshint noarg:false */\r\n\t\tvar e = window.event;\r\n\t\tif (!e) {\r\n\t\t\tvar caller = arguments.callee.caller;\r\n\t\t\twhile (caller) {\r\n\t\t\t\te = caller['arguments'][0];\r\n\t\t\t\tif (e && window.Event === e.constructor) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcaller = caller.caller;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn e;\r\n\t},\r\n\r\n\t// this is a horrible workaround for a bug in Android where a single touch triggers two click events\r\n\t_filterClick: function (e, handler) {\r\n\t\tvar timeStamp = (e.timeStamp || e.originalEvent.timeStamp),\r\n\t\t\telapsed = L.DomEvent._lastClick && (timeStamp - L.DomEvent._lastClick);\r\n\r\n\t\t// are they closer together than 500ms yet more than 100ms?\r\n\t\t// Android typically triggers them ~300ms apart while multiple listeners\r\n\t\t// on the same event should be triggered far faster;\r\n\t\t// or check if click is simulated on the element, and if it is, reject any non-simulated events\r\n\r\n\t\tif ((elapsed && elapsed > 100 && elapsed < 500) || (e.target._simulatedClick && !e._simulated)) {\r\n\t\t\tL.DomEvent.stop(e);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tL.DomEvent._lastClick = timeStamp;\r\n\r\n\t\treturn handler(e);\r\n\t}\r\n};\r\n\r\nL.DomEvent.on = L.DomEvent.addListener;\r\nL.DomEvent.off = L.DomEvent.removeListener;\r\n\n\n/*\r\n * L.Draggable allows you to add dragging capabilities to any element. Supports mobile devices too.\r\n */\r\n\r\nL.Draggable = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\tstatics: {\r\n\t\tSTART: L.Browser.touch ? ['touchstart', 'mousedown'] : ['mousedown'],\r\n\t\tEND: {\r\n\t\t\tmousedown: 'mouseup',\r\n\t\t\ttouchstart: 'touchend',\r\n\t\t\tpointerdown: 'touchend',\r\n\t\t\tMSPointerDown: 'touchend'\r\n\t\t},\r\n\t\tMOVE: {\r\n\t\t\tmousedown: 'mousemove',\r\n\t\t\ttouchstart: 'touchmove',\r\n\t\t\tpointerdown: 'touchmove',\r\n\t\t\tMSPointerDown: 'touchmove'\r\n\t\t}\r\n\t},\r\n\r\n\tinitialize: function (element, dragStartTarget) {\r\n\t\tthis._element = element;\r\n\t\tthis._dragStartTarget = dragStartTarget || element;\r\n\t},\r\n\r\n\tenable: function () {\r\n\t\tif (this._enabled) { return; }\r\n\r\n\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\tL.DomEvent.on(this._dragStartTarget, L.Draggable.START[i], this._onDown, this);\r\n\t\t}\r\n\r\n\t\tthis._enabled = true;\r\n\t},\r\n\r\n\tdisable: function () {\r\n\t\tif (!this._enabled) { return; }\r\n\r\n\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\tL.DomEvent.off(this._dragStartTarget, L.Draggable.START[i], this._onDown, this);\r\n\t\t}\r\n\r\n\t\tthis._enabled = false;\r\n\t\tthis._moved = false;\r\n\t},\r\n\r\n\t_onDown: function (e) {\r\n\t\tthis._moved = false;\r\n\r\n\t\tif (e.shiftKey || ((e.which !== 1) && (e.button !== 1) && !e.touches)) { return; }\r\n\r\n\t\tL.DomEvent.stopPropagation(e);\r\n\r\n\t\tif (L.Draggable._disabled) { return; }\r\n\r\n\t\tL.DomUtil.disableImageDrag();\r\n\t\tL.DomUtil.disableTextSelection();\r\n\r\n\t\tif (this._moving) { return; }\r\n\r\n\t\tvar first = e.touches ? e.touches[0] : e;\r\n\r\n\t\tthis._startPoint = new L.Point(first.clientX, first.clientY);\r\n\t\tthis._startPos = this._newPos = L.DomUtil.getPosition(this._element);\r\n\r\n\t\tL.DomEvent\r\n\t\t    .on(document, L.Draggable.MOVE[e.type], this._onMove, this)\r\n\t\t    .on(document, L.Draggable.END[e.type], this._onUp, this);\r\n\t},\r\n\r\n\t_onMove: function (e) {\r\n\t\tif (e.touches && e.touches.length > 1) {\r\n\t\t\tthis._moved = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar first = (e.touches && e.touches.length === 1 ? e.touches[0] : e),\r\n\t\t    newPoint = new L.Point(first.clientX, first.clientY),\r\n\t\t    offset = newPoint.subtract(this._startPoint);\r\n\r\n\t\tif (!offset.x && !offset.y) { return; }\r\n\t\tif (L.Browser.touch && Math.abs(offset.x) + Math.abs(offset.y) < 3) { return; }\r\n\r\n\t\tL.DomEvent.preventDefault(e);\r\n\r\n\t\tif (!this._moved) {\r\n\t\t\tthis.fire('dragstart');\r\n\r\n\t\t\tthis._moved = true;\r\n\t\t\tthis._startPos = L.DomUtil.getPosition(this._element).subtract(offset);\r\n\r\n\t\t\tL.DomUtil.addClass(document.body, 'leaflet-dragging');\r\n\t\t\tthis._lastTarget = e.target || e.srcElement;\r\n\t\t\tL.DomUtil.addClass(this._lastTarget, 'leaflet-drag-target');\r\n\t\t}\r\n\r\n\t\tthis._newPos = this._startPos.add(offset);\r\n\t\tthis._moving = true;\r\n\r\n\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\t\tthis._animRequest = L.Util.requestAnimFrame(this._updatePosition, this, true, this._dragStartTarget);\r\n\t},\r\n\r\n\t_updatePosition: function () {\r\n\t\tthis.fire('predrag');\r\n\t\tL.DomUtil.setPosition(this._element, this._newPos);\r\n\t\tthis.fire('drag');\r\n\t},\r\n\r\n\t_onUp: function () {\r\n\t\tL.DomUtil.removeClass(document.body, 'leaflet-dragging');\r\n\r\n\t\tif (this._lastTarget) {\r\n\t\t\tL.DomUtil.removeClass(this._lastTarget, 'leaflet-drag-target');\r\n\t\t\tthis._lastTarget = null;\r\n\t\t}\r\n\r\n\t\tfor (var i in L.Draggable.MOVE) {\r\n\t\t\tL.DomEvent\r\n\t\t\t    .off(document, L.Draggable.MOVE[i], this._onMove)\r\n\t\t\t    .off(document, L.Draggable.END[i], this._onUp);\r\n\t\t}\r\n\r\n\t\tL.DomUtil.enableImageDrag();\r\n\t\tL.DomUtil.enableTextSelection();\r\n\r\n\t\tif (this._moved && this._moving) {\r\n\t\t\t// ensure drag is not fired after dragend\r\n\t\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\r\n\t\t\tthis.fire('dragend', {\r\n\t\t\t\tdistance: this._newPos.distanceTo(this._startPos)\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis._moving = false;\r\n\t}\r\n});\r\n\n\n/*\n\tL.Handler is a base class for handler classes that are used internally to inject\n\tinteraction features like dragging to classes like Map and Marker.\n*/\n\nL.Handler = L.Class.extend({\n\tinitialize: function (map) {\n\t\tthis._map = map;\n\t},\n\n\tenable: function () {\n\t\tif (this._enabled) { return; }\n\n\t\tthis._enabled = true;\n\t\tthis.addHooks();\n\t},\n\n\tdisable: function () {\n\t\tif (!this._enabled) { return; }\n\n\t\tthis._enabled = false;\n\t\tthis.removeHooks();\n\t},\n\n\tenabled: function () {\n\t\treturn !!this._enabled;\n\t}\n});\n\n\n/*\n * L.Handler.MapDrag is used to make the map draggable (with panning inertia), enabled by default.\n */\n\nL.Map.mergeOptions({\n\tdragging: true,\n\n\tinertia: !L.Browser.android23,\n\tinertiaDeceleration: 3400, // px/s^2\n\tinertiaMaxSpeed: Infinity, // px/s\n\tinertiaThreshold: L.Browser.touch ? 32 : 18, // ms\n\teaseLinearity: 0.25,\n\n\t// TODO refactor, move to CRS\n\tworldCopyJump: false\n});\n\nL.Map.Drag = L.Handler.extend({\n\taddHooks: function () {\n\t\tif (!this._draggable) {\n\t\t\tvar map = this._map;\n\n\t\t\tthis._draggable = new L.Draggable(map._mapPane, map._container);\n\n\t\t\tthis._draggable.on({\n\t\t\t\t'dragstart': this._onDragStart,\n\t\t\t\t'drag': this._onDrag,\n\t\t\t\t'dragend': this._onDragEnd\n\t\t\t}, this);\n\n\t\t\tif (map.options.worldCopyJump) {\n\t\t\t\tthis._draggable.on('predrag', this._onPreDrag, this);\n\t\t\t\tmap.on('viewreset', this._onViewReset, this);\n\n\t\t\t\tmap.whenReady(this._onViewReset, this);\n\t\t\t}\n\t\t}\n\t\tthis._draggable.enable();\n\t},\n\n\tremoveHooks: function () {\n\t\tthis._draggable.disable();\n\t},\n\n\tmoved: function () {\n\t\treturn this._draggable && this._draggable._moved;\n\t},\n\n\t_onDragStart: function () {\n\t\tvar map = this._map;\n\n\t\tif (map._panAnim) {\n\t\t\tmap._panAnim.stop();\n\t\t}\n\n\t\tmap\n\t\t    .fire('movestart')\n\t\t    .fire('dragstart');\n\n\t\tif (map.options.inertia) {\n\t\t\tthis._positions = [];\n\t\t\tthis._times = [];\n\t\t}\n\t},\n\n\t_onDrag: function () {\n\t\tif (this._map.options.inertia) {\n\t\t\tvar time = this._lastTime = +new Date(),\n\t\t\t    pos = this._lastPos = this._draggable._newPos;\n\n\t\t\tthis._positions.push(pos);\n\t\t\tthis._times.push(time);\n\n\t\t\tif (time - this._times[0] > 200) {\n\t\t\t\tthis._positions.shift();\n\t\t\t\tthis._times.shift();\n\t\t\t}\n\t\t}\n\n\t\tthis._map\n\t\t    .fire('move')\n\t\t    .fire('drag');\n\t},\n\n\t_onViewReset: function () {\n\t\t// TODO fix hardcoded Earth values\n\t\tvar pxCenter = this._map.getSize()._divideBy(2),\n\t\t    pxWorldCenter = this._map.latLngToLayerPoint([0, 0]);\n\n\t\tthis._initialWorldOffset = pxWorldCenter.subtract(pxCenter).x;\n\t\tthis._worldWidth = this._map.project([0, 180]).x;\n\t},\n\n\t_onPreDrag: function () {\n\t\t// TODO refactor to be able to adjust map pane position after zoom\n\t\tvar worldWidth = this._worldWidth,\n\t\t    halfWidth = Math.round(worldWidth / 2),\n\t\t    dx = this._initialWorldOffset,\n\t\t    x = this._draggable._newPos.x,\n\t\t    newX1 = (x - halfWidth + dx) % worldWidth + halfWidth - dx,\n\t\t    newX2 = (x + halfWidth + dx) % worldWidth - halfWidth - dx,\n\t\t    newX = Math.abs(newX1 + dx) < Math.abs(newX2 + dx) ? newX1 : newX2;\n\n\t\tthis._draggable._newPos.x = newX;\n\t},\n\n\t_onDragEnd: function (e) {\n\t\tvar map = this._map,\n\t\t    options = map.options,\n\t\t    delay = +new Date() - this._lastTime,\n\n\t\t    noInertia = !options.inertia || delay > options.inertiaThreshold || !this._positions[0];\n\n\t\tmap.fire('dragend', e);\n\n\t\tif (noInertia) {\n\t\t\tmap.fire('moveend');\n\n\t\t} else {\n\n\t\t\tvar direction = this._lastPos.subtract(this._positions[0]),\n\t\t\t    duration = (this._lastTime + delay - this._times[0]) / 1000,\n\t\t\t    ease = options.easeLinearity,\n\n\t\t\t    speedVector = direction.multiplyBy(ease / duration),\n\t\t\t    speed = speedVector.distanceTo([0, 0]),\n\n\t\t\t    limitedSpeed = Math.min(options.inertiaMaxSpeed, speed),\n\t\t\t    limitedSpeedVector = speedVector.multiplyBy(limitedSpeed / speed),\n\n\t\t\t    decelerationDuration = limitedSpeed / (options.inertiaDeceleration * ease),\n\t\t\t    offset = limitedSpeedVector.multiplyBy(-decelerationDuration / 2).round();\n\n\t\t\tif (!offset.x || !offset.y) {\n\t\t\t\tmap.fire('moveend');\n\n\t\t\t} else {\n\t\t\t\toffset = map._limitOffset(offset, map.options.maxBounds);\n\n\t\t\t\tL.Util.requestAnimFrame(function () {\n\t\t\t\t\tmap.panBy(offset, {\n\t\t\t\t\t\tduration: decelerationDuration,\n\t\t\t\t\t\teaseLinearity: ease,\n\t\t\t\t\t\tnoMoveStart: true\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'dragging', L.Map.Drag);\n\n\n/*\n * L.Handler.DoubleClickZoom is used to handle double-click zoom on the map, enabled by default.\n */\n\nL.Map.mergeOptions({\n\tdoubleClickZoom: true\n});\n\nL.Map.DoubleClickZoom = L.Handler.extend({\n\taddHooks: function () {\n\t\tthis._map.on('dblclick', this._onDoubleClick, this);\n\t},\n\n\tremoveHooks: function () {\n\t\tthis._map.off('dblclick', this._onDoubleClick, this);\n\t},\n\n\t_onDoubleClick: function (e) {\n\t\tvar map = this._map,\n\t\t    zoom = map.getZoom() + (e.originalEvent.shiftKey ? -1 : 1);\n\n\t\tif (map.options.doubleClickZoom === 'center') {\n\t\t\tmap.setZoom(zoom);\n\t\t} else {\n\t\t\tmap.setZoomAround(e.containerPoint, zoom);\n\t\t}\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'doubleClickZoom', L.Map.DoubleClickZoom);\n\n\n/*\n * L.Handler.ScrollWheelZoom is used by L.Map to enable mouse scroll wheel zoom on the map.\n */\n\nL.Map.mergeOptions({\n\tscrollWheelZoom: true\n});\n\nL.Map.ScrollWheelZoom = L.Handler.extend({\n\taddHooks: function () {\n\t\tL.DomEvent.on(this._map._container, 'mousewheel', this._onWheelScroll, this);\n\t\tL.DomEvent.on(this._map._container, 'MozMousePixelScroll', L.DomEvent.preventDefault);\n\t\tthis._delta = 0;\n\t},\n\n\tremoveHooks: function () {\n\t\tL.DomEvent.off(this._map._container, 'mousewheel', this._onWheelScroll);\n\t\tL.DomEvent.off(this._map._container, 'MozMousePixelScroll', L.DomEvent.preventDefault);\n\t},\n\n\t_onWheelScroll: function (e) {\n\t\tvar delta = L.DomEvent.getWheelDelta(e);\n\n\t\tthis._delta += delta;\n\t\tthis._lastMousePos = this._map.mouseEventToContainerPoint(e);\n\n\t\tif (!this._startTime) {\n\t\t\tthis._startTime = +new Date();\n\t\t}\n\n\t\tvar left = Math.max(40 - (+new Date() - this._startTime), 0);\n\n\t\tclearTimeout(this._timer);\n\t\tthis._timer = setTimeout(L.bind(this._performZoom, this), left);\n\n\t\tL.DomEvent.preventDefault(e);\n\t\tL.DomEvent.stopPropagation(e);\n\t},\n\n\t_performZoom: function () {\n\t\tvar map = this._map,\n\t\t    delta = this._delta,\n\t\t    zoom = map.getZoom();\n\n\t\tdelta = delta > 0 ? Math.ceil(delta) : Math.floor(delta);\n\t\tdelta = Math.max(Math.min(delta, 4), -4);\n\t\tdelta = map._limitZoom(zoom + delta) - zoom;\n\n\t\tthis._delta = 0;\n\t\tthis._startTime = null;\n\n\t\tif (!delta) { return; }\n\n\t\tif (map.options.scrollWheelZoom === 'center') {\n\t\t\tmap.setZoom(zoom + delta);\n\t\t} else {\n\t\t\tmap.setZoomAround(this._lastMousePos, zoom + delta);\n\t\t}\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'scrollWheelZoom', L.Map.ScrollWheelZoom);\n\n\n/*\r\n * Extends the event handling code with double tap support for mobile browsers.\r\n */\r\n\r\nL.extend(L.DomEvent, {\r\n\r\n\t_touchstart: L.Browser.msPointer ? 'MSPointerDown' : L.Browser.pointer ? 'pointerdown' : 'touchstart',\r\n\t_touchend: L.Browser.msPointer ? 'MSPointerUp' : L.Browser.pointer ? 'pointerup' : 'touchend',\r\n\r\n\t// inspired by Zepto touch code by Thomas Fuchs\r\n\taddDoubleTapListener: function (obj, handler, id) {\r\n\t\tvar last,\r\n\t\t    doubleTap = false,\r\n\t\t    delay = 250,\r\n\t\t    touch,\r\n\t\t    pre = '_leaflet_',\r\n\t\t    touchstart = this._touchstart,\r\n\t\t    touchend = this._touchend,\r\n\t\t    trackedTouches = [];\r\n\r\n\t\tfunction onTouchStart(e) {\r\n\t\t\tvar count;\r\n\r\n\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\ttrackedTouches.push(e.pointerId);\r\n\t\t\t\tcount = trackedTouches.length;\r\n\t\t\t} else {\r\n\t\t\t\tcount = e.touches.length;\r\n\t\t\t}\r\n\t\t\tif (count > 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar now = Date.now(),\r\n\t\t\t\tdelta = now - (last || now);\r\n\r\n\t\t\ttouch = e.touches ? e.touches[0] : e;\r\n\t\t\tdoubleTap = (delta > 0 && delta <= delay);\r\n\t\t\tlast = now;\r\n\t\t}\r\n\r\n\t\tfunction onTouchEnd(e) {\r\n\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\tvar idx = trackedTouches.indexOf(e.pointerId);\r\n\t\t\t\tif (idx === -1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\ttrackedTouches.splice(idx, 1);\r\n\t\t\t}\r\n\r\n\t\t\tif (doubleTap) {\r\n\t\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\t\t// work around .type being readonly with MSPointer* events\r\n\t\t\t\t\tvar newTouch = { },\r\n\t\t\t\t\t\tprop;\r\n\r\n\t\t\t\t\t// jshint forin:false\r\n\t\t\t\t\tfor (var i in touch) {\r\n\t\t\t\t\t\tprop = touch[i];\r\n\t\t\t\t\t\tif (typeof prop === 'function') {\r\n\t\t\t\t\t\t\tnewTouch[i] = prop.bind(touch);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tnewTouch[i] = prop;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttouch = newTouch;\r\n\t\t\t\t}\r\n\t\t\t\ttouch.type = 'dblclick';\r\n\t\t\t\thandler(touch);\r\n\t\t\t\tlast = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tobj[pre + touchstart + id] = onTouchStart;\r\n\t\tobj[pre + touchend + id] = onTouchEnd;\r\n\r\n\t\t// on pointer we need to listen on the document, otherwise a drag starting on the map and moving off screen\r\n\t\t// will not come through to us, so we will lose track of how many touches are ongoing\r\n\t\tvar endElement = L.Browser.pointer ? document.documentElement : obj;\r\n\r\n\t\tobj.addEventListener(touchstart, onTouchStart, false);\r\n\t\tendElement.addEventListener(touchend, onTouchEnd, false);\r\n\r\n\t\tif (L.Browser.pointer) {\r\n\t\t\tendElement.addEventListener(L.DomEvent.POINTER_CANCEL, onTouchEnd, false);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveDoubleTapListener: function (obj, id) {\r\n\t\tvar pre = '_leaflet_';\r\n\r\n\t\tobj.removeEventListener(this._touchstart, obj[pre + this._touchstart + id], false);\r\n\t\t(L.Browser.pointer ? document.documentElement : obj).removeEventListener(\r\n\t\t        this._touchend, obj[pre + this._touchend + id], false);\r\n\r\n\t\tif (L.Browser.pointer) {\r\n\t\t\tdocument.documentElement.removeEventListener(L.DomEvent.POINTER_CANCEL, obj[pre + this._touchend + id],\r\n\t\t\t\tfalse);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n\n\n/*\n * Extends L.DomEvent to provide touch support for Internet Explorer and Windows-based devices.\n */\n\nL.extend(L.DomEvent, {\n\n\t//static\n\tPOINTER_DOWN: L.Browser.msPointer ? 'MSPointerDown' : 'pointerdown',\n\tPOINTER_MOVE: L.Browser.msPointer ? 'MSPointerMove' : 'pointermove',\n\tPOINTER_UP: L.Browser.msPointer ? 'MSPointerUp' : 'pointerup',\n\tPOINTER_CANCEL: L.Browser.msPointer ? 'MSPointerCancel' : 'pointercancel',\n\n\t_pointers: [],\n\t_pointerDocumentListener: false,\n\n\t// Provides a touch events wrapper for (ms)pointer events.\n\t// Based on changes by veproza https://github.com/CloudMade/Leaflet/pull/1019\n\t//ref http://www.w3.org/TR/pointerevents/ https://www.w3.org/Bugs/Public/show_bug.cgi?id=22890\n\n\taddPointerListener: function (obj, type, handler, id) {\n\n\t\tswitch (type) {\n\t\tcase 'touchstart':\n\t\t\treturn this.addPointerListenerStart(obj, type, handler, id);\n\t\tcase 'touchend':\n\t\t\treturn this.addPointerListenerEnd(obj, type, handler, id);\n\t\tcase 'touchmove':\n\t\t\treturn this.addPointerListenerMove(obj, type, handler, id);\n\t\tdefault:\n\t\t\tthrow 'Unknown touch event type';\n\t\t}\n\t},\n\n\taddPointerListenerStart: function (obj, type, handler, id) {\n\t\tvar pre = '_leaflet_',\n\t\t    pointers = this._pointers;\n\n\t\tvar cb = function (e) {\n\t\t\tif (e.pointerType !== 'mouse' && e.pointerType !== e.MSPOINTER_TYPE_MOUSE) {\n\t\t\t\tL.DomEvent.preventDefault(e);\n\t\t\t}\n\n\t\t\tvar alreadyInArray = false;\n\t\t\tfor (var i = 0; i < pointers.length; i++) {\n\t\t\t\tif (pointers[i].pointerId === e.pointerId) {\n\t\t\t\t\talreadyInArray = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!alreadyInArray) {\n\t\t\t\tpointers.push(e);\n\t\t\t}\n\n\t\t\te.touches = pointers.slice();\n\t\t\te.changedTouches = [e];\n\n\t\t\thandler(e);\n\t\t};\n\n\t\tobj[pre + 'touchstart' + id] = cb;\n\t\tobj.addEventListener(this.POINTER_DOWN, cb, false);\n\n\t\t// need to also listen for end events to keep the _pointers list accurate\n\t\t// this needs to be on the body and never go away\n\t\tif (!this._pointerDocumentListener) {\n\t\t\tvar internalCb = function (e) {\n\t\t\t\tfor (var i = 0; i < pointers.length; i++) {\n\t\t\t\t\tif (pointers[i].pointerId === e.pointerId) {\n\t\t\t\t\t\tpointers.splice(i, 1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\t//We listen on the documentElement as any drags that end by moving the touch off the screen get fired there\n\t\t\tdocument.documentElement.addEventListener(this.POINTER_UP, internalCb, false);\n\t\t\tdocument.documentElement.addEventListener(this.POINTER_CANCEL, internalCb, false);\n\n\t\t\tthis._pointerDocumentListener = true;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\taddPointerListenerMove: function (obj, type, handler, id) {\n\t\tvar pre = '_leaflet_',\n\t\t    touches = this._pointers;\n\n\t\tfunction cb(e) {\n\n\t\t\t// don't fire touch moves when mouse isn't down\n\t\t\tif ((e.pointerType === e.MSPOINTER_TYPE_MOUSE || e.pointerType === 'mouse') && e.buttons === 0) { return; }\n\n\t\t\tfor (var i = 0; i < touches.length; i++) {\n\t\t\t\tif (touches[i].pointerId === e.pointerId) {\n\t\t\t\t\ttouches[i] = e;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\te.touches = touches.slice();\n\t\t\te.changedTouches = [e];\n\n\t\t\thandler(e);\n\t\t}\n\n\t\tobj[pre + 'touchmove' + id] = cb;\n\t\tobj.addEventListener(this.POINTER_MOVE, cb, false);\n\n\t\treturn this;\n\t},\n\n\taddPointerListenerEnd: function (obj, type, handler, id) {\n\t\tvar pre = '_leaflet_',\n\t\t    touches = this._pointers;\n\n\t\tvar cb = function (e) {\n\t\t\tfor (var i = 0; i < touches.length; i++) {\n\t\t\t\tif (touches[i].pointerId === e.pointerId) {\n\t\t\t\t\ttouches.splice(i, 1);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\te.touches = touches.slice();\n\t\t\te.changedTouches = [e];\n\n\t\t\thandler(e);\n\t\t};\n\n\t\tobj[pre + 'touchend' + id] = cb;\n\t\tobj.addEventListener(this.POINTER_UP, cb, false);\n\t\tobj.addEventListener(this.POINTER_CANCEL, cb, false);\n\n\t\treturn this;\n\t},\n\n\tremovePointerListener: function (obj, type, id) {\n\t\tvar pre = '_leaflet_',\n\t\t    cb = obj[pre + type + id];\n\n\t\tswitch (type) {\n\t\tcase 'touchstart':\n\t\t\tobj.removeEventListener(this.POINTER_DOWN, cb, false);\n\t\t\tbreak;\n\t\tcase 'touchmove':\n\t\t\tobj.removeEventListener(this.POINTER_MOVE, cb, false);\n\t\t\tbreak;\n\t\tcase 'touchend':\n\t\t\tobj.removeEventListener(this.POINTER_UP, cb, false);\n\t\t\tobj.removeEventListener(this.POINTER_CANCEL, cb, false);\n\t\t\tbreak;\n\t\t}\n\n\t\treturn this;\n\t}\n});\n\n\n/*\n * L.Handler.TouchZoom is used by L.Map to add pinch zoom on supported mobile browsers.\n */\n\nL.Map.mergeOptions({\n\ttouchZoom: L.Browser.touch && !L.Browser.android23,\n\tbounceAtZoomLimits: true\n});\n\nL.Map.TouchZoom = L.Handler.extend({\n\taddHooks: function () {\n\t\tL.DomEvent.on(this._map._container, 'touchstart', this._onTouchStart, this);\n\t},\n\n\tremoveHooks: function () {\n\t\tL.DomEvent.off(this._map._container, 'touchstart', this._onTouchStart, this);\n\t},\n\n\t_onTouchStart: function (e) {\n\t\tvar map = this._map;\n\n\t\tif (!e.touches || e.touches.length !== 2 || map._animatingZoom || this._zooming) { return; }\n\n\t\tvar p1 = map.mouseEventToLayerPoint(e.touches[0]),\n\t\t    p2 = map.mouseEventToLayerPoint(e.touches[1]),\n\t\t    viewCenter = map._getCenterLayerPoint();\n\n\t\tthis._startCenter = p1.add(p2)._divideBy(2);\n\t\tthis._startDist = p1.distanceTo(p2);\n\n\t\tthis._moved = false;\n\t\tthis._zooming = true;\n\n\t\tthis._centerOffset = viewCenter.subtract(this._startCenter);\n\n\t\tif (map._panAnim) {\n\t\t\tmap._panAnim.stop();\n\t\t}\n\n\t\tL.DomEvent\n\t\t    .on(document, 'touchmove', this._onTouchMove, this)\n\t\t    .on(document, 'touchend', this._onTouchEnd, this);\n\n\t\tL.DomEvent.preventDefault(e);\n\t},\n\n\t_onTouchMove: function (e) {\n\t\tvar map = this._map;\n\n\t\tif (!e.touches || e.touches.length !== 2 || !this._zooming) { return; }\n\n\t\tvar p1 = map.mouseEventToLayerPoint(e.touches[0]),\n\t\t    p2 = map.mouseEventToLayerPoint(e.touches[1]);\n\n\t\tthis._scale = p1.distanceTo(p2) / this._startDist;\n\t\tthis._delta = p1._add(p2)._divideBy(2)._subtract(this._startCenter);\n\n\t\tif (this._scale === 1) { return; }\n\n\t\tif (!map.options.bounceAtZoomLimits) {\n\t\t\tif ((map.getZoom() === map.getMinZoom() && this._scale < 1) ||\n\t\t\t    (map.getZoom() === map.getMaxZoom() && this._scale > 1)) { return; }\n\t\t}\n\n\t\tif (!this._moved) {\n\t\t\tL.DomUtil.addClass(map._mapPane, 'leaflet-touching');\n\n\t\t\tmap\n\t\t\t    .fire('movestart')\n\t\t\t    .fire('zoomstart');\n\n\t\t\tthis._moved = true;\n\t\t}\n\n\t\tL.Util.cancelAnimFrame(this._animRequest);\n\t\tthis._animRequest = L.Util.requestAnimFrame(\n\t\t        this._updateOnMove, this, true, this._map._container);\n\n\t\tL.DomEvent.preventDefault(e);\n\t},\n\n\t_updateOnMove: function () {\n\t\tvar map = this._map,\n\t\t    origin = this._getScaleOrigin(),\n\t\t    center = map.layerPointToLatLng(origin),\n\t\t    zoom = map.getScaleZoom(this._scale);\n\n\t\tmap._animateZoom(center, zoom, this._startCenter, this._scale, this._delta, false, true);\n\t},\n\n\t_onTouchEnd: function () {\n\t\tif (!this._moved || !this._zooming) {\n\t\t\tthis._zooming = false;\n\t\t\treturn;\n\t\t}\n\n\t\tvar map = this._map;\n\n\t\tthis._zooming = false;\n\t\tL.DomUtil.removeClass(map._mapPane, 'leaflet-touching');\n\t\tL.Util.cancelAnimFrame(this._animRequest);\n\n\t\tL.DomEvent\n\t\t    .off(document, 'touchmove', this._onTouchMove)\n\t\t    .off(document, 'touchend', this._onTouchEnd);\n\n\t\tvar origin = this._getScaleOrigin(),\n\t\t    center = map.layerPointToLatLng(origin),\n\n\t\t    oldZoom = map.getZoom(),\n\t\t    floatZoomDelta = map.getScaleZoom(this._scale) - oldZoom,\n\t\t    roundZoomDelta = (floatZoomDelta > 0 ?\n\t\t            Math.ceil(floatZoomDelta) : Math.floor(floatZoomDelta)),\n\n\t\t    zoom = map._limitZoom(oldZoom + roundZoomDelta),\n\t\t    scale = map.getZoomScale(zoom) / this._scale;\n\n\t\tmap._animateZoom(center, zoom, origin, scale);\n\t},\n\n\t_getScaleOrigin: function () {\n\t\tvar centerOffset = this._centerOffset.subtract(this._delta).divideBy(this._scale);\n\t\treturn this._startCenter.add(centerOffset);\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'touchZoom', L.Map.TouchZoom);\n\n\n/*\n * L.Map.Tap is used to enable mobile hacks like quick taps and long hold.\n */\n\nL.Map.mergeOptions({\n\ttap: true,\n\ttapTolerance: 15\n});\n\nL.Map.Tap = L.Handler.extend({\n\taddHooks: function () {\n\t\tL.DomEvent.on(this._map._container, 'touchstart', this._onDown, this);\n\t},\n\n\tremoveHooks: function () {\n\t\tL.DomEvent.off(this._map._container, 'touchstart', this._onDown, this);\n\t},\n\n\t_onDown: function (e) {\n\t\tif (!e.touches) { return; }\n\n\t\tL.DomEvent.preventDefault(e);\n\n\t\tthis._fireClick = true;\n\n\t\t// don't simulate click or track longpress if more than 1 touch\n\t\tif (e.touches.length > 1) {\n\t\t\tthis._fireClick = false;\n\t\t\tclearTimeout(this._holdTimeout);\n\t\t\treturn;\n\t\t}\n\n\t\tvar first = e.touches[0],\n\t\t    el = first.target;\n\n\t\tthis._startPos = this._newPos = new L.Point(first.clientX, first.clientY);\n\n\t\t// if touching a link, highlight it\n\t\tif (el.tagName && el.tagName.toLowerCase() === 'a') {\n\t\t\tL.DomUtil.addClass(el, 'leaflet-active');\n\t\t}\n\n\t\t// simulate long hold but setting a timeout\n\t\tthis._holdTimeout = setTimeout(L.bind(function () {\n\t\t\tif (this._isTapValid()) {\n\t\t\t\tthis._fireClick = false;\n\t\t\t\tthis._onUp();\n\t\t\t\tthis._simulateEvent('contextmenu', first);\n\t\t\t}\n\t\t}, this), 1000);\n\n\t\tL.DomEvent\n\t\t\t.on(document, 'touchmove', this._onMove, this)\n\t\t\t.on(document, 'touchend', this._onUp, this);\n\t},\n\n\t_onUp: function (e) {\n\t\tclearTimeout(this._holdTimeout);\n\n\t\tL.DomEvent\n\t\t\t.off(document, 'touchmove', this._onMove, this)\n\t\t\t.off(document, 'touchend', this._onUp, this);\n\n\t\tif (this._fireClick && e && e.changedTouches) {\n\n\t\t\tvar first = e.changedTouches[0],\n\t\t\t    el = first.target;\n\n\t\t\tif (el && el.tagName && el.tagName.toLowerCase() === 'a') {\n\t\t\t\tL.DomUtil.removeClass(el, 'leaflet-active');\n\t\t\t}\n\n\t\t\t// simulate click if the touch didn't move too much\n\t\t\tif (this._isTapValid()) {\n\t\t\t\tthis._simulateEvent('click', first);\n\t\t\t}\n\t\t}\n\t},\n\n\t_isTapValid: function () {\n\t\treturn this._newPos.distanceTo(this._startPos) <= this._map.options.tapTolerance;\n\t},\n\n\t_onMove: function (e) {\n\t\tvar first = e.touches[0];\n\t\tthis._newPos = new L.Point(first.clientX, first.clientY);\n\t},\n\n\t_simulateEvent: function (type, e) {\n\t\tvar simulatedEvent = document.createEvent('MouseEvents');\n\n\t\tsimulatedEvent._simulated = true;\n\t\te.target._simulatedClick = true;\n\n\t\tsimulatedEvent.initMouseEvent(\n\t\t        type, true, true, window, 1,\n\t\t        e.screenX, e.screenY,\n\t\t        e.clientX, e.clientY,\n\t\t        false, false, false, false, 0, null);\n\n\t\te.target.dispatchEvent(simulatedEvent);\n\t}\n});\n\nif (L.Browser.touch && !L.Browser.pointer) {\n\tL.Map.addInitHook('addHandler', 'tap', L.Map.Tap);\n}\n\n\n/*\n * L.Handler.ShiftDragZoom is used to add shift-drag zoom interaction to the map\n  * (zoom to a selected bounding box), enabled by default.\n */\n\nL.Map.mergeOptions({\n\tboxZoom: true\n});\n\nL.Map.BoxZoom = L.Handler.extend({\n\tinitialize: function (map) {\n\t\tthis._map = map;\n\t\tthis._container = map._container;\n\t\tthis._pane = map._panes.overlayPane;\n\t\tthis._moved = false;\n\t},\n\n\taddHooks: function () {\n\t\tL.DomEvent.on(this._container, 'mousedown', this._onMouseDown, this);\n\t},\n\n\tremoveHooks: function () {\n\t\tL.DomEvent.off(this._container, 'mousedown', this._onMouseDown);\n\t\tthis._moved = false;\n\t},\n\n\tmoved: function () {\n\t\treturn this._moved;\n\t},\n\n\t_onMouseDown: function (e) {\n\t\tthis._moved = false;\n\n\t\tif (!e.shiftKey || ((e.which !== 1) && (e.button !== 1))) { return false; }\n\n\t\tL.DomUtil.disableTextSelection();\n\t\tL.DomUtil.disableImageDrag();\n\n\t\tthis._startLayerPoint = this._map.mouseEventToLayerPoint(e);\n\n\t\tL.DomEvent\n\t\t    .on(document, 'mousemove', this._onMouseMove, this)\n\t\t    .on(document, 'mouseup', this._onMouseUp, this)\n\t\t    .on(document, 'keydown', this._onKeyDown, this);\n\t},\n\n\t_onMouseMove: function (e) {\n\t\tif (!this._moved) {\n\t\t\tthis._box = L.DomUtil.create('div', 'leaflet-zoom-box', this._pane);\n\t\t\tL.DomUtil.setPosition(this._box, this._startLayerPoint);\n\n\t\t\t//TODO refactor: move cursor to styles\n\t\t\tthis._container.style.cursor = 'crosshair';\n\t\t\tthis._map.fire('boxzoomstart');\n\t\t}\n\n\t\tvar startPoint = this._startLayerPoint,\n\t\t    box = this._box,\n\n\t\t    layerPoint = this._map.mouseEventToLayerPoint(e),\n\t\t    offset = layerPoint.subtract(startPoint),\n\n\t\t    newPos = new L.Point(\n\t\t        Math.min(layerPoint.x, startPoint.x),\n\t\t        Math.min(layerPoint.y, startPoint.y));\n\n\t\tL.DomUtil.setPosition(box, newPos);\n\n\t\tthis._moved = true;\n\n\t\t// TODO refactor: remove hardcoded 4 pixels\n\t\tbox.style.width  = (Math.max(0, Math.abs(offset.x) - 4)) + 'px';\n\t\tbox.style.height = (Math.max(0, Math.abs(offset.y) - 4)) + 'px';\n\t},\n\n\t_finish: function () {\n\t\tif (this._moved) {\n\t\t\tthis._pane.removeChild(this._box);\n\t\t\tthis._container.style.cursor = '';\n\t\t}\n\n\t\tL.DomUtil.enableTextSelection();\n\t\tL.DomUtil.enableImageDrag();\n\n\t\tL.DomEvent\n\t\t    .off(document, 'mousemove', this._onMouseMove)\n\t\t    .off(document, 'mouseup', this._onMouseUp)\n\t\t    .off(document, 'keydown', this._onKeyDown);\n\t},\n\n\t_onMouseUp: function (e) {\n\n\t\tthis._finish();\n\n\t\tvar map = this._map,\n\t\t    layerPoint = map.mouseEventToLayerPoint(e);\n\n\t\tif (this._startLayerPoint.equals(layerPoint)) { return; }\n\n\t\tvar bounds = new L.LatLngBounds(\n\t\t        map.layerPointToLatLng(this._startLayerPoint),\n\t\t        map.layerPointToLatLng(layerPoint));\n\n\t\tmap.fitBounds(bounds);\n\n\t\tmap.fire('boxzoomend', {\n\t\t\tboxZoomBounds: bounds\n\t\t});\n\t},\n\n\t_onKeyDown: function (e) {\n\t\tif (e.keyCode === 27) {\n\t\t\tthis._finish();\n\t\t}\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'boxZoom', L.Map.BoxZoom);\n\n\n/*\n * L.Map.Keyboard is handling keyboard interaction with the map, enabled by default.\n */\n\nL.Map.mergeOptions({\n\tkeyboard: true,\n\tkeyboardPanOffset: 80,\n\tkeyboardZoomOffset: 1\n});\n\nL.Map.Keyboard = L.Handler.extend({\n\n\tkeyCodes: {\n\t\tleft:    [37],\n\t\tright:   [39],\n\t\tdown:    [40],\n\t\tup:      [38],\n\t\tzoomIn:  [187, 107, 61, 171],\n\t\tzoomOut: [189, 109, 173]\n\t},\n\n\tinitialize: function (map) {\n\t\tthis._map = map;\n\n\t\tthis._setPanOffset(map.options.keyboardPanOffset);\n\t\tthis._setZoomOffset(map.options.keyboardZoomOffset);\n\t},\n\n\taddHooks: function () {\n\t\tvar container = this._map._container;\n\n\t\t// make the container focusable by tabbing\n\t\tif (container.tabIndex === -1) {\n\t\t\tcontainer.tabIndex = '0';\n\t\t}\n\n\t\tL.DomEvent\n\t\t    .on(container, 'focus', this._onFocus, this)\n\t\t    .on(container, 'blur', this._onBlur, this)\n\t\t    .on(container, 'mousedown', this._onMouseDown, this);\n\n\t\tthis._map\n\t\t    .on('focus', this._addHooks, this)\n\t\t    .on('blur', this._removeHooks, this);\n\t},\n\n\tremoveHooks: function () {\n\t\tthis._removeHooks();\n\n\t\tvar container = this._map._container;\n\n\t\tL.DomEvent\n\t\t    .off(container, 'focus', this._onFocus, this)\n\t\t    .off(container, 'blur', this._onBlur, this)\n\t\t    .off(container, 'mousedown', this._onMouseDown, this);\n\n\t\tthis._map\n\t\t    .off('focus', this._addHooks, this)\n\t\t    .off('blur', this._removeHooks, this);\n\t},\n\n\t_onMouseDown: function () {\n\t\tif (this._focused) { return; }\n\n\t\tvar body = document.body,\n\t\t    docEl = document.documentElement,\n\t\t    top = body.scrollTop || docEl.scrollTop,\n\t\t    left = body.scrollLeft || docEl.scrollLeft;\n\n\t\tthis._map._container.focus();\n\n\t\twindow.scrollTo(left, top);\n\t},\n\n\t_onFocus: function () {\n\t\tthis._focused = true;\n\t\tthis._map.fire('focus');\n\t},\n\n\t_onBlur: function () {\n\t\tthis._focused = false;\n\t\tthis._map.fire('blur');\n\t},\n\n\t_setPanOffset: function (pan) {\n\t\tvar keys = this._panKeys = {},\n\t\t    codes = this.keyCodes,\n\t\t    i, len;\n\n\t\tfor (i = 0, len = codes.left.length; i < len; i++) {\n\t\t\tkeys[codes.left[i]] = [-1 * pan, 0];\n\t\t}\n\t\tfor (i = 0, len = codes.right.length; i < len; i++) {\n\t\t\tkeys[codes.right[i]] = [pan, 0];\n\t\t}\n\t\tfor (i = 0, len = codes.down.length; i < len; i++) {\n\t\t\tkeys[codes.down[i]] = [0, pan];\n\t\t}\n\t\tfor (i = 0, len = codes.up.length; i < len; i++) {\n\t\t\tkeys[codes.up[i]] = [0, -1 * pan];\n\t\t}\n\t},\n\n\t_setZoomOffset: function (zoom) {\n\t\tvar keys = this._zoomKeys = {},\n\t\t    codes = this.keyCodes,\n\t\t    i, len;\n\n\t\tfor (i = 0, len = codes.zoomIn.length; i < len; i++) {\n\t\t\tkeys[codes.zoomIn[i]] = zoom;\n\t\t}\n\t\tfor (i = 0, len = codes.zoomOut.length; i < len; i++) {\n\t\t\tkeys[codes.zoomOut[i]] = -zoom;\n\t\t}\n\t},\n\n\t_addHooks: function () {\n\t\tL.DomEvent.on(document, 'keydown', this._onKeyDown, this);\n\t},\n\n\t_removeHooks: function () {\n\t\tL.DomEvent.off(document, 'keydown', this._onKeyDown, this);\n\t},\n\n\t_onKeyDown: function (e) {\n\t\tvar key = e.keyCode,\n\t\t    map = this._map;\n\n\t\tif (key in this._panKeys) {\n\n\t\t\tif (map._panAnim && map._panAnim._inProgress) { return; }\n\n\t\t\tmap.panBy(this._panKeys[key]);\n\n\t\t\tif (map.options.maxBounds) {\n\t\t\t\tmap.panInsideBounds(map.options.maxBounds);\n\t\t\t}\n\n\t\t} else if (key in this._zoomKeys) {\n\t\t\tmap.setZoom(map.getZoom() + this._zoomKeys[key]);\n\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tL.DomEvent.stop(e);\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'keyboard', L.Map.Keyboard);\n\n\n/*\n * L.Handler.MarkerDrag is used internally by L.Marker to make the markers draggable.\n */\n\nL.Handler.MarkerDrag = L.Handler.extend({\n\tinitialize: function (marker) {\n\t\tthis._marker = marker;\n\t},\n\n\taddHooks: function () {\n\t\tvar icon = this._marker._icon;\n\t\tif (!this._draggable) {\n\t\t\tthis._draggable = new L.Draggable(icon, icon);\n\t\t}\n\n\t\tthis._draggable\n\t\t\t.on('dragstart', this._onDragStart, this)\n\t\t\t.on('drag', this._onDrag, this)\n\t\t\t.on('dragend', this._onDragEnd, this);\n\t\tthis._draggable.enable();\n\t\tL.DomUtil.addClass(this._marker._icon, 'leaflet-marker-draggable');\n\t},\n\n\tremoveHooks: function () {\n\t\tthis._draggable\n\t\t\t.off('dragstart', this._onDragStart, this)\n\t\t\t.off('drag', this._onDrag, this)\n\t\t\t.off('dragend', this._onDragEnd, this);\n\n\t\tthis._draggable.disable();\n\t\tL.DomUtil.removeClass(this._marker._icon, 'leaflet-marker-draggable');\n\t},\n\n\tmoved: function () {\n\t\treturn this._draggable && this._draggable._moved;\n\t},\n\n\t_onDragStart: function () {\n\t\tthis._marker\n\t\t    .closePopup()\n\t\t    .fire('movestart')\n\t\t    .fire('dragstart');\n\t},\n\n\t_onDrag: function () {\n\t\tvar marker = this._marker,\n\t\t    shadow = marker._shadow,\n\t\t    iconPos = L.DomUtil.getPosition(marker._icon),\n\t\t    latlng = marker._map.layerPointToLatLng(iconPos);\n\n\t\t// update shadow position\n\t\tif (shadow) {\n\t\t\tL.DomUtil.setPosition(shadow, iconPos);\n\t\t}\n\n\t\tmarker._latlng = latlng;\n\n\t\tmarker\n\t\t    .fire('move', {latlng: latlng})\n\t\t    .fire('drag');\n\t},\n\n\t_onDragEnd: function (e) {\n\t\tthis._marker\n\t\t    .fire('moveend')\n\t\t    .fire('dragend', e);\n\t}\n});\n\n\n/*\r\n * L.Control is a base class for implementing map controls. Handles positioning.\r\n * All other controls extend from this class.\r\n */\r\n\r\nL.Control = L.Class.extend({\r\n\toptions: {\r\n\t\tposition: 'topright'\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tgetPosition: function () {\r\n\t\treturn this.options.position;\r\n\t},\r\n\r\n\tsetPosition: function (position) {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (map) {\r\n\t\t\tmap.removeControl(this);\r\n\t\t}\r\n\r\n\t\tthis.options.position = position;\r\n\r\n\t\tif (map) {\r\n\t\t\tmap.addControl(this);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetContainer: function () {\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tvar container = this._container = this.onAdd(map),\r\n\t\t    pos = this.getPosition(),\r\n\t\t    corner = map._controlCorners[pos];\r\n\r\n\t\tL.DomUtil.addClass(container, 'leaflet-control');\r\n\r\n\t\tif (pos.indexOf('bottom') !== -1) {\r\n\t\t\tcorner.insertBefore(container, corner.firstChild);\r\n\t\t} else {\r\n\t\t\tcorner.appendChild(container);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveFrom: function (map) {\r\n\t\tvar pos = this.getPosition(),\r\n\t\t    corner = map._controlCorners[pos];\r\n\r\n\t\tcorner.removeChild(this._container);\r\n\t\tthis._map = null;\r\n\r\n\t\tif (this.onRemove) {\r\n\t\t\tthis.onRemove(map);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_refocusOnMap: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.getContainer().focus();\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.control = function (options) {\r\n\treturn new L.Control(options);\r\n};\r\n\r\n\r\n// adds control-related methods to L.Map\r\n\r\nL.Map.include({\r\n\taddControl: function (control) {\r\n\t\tcontrol.addTo(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveControl: function (control) {\r\n\t\tcontrol.removeFrom(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_initControlPos: function () {\r\n\t\tvar corners = this._controlCorners = {},\r\n\t\t    l = 'leaflet-',\r\n\t\t    container = this._controlContainer =\r\n\t\t            L.DomUtil.create('div', l + 'control-container', this._container);\r\n\r\n\t\tfunction createCorner(vSide, hSide) {\r\n\t\t\tvar className = l + vSide + ' ' + l + hSide;\r\n\r\n\t\t\tcorners[vSide + hSide] = L.DomUtil.create('div', className, container);\r\n\t\t}\r\n\r\n\t\tcreateCorner('top', 'left');\r\n\t\tcreateCorner('top', 'right');\r\n\t\tcreateCorner('bottom', 'left');\r\n\t\tcreateCorner('bottom', 'right');\r\n\t},\r\n\r\n\t_clearControlPos: function () {\r\n\t\tthis._container.removeChild(this._controlContainer);\r\n\t}\r\n});\r\n\n\n/*\r\n * L.Control.Zoom is used for the default zoom buttons on the map.\r\n */\r\n\r\nL.Control.Zoom = L.Control.extend({\r\n\toptions: {\r\n\t\tposition: 'topleft',\r\n\t\tzoomInText: '+',\r\n\t\tzoomInTitle: 'Zoom in',\r\n\t\tzoomOutText: '-',\r\n\t\tzoomOutTitle: 'Zoom out'\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tvar zoomName = 'leaflet-control-zoom',\r\n\t\t    container = L.DomUtil.create('div', zoomName + ' leaflet-bar');\r\n\r\n\t\tthis._map = map;\r\n\r\n\t\tthis._zoomInButton  = this._createButton(\r\n\t\t        this.options.zoomInText, this.options.zoomInTitle,\r\n\t\t        zoomName + '-in',  container, this._zoomIn,  this);\r\n\t\tthis._zoomOutButton = this._createButton(\r\n\t\t        this.options.zoomOutText, this.options.zoomOutTitle,\r\n\t\t        zoomName + '-out', container, this._zoomOut, this);\r\n\r\n\t\tthis._updateDisabled();\r\n\t\tmap.on('zoomend zoomlevelschange', this._updateDisabled, this);\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap.off('zoomend zoomlevelschange', this._updateDisabled, this);\r\n\t},\r\n\r\n\t_zoomIn: function (e) {\r\n\t\tthis._map.zoomIn(e.shiftKey ? 3 : 1);\r\n\t},\r\n\r\n\t_zoomOut: function (e) {\r\n\t\tthis._map.zoomOut(e.shiftKey ? 3 : 1);\r\n\t},\r\n\r\n\t_createButton: function (html, title, className, container, fn, context) {\r\n\t\tvar link = L.DomUtil.create('a', className, container);\r\n\t\tlink.innerHTML = html;\r\n\t\tlink.href = '#';\r\n\t\tlink.title = title;\r\n\r\n\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\tL.DomEvent\r\n\t\t    .on(link, 'click', stop)\r\n\t\t    .on(link, 'mousedown', stop)\r\n\t\t    .on(link, 'dblclick', stop)\r\n\t\t    .on(link, 'click', L.DomEvent.preventDefault)\r\n\t\t    .on(link, 'click', fn, context)\r\n\t\t    .on(link, 'click', this._refocusOnMap, context);\r\n\r\n\t\treturn link;\r\n\t},\r\n\r\n\t_updateDisabled: function () {\r\n\t\tvar map = this._map,\r\n\t\t\tclassName = 'leaflet-disabled';\r\n\r\n\t\tL.DomUtil.removeClass(this._zoomInButton, className);\r\n\t\tL.DomUtil.removeClass(this._zoomOutButton, className);\r\n\r\n\t\tif (map._zoom === map.getMinZoom()) {\r\n\t\t\tL.DomUtil.addClass(this._zoomOutButton, className);\r\n\t\t}\r\n\t\tif (map._zoom === map.getMaxZoom()) {\r\n\t\t\tL.DomUtil.addClass(this._zoomInButton, className);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.mergeOptions({\r\n\tzoomControl: true\r\n});\r\n\r\nL.Map.addInitHook(function () {\r\n\tif (this.options.zoomControl) {\r\n\t\tthis.zoomControl = new L.Control.Zoom();\r\n\t\tthis.addControl(this.zoomControl);\r\n\t}\r\n});\r\n\r\nL.control.zoom = function (options) {\r\n\treturn new L.Control.Zoom(options);\r\n};\r\n\r\n\n\n/*\r\n * L.Control.Attribution is used for displaying attribution on the map (added by default).\r\n */\r\n\r\nL.Control.Attribution = L.Control.extend({\r\n\toptions: {\r\n\t\tposition: 'bottomright',\r\n\t\tprefix: '<a href=\"http://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a>'\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._attributions = {};\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._container = L.DomUtil.create('div', 'leaflet-control-attribution');\r\n\t\tL.DomEvent.disableClickPropagation(this._container);\r\n\r\n\t\tfor (var i in map._layers) {\r\n\t\t\tif (map._layers[i].getAttribution) {\r\n\t\t\t\tthis.addAttribution(map._layers[i].getAttribution());\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tmap\r\n\t\t    .on('layeradd', this._onLayerAdd, this)\r\n\t\t    .on('layerremove', this._onLayerRemove, this);\r\n\r\n\t\tthis._update();\r\n\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap\r\n\t\t    .off('layeradd', this._onLayerAdd)\r\n\t\t    .off('layerremove', this._onLayerRemove);\r\n\r\n\t},\r\n\r\n\tsetPrefix: function (prefix) {\r\n\t\tthis.options.prefix = prefix;\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddAttribution: function (text) {\r\n\t\tif (!text) { return; }\r\n\r\n\t\tif (!this._attributions[text]) {\r\n\t\t\tthis._attributions[text] = 0;\r\n\t\t}\r\n\t\tthis._attributions[text]++;\r\n\r\n\t\tthis._update();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveAttribution: function (text) {\r\n\t\tif (!text) { return; }\r\n\r\n\t\tif (this._attributions[text]) {\r\n\t\t\tthis._attributions[text]--;\r\n\t\t\tthis._update();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_update: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tvar attribs = [];\r\n\r\n\t\tfor (var i in this._attributions) {\r\n\t\t\tif (this._attributions[i]) {\r\n\t\t\t\tattribs.push(i);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar prefixAndAttribs = [];\r\n\r\n\t\tif (this.options.prefix) {\r\n\t\t\tprefixAndAttribs.push(this.options.prefix);\r\n\t\t}\r\n\t\tif (attribs.length) {\r\n\t\t\tprefixAndAttribs.push(attribs.join(', '));\r\n\t\t}\r\n\r\n\t\tthis._container.innerHTML = prefixAndAttribs.join(' | ');\r\n\t},\r\n\r\n\t_onLayerAdd: function (e) {\r\n\t\tif (e.layer.getAttribution) {\r\n\t\t\tthis.addAttribution(e.layer.getAttribution());\r\n\t\t}\r\n\t},\r\n\r\n\t_onLayerRemove: function (e) {\r\n\t\tif (e.layer.getAttribution) {\r\n\t\t\tthis.removeAttribution(e.layer.getAttribution());\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.mergeOptions({\r\n\tattributionControl: true\r\n});\r\n\r\nL.Map.addInitHook(function () {\r\n\tif (this.options.attributionControl) {\r\n\t\tthis.attributionControl = (new L.Control.Attribution()).addTo(this);\r\n\t}\r\n});\r\n\r\nL.control.attribution = function (options) {\r\n\treturn new L.Control.Attribution(options);\r\n};\r\n\n\n/*\n * L.Control.Scale is used for displaying metric/imperial scale on the map.\n */\n\nL.Control.Scale = L.Control.extend({\n\toptions: {\n\t\tposition: 'bottomleft',\n\t\tmaxWidth: 100,\n\t\tmetric: true,\n\t\timperial: true,\n\t\tupdateWhenIdle: false\n\t},\n\n\tonAdd: function (map) {\n\t\tthis._map = map;\n\n\t\tvar className = 'leaflet-control-scale',\n\t\t    container = L.DomUtil.create('div', className),\n\t\t    options = this.options;\n\n\t\tthis._addScales(options, className, container);\n\n\t\tmap.on(options.updateWhenIdle ? 'moveend' : 'move', this._update, this);\n\t\tmap.whenReady(this._update, this);\n\n\t\treturn container;\n\t},\n\n\tonRemove: function (map) {\n\t\tmap.off(this.options.updateWhenIdle ? 'moveend' : 'move', this._update, this);\n\t},\n\n\t_addScales: function (options, className, container) {\n\t\tif (options.metric) {\n\t\t\tthis._mScale = L.DomUtil.create('div', className + '-line', container);\n\t\t}\n\t\tif (options.imperial) {\n\t\t\tthis._iScale = L.DomUtil.create('div', className + '-line', container);\n\t\t}\n\t},\n\n\t_update: function () {\n\t\tvar bounds = this._map.getBounds(),\n\t\t    centerLat = bounds.getCenter().lat,\n\t\t    halfWorldMeters = 6378137 * Math.PI * Math.cos(centerLat * Math.PI / 180),\n\t\t    dist = halfWorldMeters * (bounds.getNorthEast().lng - bounds.getSouthWest().lng) / 180,\n\n\t\t    size = this._map.getSize(),\n\t\t    options = this.options,\n\t\t    maxMeters = 0;\n\n\t\tif (size.x > 0) {\n\t\t\tmaxMeters = dist * (options.maxWidth / size.x);\n\t\t}\n\n\t\tthis._updateScales(options, maxMeters);\n\t},\n\n\t_updateScales: function (options, maxMeters) {\n\t\tif (options.metric && maxMeters) {\n\t\t\tthis._updateMetric(maxMeters);\n\t\t}\n\n\t\tif (options.imperial && maxMeters) {\n\t\t\tthis._updateImperial(maxMeters);\n\t\t}\n\t},\n\n\t_updateMetric: function (maxMeters) {\n\t\tvar meters = this._getRoundNum(maxMeters);\n\n\t\tthis._mScale.style.width = this._getScaleWidth(meters / maxMeters) + 'px';\n\t\tthis._mScale.innerHTML = meters < 1000 ? meters + ' m' : (meters / 1000) + ' km';\n\t},\n\n\t_updateImperial: function (maxMeters) {\n\t\tvar maxFeet = maxMeters * 3.2808399,\n\t\t    scale = this._iScale,\n\t\t    maxMiles, miles, feet;\n\n\t\tif (maxFeet > 5280) {\n\t\t\tmaxMiles = maxFeet / 5280;\n\t\t\tmiles = this._getRoundNum(maxMiles);\n\n\t\t\tscale.style.width = this._getScaleWidth(miles / maxMiles) + 'px';\n\t\t\tscale.innerHTML = miles + ' mi';\n\n\t\t} else {\n\t\t\tfeet = this._getRoundNum(maxFeet);\n\n\t\t\tscale.style.width = this._getScaleWidth(feet / maxFeet) + 'px';\n\t\t\tscale.innerHTML = feet + ' ft';\n\t\t}\n\t},\n\n\t_getScaleWidth: function (ratio) {\n\t\treturn Math.round(this.options.maxWidth * ratio) - 10;\n\t},\n\n\t_getRoundNum: function (num) {\n\t\tvar pow10 = Math.pow(10, (Math.floor(num) + '').length - 1),\n\t\t    d = num / pow10;\n\n\t\td = d >= 10 ? 10 : d >= 5 ? 5 : d >= 3 ? 3 : d >= 2 ? 2 : 1;\n\n\t\treturn pow10 * d;\n\t}\n});\n\nL.control.scale = function (options) {\n\treturn new L.Control.Scale(options);\n};\n\n\n/*\r\n * L.Control.Layers is a control to allow users to switch between different layers on the map.\r\n */\r\n\r\nL.Control.Layers = L.Control.extend({\r\n\toptions: {\r\n\t\tcollapsed: true,\r\n\t\tposition: 'topright',\r\n\t\tautoZIndex: true\r\n\t},\r\n\r\n\tinitialize: function (baseLayers, overlays, options) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._layers = {};\r\n\t\tthis._lastZIndex = 0;\r\n\t\tthis._handlingClick = false;\r\n\r\n\t\tfor (var i in baseLayers) {\r\n\t\t\tthis._addLayer(baseLayers[i], i);\r\n\t\t}\r\n\r\n\t\tfor (i in overlays) {\r\n\t\t\tthis._addLayer(overlays[i], i, true);\r\n\t\t}\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._initLayout();\r\n\t\tthis._update();\r\n\r\n\t\tmap\r\n\t\t    .on('layeradd', this._onLayerChange, this)\r\n\t\t    .on('layerremove', this._onLayerChange, this);\r\n\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap\r\n\t\t    .off('layeradd', this._onLayerChange, this)\r\n\t\t    .off('layerremove', this._onLayerChange, this);\r\n\t},\r\n\r\n\taddBaseLayer: function (layer, name) {\r\n\t\tthis._addLayer(layer, name);\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddOverlay: function (layer, name) {\r\n\t\tthis._addLayer(layer, name, true);\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tvar id = L.stamp(layer);\r\n\t\tdelete this._layers[id];\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_initLayout: function () {\r\n\t\tvar className = 'leaflet-control-layers',\r\n\t\t    container = this._container = L.DomUtil.create('div', className);\r\n\r\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\r\n\t\tcontainer.setAttribute('aria-haspopup', true);\r\n\r\n\t\tif (!L.Browser.touch) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.disableClickPropagation(container)\r\n\t\t\t\t.disableScrollPropagation(container);\r\n\t\t} else {\r\n\t\t\tL.DomEvent.on(container, 'click', L.DomEvent.stopPropagation);\r\n\t\t}\r\n\r\n\t\tvar form = this._form = L.DomUtil.create('form', className + '-list');\r\n\r\n\t\tif (this.options.collapsed) {\r\n\t\t\tif (!L.Browser.android) {\r\n\t\t\t\tL.DomEvent\r\n\t\t\t\t    .on(container, 'mouseover', this._expand, this)\r\n\t\t\t\t    .on(container, 'mouseout', this._collapse, this);\r\n\t\t\t}\r\n\t\t\tvar link = this._layersLink = L.DomUtil.create('a', className + '-toggle', container);\r\n\t\t\tlink.href = '#';\r\n\t\t\tlink.title = 'Layers';\r\n\r\n\t\t\tif (L.Browser.touch) {\r\n\t\t\t\tL.DomEvent\r\n\t\t\t\t    .on(link, 'click', L.DomEvent.stop)\r\n\t\t\t\t    .on(link, 'click', this._expand, this);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tL.DomEvent.on(link, 'focus', this._expand, this);\r\n\t\t\t}\r\n\t\t\t//Work around for Firefox android issue https://github.com/Leaflet/Leaflet/issues/2033\r\n\t\t\tL.DomEvent.on(form, 'click', function () {\r\n\t\t\t\tsetTimeout(L.bind(this._onInputClick, this), 0);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis._map.on('click', this._collapse, this);\r\n\t\t\t// TODO keyboard accessibility\r\n\t\t} else {\r\n\t\t\tthis._expand();\r\n\t\t}\r\n\r\n\t\tthis._baseLayersList = L.DomUtil.create('div', className + '-base', form);\r\n\t\tthis._separator = L.DomUtil.create('div', className + '-separator', form);\r\n\t\tthis._overlaysList = L.DomUtil.create('div', className + '-overlays', form);\r\n\r\n\t\tcontainer.appendChild(form);\r\n\t},\r\n\r\n\t_addLayer: function (layer, name, overlay) {\r\n\t\tvar id = L.stamp(layer);\r\n\r\n\t\tthis._layers[id] = {\r\n\t\t\tlayer: layer,\r\n\t\t\tname: name,\r\n\t\t\toverlay: overlay\r\n\t\t};\r\n\r\n\t\tif (this.options.autoZIndex && layer.setZIndex) {\r\n\t\t\tthis._lastZIndex++;\r\n\t\t\tlayer.setZIndex(this._lastZIndex);\r\n\t\t}\r\n\t},\r\n\r\n\t_update: function () {\r\n\t\tif (!this._container) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._baseLayersList.innerHTML = '';\r\n\t\tthis._overlaysList.innerHTML = '';\r\n\r\n\t\tvar baseLayersPresent = false,\r\n\t\t    overlaysPresent = false,\r\n\t\t    i, obj;\r\n\r\n\t\tfor (i in this._layers) {\r\n\t\t\tobj = this._layers[i];\r\n\t\t\tthis._addItem(obj);\r\n\t\t\toverlaysPresent = overlaysPresent || obj.overlay;\r\n\t\t\tbaseLayersPresent = baseLayersPresent || !obj.overlay;\r\n\t\t}\r\n\r\n\t\tthis._separator.style.display = overlaysPresent && baseLayersPresent ? '' : 'none';\r\n\t},\r\n\r\n\t_onLayerChange: function (e) {\r\n\t\tvar obj = this._layers[L.stamp(e.layer)];\r\n\r\n\t\tif (!obj) { return; }\r\n\r\n\t\tif (!this._handlingClick) {\r\n\t\t\tthis._update();\r\n\t\t}\r\n\r\n\t\tvar type = obj.overlay ?\r\n\t\t\t(e.type === 'layeradd' ? 'overlayadd' : 'overlayremove') :\r\n\t\t\t(e.type === 'layeradd' ? 'baselayerchange' : null);\r\n\r\n\t\tif (type) {\r\n\t\t\tthis._map.fire(type, obj);\r\n\t\t}\r\n\t},\r\n\r\n\t// IE7 bugs out if you create a radio dynamically, so you have to do it this hacky way (see http://bit.ly/PqYLBe)\r\n\t_createRadioElement: function (name, checked) {\r\n\r\n\t\tvar radioHtml = '<input type=\"radio\" class=\"leaflet-control-layers-selector\" name=\"' + name + '\"';\r\n\t\tif (checked) {\r\n\t\t\tradioHtml += ' checked=\"checked\"';\r\n\t\t}\r\n\t\tradioHtml += '/>';\r\n\r\n\t\tvar radioFragment = document.createElement('div');\r\n\t\tradioFragment.innerHTML = radioHtml;\r\n\r\n\t\treturn radioFragment.firstChild;\r\n\t},\r\n\r\n\t_addItem: function (obj) {\r\n\t\tvar label = document.createElement('label'),\r\n\t\t    input,\r\n\t\t    checked = this._map.hasLayer(obj.layer);\r\n\r\n\t\tif (obj.overlay) {\r\n\t\t\tinput = document.createElement('input');\r\n\t\t\tinput.type = 'checkbox';\r\n\t\t\tinput.className = 'leaflet-control-layers-selector';\r\n\t\t\tinput.defaultChecked = checked;\r\n\t\t} else {\r\n\t\t\tinput = this._createRadioElement('leaflet-base-layers', checked);\r\n\t\t}\r\n\r\n\t\tinput.layerId = L.stamp(obj.layer);\r\n\r\n\t\tL.DomEvent.on(input, 'click', this._onInputClick, this);\r\n\r\n\t\tvar name = document.createElement('span');\r\n\t\tname.innerHTML = ' ' + obj.name;\r\n\r\n\t\tlabel.appendChild(input);\r\n\t\tlabel.appendChild(name);\r\n\r\n\t\tvar container = obj.overlay ? this._overlaysList : this._baseLayersList;\r\n\t\tcontainer.appendChild(label);\r\n\r\n\t\treturn label;\r\n\t},\r\n\r\n\t_onInputClick: function () {\r\n\t\tvar i, input, obj,\r\n\t\t    inputs = this._form.getElementsByTagName('input'),\r\n\t\t    inputsLen = inputs.length;\r\n\r\n\t\tthis._handlingClick = true;\r\n\r\n\t\tfor (i = 0; i < inputsLen; i++) {\r\n\t\t\tinput = inputs[i];\r\n\t\t\tobj = this._layers[input.layerId];\r\n\r\n\t\t\tif (input.checked && !this._map.hasLayer(obj.layer)) {\r\n\t\t\t\tthis._map.addLayer(obj.layer);\r\n\r\n\t\t\t} else if (!input.checked && this._map.hasLayer(obj.layer)) {\r\n\t\t\t\tthis._map.removeLayer(obj.layer);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._handlingClick = false;\r\n\r\n\t\tthis._refocusOnMap();\r\n\t},\r\n\r\n\t_expand: function () {\r\n\t\tL.DomUtil.addClass(this._container, 'leaflet-control-layers-expanded');\r\n\t},\r\n\r\n\t_collapse: function () {\r\n\t\tthis._container.className = this._container.className.replace(' leaflet-control-layers-expanded', '');\r\n\t}\r\n});\r\n\r\nL.control.layers = function (baseLayers, overlays, options) {\r\n\treturn new L.Control.Layers(baseLayers, overlays, options);\r\n};\r\n\n\n/*\n * L.PosAnimation is used by Leaflet internally for pan animations.\n */\n\nL.PosAnimation = L.Class.extend({\n\tincludes: L.Mixin.Events,\n\n\trun: function (el, newPos, duration, easeLinearity) { // (HTMLElement, Point[, Number, Number])\n\t\tthis.stop();\n\n\t\tthis._el = el;\n\t\tthis._inProgress = true;\n\t\tthis._newPos = newPos;\n\n\t\tthis.fire('start');\n\n\t\tel.style[L.DomUtil.TRANSITION] = 'all ' + (duration || 0.25) +\n\t\t        's cubic-bezier(0,0,' + (easeLinearity || 0.5) + ',1)';\n\n\t\tL.DomEvent.on(el, L.DomUtil.TRANSITION_END, this._onTransitionEnd, this);\n\t\tL.DomUtil.setPosition(el, newPos);\n\n\t\t// toggle reflow, Chrome flickers for some reason if you don't do this\n\t\tL.Util.falseFn(el.offsetWidth);\n\n\t\t// there's no native way to track value updates of transitioned properties, so we imitate this\n\t\tthis._stepTimer = setInterval(L.bind(this._onStep, this), 50);\n\t},\n\n\tstop: function () {\n\t\tif (!this._inProgress) { return; }\n\n\t\t// if we just removed the transition property, the element would jump to its final position,\n\t\t// so we need to make it stay at the current position\n\n\t\tL.DomUtil.setPosition(this._el, this._getPos());\n\t\tthis._onTransitionEnd();\n\t\tL.Util.falseFn(this._el.offsetWidth); // force reflow in case we are about to start a new animation\n\t},\n\n\t_onStep: function () {\n\t\tvar stepPos = this._getPos();\n\t\tif (!stepPos) {\n\t\t\tthis._onTransitionEnd();\n\t\t\treturn;\n\t\t}\n\t\t// jshint camelcase: false\n\t\t// make L.DomUtil.getPosition return intermediate position value during animation\n\t\tthis._el._leaflet_pos = stepPos;\n\n\t\tthis.fire('step');\n\t},\n\n\t// you can't easily get intermediate values of properties animated with CSS3 Transitions,\n\t// we need to parse computed style (in case of transform it returns matrix string)\n\n\t_transformRe: /([-+]?(?:\\d*\\.)?\\d+)\\D*, ([-+]?(?:\\d*\\.)?\\d+)\\D*\\)/,\n\n\t_getPos: function () {\n\t\tvar left, top, matches,\n\t\t    el = this._el,\n\t\t    style = window.getComputedStyle(el);\n\n\t\tif (L.Browser.any3d) {\n\t\t\tmatches = style[L.DomUtil.TRANSFORM].match(this._transformRe);\n\t\t\tif (!matches) { return; }\n\t\t\tleft = parseFloat(matches[1]);\n\t\t\ttop  = parseFloat(matches[2]);\n\t\t} else {\n\t\t\tleft = parseFloat(style.left);\n\t\t\ttop  = parseFloat(style.top);\n\t\t}\n\n\t\treturn new L.Point(left, top, true);\n\t},\n\n\t_onTransitionEnd: function () {\n\t\tL.DomEvent.off(this._el, L.DomUtil.TRANSITION_END, this._onTransitionEnd, this);\n\n\t\tif (!this._inProgress) { return; }\n\t\tthis._inProgress = false;\n\n\t\tthis._el.style[L.DomUtil.TRANSITION] = '';\n\n\t\t// jshint camelcase: false\n\t\t// make sure L.DomUtil.getPosition returns the final position value after animation\n\t\tthis._el._leaflet_pos = this._newPos;\n\n\t\tclearInterval(this._stepTimer);\n\n\t\tthis.fire('step').fire('end');\n\t}\n\n});\n\n\n/*\n * Extends L.Map to handle panning animations.\n */\n\nL.Map.include({\n\n\tsetView: function (center, zoom, options) {\n\n\t\tzoom = zoom === undefined ? this._zoom : this._limitZoom(zoom);\n\t\tcenter = this._limitCenter(L.latLng(center), zoom, this.options.maxBounds);\n\t\toptions = options || {};\n\n\t\tif (this._panAnim) {\n\t\t\tthis._panAnim.stop();\n\t\t}\n\n\t\tif (this._loaded && !options.reset && options !== true) {\n\n\t\t\tif (options.animate !== undefined) {\n\t\t\t\toptions.zoom = L.extend({animate: options.animate}, options.zoom);\n\t\t\t\toptions.pan = L.extend({animate: options.animate}, options.pan);\n\t\t\t}\n\n\t\t\t// try animating pan or zoom\n\t\t\tvar animated = (this._zoom !== zoom) ?\n\t\t\t\tthis._tryAnimatedZoom && this._tryAnimatedZoom(center, zoom, options.zoom) :\n\t\t\t\tthis._tryAnimatedPan(center, options.pan);\n\n\t\t\tif (animated) {\n\t\t\t\t// prevent resize handler call, the view will refresh after animation anyway\n\t\t\t\tclearTimeout(this._sizeTimer);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}\n\n\t\t// animation didn't start, just reset the map view\n\t\tthis._resetView(center, zoom);\n\n\t\treturn this;\n\t},\n\n\tpanBy: function (offset, options) {\n\t\toffset = L.point(offset).round();\n\t\toptions = options || {};\n\n\t\tif (!offset.x && !offset.y) {\n\t\t\treturn this;\n\t\t}\n\n\t\tif (!this._panAnim) {\n\t\t\tthis._panAnim = new L.PosAnimation();\n\n\t\t\tthis._panAnim.on({\n\t\t\t\t'step': this._onPanTransitionStep,\n\t\t\t\t'end': this._onPanTransitionEnd\n\t\t\t}, this);\n\t\t}\n\n\t\t// don't fire movestart if animating inertia\n\t\tif (!options.noMoveStart) {\n\t\t\tthis.fire('movestart');\n\t\t}\n\n\t\t// animate pan unless animate: false specified\n\t\tif (options.animate !== false) {\n\t\t\tL.DomUtil.addClass(this._mapPane, 'leaflet-pan-anim');\n\n\t\t\tvar newPos = this._getMapPanePos().subtract(offset);\n\t\t\tthis._panAnim.run(this._mapPane, newPos, options.duration || 0.25, options.easeLinearity);\n\t\t} else {\n\t\t\tthis._rawPanBy(offset);\n\t\t\tthis.fire('move').fire('moveend');\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t_onPanTransitionStep: function () {\n\t\tthis.fire('move');\n\t},\n\n\t_onPanTransitionEnd: function () {\n\t\tL.DomUtil.removeClass(this._mapPane, 'leaflet-pan-anim');\n\t\tthis.fire('moveend');\n\t},\n\n\t_tryAnimatedPan: function (center, options) {\n\t\t// difference between the new and current centers in pixels\n\t\tvar offset = this._getCenterOffset(center)._floor();\n\n\t\t// don't animate too far unless animate: true specified in options\n\t\tif ((options && options.animate) !== true && !this.getSize().contains(offset)) { return false; }\n\n\t\tthis.panBy(offset, options);\n\n\t\treturn true;\n\t}\n});\n\n\n/*\n * L.PosAnimation fallback implementation that powers Leaflet pan animations\n * in browsers that don't support CSS3 Transitions.\n */\n\nL.PosAnimation = L.DomUtil.TRANSITION ? L.PosAnimation : L.PosAnimation.extend({\n\n\trun: function (el, newPos, duration, easeLinearity) { // (HTMLElement, Point[, Number, Number])\n\t\tthis.stop();\n\n\t\tthis._el = el;\n\t\tthis._inProgress = true;\n\t\tthis._duration = duration || 0.25;\n\t\tthis._easeOutPower = 1 / Math.max(easeLinearity || 0.5, 0.2);\n\n\t\tthis._startPos = L.DomUtil.getPosition(el);\n\t\tthis._offset = newPos.subtract(this._startPos);\n\t\tthis._startTime = +new Date();\n\n\t\tthis.fire('start');\n\n\t\tthis._animate();\n\t},\n\n\tstop: function () {\n\t\tif (!this._inProgress) { return; }\n\n\t\tthis._step();\n\t\tthis._complete();\n\t},\n\n\t_animate: function () {\n\t\t// animation loop\n\t\tthis._animId = L.Util.requestAnimFrame(this._animate, this);\n\t\tthis._step();\n\t},\n\n\t_step: function () {\n\t\tvar elapsed = (+new Date()) - this._startTime,\n\t\t    duration = this._duration * 1000;\n\n\t\tif (elapsed < duration) {\n\t\t\tthis._runFrame(this._easeOut(elapsed / duration));\n\t\t} else {\n\t\t\tthis._runFrame(1);\n\t\t\tthis._complete();\n\t\t}\n\t},\n\n\t_runFrame: function (progress) {\n\t\tvar pos = this._startPos.add(this._offset.multiplyBy(progress));\n\t\tL.DomUtil.setPosition(this._el, pos);\n\n\t\tthis.fire('step');\n\t},\n\n\t_complete: function () {\n\t\tL.Util.cancelAnimFrame(this._animId);\n\n\t\tthis._inProgress = false;\n\t\tthis.fire('end');\n\t},\n\n\t_easeOut: function (t) {\n\t\treturn 1 - Math.pow(1 - t, this._easeOutPower);\n\t}\n});\n\n\n/*\n * Extends L.Map to handle zoom animations.\n */\n\nL.Map.mergeOptions({\n\tzoomAnimation: true,\n\tzoomAnimationThreshold: 4\n});\n\nif (L.DomUtil.TRANSITION) {\n\n\tL.Map.addInitHook(function () {\n\t\t// don't animate on browsers without hardware-accelerated transitions or old Android/Opera\n\t\tthis._zoomAnimated = this.options.zoomAnimation && L.DomUtil.TRANSITION &&\n\t\t\t\tL.Browser.any3d && !L.Browser.android23 && !L.Browser.mobileOpera;\n\n\t\t// zoom transitions run with the same duration for all layers, so if one of transitionend events\n\t\t// happens after starting zoom animation (propagating to the map pane), we know that it ended globally\n\t\tif (this._zoomAnimated) {\n\t\t\tL.DomEvent.on(this._mapPane, L.DomUtil.TRANSITION_END, this._catchTransitionEnd, this);\n\t\t}\n\t});\n}\n\nL.Map.include(!L.DomUtil.TRANSITION ? {} : {\n\n\t_catchTransitionEnd: function (e) {\n\t\tif (this._animatingZoom && e.propertyName.indexOf('transform') >= 0) {\n\t\t\tthis._onZoomTransitionEnd();\n\t\t}\n\t},\n\n\t_nothingToAnimate: function () {\n\t\treturn !this._container.getElementsByClassName('leaflet-zoom-animated').length;\n\t},\n\n\t_tryAnimatedZoom: function (center, zoom, options) {\n\n\t\tif (this._animatingZoom) { return true; }\n\n\t\toptions = options || {};\n\n\t\t// don't animate if disabled, not supported or zoom difference is too large\n\t\tif (!this._zoomAnimated || options.animate === false || this._nothingToAnimate() ||\n\t\t        Math.abs(zoom - this._zoom) > this.options.zoomAnimationThreshold) { return false; }\n\n\t\t// offset is the pixel coords of the zoom origin relative to the current center\n\t\tvar scale = this.getZoomScale(zoom),\n\t\t    offset = this._getCenterOffset(center)._divideBy(1 - 1 / scale),\n\t\t\torigin = this._getCenterLayerPoint()._add(offset);\n\n\t\t// don't animate if the zoom origin isn't within one screen from the current center, unless forced\n\t\tif (options.animate !== true && !this.getSize().contains(offset)) { return false; }\n\n\t\tthis\n\t\t    .fire('movestart')\n\t\t    .fire('zoomstart');\n\n\t\tthis._animateZoom(center, zoom, origin, scale, null, true);\n\n\t\treturn true;\n\t},\n\n\t_animateZoom: function (center, zoom, origin, scale, delta, backwards, forTouchZoom) {\n\n\t\tif (!forTouchZoom) {\n\t\t\tthis._animatingZoom = true;\n\t\t}\n\n\t\t// put transform transition on all layers with leaflet-zoom-animated class\n\t\tL.DomUtil.addClass(this._mapPane, 'leaflet-zoom-anim');\n\n\t\t// remember what center/zoom to set after animation\n\t\tthis._animateToCenter = center;\n\t\tthis._animateToZoom = zoom;\n\n\t\t// disable any dragging during animation\n\t\tif (L.Draggable) {\n\t\t\tL.Draggable._disabled = true;\n\t\t}\n\n\t\tL.Util.requestAnimFrame(function () {\n\t\t\tthis.fire('zoomanim', {\n\t\t\t\tcenter: center,\n\t\t\t\tzoom: zoom,\n\t\t\t\torigin: origin,\n\t\t\t\tscale: scale,\n\t\t\t\tdelta: delta,\n\t\t\t\tbackwards: backwards\n\t\t\t});\n\t\t\t// horrible hack to work around a Chrome bug https://github.com/Leaflet/Leaflet/issues/3689\n\t\t\tsetTimeout(L.bind(this._onZoomTransitionEnd, this), 250);\n\t\t}, this);\n\t},\n\n\t_onZoomTransitionEnd: function () {\n\t\tif (!this._animatingZoom) { return; }\n\n\t\tthis._animatingZoom = false;\n\n\t\tL.DomUtil.removeClass(this._mapPane, 'leaflet-zoom-anim');\n\n\t\tL.Util.requestAnimFrame(function () {\n\t\t\tthis._resetView(this._animateToCenter, this._animateToZoom, true, true);\n\n\t\t\tif (L.Draggable) {\n\t\t\t\tL.Draggable._disabled = false;\n\t\t\t}\n\t\t}, this);\n\t}\n});\n\n\n/*\n\tZoom animation logic for L.TileLayer.\n*/\n\nL.TileLayer.include({\n\t_animateZoom: function (e) {\n\t\tif (!this._animating) {\n\t\t\tthis._animating = true;\n\t\t\tthis._prepareBgBuffer();\n\t\t}\n\n\t\tvar bg = this._bgBuffer,\n\t\t    transform = L.DomUtil.TRANSFORM,\n\t\t    initialTransform = e.delta ? L.DomUtil.getTranslateString(e.delta) : bg.style[transform],\n\t\t    scaleStr = L.DomUtil.getScaleString(e.scale, e.origin);\n\n\t\tbg.style[transform] = e.backwards ?\n\t\t\t\tscaleStr + ' ' + initialTransform :\n\t\t\t\tinitialTransform + ' ' + scaleStr;\n\t},\n\n\t_endZoomAnim: function () {\n\t\tvar front = this._tileContainer,\n\t\t    bg = this._bgBuffer;\n\n\t\tfront.style.visibility = '';\n\t\tfront.parentNode.appendChild(front); // Bring to fore\n\n\t\t// force reflow\n\t\tL.Util.falseFn(bg.offsetWidth);\n\n\t\tvar zoom = this._map.getZoom();\n\t\tif (zoom > this.options.maxZoom || zoom < this.options.minZoom) {\n\t\t\tthis._clearBgBuffer();\n\t\t}\n\n\t\tthis._animating = false;\n\t},\n\n\t_clearBgBuffer: function () {\n\t\tvar map = this._map;\n\n\t\tif (map && !map._animatingZoom && !map.touchZoom._zooming) {\n\t\t\tthis._bgBuffer.innerHTML = '';\n\t\t\tthis._bgBuffer.style[L.DomUtil.TRANSFORM] = '';\n\t\t}\n\t},\n\n\t_prepareBgBuffer: function () {\n\n\t\tvar front = this._tileContainer,\n\t\t    bg = this._bgBuffer;\n\n\t\t// if foreground layer doesn't have many tiles but bg layer does,\n\t\t// keep the existing bg layer and just zoom it some more\n\n\t\tvar bgLoaded = this._getLoadedTilesPercentage(bg),\n\t\t    frontLoaded = this._getLoadedTilesPercentage(front);\n\n\t\tif (bg && bgLoaded > 0.5 && frontLoaded < 0.5) {\n\n\t\t\tfront.style.visibility = 'hidden';\n\t\t\tthis._stopLoadingImages(front);\n\t\t\treturn;\n\t\t}\n\n\t\t// prepare the buffer to become the front tile pane\n\t\tbg.style.visibility = 'hidden';\n\t\tbg.style[L.DomUtil.TRANSFORM] = '';\n\n\t\t// switch out the current layer to be the new bg layer (and vice-versa)\n\t\tthis._tileContainer = bg;\n\t\tbg = this._bgBuffer = front;\n\n\t\tthis._stopLoadingImages(bg);\n\n\t\t//prevent bg buffer from clearing right after zoom\n\t\tclearTimeout(this._clearBgBufferTimer);\n\t},\n\n\t_getLoadedTilesPercentage: function (container) {\n\t\tvar tiles = container.getElementsByTagName('img'),\n\t\t    i, len, count = 0;\n\n\t\tfor (i = 0, len = tiles.length; i < len; i++) {\n\t\t\tif (tiles[i].complete) {\n\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\treturn count / len;\n\t},\n\n\t// stops loading all tiles in the background layer\n\t_stopLoadingImages: function (container) {\n\t\tvar tiles = Array.prototype.slice.call(container.getElementsByTagName('img')),\n\t\t    i, len, tile;\n\n\t\tfor (i = 0, len = tiles.length; i < len; i++) {\n\t\t\ttile = tiles[i];\n\n\t\t\tif (!tile.complete) {\n\t\t\t\ttile.onload = L.Util.falseFn;\n\t\t\t\ttile.onerror = L.Util.falseFn;\n\t\t\t\ttile.src = L.Util.emptyImageUrl;\n\n\t\t\t\ttile.parentNode.removeChild(tile);\n\t\t\t}\n\t\t}\n\t}\n});\n\n\n/*\r\n * Provides L.Map with convenient shortcuts for using browser geolocation features.\r\n */\r\n\r\nL.Map.include({\r\n\t_defaultLocateOptions: {\r\n\t\twatch: false,\r\n\t\tsetView: false,\r\n\t\tmaxZoom: Infinity,\r\n\t\ttimeout: 10000,\r\n\t\tmaximumAge: 0,\r\n\t\tenableHighAccuracy: false\r\n\t},\r\n\r\n\tlocate: function (/*Object*/ options) {\r\n\r\n\t\toptions = this._locateOptions = L.extend(this._defaultLocateOptions, options);\r\n\r\n\t\tif (!navigator.geolocation) {\r\n\t\t\tthis._handleGeolocationError({\r\n\t\t\t\tcode: 0,\r\n\t\t\t\tmessage: 'Geolocation not supported.'\r\n\t\t\t});\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar onResponse = L.bind(this._handleGeolocationResponse, this),\r\n\t\t\tonError = L.bind(this._handleGeolocationError, this);\r\n\r\n\t\tif (options.watch) {\r\n\t\t\tthis._locationWatchId =\r\n\t\t\t        navigator.geolocation.watchPosition(onResponse, onError, options);\r\n\t\t} else {\r\n\t\t\tnavigator.geolocation.getCurrentPosition(onResponse, onError, options);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstopLocate: function () {\r\n\t\tif (navigator.geolocation) {\r\n\t\t\tnavigator.geolocation.clearWatch(this._locationWatchId);\r\n\t\t}\r\n\t\tif (this._locateOptions) {\r\n\t\t\tthis._locateOptions.setView = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_handleGeolocationError: function (error) {\r\n\t\tvar c = error.code,\r\n\t\t    message = error.message ||\r\n\t\t            (c === 1 ? 'permission denied' :\r\n\t\t            (c === 2 ? 'position unavailable' : 'timeout'));\r\n\r\n\t\tif (this._locateOptions.setView && !this._loaded) {\r\n\t\t\tthis.fitWorld();\r\n\t\t}\r\n\r\n\t\tthis.fire('locationerror', {\r\n\t\t\tcode: c,\r\n\t\t\tmessage: 'Geolocation error: ' + message + '.'\r\n\t\t});\r\n\t},\r\n\r\n\t_handleGeolocationResponse: function (pos) {\r\n\t\tvar lat = pos.coords.latitude,\r\n\t\t    lng = pos.coords.longitude,\r\n\t\t    latlng = new L.LatLng(lat, lng),\r\n\r\n\t\t    latAccuracy = 180 * pos.coords.accuracy / 40075017,\r\n\t\t    lngAccuracy = latAccuracy / Math.cos(L.LatLng.DEG_TO_RAD * lat),\r\n\r\n\t\t    bounds = L.latLngBounds(\r\n\t\t            [lat - latAccuracy, lng - lngAccuracy],\r\n\t\t            [lat + latAccuracy, lng + lngAccuracy]),\r\n\r\n\t\t    options = this._locateOptions;\r\n\r\n\t\tif (options.setView) {\r\n\t\t\tvar zoom = Math.min(this.getBoundsZoom(bounds), options.maxZoom);\r\n\t\t\tthis.setView(latlng, zoom);\r\n\t\t}\r\n\r\n\t\tvar data = {\r\n\t\t\tlatlng: latlng,\r\n\t\t\tbounds: bounds,\r\n\t\t\ttimestamp: pos.timestamp\r\n\t\t};\r\n\r\n\t\tfor (var i in pos.coords) {\r\n\t\t\tif (typeof pos.coords[i] === 'number') {\r\n\t\t\t\tdata[i] = pos.coords[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.fire('locationfound', data);\r\n\t}\r\n});\r\n\n\n}(window, document));\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/leaflet/dist/leaflet-src.js\n// module id = 9\n// module chunks = 0","/*\n * leaflet-geocoder-mapzen\n * Leaflet plugin to search (geocode) using Mapzen Search or your\n * own hosted version of the Pelias Geocoder API.\n *\n * License: MIT\n * (c) Mapzen\n */\n;(function (factory) { // eslint-disable-line no-extra-semi\n  var L;\n  if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['leaflet'], factory);\n  } else if (typeof module !== 'undefined') {\n    // Node/CommonJS\n    L = require('leaflet');\n    module.exports = factory(L);\n  } else {\n    // Browser globals\n    if (typeof window.L === 'undefined') {\n      throw new Error('Leaflet must be loaded first');\n    }\n    factory(window.L);\n  }\n}(function (L) {\n  'use strict';\n\n  var MINIMUM_INPUT_LENGTH_FOR_AUTOCOMPLETE = 1;\n  var FULL_WIDTH_MARGIN = 20; // in pixels\n  var FULL_WIDTH_TOUCH_ADJUSTED_MARGIN = 4; // in pixels\n  var RESULTS_HEIGHT_MARGIN = 20; // in pixels\n  var API_RATE_LIMIT = 250; // in ms, throttled time between subsequent requests to API\n\n  L.Control.Geocoder = L.Control.extend({\n\n    includes: L.Mixin.Events,\n\n    options: {\n      position: 'topleft',\n      attribution: 'Geocoding by <a href=\"https://mapzen.com/projects/search/\">Mapzen</a>',\n      url: 'https://search.mapzen.com/v1',\n      placeholder: 'Search',\n      title: 'Search',\n      bounds: false,\n      latlng: null,\n      layers: null,\n      panToPoint: true,\n      pointIcon: true, // 'images/point_icon.png',\n      polygonIcon: true, // 'images/polygon_icon.png',\n      fullWidth: 650,\n      markers: true,\n      expanded: false,\n      autocomplete: true\n    },\n\n    initialize: function (apiKey, options) {\n      // For IE8 compatibility (if XDomainRequest is present),\n      // we set the default value of options.url to the protocol-relative\n      // version, because XDomainRequest does not allow http-to-https requests\n      // This is set first so it can always be overridden by the user\n      if (window.XDomainRequest) {\n        this.options.url = '//search.mapzen.com/v1';\n      }\n\n      // If the apiKey is omitted entirely and the\n      // first parameter is actually the options\n      if (typeof apiKey === 'object' && !!apiKey) {\n        options = apiKey;\n      } else {\n        this.apiKey = apiKey;\n      }\n\n      // Now merge user-specified options\n      L.Util.setOptions(this, options);\n      this.marker;\n      this.markers = [];\n    },\n\n    getLayers: function (params) {\n      var layers = this.options.layers;\n\n      if (!layers) {\n        return params;\n      }\n\n      params.layers = layers;\n      return params;\n    },\n\n    getBoundingBoxParam: function (params) {\n      /*\n       * this.options.bounds can be one of the following\n       * true //Boolean - take the map bounds\n       * false //Boolean - no bounds\n       * L.latLngBounds(...) //Object\n       * [[10, 10], [40, 60]] //Array\n      */\n      var bounds = this.options.bounds;\n\n      // If falsy, bail\n      if (!bounds) {\n        return params;\n      }\n\n      // If set to true, use map bounds\n      // If it is a valid L.LatLngBounds object, get its values\n      // If it is an array, try running it through L.LatLngBounds\n      if (bounds === true) {\n        bounds = this._map.getBounds();\n        params = makeParamsFromLeaflet(params, bounds);\n      } else if (typeof bounds === 'object' && bounds.isValid && bounds.isValid()) {\n        params = makeParamsFromLeaflet(params, bounds);\n      } else if (L.Util.isArray(bounds)) {\n        var latLngBounds = L.latLngBounds(bounds);\n        if (latLngBounds.isValid && latLngBounds.isValid()) {\n          params = makeParamsFromLeaflet(params, latLngBounds);\n        }\n      }\n\n      function makeParamsFromLeaflet (params, latLngBounds) {\n        params['boundary.rect.min_lon'] = latLngBounds.getWest();\n        params['boundary.rect.min_lat'] = latLngBounds.getSouth();\n        params['boundary.rect.max_lon'] = latLngBounds.getEast();\n        params['boundary.rect.max_lat'] = latLngBounds.getNorth();\n        return params;\n      }\n\n      return params;\n    },\n\n    getLatlngParam: function (params) {\n      /*\n       * this.options.latlng can be one of the following\n       * [50, 30] //Array\n       * {lon: 30, lat: 50} //Object\n       * {lat: 50, lng: 30} //Object\n       * L.latLng(50, 30) //Object\n       * true //Boolean - take the map center\n       * false //Boolean - No latlng to be considered\n      */\n      var latlng = this.options.latlng;\n\n      if (!latlng) {\n        return params;\n      }\n\n      if (latlng.constructor === Array) {\n        // TODO Check for array size, throw errors if invalid lat/lon\n        params['focus.point.lat'] = latlng[0];\n        params['focus.point.lon'] = latlng[1];\n      } else if (typeof latlng !== 'object') {\n        // fallback to the map's center L.latLng()\n        latlng = this._map.getCenter();\n        params['focus.point.lat'] = latlng.lat;\n        params['focus.point.lon'] = latlng.lng;\n      } else {\n        // TODO Check for valid L.LatLng Object or Object thats in the form of {lat:..,lon:..}\n        // TODO Check for valid lat/lon values, Error handling\n        params['focus.point.lat'] = latlng.lat;\n        params['focus.point.lon'] = latlng.lng ? latlng.lng : latlng.lon;\n      }\n\n      return params;\n    },\n\n    search: function (input) {\n      // Prevent lack of input from sending a malformed query to Pelias\n      if (!input) return;\n\n      var url = this.options.url + '/search';\n      var params = {\n        text: input\n      };\n\n      this.callPelias(url, params, 'search');\n    },\n\n    autocomplete: throttle(function (input) {\n      // Prevent lack of input from sending a malformed query to Pelias\n      if (!input) return;\n\n      var url = this.options.url + '/autocomplete';\n      var params = {\n        text: input\n      };\n\n      this.callPelias(url, params, 'autocomplete');\n    }, API_RATE_LIMIT),\n\n    // Timestamp of the last response which was successfully rendered to the UI.\n    // The time represents when the request was *sent*, not when it was recieved.\n    maxReqTimestampRendered: new Date().getTime(),\n\n    callPelias: function (endpoint, params, type) {\n      params = this.getBoundingBoxParam(params);\n      params = this.getLatlngParam(params);\n      params = this.getLayers(params);\n\n      // Search API key\n      if (this.apiKey) {\n        params.api_key = this.apiKey;\n      }\n\n      L.DomUtil.addClass(this._search, 'leaflet-pelias-loading');\n\n      // Track when the request began\n      var reqStartedAt = new Date().getTime();\n\n      AJAX.request(endpoint, params, function (err, results) {\n        L.DomUtil.removeClass(this._search, 'leaflet-pelias-loading');\n\n        if (err) {\n          var errorMessage;\n          switch (err.code) {\n            // Error codes.\n            // https://mapzen.com/documentation/search/http-status-codes/\n            case 403:\n              errorMessage = 'A valid API key is needed for this search feature.';\n              break;\n            case 404:\n              errorMessage = 'The search service cannot be found. :-(';\n              break;\n            case 408:\n              errorMessage = 'The search service took too long to respond. Try again in a second.';\n              break;\n            case 429:\n              errorMessage = 'There were too many requests. Try again in a second.';\n              break;\n            case 500:\n              errorMessage = 'The search service is not working right now. Please try again later.';\n              break;\n            case 502:\n              errorMessage = 'Connection lost. Please try again later.';\n              break;\n            // Note the status code is 0 if CORS is not enabled on the error response\n            default:\n              errorMessage = 'The search service is having problems :-(';\n              break;\n          }\n          this.showMessage(errorMessage);\n          this.fire('error', {\n            results: results,\n            endpoint: endpoint,\n            requestType: type,\n            params: params,\n            errorCode: err.code,\n            errorMessage: errorMessage\n          });\n        }\n\n        if (results && results.features) {\n          // Ignore requests that started before a request which has already\n          // been successfully rendered on to the UI.\n          if (this.maxReqTimestampRendered < reqStartedAt) {\n            this.maxReqTimestampRendered = reqStartedAt;\n            this.showResults(results.features);\n            this.fire('results', {\n              results: results,\n              endpoint: endpoint,\n              requestType: type,\n              params: params\n            });\n          }\n          // Else ignore the request, it is stale.\n        }\n      }, this);\n    },\n\n    highlight: function (text, focus) {\n      var r = RegExp('(' + escapeRegExp(focus) + ')', 'gi');\n      return text.replace(r, '<strong>$1</strong>');\n    },\n\n    getIconType: function (layer) {\n      var pointIcon = this.options.pointIcon;\n      var polygonIcon = this.options.polygonIcon;\n      var classPrefix = 'leaflet-pelias-layer-icon-';\n\n      if (layer.match('venue') || layer.match('address')) {\n        if (pointIcon === true) {\n          return {\n            type: 'class',\n            value: classPrefix + 'point'\n          };\n        } else if (pointIcon === false) {\n          return false;\n        } else {\n          return {\n            type: 'image',\n            value: pointIcon\n          };\n        }\n      } else {\n        if (polygonIcon === true) {\n          return {\n            type: 'class',\n            value: classPrefix + 'polygon'\n          };\n        } else if (polygonIcon === false) {\n          return false;\n        } else {\n          return {\n            type: 'image',\n            value: polygonIcon\n          };\n        }\n      }\n    },\n\n    showResults: function (features) {\n      // Exit function if there are no features\n      if (features.length === 0) {\n        this.showMessage('No results were found.');\n        return;\n      }\n\n      var resultsContainer = this._results;\n\n      // Reset and display results container\n      resultsContainer.innerHTML = '';\n      resultsContainer.style.display = 'block';\n      // manage result box height\n      resultsContainer.style.maxHeight = (this._map.getSize().y - resultsContainer.offsetTop - this._container.offsetTop - RESULTS_HEIGHT_MARGIN) + 'px';\n\n      var list = L.DomUtil.create('ul', 'leaflet-pelias-list', resultsContainer);\n\n      for (var i = 0, j = features.length; i < j; i++) {\n        var feature = features[i];\n        var resultItem = L.DomUtil.create('li', 'leaflet-pelias-result', list);\n\n        resultItem.feature = feature;\n        resultItem.layer = feature.properties.layer;\n\n        // Deprecated\n        // Use L.GeoJSON.coordsToLatLng(resultItem.feature.geometry.coordinates) instead\n        // This returns a L.LatLng object that can be used throughout Leaflet\n        resultItem.coords = feature.geometry.coordinates;\n\n        var icon = this.getIconType(feature.properties.layer);\n        if (icon) {\n          // Point or polygon icon\n          // May be a class or an image path\n          var layerIconContainer = L.DomUtil.create('span', 'leaflet-pelias-layer-icon-container', resultItem);\n          var layerIcon;\n\n          if (icon.type === 'class') {\n            layerIcon = L.DomUtil.create('div', 'leaflet-pelias-layer-icon ' + icon.value, layerIconContainer);\n          } else {\n            layerIcon = L.DomUtil.create('img', 'leaflet-pelias-layer-icon', layerIconContainer);\n            layerIcon.src = icon.value;\n          }\n\n          layerIcon.title = 'layer: ' + feature.properties.layer;\n        }\n\n        if (this._input.value.length > 0) {\n          resultItem.innerHTML += this.highlight(feature.properties.label, this._input.value);\n        }\n      }\n    },\n\n    showMessage: function (text) {\n      var resultsContainer = this._results;\n\n      // Reset and display results container\n      resultsContainer.innerHTML = '';\n      resultsContainer.style.display = 'block';\n\n      var messageEl = L.DomUtil.create('div', 'leaflet-pelias-message', resultsContainer);\n      messageEl.textContent = text;\n    },\n\n    removeMarkers: function () {\n      if (this.options.markers) {\n        for (var i = 0; i < this.markers.length; i++) {\n          this._map.removeLayer(this.markers[i]);\n        }\n        this.markers = [];\n      }\n    },\n\n    showMarker: function (text, latlng) {\n      this.removeMarkers();\n      this._map.setView(latlng, this._map.getZoom() || 8);\n\n      var markerOptions = (typeof this.options.markers === 'object') ? this.options.markers : {};\n\n      if (this.options.markers) {\n        this.marker = new L.marker(latlng, markerOptions).bindPopup(text); // eslint-disable-line new-cap\n        this._map.addLayer(this.marker);\n        this.markers.push(this.marker);\n        this.marker.openPopup();\n      }\n    },\n\n    setSelectedResult: function (selected, originalEvent) {\n      var latlng = L.GeoJSON.coordsToLatLng(selected.feature.geometry.coordinates);\n      this._input.value = selected.innerText || selected.textContent;\n      this.showMarker(selected.innerHTML, latlng);\n      this.fire('select', {\n        originalEvent: originalEvent,\n        latlng: latlng,\n        feature: selected.feature\n      });\n      this.blur();\n    },\n\n    resetInput: function () {\n      this._input.value = '';\n      L.DomUtil.addClass(this._close, 'leaflet-pelias-hidden');\n      this.removeMarkers();\n      this._input.focus();\n      this.fire('reset');\n    },\n\n    // Removes focus from geocoder control\n    blur: function () {\n      this.clearResults();\n      if (this._input.value === '' && this._results.style.display !== 'none') {\n        L.DomUtil.addClass(this._close, 'leaflet-pelias-hidden');\n        if (!this.options.expanded) {\n          this.collapse();\n        }\n      }\n    },\n\n    clearResults: function () {\n      // Hide results from view\n      this._results.style.display = 'none';\n\n      // Destroy contents if input has also cleared\n      if (this._input.value === '') {\n        this._results.innerHTML = '';\n      }\n    },\n\n    expand: function () {\n      L.DomUtil.addClass(this._container, 'leaflet-pelias-expanded');\n      this.setFullWidth();\n      this.fire('expand');\n    },\n\n    collapse: function () {\n      // 'expanded' options check happens outside of this function now\n      // So it's now possible for a script to force-collapse a geocoder\n      // that otherwise defaults to the always-expanded state\n      L.DomUtil.removeClass(this._container, 'leaflet-pelias-expanded');\n      this._input.blur();\n      this.clearFullWidth();\n      this.clearResults();\n      this.fire('collapse');\n    },\n\n    // Set full width of expanded input, if enabled\n    setFullWidth: function () {\n      if (this.options.fullWidth) {\n        // If fullWidth setting is a number, only expand if map container\n        // is smaller than that breakpoint. Otherwise, clear width\n        // Always ask map to invalidate and recalculate size first\n        this._map.invalidateSize();\n        var mapWidth = this._map.getSize().x;\n        var touchAdjustment = L.Browser.touch ? FULL_WIDTH_TOUCH_ADJUSTED_MARGIN : 0;\n        var width = mapWidth - FULL_WIDTH_MARGIN - touchAdjustment;\n        if (typeof this.options.fullWidth === 'number' && mapWidth >= window.parseInt(this.options.fullWidth, 10)) {\n          this.clearFullWidth();\n          return;\n        }\n        this._container.style.width = width.toString() + 'px';\n      }\n    },\n\n    clearFullWidth: function () {\n      // Clear set width, if any\n      if (this.options.fullWidth) {\n        this._container.style.width = '';\n      }\n    },\n\n    onAdd: function (map) {\n      var container = L.DomUtil.create('div',\n          'leaflet-pelias-control leaflet-bar leaflet-control');\n\n      this._body = document.body || document.getElementsByTagName('body')[0];\n      this._container = container;\n      this._input = L.DomUtil.create('input', 'leaflet-pelias-input', this._container);\n      this._input.spellcheck = false;\n\n      // Only set if title option is not null or falsy\n      if (this.options.title) {\n        this._input.title = this.options.title;\n      }\n\n      // Only set if placeholder option is not null or falsy\n      if (this.options.placeholder) {\n        this._input.placeholder = this.options.placeholder;\n      }\n\n      this._search = L.DomUtil.create('a', 'leaflet-pelias-search-icon', this._container);\n      this._close = L.DomUtil.create('div', 'leaflet-pelias-close leaflet-pelias-hidden', this._container);\n      this._close.innerHTML = '×';\n      this._close.title = 'Close';\n\n      this._results = L.DomUtil.create('div', 'leaflet-pelias-results leaflet-bar', this._container);\n\n      if (this.options.expanded) {\n        this.expand();\n      }\n\n      L.DomEvent\n        .on(this._container, 'click', function (e) {\n          // Other listeners should call stopProgation() to\n          // prevent this from firing too greedily\n          this._input.focus();\n        }, this)\n        .on(this._input, 'focus', function (e) {\n          if (this._input.value) {\n            this._results.style.display = 'block';\n          }\n        }, this)\n        .on(this._map, 'click', function (e) {\n          // Does what you might expect a _input.blur() listener might do,\n          // but since that would fire for any reason (e.g. clicking a result)\n          // what you really want is to blur from the control by listening to clicks on the map\n          this.blur();\n        }, this)\n        .on(this._search, 'click', function (e) {\n          L.DomEvent.stopPropagation(e);\n\n          // Toggles expanded state of container on click of search icon\n          if (L.DomUtil.hasClass(this._container, 'leaflet-pelias-expanded')) {\n            // If expanded option is true, just focus the input\n            if (this.options.expanded === true) {\n              this._input.focus();\n              return;\n            } else {\n              // Otherwise, toggle to hidden state\n              L.DomUtil.addClass(this._close, 'leaflet-pelias-hidden');\n              this.collapse();\n            }\n          } else {\n            // If not currently expanded, clicking here always expands it\n            if (this._input.value.length > 0) {\n              L.DomUtil.removeClass(this._close, 'leaflet-pelias-hidden');\n            }\n            this.expand();\n            this._input.focus();\n          }\n        }, this)\n        .on(this._close, 'click', function (e) {\n          this.resetInput();\n          this.clearResults();\n          L.DomEvent.stopPropagation(e);\n        }, this)\n        .on(this._input, 'keydown', function (e) {\n          var list = this._results.querySelectorAll('.leaflet-pelias-result');\n          var selected = this._results.querySelectorAll('.leaflet-pelias-selected')[0];\n          var selectedPosition;\n          var self = this;\n          var panToPoint = function (shouldPan) {\n            var _selected = self._results.querySelectorAll('.leaflet-pelias-selected')[0];\n            if (_selected && shouldPan) {\n              self.showMarker(_selected.innerHTML, L.GeoJSON.coordsToLatLng(_selected.feature.geometry.coordinates));\n            }\n          };\n\n          var scrollSelectedResultIntoView = function () {\n            var _selected = self._results.querySelectorAll('.leaflet-pelias-selected')[0];\n            var _selectedRect = _selected.getBoundingClientRect();\n            var _resultsRect = self._results.getBoundingClientRect();\n            // Is the selected element not visible?\n            if (_selectedRect.bottom > _resultsRect.bottom) {\n              self._results.scrollTop = _selected.offsetTop + _selected.offsetHeight - self._results.offsetHeight;\n            } else if (_selectedRect.top < _resultsRect.top) {\n              self._results.scrollTop = _selected.offsetTop;\n            }\n          };\n\n          for (var i = 0; i < list.length; i++) {\n            if (list[i] === selected) {\n              selectedPosition = i;\n              break;\n            }\n          }\n\n          // TODO cleanup\n          switch (e.keyCode) {\n            // 13 = enter\n            case 13:\n              if (selected) {\n                this.setSelectedResult(selected, e);\n              } else {\n                // perform a full text search on enter\n                var text = (e.target || e.srcElement).value;\n                this.search(text);\n              }\n              L.DomEvent.preventDefault(e);\n              break;\n            // 38 = up arrow\n            case 38:\n              // Ignore key if there are no results or if list is not visible\n              if (list.length === 0 || this._results.style.display === 'none') {\n                return;\n              }\n\n              if (selected) {\n                L.DomUtil.removeClass(selected, 'leaflet-pelias-selected');\n              }\n\n              var previousItem = list[selectedPosition - 1];\n              var highlighted = (selected && previousItem) ? previousItem : list[list.length - 1]; // eslint-disable-line no-redeclare\n\n              L.DomUtil.addClass(highlighted, 'leaflet-pelias-selected');\n              scrollSelectedResultIntoView();\n              panToPoint(this.options.panToPoint);\n              this.fire('highlight', {\n                originalEvent: e,\n                latlng: L.GeoJSON.coordsToLatLng(highlighted.feature.geometry.coordinates),\n                feature: highlighted.feature\n              });\n\n              L.DomEvent.preventDefault(e);\n              break;\n            // 40 = down arrow\n            case 40:\n              // Ignore key if there are no results or if list is not visible\n              if (list.length === 0 || this._results.style.display === 'none') {\n                return;\n              }\n\n              if (selected) {\n                L.DomUtil.removeClass(selected, 'leaflet-pelias-selected');\n              }\n\n              var nextItem = list[selectedPosition + 1];\n              var highlighted = (selected && nextItem) ? nextItem : list[0]; // eslint-disable-line no-redeclare\n\n              L.DomUtil.addClass(highlighted, 'leaflet-pelias-selected');\n              scrollSelectedResultIntoView();\n              panToPoint(this.options.panToPoint);\n              this.fire('highlight', {\n                originalEvent: e,\n                latlng: L.GeoJSON.coordsToLatLng(highlighted.feature.geometry.coordinates),\n                feature: highlighted.feature\n              });\n\n              L.DomEvent.preventDefault(e);\n              break;\n            // all other keys\n            default:\n              break;\n          }\n        }, this)\n        .on(this._input, 'keyup', function (e) {\n          var key = e.which || e.keyCode;\n          var text = (e.target || e.srcElement).value;\n\n          if (this._input.value.length > 0) {\n            L.DomUtil.removeClass(this._close, 'leaflet-pelias-hidden');\n          } else {\n            L.DomUtil.addClass(this._close, 'leaflet-pelias-hidden');\n          }\n\n          // Ignore all further action if the keycode matches an arrow\n          // key (handled via keydown event)\n          if (key === 13 || key === 38 || key === 40) {\n            return;\n          }\n\n          // keyCode 27 = esc key (esc should clear results)\n          if (key === 27) {\n            // If input is blank or results have already been cleared\n            // (perhaps due to a previous 'esc') then pressing esc at\n            // this point will blur from input as well.\n            if (text.length === 0 || this._results.style.display === 'none') {\n              this._input.blur();\n\n              if (L.DomUtil.hasClass(this._container, 'leaflet-pelias-expanded')) {\n                if (!this.options.expanded) {\n                  this.collapse();\n                }\n                this.clearResults();\n              }\n            }\n            // Clears results\n            this._results.innerHTML = '';\n            this._results.style.display = 'none';\n            L.DomUtil.removeClass(this._search, 'leaflet-pelias-loading');\n            return;\n          }\n\n          if (this._input.value !== this._lastValue) {\n            this._lastValue = this._input.value;\n\n            if (text.length >= MINIMUM_INPUT_LENGTH_FOR_AUTOCOMPLETE && this.options.autocomplete === true) {\n              this.autocomplete(text);\n            } else {\n              this.clearResults();\n            }\n          }\n        }, this)\n        .on(this._results, 'click', function (e) {\n          L.DomEvent.preventDefault(e);\n          L.DomEvent.stopPropagation(e);\n\n          var _selected = this._results.querySelectorAll('.leaflet-pelias-selected')[0];\n          if (_selected) {\n            L.DomUtil.removeClass(_selected, 'leaflet-pelias-selected');\n          }\n\n          var selected = e.target || e.srcElement; /* IE8 */\n          var findParent = function () {\n            if (!L.DomUtil.hasClass(selected, 'leaflet-pelias-result')) {\n              selected = selected.parentElement;\n              if (selected) {\n                findParent();\n              }\n            }\n            return selected;\n          };\n\n          // click event can be registered on the child nodes\n          // that does not have the required coords prop\n          // so its important to find the parent.\n          findParent();\n\n          // If nothing is selected, (e.g. it's a message, not a result),\n          // do nothing.\n          if (selected) {\n            L.DomUtil.addClass(selected, 'leaflet-pelias-selected');\n            this.setSelectedResult(selected, e);\n          }\n        }, this)\n        .on(this._results, 'mouseover', function (e) {\n          // Prevent scrolling over results list from zooming the map, if enabled\n          this._scrollWheelZoomEnabled = map.scrollWheelZoom.enabled();\n          if (this._scrollWheelZoomEnabled) {\n            map.scrollWheelZoom.disable();\n          }\n        }, this)\n        .on(this._results, 'mouseout', function (e) {\n          // Re-enable scroll wheel zoom (if previously enabled) after\n          // leaving the results box\n          if (this._scrollWheelZoomEnabled) {\n            map.scrollWheelZoom.enable();\n          }\n        }, this);\n\n      // Recalculate width of the input bar when window resizes\n      if (this.options.fullWidth) {\n        L.DomEvent.on(window, 'resize', function (e) {\n          if (L.DomUtil.hasClass(this._container, 'leaflet-pelias-expanded')) {\n            this.setFullWidth();\n          }\n        }, this);\n      }\n\n      // Collapse an empty input bar when user interacts with the map\n      // Disabled if expanded is set to true\n      if (!this.options.expanded) {\n        L.DomEvent.on(this._map, 'mousedown', this._onMapInteraction, this);\n        L.DomEvent.on(this._map, 'touchstart', this._onMapInteraction, this);\n      }\n\n      L.DomEvent.disableClickPropagation(this._container);\n      if (map.attributionControl) {\n        map.attributionControl.addAttribution(this.options.attribution);\n      }\n      return container;\n    },\n\n    _onMapInteraction: function (event) {\n      // Only collapse if the input is clear, and is currently expanded.\n      if (!this._input.value && L.DomUtil.hasClass(this._container, 'leaflet-pelias-expanded')) {\n        this.collapse();\n      }\n    },\n\n    onRemove: function (map) {\n      map.attributionControl.removeAttribution(this.options.attribution);\n    }\n  });\n\n  L.control.geocoder = function (apiKey, options) {\n    return new L.Control.Geocoder(apiKey, options);\n  };\n\n  /*\n   * AJAX Utility function (implements basic HTTP get)\n   */\n  var AJAX = {\n    serialize: function (params) {\n      var data = '';\n\n      for (var key in params) {\n        if (params.hasOwnProperty(key)) {\n          var param = params[key];\n          var type = param.toString();\n          var value;\n\n          if (data.length) {\n            data += '&';\n          }\n\n          switch (type) {\n            case '[object Array]':\n              value = (param[0].toString() === '[object Object]') ? JSON.stringify(param) : param.join(',');\n              break;\n            case '[object Object]':\n              value = JSON.stringify(param);\n              break;\n            case '[object Date]':\n              value = param.valueOf();\n              break;\n            default:\n              value = param;\n              break;\n          }\n\n          data += encodeURIComponent(key) + '=' + encodeURIComponent(value);\n        }\n      }\n\n      return data;\n    },\n    http_request: function (callback, context) {\n      if (window.XDomainRequest) {\n        return this.xdr(callback, context);\n      } else {\n        return this.xhr(callback, context);\n      }\n    },\n    xhr: function (callback, context) {\n      var xhr = new XMLHttpRequest();\n\n      xhr.onerror = function (e) {\n        xhr.onreadystatechange = L.Util.falseFn;\n        var error = {\n          code: xhr.status,\n          message: xhr.statusText\n        };\n\n        callback.call(context, error, null);\n      };\n\n      xhr.onreadystatechange = function () {\n        var response;\n        var error;\n\n        if (xhr.readyState === 4) {\n          // Handle all non-200 responses first\n          if (xhr.status !== 200) {\n            error = {\n              code: xhr.status,\n              message: xhr.statusText\n            };\n            callback.call(context, error, null);\n          } else {\n            try {\n              response = JSON.parse(xhr.responseText);\n            } catch (e) {\n              response = null;\n              error = {\n                code: 500,\n                message: 'Parse Error'\n              };\n            }\n\n            if (!error && response.error) {\n              error = response.error;\n              response = null;\n            }\n\n            xhr.onerror = L.Util.falseFn;\n\n            callback.call(context, error, response);\n          }\n        }\n      };\n\n      return xhr;\n    },\n    xdr: function (callback, context) {\n      var xdr = new window.XDomainRequest();\n\n      xdr.onerror = function (e) {\n        xdr.onload = L.Util.falseFn;\n\n        // XDRs have no access to actual status codes\n        var error = {\n          code: 500,\n          message: 'XMLHttpRequest Error'\n        };\n        callback.call(context, error, null);\n      };\n\n      // XDRs have .onload instead of .onreadystatechange\n      xdr.onload = function () {\n        var response;\n        var error;\n\n        try {\n          response = JSON.parse(xdr.responseText);\n        } catch (e) {\n          response = null;\n          error = {\n            code: 500,\n            message: 'Parse Error'\n          };\n        }\n\n        if (!error && response.error) {\n          error = response.error;\n          response = null;\n        }\n\n        xdr.onerror = L.Util.falseFn;\n        callback.call(context, error, response);\n      };\n\n      return xdr;\n    },\n    request: function (url, params, callback, context) {\n      var paramString = this.serialize(params);\n      var httpRequest = this.http_request(callback, context);\n\n      httpRequest.open('GET', url + '?' + paramString);\n      if (httpRequest.constructor.name === 'XMLHttpRequest') {\n        httpRequest.setRequestHeader('Accept', 'application/json');\n      }\n\n      setTimeout(function () {\n        httpRequest.send(null);\n      }, 0);\n    }\n  };\n\n  /*\n   * throttle Utility function (borrowed from underscore)\n   */\n  function throttle (func, wait, options) {\n    var context, args, result;\n    var timeout = null;\n    var previous = 0;\n    if (!options) options = {};\n    var later = function () {\n      previous = options.leading === false ? 0 : new Date().getTime();\n      timeout = null;\n      result = func.apply(context, args);\n      if (!timeout) context = args = null;\n    };\n    return function () {\n      var now = new Date().getTime();\n      if (!previous && options.leading === false) previous = now;\n      var remaining = wait - (now - previous);\n      context = this;\n      args = arguments;\n      if (remaining <= 0 || remaining > wait) {\n        if (timeout) {\n          clearTimeout(timeout);\n          timeout = null;\n        }\n        previous = now;\n        result = func.apply(context, args);\n        if (!timeout) context = args = null;\n      } else if (!timeout && options.trailing !== false) {\n        timeout = setTimeout(later, remaining);\n      }\n      return result;\n    };\n  }\n\n  /*\n   * escaping a string for regex Utility function\n   * from https://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex\n   */\n  function escapeRegExp (str) {\n    return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');\n  }\n}));\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/leaflet-geocoder-mapzen/dist/leaflet-geocoder-mapzen.js\n// module id = 10\n// module chunks = 0","/*\n\tLeaflet.contextmenu, a context menu for Leaflet.\n\t(c) 2015, Adam Ratcliffe, GeoSmart Maps Limited\n       \n        @preserve\n*/\n\n(function(factory) {\n\t// Packaging/modules magic dance\n\tvar L;\n\tif (typeof define === 'function' && define.amd) {\n\t\t// AMD\n\t\tdefine(['leaflet'], factory);\n\t} else if (typeof module !== 'undefined') {\n\t\t// Node/CommonJS\n\t\tL = require('leaflet');\n\t\tmodule.exports = factory(L);\n\t} else {\n\t\t// Browser globals\n\t\tif (typeof window.L === 'undefined') {\n\t\t\tthrow new Error('Leaflet must be loaded first');\n\t\t}\n\t\tfactory(window.L);\n\t}\n})(function(L) {\nL.Map.mergeOptions({\n\tcontextmenuItems: []\n});\n\nL.Map.ContextMenu = L.Handler.extend({\n\n\t_touchstart: L.Browser.msPointer ? 'MSPointerDown' : L.Browser.pointer ? 'pointerdown' : 'touchstart',\n\n\tstatics: {\n\t\tBASE_CLS: 'leaflet-contextmenu'\n\t},\n\n\tinitialize: function (map) {\n\t\tL.Handler.prototype.initialize.call(this, map);\n\n\t\tthis._items = [];\n\t\tthis._visible = false;\n\n\t\tvar container = this._container = L.DomUtil.create('div', L.Map.ContextMenu.BASE_CLS, map._container);\n\t\tcontainer.style.zIndex = 10000;\n\t\tcontainer.style.position = 'absolute';\n\n\t\tif (map.options.contextmenuWidth) {\n\t\t\tcontainer.style.width = map.options.contextmenuWidth + 'px';\n\t\t}\n\t\t\n\t\tthis._createItems();\n\n\t\tL.DomEvent\n\t\t\t.on(container, 'click', L.DomEvent.stop)\n\t\t\t.on(container, 'mousedown', L.DomEvent.stop)\n\t\t\t.on(container, 'dblclick', L.DomEvent.stop)\n\t\t\t.on(container, 'contextmenu', L.DomEvent.stop);\n\t},\n\n\taddHooks: function () {\n        var container = this._map.getContainer();\n        \n\t\tL.DomEvent\n            .on(container, 'mouseleave', this._hide, this)\n\t\t\t.on(document, 'keydown', this._onKeyDown, this);\n\n        if (L.Browser.touch) {\n            L.DomEvent.on(document, this._touchstart, this._hide, this);\n        }\n        \n\t\tthis._map.on({\n\t\t\tcontextmenu: this._show,\n\t\t\tmousedown: this._hide,\n\t\t\tmovestart: this._hide,\n\t\t\tzoomstart: this._hide\n\t\t}, this);\n\t},\n\n\tremoveHooks: function () {\n        var container = this._map.getContainer();\n        \n\t\tL.DomEvent\n            .off(container, 'mouseleave', this._hide, this)\t\t\t\n\t\t\t.off(document, 'keydown', this._onKeyDown, this);\n\n        if (L.Browser.touch) {\n            L.DomEvent.off(document, this._touchstart, this._hide, this);\n        }        \n\n\t\tthis._map.off({\n\t\t\tcontextmenu: this._show,\n\t\t\tmousedown: this._hide,\n\t\t\tmovestart: this._hide,\n\t\t\tzoomstart: this._hide\n\t\t}, this);\n\t},\n\n\tshowAt: function (point, data) {\n\t\tif (point instanceof L.LatLng) {\n\t\t\tpoint = this._map.latLngToContainerPoint(point);\n\t\t}\n\t\tthis._showAtPoint(point, data);\n\t},\n\n\thide: function () {\n\t\tthis._hide();\n\t},\n\n\taddItem: function (options) {\n\t\treturn this.insertItem(options);\n\t},\n\n\tinsertItem: function (options, index) {\n\t\tindex = index !== undefined ? index: this._items.length; \n\n\t\tvar item = this._createItem(this._container, options, index);\n\t\t\n\t\tthis._items.push(item);\n\n\t\tthis._sizeChanged = true;\n\n\t\tthis._map.fire('contextmenu.additem', {\n\t\t\tcontextmenu: this,\n\t\t\tel: item.el,\n\t\t\tindex: index\n\t\t});\n\n\t\treturn item.el;\n\t},\n\n\tremoveItem: function (item) {\n\t\tvar container = this._container;\n\n\t\tif (!isNaN(item)) {\n\t\t\titem = container.children[item];\n\t\t}\n\n\t\tif (item) {\n\t\t\tthis._removeItem(L.Util.stamp(item));\n\n\t\t\tthis._sizeChanged = true;\n\n\t\t\tthis._map.fire('contextmenu.removeitem', {\n\t\t\t\tcontextmenu: this,\n\t\t\t\tel: item\n\t\t\t});\n\t\t}\t\t\n\t},\n\n\tremoveAllItems: function () {\n\t\tvar item;\n\n\t\twhile (this._container.children.length) {\n\t\t\titem = this._container.children[0];\n\t\t\tthis._removeItem(L.Util.stamp(item));\n\t\t}\n\t},\n\n\thideAllItems: function () {\n\t\tvar item, i, l;\n\n\t\tfor (i = 0, l = this._items.length; i < l; i++) {\n\t\t\titem = this._items[i];\n\t\t\titem.el.style.display = 'none';\n\t\t}\n\t},\n\n\tshowAllItems: function () {\n\t\tvar item, i, l;\n\n\t\tfor (i = 0, l = this._items.length; i < l; i++) {\n\t\t\titem = this._items[i];\n\t\t\titem.el.style.display = '';\n\t\t}\t\t\n\t},\n\n\tsetDisabled: function (item, disabled) {\n\t\tvar container = this._container,\n\t\titemCls = L.Map.ContextMenu.BASE_CLS + '-item';\n\n\t\tif (!isNaN(item)) {\n\t\t\titem = container.children[item];\n\t\t}\n\n\t\tif (item && L.DomUtil.hasClass(item, itemCls)) {\n\t\t\tif (disabled) {\n\t\t\t\tL.DomUtil.addClass(item, itemCls + '-disabled');\n\t\t\t\tthis._map.fire('contextmenu.disableitem', {\n\t\t\t\t\tcontextmenu: this,\n\t\t\t\t\tel: item\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tL.DomUtil.removeClass(item, itemCls + '-disabled');\n\t\t\t\tthis._map.fire('contextmenu.enableitem', {\n\t\t\t\t\tcontextmenu: this,\n\t\t\t\t\tel: item\n\t\t\t\t});\n\t\t\t}\t\t\t\n\t\t}\n\t},\n\n\tisVisible: function () {\n\t\treturn this._visible;\n\t},\n\n\t_createItems: function () {\n\t\tvar itemOptions = this._map.options.contextmenuItems,\n\t\t    item,\n\t\t    i, l;\n\n\t\tfor (i = 0, l = itemOptions.length; i < l; i++) {\n\t\t\tthis._items.push(this._createItem(this._container, itemOptions[i]));\n\t\t}\n\t},\n\n\t_createItem: function (container, options, index) {\n\t\tif (options.separator || options === '-') {\n\t\t\treturn this._createSeparator(container, index);\n\t\t}\n\n\t\tvar itemCls = L.Map.ContextMenu.BASE_CLS + '-item', \n\t\t    cls = options.disabled ? (itemCls + ' ' + itemCls + '-disabled') : itemCls,\n\t\t    el = this._insertElementAt('a', cls, container, index),\n\t\t    callback = this._createEventHandler(el, options.callback, options.context, options.hideOnSelect),\n\t\t    html = '';\n\t\t\n\t\tif (options.icon) {\n\t\t\thtml = '<img class=\"' + L.Map.ContextMenu.BASE_CLS + '-icon\" src=\"' + options.icon + '\"/>';\n\t\t} else if (options.iconCls) {\n\t\t\thtml = '<span class=\"' + L.Map.ContextMenu.BASE_CLS + '-icon ' + options.iconCls + '\"></span>';\n\t\t}\n\n\t\tel.innerHTML = html + options.text;\t\t\n\t\tel.href = '#';\n\n\t\tL.DomEvent\n\t\t\t.on(el, 'mouseover', this._onItemMouseOver, this)\n\t\t\t.on(el, 'mouseout', this._onItemMouseOut, this)\n\t\t\t.on(el, 'mousedown', L.DomEvent.stopPropagation)\n\t\t\t.on(el, 'click', callback);\n\n        if (L.Browser.touch) {\n            L.DomEvent.on(el, this._touchstart, L.DomEvent.stopPropagation);\n        }\n\n\t\treturn {\n\t\t\tid: L.Util.stamp(el),\n\t\t\tel: el,\n\t\t\tcallback: callback\n\t\t};\n\t},\n\n\t_removeItem: function (id) {\n\t\tvar item,\n\t\t    el,\n\t\t    i, l, callback;\n\n\t\tfor (i = 0, l = this._items.length; i < l; i++) {\n\t\t\titem = this._items[i];\n\n\t\t\tif (item.id === id) {\n\t\t\t\tel = item.el;\n\t\t\t\tcallback = item.callback;\n\n\t\t\t\tif (callback) {\n\t\t\t\t\tL.DomEvent\n\t\t\t\t\t\t.off(el, 'mouseover', this._onItemMouseOver, this)\n\t\t\t\t\t\t.off(el, 'mouseover', this._onItemMouseOut, this)\n\t\t\t\t\t\t.off(el, 'mousedown', L.DomEvent.stopPropagation)\n\t\t\t\t\t\t.off(el, 'click', callback);\n\n                    if (L.Browser.touch) {\n                        L.DomEvent.off(el, this._touchstart, L.DomEvent.stopPropagation);\n                    }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis._container.removeChild(el);\n\t\t\t\tthis._items.splice(i, 1);\n\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t},\n\n\t_createSeparator: function (container, index) {\n\t\tvar el = this._insertElementAt('div', L.Map.ContextMenu.BASE_CLS + '-separator', container, index);\n\t\t\n\t\treturn {\n\t\t\tid: L.Util.stamp(el),\n\t\t\tel: el\n\t\t};\n\t},\n\n\t_createEventHandler: function (el, func, context, hideOnSelect) {\n\t\tvar me = this,\n\t\t    map = this._map,\n\t\t    disabledCls = L.Map.ContextMenu.BASE_CLS + '-item-disabled',\n\t\t    hideOnSelect = (hideOnSelect !== undefined) ? hideOnSelect : true;\n\t\t\n\t\treturn function (e) {\n\t\t\tif (L.DomUtil.hasClass(el, disabledCls)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tif (hideOnSelect) {\n\t\t\t\tme._hide();\t\t\t\n\t\t\t}\n\n\t\t\tif (func) {\n\t\t\t\tfunc.call(context || map, me._showLocation);\t\t\t\n\t\t\t}\n\n\t\t\tme._map.fire('contextmenu:select', {\n\t\t\t\tcontextmenu: me,\n\t\t\t\tel: el\n\t\t\t});\n\t\t};\n\t},\n\n\t_insertElementAt: function (tagName, className, container, index) {\n\t\tvar refEl,\n\t\t    el = document.createElement(tagName);\n\n\t\tel.className = className;\n\n\t\tif (index !== undefined) {\n\t\t\trefEl = container.children[index];\n\t\t}\n\n\t\tif (refEl) {\n\t\t\tcontainer.insertBefore(el, refEl);\n\t\t} else {\n\t\t\tcontainer.appendChild(el);\n\t\t}\n\n\t\treturn el;\n\t},\n\n\t_show: function (e) {\n\t\tthis._showAtPoint(e.containerPoint, e);\n\t},\n\n\t_showAtPoint: function (pt, data) {\n\t\tif (this._items.length) {\n\t\t\tvar map = this._map,\n\t\t\tlayerPoint = map.containerPointToLayerPoint(pt),\n\t\t\tlatlng = map.layerPointToLatLng(layerPoint),\n\t\t\tevent = L.extend(data || {}, {contextmenu: this});\n\t\t\t\n\t\t\tthis._showLocation = {\n\t\t\t\tlatlng: latlng,\n\t\t\t\tlayerPoint: layerPoint,\n\t\t\t\tcontainerPoint: pt\n\t\t\t};\n\n\t\t\tif(data && data.relatedTarget){\n\t\t\t\tthis._showLocation.relatedTarget = data.relatedTarget;\n\t\t\t}\n\n\t\t\tthis._setPosition(pt);\t\t\t\n\n\t\t\tif (!this._visible) {\n\t\t\t\tthis._container.style.display = 'block';\t\t\t\t\t\t\t\n\t\t\t\tthis._visible = true;\t\t\t\t\t\t\t\n\t\t\t} else {\n\t\t\t\tthis._setPosition(pt);\t\t\t\n\t\t\t}\n\n\t\t\tthis._map.fire('contextmenu.show', event);\n\t\t}\n\t},\n\n\t_hide: function () {        \n\t\tif (this._visible) {\n\t\t\tthis._visible = false;\n\t\t\tthis._container.style.display = 'none';\n\t\t\tthis._map.fire('contextmenu.hide', {contextmenu: this});\n\t\t}\n\t},\n\n\t_setPosition: function (pt) {\n\t\tvar mapSize = this._map.getSize(),\n\t\t    container = this._container,\n\t\t    containerSize = this._getElementSize(container),\n\t\t    anchor;\n\n\t\tif (this._map.options.contextmenuAnchor) {\n\t\t\tanchor = L.point(this._map.options.contextmenuAnchor);\n\t\t\tpt = pt.add(anchor);\n\t\t}\n\n\t\tcontainer._leaflet_pos = pt;\n\n\t\tif (pt.x + containerSize.x > mapSize.x) {\n\t\t\tcontainer.style.left = 'auto';\n\t\t\tcontainer.style.right = Math.max(mapSize.x - pt.x, 0) + 'px';\n\t\t} else {\n\t\t\tcontainer.style.left = Math.max(pt.x, 0) + 'px';\n\t\t\tcontainer.style.right = 'auto';\n\t\t}\n\t\t\n\t\tif (pt.y + containerSize.y > mapSize.y) {\n\t\t\tcontainer.style.top = 'auto';\n\t\t\tcontainer.style.bottom = Math.max(mapSize.y - pt.y, 0) + 'px';\n\t\t} else {\n\t\t\tcontainer.style.top = Math.max(pt.y, 0) + 'px';\n\t\t\tcontainer.style.bottom = 'auto';\n\t\t}\n\t},\n\n\t_getElementSize: function (el) {\t\t\n\t\tvar size = this._size,\n\t\t    initialDisplay = el.style.display;\n\n\t\tif (!size || this._sizeChanged) {\n\t\t\tsize = {};\n\n\t\t\tel.style.left = '-999999px';\n\t\t\tel.style.right = 'auto';\n\t\t\tel.style.display = 'block';\n\t\t\t\n\t\t\tsize.x = el.offsetWidth;\n\t\t\tsize.y = el.offsetHeight;\n\t\t\t\n\t\t\tel.style.left = 'auto';\n\t\t\tel.style.display = initialDisplay;\n\t\t\t\n\t\t\tthis._sizeChanged = false;\n\t\t}\n\n\t\treturn size;\n\t},\n\n\t_onKeyDown: function (e) {\n\t\tvar key = e.keyCode;\n\n\t\t// If ESC pressed and context menu is visible hide it \n\t\tif (key === 27) {\n\t\t\tthis._hide();\n\t\t}\n\t},\n\n\t_onItemMouseOver: function (e) {\n\t\tL.DomUtil.addClass(e.target || e.srcElement, 'over');\n\t},\n\n\t_onItemMouseOut: function (e) {\n\t\tL.DomUtil.removeClass(e.target || e.srcElement, 'over');\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'contextmenu', L.Map.ContextMenu);\nL.Mixin.ContextMenu = {\n\n\tbindContextMenu: function (options) {\n\t\tL.setOptions(this, options);\n\t\tthis._initContextMenu();\n\n\t\treturn this;\n\t},\n\n\tunbindContextMenu: function (){\n\t\tthis.off('contextmenu', this._showContextMenu, this);\n\n\t\treturn this;\n\t},\n\n\taddContextMenuItem: function (item) {\n\t\t\tthis.options.contextmenuItems.push(item);\n\t},\n\n\tremoveContextMenuItemWithIndex: function (index) {\n\t\t  var items = [];\n\t\t\tfor (var i = 0; i < this.options.contextmenuItems.length; i++) {\n\t\t\t\t\tif(this.options.contextmenuItems[i].index == index){\n\t\t\t\t\t\t\titems.push(i);\n\t\t\t\t\t}\n\t\t\t}\n\t\t\tvar elem = items.pop();\n\t\t\twhile (elem !== undefined) {\n\t\t\t\t  this.options.contextmenuItems.splice(elem,1);\n\t\t\t\t\telem = items.pop();\n\t\t  }\n\t},\n\n\treplaceConextMenuItem: function (item) {\n\t\t  this.removeContextMenuItemWithIndex(item.index);\n\t\t  this.addContextMenuItem(item);\n\t},\n\n\t_initContextMenu: function () {\n\t\tthis._items = [];\n\t\n\t\tthis.on('contextmenu', this._showContextMenu, this);\n\t},\n\n\t_showContextMenu: function (e) {\n\t\tvar itemOptions,\n\t\t    data, pt, i, l;\n\n\t\tif (this._map.contextmenu) {\n            data = L.extend({relatedTarget: this}, e)\n            \n\t\t\tpt = this._map.mouseEventToContainerPoint(e.originalEvent);\n\n\t\t\tif (!this.options.contextmenuInheritItems) {\n\t\t\t\tthis._map.contextmenu.hideAllItems();\n\t\t\t}\n\n\t\t\tfor (i = 0, l = this.options.contextmenuItems.length; i < l; i++) {\n\t\t\t\titemOptions = this.options.contextmenuItems[i];\n\t\t\t\tthis._items.push(this._map.contextmenu.insertItem(itemOptions, itemOptions.index));\n\t\t\t}\n\n\t\t\tthis._map.once('contextmenu.hide', this._hideContextMenu, this);\n\t\t\n\t\t\tthis._map.contextmenu.showAt(pt, data);\n\t\t}\n\t},\n\n\t_hideContextMenu: function () {\n\t\tvar i, l;\n\n\t\tfor (i = 0, l = this._items.length; i < l; i++) {\n\t\t\tthis._map.contextmenu.removeItem(this._items[i]);\n\t\t}\n\t\tthis._items.length = 0;\t\t\n\n\t\tif (!this.options.contextmenuInheritItems) {\n\t\t\tthis._map.contextmenu.showAllItems();\n\t\t}\n\t}\t\n};\n\nvar classes = [L.Marker, L.Path],\n    defaultOptions = {\n\t\tcontextmenu: false,\n\t\tcontextmenuItems: [],\n\t    contextmenuInheritItems: true\n\t},\n    cls, i, l;\n\nfor (i = 0, l = classes.length; i < l; i++) {\n\tcls = classes[i];\n\n\t// L.Class should probably provide an empty options hash, as it does not test\n\t// for it here and add if needed\n\tif (!cls.prototype.options) {\n\t\tcls.prototype.options = defaultOptions;\n\t} else {\n\t\tcls.mergeOptions(defaultOptions);\n\t}\n\n\tcls.addInitHook(function () {\n\t\tif (this.options.contextmenu) {\n\t\t\tthis._initContextMenu();\n\t\t}\n\t});\n\n\tcls.include(L.Mixin.ContextMenu);\n}\n\treturn L.Map.ContextMenu;\n\t});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/leaflet-contextmenu/dist/leaflet.contextmenu.js\n// module id = 11\n// module chunks = 0","/*\n * Google layer using Google Maps API\n */\n\n/* global google: true */\n\nL.Google = L.Class.extend({\n\tincludes: L.Mixin.Events,\n\n\toptions: {\n\t\tminZoom: 0,\n\t\tmaxZoom: 18,\n\t\ttileSize: 256,\n\t\tsubdomains: 'abc',\n\t\terrorTileUrl: '',\n\t\tattribution: '',\n\t\topacity: 1,\n\t\tcontinuousWorld: false,\n\t\tnoWrap: false,\n\t\tmapOptions: {\n\t\t\tbackgroundColor: '#dddddd'\n\t\t}\n\t},\n\n\t// Possible types: SATELLITE, ROADMAP, HYBRID, TERRAIN\n\tinitialize: function(type, options) {\n\t\tL.Util.setOptions(this, options);\n\n\t\tthis._ready = google.maps.Map !== undefined;\n\t\tif (!this._ready) L.Google.asyncWait.push(this);\n\n\t\tthis._type = type || 'SATELLITE';\n\t},\n\n\tonAdd: function(map, insertAtTheBottom) {\n\t\tthis._map = map;\n\t\tthis._insertAtTheBottom = insertAtTheBottom;\n\n\t\t// create a container div for tiles\n\t\tthis._initContainer();\n\t\tthis._initMapObject();\n\n\t\t// set up events\n\t\tmap.on('viewreset', this._resetCallback, this);\n\n\t\tthis._limitedUpdate = L.Util.limitExecByInterval(this._update, 150, this);\n\t\tmap.on('move', this._update, this);\n\n\t\tmap.on('zoomanim', this._handleZoomAnim, this);\n\n\t\t//20px instead of 1em to avoid a slight overlap with google's attribution\n\t\tmap._controlCorners.bottomright.style.marginBottom = '20px';\n\n\t\tthis._reset();\n\t\tthis._update();\n\t},\n\n\tonRemove: function(map) {\n\t\tmap._container.removeChild(this._container);\n\n\t\tmap.off('viewreset', this._resetCallback, this);\n\n\t\tmap.off('move', this._update, this);\n\n\t\tmap.off('zoomanim', this._handleZoomAnim, this);\n\n\t\tmap._controlCorners.bottomright.style.marginBottom = '0em';\n\t},\n\n\tgetAttribution: function() {\n\t\treturn this.options.attribution;\n\t},\n\n\tsetOpacity: function(opacity) {\n\t\tthis.options.opacity = opacity;\n\t\tif (opacity < 1) {\n\t\t\tL.DomUtil.setOpacity(this._container, opacity);\n\t\t}\n\t},\n\n\tsetElementSize: function(e, size) {\n\t\te.style.width = size.x + 'px';\n\t\te.style.height = size.y + 'px';\n\t},\n\n\t_initContainer: function() {\n\t\tvar tilePane = this._map._container,\n\t\t\tfirst = tilePane.firstChild;\n\n\t\tif (!this._container) {\n\t\t\tthis._container = L.DomUtil.create('div', 'leaflet-google-layer leaflet-top leaflet-left');\n\t\t\tthis._container.id = '_GMapContainer_' + L.Util.stamp(this);\n\t\t\tthis._container.style.zIndex = 'auto';\n\t\t}\n\n\t\ttilePane.insertBefore(this._container, first);\n\n\t\tthis.setOpacity(this.options.opacity);\n\t\tthis.setElementSize(this._container, this._map.getSize());\n\t},\n\n\t_initMapObject: function() {\n\t\tif (!this._ready) return;\n\t\tthis._google_center = new google.maps.LatLng(0, 0);\n\t\tvar map = new google.maps.Map(this._container, {\n\t\t\tcenter: this._google_center,\n\t\t\tzoom: 0,\n\t\t\ttilt: 0,\n\t\t\tmapTypeId: google.maps.MapTypeId[this._type],\n\t\t\tdisableDefaultUI: true,\n\t\t\tkeyboardShortcuts: false,\n\t\t\tdraggable: false,\n\t\t\tdisableDoubleClickZoom: true,\n\t\t\tscrollwheel: false,\n\t\t\tstreetViewControl: false,\n\t\t\tstyles: this.options.mapOptions.styles,\n\t\t\tbackgroundColor: this.options.mapOptions.backgroundColor\n\t\t});\n\n\t\tvar _this = this;\n\t\tthis._reposition = google.maps.event.addListenerOnce(map, 'center_changed',\n\t\t\tfunction() { _this.onReposition(); });\n\t\tthis._google = map;\n\n\t\tgoogle.maps.event.addListenerOnce(map, 'idle',\n\t\t\tfunction() { _this._checkZoomLevels(); });\n\t\tgoogle.maps.event.addListenerOnce(map, 'tilesloaded',\n\t\t\tfunction() { _this.fire('load'); });\n\t\t//Reporting that map-object was initialized.\n\t\tthis.fire('MapObjectInitialized', { mapObject: map });\n\t},\n\n\t_checkZoomLevels: function() {\n\t\t//setting the zoom level on the Google map may result in a different zoom level than the one requested\n\t\t//(it won't go beyond the level for which they have data).\n\t\t// verify and make sure the zoom levels on both Leaflet and Google maps are consistent\n\t\tif (this._google.getZoom() !== this._map.getZoom()) {\n\t\t\t//zoom levels are out of sync. Set the leaflet zoom level to match the google one\n\t\t\tthis._map.setZoom( this._google.getZoom() );\n\t\t}\n\t},\n\n\t_resetCallback: function(e) {\n\t\tthis._reset(e.hard);\n\t},\n\n\t_reset: function(clearOldContainer) {\n\t\tthis._initContainer();\n\t},\n\n\t_update: function(e) {\n\t\tif (!this._google) return;\n\t\tthis._resize();\n\n\t\tvar center = this._map.getCenter();\n\t\tvar _center = new google.maps.LatLng(center.lat, center.lng);\n\n\t\tthis._google.setCenter(_center);\n\t\tthis._google.setZoom(Math.round(this._map.getZoom()));\n\n\t\tthis._checkZoomLevels();\n\t},\n\n\t_resize: function() {\n\t\tvar size = this._map.getSize();\n\t\tif (this._container.style.width === size.x &&\n\t\t\t\tthis._container.style.height === size.y)\n\t\t\treturn;\n\t\tthis.setElementSize(this._container, size);\n\t\tthis.onReposition();\n\t},\n\n\n\t_handleZoomAnim: function (e) {\n\t\tvar center = e.center;\n\t\tvar _center = new google.maps.LatLng(center.lat, center.lng);\n\n\t\tthis._google.setCenter(_center);\n\t\tthis._google.setZoom(Math.round(e.zoom));\n\t},\n\n\n\tonReposition: function() {\n\t\tif (!this._google) return;\n\t\tgoogle.maps.event.trigger(this._google, 'resize');\n\t}\n});\n\nL.Google.asyncWait = [];\nL.Google.asyncInitialize = function() {\n\tvar i;\n\tfor (i = 0; i < L.Google.asyncWait.length; i++) {\n\t\tvar o = L.Google.asyncWait[i];\n\t\to._ready = true;\n\t\tif (o._container) {\n\t\t\to._initMapObject();\n\t\t\to._update();\n\t\t}\n\t}\n\tL.Google.asyncWait = [];\n};\n\n\n// WEBPACK FOOTER //\n// ../d2-tracker/lib/Google.js","/* Services */\r\nvar eventCaptureServices = angular.module('eventCaptureServices', ['ngResource'])\r\n\r\n.factory('ECStorageService', function(){\r\n    var store = new dhis2.storage.Store({\r\n        name: 'dhis2ec',\r\n        adapters: [dhis2.storage.IndexedDBAdapter, dhis2.storage.DomSessionStorageAdapter, dhis2.storage.InMemoryAdapter],\r\n        objectStores: ['programs', 'optionSets', 'events', 'programRules', 'programRuleVariables', 'programIndicators', 'ouLevels', 'constants', 'dataElements']\r\n    });\r\n    return{\r\n        currentStore: store\r\n    };\r\n})\r\n\r\n.factory('OfflineECStorageService', function($http, $q, $rootScope, $translate, ECStorageService, ModalService, NotificationService){\r\n    return {        \r\n        hasLocalData: function() {\r\n            var def = $q.defer();\r\n            ECStorageService.currentStore.open().done(function(){\r\n                ECStorageService.currentStore.getKeys('events').done(function(events){\r\n                    $rootScope.$apply(function(){\r\n                        def.resolve( events.length > 0 );\r\n                    });                    \r\n                });\r\n            });            \r\n            return def.promise;\r\n        },\r\n        getLocalData: function(){\r\n            var def = $q.defer();            \r\n            ECStorageService.currentStore.open().done(function(){\r\n                ECStorageService.currentStore.getAll('events').done(function(events){\r\n                    $rootScope.$apply(function(){\r\n                        def.resolve({events: events});\r\n                    });                    \r\n                });\r\n            });            \r\n            return def.promise;\r\n        },\r\n        uploadLocalData: function(){            \r\n            var def = $q.defer();\r\n            this.getLocalData().then(function(localData){                \r\n                var evs = {events: []};\r\n                angular.forEach(localData.events, function(ev){\r\n                    ev.event = ev.id;\r\n                    delete ev.id;\r\n                    evs.events.push(ev);\r\n                });\r\n                \r\n                $http.post(DHIS2URL + '/events', evs).then(function(evResponse){\r\n                    dhis2.ec.store.removeAll( 'events' );\r\n                    NotificationService.displayDelayedHeaderMessage( $translate.instant('upload_success') );\r\n                    log( 'Successfully uploaded local events' );\r\n                    def.resolve();\r\n                }, function( error ){\r\n                    var serverLog = '';\r\n                    if( error && error.data && error.data.response && error.data.response.importSummaries ){\r\n                        angular.forEach(error.data.response.importSummaries, function(is){\r\n                            if( is.description ){\r\n                                serverLog += is.description + ';  ';\r\n                            }\r\n                        });\r\n                    }\r\n                    \r\n                    var modalOptions = {\r\n                        closeButtonText: 'keep_offline_data',\r\n                        actionButtonText: 'delete_offline_data',\r\n                        headerText: 'error',\r\n                        bodyText: $translate.instant('data_upload_to_server_failed:') + '  ' + serverLog\r\n                    };\r\n                    \r\n                    var modalDefaults = {\r\n                        backdrop: true,\r\n                        keyboard: true,\r\n                        modalFade: true,\r\n                        templateUrl: 'views/modal-offline.html'\r\n                    };\r\n                        \r\n                        \r\n                    ModalService.showModal(modalDefaults, modalOptions).then(function(result){\r\n                        dhis2.ec.store.removeAll( 'events' );\r\n                        NotificationService.displayDelayedHeaderMessage( $translate.instant('offline_data_deleted') );\r\n                        def.resolve();\r\n                    }, function(){\r\n                        NotificationService.displayDelayedHeaderMessage( $translate.instant('upload_failed_try_again') );\r\n                        def.resolve();\r\n                    });\r\n                });                      \r\n            });\r\n            return def.promise;\r\n        }\r\n    };\r\n})\r\n\r\n/* Factory to fetch optionSets */\r\n.factory('OptionSetService', function() {\r\n    return {\r\n        getCode: function(options, key){\r\n            if(options){\r\n                for(var i=0; i<options.length; i++){\r\n                    if( key === options[i].displayName){\r\n                        return options[i].code;\r\n                    }\r\n                }\r\n            }            \r\n            return key;\r\n        },        \r\n        getName: function(options, key){\r\n            if(options){\r\n                for(var i=0; i<options.length; i++){                    \r\n                    if( key === options[i].code){\r\n                        return options[i].displayName;\r\n                    }\r\n                }\r\n            }            \r\n            return key;\r\n        }\r\n    };\r\n})\r\n\r\n/* Factory to fetch programs */\r\n.factory('ProgramFactory', function($q, $rootScope, SessionStorageService, ECStorageService, CommonUtils) {\r\n    \r\n    return {\r\n        getProgramsByOu: function(ou, selectedProgram){\r\n            var roles = SessionStorageService.get('USER_PROFILE');\r\n            var userRoles = roles && roles.userCredentials && roles.userCredentials.userRoles ? roles.userCredentials.userRoles : [];\r\n            var def = $q.defer();\r\n            \r\n            ECStorageService.currentStore.open().done(function(){\r\n                ECStorageService.currentStore.getAll('programs').done(function(prs){\r\n                    var programs = [];\r\n                    angular.forEach(prs, function(pr){                            \r\n                        if(pr.organisationUnits.hasOwnProperty( ou.id ) && CommonUtils.userHasValidRole(pr, 'programs', userRoles)){\r\n                            programs.push(pr);\r\n                        }\r\n                    });\r\n                    \r\n                    if(programs.length === 0){\r\n                        selectedProgram = null;\r\n                    }\r\n                    else if(programs.length === 1){\r\n                        selectedProgram = programs[0];\r\n                    } \r\n                    else{\r\n                        if(selectedProgram){\r\n                            var continueLoop = true;\r\n                            for(var i=0; i<programs.length && continueLoop; i++){\r\n                                if(programs[i].id === selectedProgram.id){                                \r\n                                    selectedProgram = programs[i];\r\n                                    continueLoop = false;\r\n                                }\r\n                            }\r\n                            if(continueLoop){\r\n                                selectedProgram = null;\r\n                            }\r\n                        }\r\n                    }\r\n                    \r\n                    $rootScope.$apply(function(){\r\n                        def.resolve({programs: programs, selectedProgram: selectedProgram});\r\n                    });                      \r\n                });\r\n            });\r\n            \r\n            return def.promise;\r\n        }\r\n    };\r\n})\r\n\r\n/* factory for handling program related meta-data */\r\n.factory('MetaDataFactory', function($q, $rootScope, ECStorageService) {\r\n    \r\n    return {        \r\n        get: function(store, uid){\r\n            \r\n            var def = $q.defer();\r\n            \r\n            ECStorageService.currentStore.open().done(function(){\r\n                ECStorageService.currentStore.get(store, uid).done(function(pv){                    \r\n                    $rootScope.$apply(function(){\r\n                        def.resolve(pv);\r\n                    });\r\n                });\r\n            });                        \r\n            return def.promise;\r\n        },\r\n        getByProgram: function(store, program){\r\n            var def = $q.defer();\r\n            var objs = [];\r\n            \r\n            ECStorageService.currentStore.open().done(function(){\r\n                ECStorageService.currentStore.getAll(store).done(function(data){   \r\n                    angular.forEach(data, function(o){\r\n                        if(o.program.id === program){                            \r\n                            objs.push(o);                               \r\n                        }                        \r\n                    });\r\n                    $rootScope.$apply(function(){\r\n                        def.resolve(objs);\r\n                    });\r\n                });                \r\n            });            \r\n            return def.promise;\r\n        },\r\n        getByIds: function(store, ids){\r\n            var def = $q.defer();\r\n            var objs = [];\r\n            \r\n            ECStorageService.currentStore.open().done(function(){\r\n                ECStorageService.currentStore.getAll(store).done(function(data){   \r\n                    angular.forEach(data, function(o){\r\n                        if(ids.indexOf(o.id) !== -1){                            \r\n                            objs.push(o);                               \r\n                        }                        \r\n                    });\r\n                    $rootScope.$apply(function(){\r\n                        def.resolve(objs);\r\n                    });\r\n                });                \r\n            });            \r\n            return def.promise;\r\n        },\r\n        getAll: function(store){\r\n            var def = $q.defer();            \r\n            ECStorageService.currentStore.open().done(function(){\r\n                ECStorageService.currentStore.getAll(store).done(function(objs){                       \r\n                    $rootScope.$apply(function(){\r\n                        def.resolve(objs);\r\n                    });\r\n                });                \r\n            });            \r\n            return def.promise;\r\n        }\r\n    };        \r\n})\r\n\r\n/* factory for handling events */\r\n.factory('DHIS2EventFactory', function($http, $q, ECStorageService, $rootScope) {\r\n    var internalGetByFilters = function(orgUnit, attributeCategoryUrl, pager, paging, ordering, filterings, format, filterParam, sortParam) {\r\n        var url;\r\n           if (format === \"csv\") {\r\n            \turl = DHIS2URL + '/events.csv?' + 'orgUnit=' + orgUnit;\r\n        \t} else {\r\n            \turl = DHIS2URL + '/events/query.json?' + 'orgUnit=' + orgUnit;\r\n        \t}\r\n            \r\n            if(filterings) {\r\n                angular.forEach(filterings,function(filtering) {\r\n                    url += '&' + filtering.field + '=' + filtering.value;\r\n                });\r\n            }\r\n            \r\n            if(attributeCategoryUrl && !attributeCategoryUrl.default){\r\n                url = url + '&attributeCc=' + attributeCategoryUrl.cc + '&attributeCos=' + attributeCategoryUrl.cp;\r\n            }\r\n\r\n            if( filterParam ){\r\n                url += filterParam;\r\n            }\r\n            \r\n            if( sortParam && sortParam.id && sortParam.direction){\r\n                url += '&order=' + sortParam.id + ':' + sortParam.direction;\r\n            }\r\n            \r\n            if(paging){\r\n                var pgSize = pager.pageSize ? pager.pageSize : 50;\r\n                var pg = pager.page ? pager.page : 1;\r\n                pgSize = pgSize > 1 ? pgSize  : 1;\r\n                pg = pg > 1 ? pg : 1; \r\n                url = url  + '&pageSize=' + pgSize + '&page=' + pg + '&totalPages=true';\r\n            }\r\n            else{\r\n                url = url  + '&skipPaging=true';\r\n            }\r\n            \r\n            if(ordering && ordering.field){\r\n                url = url  + '&order=' + ordering.field;\r\n                if(ordering.direction) {\r\n                    url = url  + ':' + ordering.direction;\r\n                }\r\n            }\r\n            \r\n            var promise = $http.get( url ).then(function(response){                    \r\n                return response.data;        \r\n            }, function(){     \r\n                var def = $q.defer();\r\n                ECStorageService.currentStore.open().done(function(){\r\n                    ECStorageService.currentStore.getAll('events').done(function(evs){\r\n                        var result = {events: [], pager: {pageSize: '', page: 1, toolBarDisplay: 5, pageCount: 1}};\r\n                        angular.forEach(evs, function(ev){                            \r\n                            if(ev.programStage === programStage && ev.orgUnit === orgUnit){\r\n                                ev.event = ev.id;\r\n                                result.events.push(ev);\r\n                            }\r\n                        }); \r\n                        $rootScope.$apply(function(){\r\n                            def.resolve( result );\r\n                        });                    \r\n                    });\r\n                });            \r\n                return def.promise;\r\n            });            \r\n            return promise;\r\n    };\r\n    \r\n    return {\r\n        getByStage: function(orgUnit, programStage, attributeCategoryUrl, pager, paging, format, filterUrl, sortParam){\r\n            var url;\r\n            if (format === \"csv\") {\r\n            \turl = DHIS2URL + '/events.csv?' + 'orgUnit=' + orgUnit;\r\n            } \r\n            else {\r\n            \turl = DHIS2URL + '/events/query.json?' + 'orgUnit=' + orgUnit;\r\n            }\r\n            \r\n            if( programStage ) {                \r\n                url += '&programStage=' + programStage;\r\n            }\r\n            \r\n            if( attributeCategoryUrl && !attributeCategoryUrl.default ){\r\n                url = url + '&attributeCc=' + attributeCategoryUrl.cc + '&attributeCos=' + attributeCategoryUrl.cp;\r\n            }\r\n\r\n            if( filterUrl ){\r\n                url += filterUrl;\r\n            }\r\n            \r\n            if( sortParam && sortParam.id && sortParam.direction){\r\n                url += '&order=' + sortParam.id + ':' + sortParam.direction;\r\n            }\r\n            \r\n            if(paging){\r\n                var pgSize = pager.pageSize ? pager.pageSize : 50;\r\n                var pg = pager.page ? pager.page : 1;\r\n                pgSize = pgSize > 1 ? pgSize  : 1;\r\n                pg = pg > 1 ? pg : 1; \r\n                url = url  + '&pageSize=' + pgSize + '&page=' + pg + '&totalPages=true';\r\n            }\r\n            else{\r\n                url = url  + '&skipPaging=true';\r\n            }\r\n            \r\n            var promise = $http.get( url ).then(function(response){                    \r\n                return response.data;        \r\n            }, function(){                \r\n                var def = $q.defer();\r\n                ECStorageService.currentStore.open().done(function(){\r\n                    ECStorageService.currentStore.getAll('events').done(function(evs){                        \r\n                        var result = {events: [], metaData: {pager: {pageSize: '', page: 1, toolBarDisplay: 5, pageCount: 1}}};\r\n                        angular.forEach(evs, function(ev){                            \r\n                            if(ev.programStage === programStage && ev.orgUnit === orgUnit){\r\n                                ev.event = ev.id;\r\n                                result.events.push(ev);\r\n                            }\r\n                        }); \r\n                        $rootScope.$apply(function(){\r\n                            def.resolve( result );\r\n                        });                    \r\n                    });\r\n                });            \r\n                return def.promise;\r\n            });            \r\n            return promise;            \r\n        },\r\n        get: function(eventUid, event){\r\n            if( event && event.state && event.state === 'FULL' ){                \r\n                var def = $q.defer();\r\n                def.resolve( event );\r\n                return def.promise;\r\n            }\r\n            else{\r\n                var promise = $http.get(DHIS2URL + '/events/' + eventUid + '.json').then(function(response){               \r\n                    return response.data;                \r\n                }, function(){\r\n                    var p = dhis2.ec.store.get('events', eventUid).then(function(ev){\r\n                        ev.event = eventUid;\r\n                        return ev;\r\n                    });\r\n                    return p;\r\n                });            \r\n                return promise;\r\n            }            \r\n        },        \r\n        create: function(dhis2Event){\r\n            var promise = $http.post(DHIS2URL + '/events.json', dhis2Event).then(function(response){\r\n                return response.data;\r\n            }, function(){            \r\n                dhis2Event.id = dhis2.util.uid();  \r\n                dhis2Event.event = dhis2Event.id;\r\n                dhis2.ec.store.set( 'events', dhis2Event );                \r\n                return {response: {importSummaries: [{status: 'SUCCESS', reference: dhis2Event.id}]}};\r\n            });\r\n            return promise;            \r\n        },        \r\n        delete: function(dhis2Event){\r\n            var promise = $http.delete(DHIS2URL + '/events/' + dhis2Event.event).then(function(response){\r\n                return response.data;\r\n            }, function( response ){\r\n                dhis2.ec.store.remove( 'events', dhis2Event.event );\r\n                return response.data;\r\n            });\r\n            return promise;           \r\n        },    \r\n        update: function(dhis2Event){\r\n            var promise = $http.put(DHIS2URL + '/events/' + dhis2Event.event, dhis2Event).then(function(response){              \r\n                return response.data;\r\n            }, function(){\r\n                dhis2.ec.store.remove('events', dhis2Event.event);\r\n                dhis2Event.id = dhis2Event.event;\r\n                dhis2.ec.store.set('events', dhis2Event);\r\n            });\r\n            return promise;\r\n        },        \r\n        updateForSingleValue: function(singleValue, fullValue){        \r\n            var promise = $http.put(DHIS2URL + '/events/' + singleValue.event + '/' + singleValue.dataValues[0].dataElement, singleValue ).then(function(response){\r\n                 return response.data;\r\n            }, function(){\r\n                dhis2.ec.store.remove('events', fullValue.event);\r\n                fullValue.id = fullValue.event;\r\n                dhis2.ec.store.set('events', fullValue);\r\n            });\r\n            return promise;\r\n        },\r\n        updateForEventDate: function(dhis2Event, fullEvent){\r\n            var promise = $http.put(DHIS2URL + '/events/' + dhis2Event.event + '/eventDate', dhis2Event).then(function(response){\r\n                return response.data;         \r\n            }, function(){\r\n                dhis2.ec.store.remove('events', fullEvent.event);\r\n                fullEvent.id = fullEvent.event;\r\n                dhis2.ec.store.set('events', fullEvent);\r\n            });\r\n            return promise;\r\n        }\r\n    };    \r\n});\n\n\n// WEBPACK FOOTER //\n// ./scripts/services.js","/* Filters */\r\nvar eventCaptureFilters = angular.module('eventCaptureFilters', []);\n\n\n// WEBPACK FOOTER //\n// ./scripts/filters.js","/* Directives */\r\nvar eventCaptureDirectives = angular.module('eventCaptureDirectives', [])\r\n.directive('modalBody', function (){\r\n    return {\r\n        restrict: 'E',\r\n        templateUrl: 'views/modal-body.html',\r\n        scope: {\r\n            body: '='\r\n        },\r\n        controller: [\r\n            '$scope',\r\n            '$translate',\r\n            function($scope, $translate){\r\n                \r\n            }\r\n        ]\r\n    }\r\n});\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./scripts/directives.js","var eventCapture = angular.module('eventCapture');\r\n\r\n/* Controllers */\r\n//var eventCaptureControllers = angular.module('eventCaptureControllers', ['ngCsv'])\r\n\r\n//Controller for settings page\r\neventCapture.controller('MainController',\r\n        function($rootScope,\r\n                $scope,\r\n                $route,\r\n                $modal,\r\n                $translate,\r\n                $anchorScroll,\r\n                $window,\r\n                $q,\r\n                $filter,\r\n                $location,\r\n                orderByFilter,\r\n                SessionStorageService,\r\n                Paginator,\r\n                MetaDataFactory,\r\n                ProgramFactory,                               \r\n                DHIS2EventFactory,\r\n                DHIS2EventService,\r\n                ContextMenuSelectedItem,                \r\n                DateUtils,\r\n                CalendarService,\r\n                GridColumnService,\r\n                CustomFormService,\r\n                ECStorageService,\r\n                CurrentSelection,\r\n                ModalService,\r\n                DialogService,\r\n                CommonUtils,\r\n                AuthorityService,\r\n                TrackerRulesExecutionService,\r\n                OrgUnitFactory,\r\n                OptionSetService) {\r\n    \r\n    $scope.maxOptionSize = 30;    \r\n    $scope.treeLoaded = false;    \r\n    $scope.selectedSection = {id: 'ALL'};    \r\n    $rootScope.ruleeffects = {};\r\n    $scope.hiddenFields = [];\r\n    $scope.assignedFields = [];\r\n    \r\n    $scope.calendarSetting = CalendarService.getSetting();\r\n    \r\n    //Paging\r\n    $scope.pager = {pageSize: 50, page: 1, toolBarDisplay: 5};\r\n    \r\n    function resetView(){\r\n        $scope.eventRegistration = false;\r\n        $scope.editingEventInFull = false;\r\n        $scope.editingEventInGrid = false;        \r\n    }\r\n    \r\n    resetView();\r\n    \r\n    $scope.editGridColumns = false;\r\n    $scope.updateSuccess = false;\r\n    $scope.currentGridColumnId = '';  \r\n    $scope.dhis2Events = [];\r\n    $scope.currentEvent = {};\r\n    $scope.currentEventOriginialValue = {}; \r\n    $scope.displayCustomForm = false;\r\n    $scope.currentElement = {id: '', update: false};\r\n    $scope.optionSets = [];\r\n    $scope.proceedSelection = true;\r\n    $scope.formUnsaved = false;\r\n    $scope.fileNames = {};\r\n    $scope.currentFileNames = {};\r\n    $scope.gridColumnsInUserStore = null;\r\n    $scope.model = {exportFormats:[\"XML\",\"JSON\",\"CSV\"], savingRegistration: false};\r\n    \r\n    //notes\r\n    $scope.note = {};\r\n    $scope.displayTextEffects = [];\r\n    $scope.today = DateUtils.getToday();\r\n    \r\n    var storedBy = CommonUtils.getUsername();\r\n    \r\n    $scope.noteExists = false;\r\n\r\n    var orgUnitFromUrl = ($location.search()).ou;\r\n\r\n    var eventIdFromUrl = ($location.search()).event;\r\n\r\n     //watch for selection of org unit from tree\r\n    $scope.$watch('selectedOrgUnit', function() {\r\n        if (angular.isObject($scope.selectedOrgUnit)) {\r\n            OrgUnitFactory.getFromStoreOrServer($scope.selectedOrgUnit.id).then(function (orgUnitFromStore) {\r\n                if(orgUnitFromStore) {\r\n                    $scope.model.ouDates = { startDate: orgUnitFromStore.odate, endDate: orgUnitFromStore.cdate };\r\n                    if(orgUnitFromStore.reportDateRange) {\r\n                        $scope.model.maxDate = orgUnitFromStore.reportDateRange.maxDate;\r\n                        $scope.model.minDate = orgUnitFromStore.reportDateRange.minDate;\r\n                    }\r\n                    $scope.model.editingDisabled = orgUnitFromStore.closedStatus;\r\n                }\r\n            });\r\n\r\n            $scope.pleaseSelectLabel = $translate.instant('please_select');\r\n            $scope.registeringUnitLabel = $translate.instant('registering_unit');\r\n            $scope.eventCaptureLabel = $translate.instant('event_capture');\r\n            $scope.programLabel = $translate.instant('program');\r\n            $scope.searchLabel = $translate.instant('search');\r\n            $scope.findLabel = $translate.instant('find');\r\n            $scope.searchOusLabel = $translate.instant('locate_organisation_unit_by_name');\r\n            $scope.yesLabel = $translate.instant('yes');\r\n            $scope.noLabel = $translate.instant('no');\r\n\r\n            SessionStorageService.set('SELECTED_OU', $scope.selectedOrgUnit);\r\n\r\n            $scope.userAuthority = AuthorityService.getUserAuthorities(SessionStorageService.get('USER_PROFILE'));\r\n            GridColumnService.get(\"eventCaptureGridColumns\").then(function (gridColumns) {\r\n                if (gridColumns && gridColumns.status !== \"ERROR\") {\r\n                    $scope.gridColumnsInUserStore = gridColumns;\r\n                }\r\n                //get ouLevels\r\n                ECStorageService.currentStore.open().done(function () {\r\n                    ECStorageService.currentStore.getAll('ouLevels').done(function (response) {\r\n                        var ouLevels = angular.isObject(response) ? orderByFilter(response, '-level').reverse() : [];\r\n                        CurrentSelection.setOuLevels(orderByFilter(ouLevels, '-level').reverse());\r\n                    });\r\n                });\r\n\r\n                if ($scope.optionSets.length < 1) {\r\n                    $scope.optionSets = [];\r\n                    MetaDataFactory.getAll('optionSets').then(function (optionSets) {\r\n                        angular.forEach(optionSets, function (optionSet) {\r\n                            $scope.optionSets[optionSet.id] = optionSet;\r\n                        });\r\n                        $scope.loadPrograms();\r\n                    });\r\n                }\r\n                else {\r\n                    $scope.loadPrograms();\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    $scope.verifyExpiryDate = function() {\r\n        if (!DateUtils.verifyExpiryDate($scope.currentEvent.eventDate, $scope.selectedProgram.expiryPeriodType,\r\n                $scope.selectedProgram.expiryDays)) {\r\n            $scope.currentEvent.eventDate = null;\r\n        }\r\n    };\r\n\r\n    $scope.completeEnrollment = function() {\r\n        $scope.currentEvent.status = !$scope.currentEvent.status;\r\n    };\r\n    \r\n    //load programs associated with the selected org unit.\r\n\r\n    $scope.loadPrograms = function() {\r\n        \r\n        $scope.resetOu = false;\r\n        $scope.selectedProgramStage = null;\r\n        $scope.currentStage = null;\r\n        $scope.allProgramRules = [];\r\n        $scope.dhis2Events = [];\r\n        $scope.currentEvent = {};\r\n        $scope.currentEventOriginialValue = {};\r\n        $scope.fileNames = {};        \r\n        $scope.currentFileNames = {};\r\n        $scope.orgUnitNames = {};\r\n\r\n        resetView();\r\n        $scope.editGridColumns = false;\r\n        $scope.updateSuccess = false;\r\n        $scope.currentGridColumnId = '';           \r\n        $scope.displayCustomForm = false;\r\n        \r\n        if (angular.isObject($scope.selectedOrgUnit)) {\r\n            ProgramFactory.getProgramsByOu($scope.selectedOrgUnit, $scope.selectedProgram).then(function(response){\r\n                $scope.programs = response.programs;\r\n                if (eventIdFromUrl) {\r\n                    $scope.showEventForEditing(eventIdFromUrl);\r\n                } else {\r\n                    $scope.selectedProgram = response.selectedProgram;\r\n                    $scope.getProgramDetails();\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    $scope.showEventForEditing = function(eventId) {\r\n        DHIS2EventFactory.get(eventId).then(function (event) {\r\n            if (event) {\r\n                ContextMenuSelectedItem.setSelectedItem(event);\r\n                if(!event.coordinate) {\r\n                    event.coordinate = {};\r\n                }\r\n                for (var i = 0; i < $scope.programs.length; i++) {\r\n                    if ($scope.programs[i].id === event.program) {\r\n                        $scope.selectedProgram = $scope.programs[i];\r\n                        $scope.getProgramDetails();                        \r\n                        if( $scope.selectedProgram.programStages[0].id === event.programStage ){\r\n                            $scope.formatEvent(event);\r\n                            $scope.currentEvent = angular.copy(event);\r\n                            $scope.editingEventInFull = false;\r\n                            $scope.showEditEventInFull();\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    };\r\n   \r\n    function setCommonEventProps( event ){\r\n        event.uid = event.event;\r\n        event.eventDate = DateUtils.formatFromApiToUser(event.eventDate);\r\n        event.lastUpdated = DateUtils.formatFromApiToUser(event.lastUpdated);\r\n        if (event.completedDate) {\r\n            event.completedDate = DateUtils.formatFromApiToUser(event.completedDate);\r\n        }\r\n        if(event.status === \"ACTIVE\") {\r\n            event.status = false;\r\n        } else if(event.status === \"COMPLETED\") {\r\n            event.status = true;\r\n        }\r\n    }\r\n    \r\n    $scope.formatEvent = function(event) {\r\n        if(event.notes && event.notes.length > 0 && !$scope.noteExists){\r\n            $scope.noteExists = true;\r\n        }\r\n\r\n        angular.forEach(event.dataValues, function(dataValue){\r\n            if($scope.prStDes && $scope.prStDes[dataValue.dataElement] && dataValue.value){\r\n                \r\n                if(angular.isObject($scope.prStDes[dataValue.dataElement].dataElement)){\r\n                    dataValue.value = CommonUtils.formatDataValue(null, dataValue.value, $scope.prStDes[dataValue.dataElement].dataElement, $scope.optionSets, 'USER');\r\n                }\r\n\r\n                event[dataValue.dataElement] = dataValue.value;\r\n                \r\n                switch( $scope.prStDes[dataValue.dataElement].dataElement.valueType ){\r\n                    case \"FILE_RESOURCE\":\r\n                        CommonUtils.checkAndSetFileName(event, dataValue.value, dataValue.dataElement);\r\n                        break;\r\n                    case \"ORGANISATION_UNIT\":\r\n                        CommonUtils.checkAndSetOrgUnitName( dataValue.value );\r\n                        break;\r\n                }\r\n            }\r\n        });\r\n        \r\n        $scope.fileNames = CurrentSelection.getFileNames();\r\n        $scope.orgUnitNames = CurrentSelection.getOrgUnitNames();\r\n\r\n        setCommonEventProps( event );\r\n        \r\n        if( $scope.selectedProgramStage && $scope.selectedProgramStage.captureCoordinates && !event.coordinate ){\r\n            event.coordinate = {};\r\n        }\r\n        \r\n        event.state = 'FULL';\r\n        delete event.dataValues;\r\n    };\r\n\r\n    $scope.formatEventFromGrid = function(event) {\r\n        if(event.notes && event.notes.length > 0 && !$scope.noteExists){\r\n            $scope.noteExists = true;\r\n        }\r\n        \r\n        angular.forEach($scope.selectedProgramStage.programStageDataElements, function(prStDe){            \r\n            var de = prStDe.dataElement;            \r\n            if( event[de.id] ){\r\n                event[de.id] = CommonUtils.formatDataValue(null, event[de.id], de, $scope.optionSets, 'USER');\r\n                \r\n                switch ( de.valueType ){\r\n                    case \"FILE_RESOURCE\":\r\n                        CommonUtils.checkAndSetFileName(event, event[de.id], de.id);\r\n                        break;\r\n                    case \"ORGANISATION_UNIT\":\r\n                        CommonUtils.checkAndSetOrgUnitName( event[de.id] );                        \r\n                        break;\r\n                }\r\n            }\r\n        });\r\n        \r\n        setCommonEventProps( event );\r\n        \r\n        if( event.latitude ){\r\n            var lat = $scope.formatNumberResult( event.latitude );\r\n            if( event.coordinate ){\r\n                event.coordinate.latitude = lat;\r\n            }\r\n            else{\r\n                event.coordinate = {latitude: lat};\r\n            }\r\n        }\r\n        \r\n        if( event.longitude ){\r\n            var lng = $scope.formatNumberResult( event.longitude );\r\n            if( event.coordinate ){\r\n                event.coordinate.longitude = lng;\r\n            }\r\n            else{\r\n                event.coordinate = {longitude: lng};\r\n            }\r\n        }\r\n        \r\n        event.state = 'PARTIAL';\r\n    };\r\n\r\n    /* If gridCoulumns for a program is stored in user data store then it is restored when\r\n     * the program is selected. If the grid columns are not stored then the grid columns are set\r\n     * as the default one for that program (in $scope.search() function)\r\n     * */\r\n    $scope.restoreGridColumnsFromUserStore = function() {\r\n        $scope.savedGridColumns = [];\r\n        if($scope.gridColumnsInUserStore && $scope.selectedProgram && $scope.selectedProgram.id) {\r\n            if ($scope.gridColumnsInUserStore[$scope.selectedProgram.id]) {\r\n                $scope.savedGridColumns = angular.copy($scope.gridColumnsInUserStore[$scope.selectedProgram.id]);\r\n            }\r\n        }\r\n    };\r\n\r\n    $scope.getProgramDetails = function(){\r\n        var showStatus, savedColumn;\r\n        $scope.selectedOptions = [];\r\n        $scope.selectedProgramStage = null;\r\n        $scope.eventFetched = false;\r\n        $scope.optionsReady = false;\r\n        \r\n        //Filtering\r\n        $scope.reverse = true;\r\n        $scope.sortHeader = {id: 'lastUpdated', direction: 'desc'};\r\n        $scope.filterText = {};\r\n        $scope.filterParam = '';\r\n        if( $scope.userAuthority && $scope.userAuthority.canAddOrUpdateEvent &&\r\n                $scope.selectedProgram && \r\n                $scope.selectedProgram.programStages && \r\n                $scope.selectedProgram.programStages[0] && \r\n                $scope.selectedProgram.programStages[0].id){ \r\n                \r\n            //because this is single event, take the first program stage\r\n\r\n            $scope.selectedProgramStage = $scope.selectedProgram.programStages[0];\r\n            $scope.currentStage = $scope.selectedProgramStage;\r\n\r\n            angular.forEach($scope.selectedProgramStage.programStageSections, function(section){\r\n                    section.open = true;\r\n            });\r\n\r\n            $scope.prStDes = [];\r\n            $scope.restoreGridColumnsFromUserStore();\r\n            $scope.filterTypes = {};\r\n            $scope.newDhis2Event = {};\r\n            $scope.filterTypes['uid'] = 'TEXT';\r\n            $scope.eventGridColumns = [];\r\n\r\n            $scope.eventGridColumns.push({\r\n                displayName: 'event_uid',\r\n                id: 'uid',\r\n                valueType: 'TEXT',\r\n                compulsory: false,\r\n                filterWithRange: false,\r\n                showFilter: false,\r\n                show: getShowStatus(false, 'uid'),\r\n                group: 'FIXED'\r\n            });\r\n\r\n            $scope.eventGridColumns.push({\r\n                displayName: $scope.selectedProgramStage.reportDateDescription ? $scope.selectedProgramStage.reportDateDescription : $translate.instant('incident_date'),\r\n                id: 'eventDate',\r\n                valueType: 'DATE',\r\n                filterWithRange: true,\r\n                compulsory: false,\r\n                showFilter: false,\r\n                show: getShowStatus(true, 'eventDate'),\r\n                group: 'FIXED'\r\n            });\r\n\r\n            $scope.eventGridColumns.push({\r\n                displayName: $translate.instant('last_updated'),\r\n                id: 'lastUpdated',\r\n                valueType: 'DATE',\r\n                filterWithRange: true,\r\n                compulsory: false,\r\n                showFilter: false,\r\n                show: getShowStatus(true, 'lastUpdated'),\r\n                group: 'FIXED'\r\n            });\r\n\r\n            $scope.filterTypes['eventDate'] = 'DATE';\r\n            $scope.filterText['eventDate'] = {};\r\n\r\n            angular.forEach($scope.selectedProgramStage.programStageDataElements, function (prStDe) {\r\n\r\n                $scope.prStDes[prStDe.dataElement.id] = prStDe;\r\n                $scope.newDhis2Event[prStDe.dataElement.id] = '';\r\n\r\n                showStatus = getShowStatus(prStDe.displayInReports, prStDe.dataElement.id);\r\n\r\n                    //generate grid headers using program stage data elements\r\n                    //create a template for new event\r\n                    //for date type dataelements, filtering is based on start and end dates\r\n                $scope.eventGridColumns.push({\r\n                        displayName: prStDe.dataElement.displayFormName,\r\n                        id: prStDe.dataElement.id,\r\n                        valueType: prStDe.dataElement.valueType,\r\n                        compulsory: prStDe.compulsory,\r\n                        filterWithRange: prStDe.dataElement.valueType === 'DATE' ||\r\n                        prStDe.dataElement.valueType === 'NUMBER' ||\r\n                        prStDe.dataElement.valueType === 'INTEGER' ||\r\n                        prStDe.dataElement.valueType === 'INTEGER_POSITIVE' ||\r\n                        prStDe.dataElement.valueType === 'INTEGER_NEGATIVE' ||\r\n                        prStDe.dataElement.valueType === 'INTEGER_ZERO_OR_POSITIVE' ? true : false,\r\n                        showFilter: false,\r\n                        show: showStatus,\r\n                        group: 'DYNAMIC'\r\n                });\r\n\r\n                $scope.filterTypes[prStDe.dataElement.id] = prStDe.dataElement.valueType;\r\n\r\n                if (prStDe.dataElement.valueType === 'DATE' ||\r\n                    prStDe.dataElement.valueType === 'NUMBER' ||\r\n                    prStDe.dataElement.valueType === 'INTEGER' ||\r\n                    prStDe.dataElement.valueType === 'INTEGER_POSITIVE' ||\r\n                    prStDe.dataElement.valueType === 'INTEGER_NEGATIVE' ||\r\n                    prStDe.dataElement.valueType === 'INTEGER_ZERO_OR_POSITIVE') {\r\n                    $scope.filterText[prStDe.dataElement.id] = {};\r\n                }\r\n            });\r\n\r\n            $scope.emptyFilterText = angular.copy( $scope.filterText );\r\n\r\n            $scope.customDataEntryForm = CustomFormService.getForProgramStage($scope.selectedProgramStage, $scope.prStDes);\r\n\r\n            if($scope.selectedProgramStage.captureCoordinates){\r\n                $scope.newDhis2Event.coordinate = {};\r\n            }\r\n\r\n            $scope.newDhis2Event.eventDate = '';\r\n            $scope.newDhis2Event.event = 'SINGLE_EVENT';\r\n\r\n            $scope.selectedCategories = [];\r\n            if($scope.selectedProgram.categoryCombo && !$scope.selectedProgram.categoryCombo.isDefault && $scope.selectedProgram.categoryCombo.categories){\r\n                $scope.selectedCategories = $scope.selectedProgram.categoryCombo.categories;\r\n            }\r\n            else{\r\n                $scope.loadEvents();\r\n            }\r\n            $scope.optionsReady = true;\r\n\r\n            function getShowStatus(defaultShowStatus, id) {\r\n                var showStatus = defaultShowStatus;\r\n\r\n                savedColumn = $filter('filter')($scope.savedGridColumns, {id: id}, true);\r\n                if (savedColumn.length > 0) {\r\n                    showStatus = savedColumn[0].show;\r\n                }\r\n                return showStatus;\r\n            }\r\n        }\r\n    };\r\n    \r\n    function loadOptions(){\r\n        $scope.selectedOptions = [];\r\n        var categoryOptions = null;\r\n        \r\n        if ($scope.currentEvent.attributeCategoryOptions) {\r\n            $scope.selectedOptions = $scope.currentEvent.attributeCategoryOptions.split(\";\");\r\n            for (var index1 = 0; index1 < $scope.selectedCategories.length; index1++) {\r\n                categoryOptions = $scope.selectedCategories[index1].categoryOptions;\r\n                for(var index2=0; index2<categoryOptions.length; index2++) {\r\n                    if(categoryOptions[index2].id === $scope.selectedOptions[index1]){\r\n                        $scope.selectedCategories[index1].selectedOption = categoryOptions[index2];\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            $scope.optionsReady = true;\r\n        }\r\n    }\r\n    \r\n    $scope.getCategoryOptions = function(){\r\n        $scope.eventFetched = false;\r\n        $scope.optionsReady = false;\r\n        $scope.selectedOptions = [];\r\n        \r\n        for (var i = 0; i < $scope.selectedCategories.length; i++) {\r\n            if ($scope.selectedCategories[i].selectedOption && $scope.selectedCategories[i].selectedOption.id) {\r\n                $scope.optionsReady = true;\r\n                $scope.selectedOptions.push($scope.selectedCategories[i].selectedOption.id);\r\n            }\r\n            else {\r\n                $scope.optionsReady = false;\r\n                break;\r\n            }\r\n        }        \r\n        \r\n        if($scope.optionsReady && !$scope.eventRegistration && !$scope.editingEventInFull){\r\n            $scope.loadEvents();\r\n        }\r\n    };\r\n        \r\n    //get events for the selected program (and org unit)\r\n    $scope.loadEvents = function(){\r\n        resetView();\r\n        $scope.noteExists = false;                \r\n        $scope.eventFetched = true;\r\n        \r\n        $scope.attributeCategoryUrl = {cc: $scope.selectedProgram.categoryCombo.id, default: $scope.selectedProgram.categoryCombo.isDefault, cp: \"\"};\r\n        if(!$scope.selectedProgram.categoryCombo.isDefault){            \r\n            if($scope.selectedOptions.length !== $scope.selectedCategories.length){\r\n                var dialogOptions = {\r\n                    headerText: 'error',\r\n                    bodyText: 'fill_all_category_options'\r\n                };\r\n\r\n                DialogService.showDialog({}, dialogOptions);\r\n                return;\r\n            }            \r\n            $scope.attributeCategoryUrl.cp = $scope.selectedOptions.join(';');\r\n        }\r\n               \r\n        if( $scope.selectedProgram && $scope.selectedProgramStage && $scope.selectedProgramStage.id){\r\n            \r\n            //Load events for the selected program stage and orgunit\r\n            \r\n            var dataElementUrl = $filter('filter')($scope.eventGridColumns, {group: 'DYNAMIC', show: true}).map(function(c){return c.id;});\r\n            \r\n            if( dataElementUrl && dataElementUrl.length > 0 ){\r\n                dataElementUrl = '&dataElement=' + dataElementUrl.join(',');\r\n            }\r\n            else{\r\n                dataElementUrl = '';\r\n            }\r\n            \r\n            DHIS2EventFactory.getByStage($scope.selectedOrgUnit.id, $scope.selectedProgramStage.id, $scope.attributeCategoryUrl, $scope.pager, true, null, $scope.filterParam + dataElementUrl, $scope.sortHeader ).then(function(data){                \r\n                var _dhis2Events = [];\r\n                if( dhis2.ec.isOffline ) {\r\n                    angular.forEach(data.events, function(ev){\r\n                        $scope.formatEvent( ev );\r\n                        _dhis2Events.push( ev );\r\n                    });                    \r\n                }\r\n                else{\r\n                    if( data && data.headers && data.rows ){\r\n                        _dhis2Events = [];\r\n                        angular.forEach(data.rows,function(r){\r\n                            var ev = {};\r\n                            for(var i=0; i<data.headers.length; i++ ){\r\n                                ev[data.headers[i].name] = r[i];\r\n                            }\r\n                            $scope.formatEventFromGrid( ev );\r\n                            _dhis2Events.push( ev );\r\n                        });                                        \r\n\r\n                        $scope.fileNames = CurrentSelection.getFileNames();\r\n                        $scope.orgUnitNames = CurrentSelection.getOrgUnitNames();                       \r\n                    }\r\n                }\r\n                \r\n                if( data.metaData && data.metaData.pager ){\r\n\r\n                    data.metaData.pager.pageSize = data.metaData.pager.pageSize ? data.metaData.pager.pageSize : $scope.pager.pageSize;\r\n                    $scope.pager = data.metaData.pager;\r\n                    $scope.pager.toolBarDisplay = 5;\r\n\r\n                    Paginator.setPage($scope.pager.page);\r\n                    Paginator.setPageCount($scope.pager.pageCount);\r\n                    Paginator.setPageSize($scope.pager.pageSize);\r\n                    Paginator.setItemCount($scope.pager.total);\r\n                }\r\n\r\n                if($scope.noteExists && !GridColumnService.columnExists($scope.eventGridColumns, 'comment')){\r\n                    $scope.eventGridColumns.push({displayName: 'comment', id: 'comment', type: 'TEXT', filterWithRange: false, compulsory: false, showFilter: false, show: true});\r\n                }\r\n                        \r\n                $scope.eventFetched = true;\r\n                $scope.dhis2Events = _dhis2Events;\r\n            });\r\n        }\r\n    };    \r\n    \r\n    $scope.jumpToPage = function(){\r\n        \r\n        if($scope.pager && $scope.pager.page && $scope.pager.pageCount && $scope.pager.page > $scope.pager.pageCount){\r\n            $scope.pager.page = $scope.pager.pageCount;\r\n        }\r\n        $scope.loadEvents();\r\n    };\r\n    \r\n    $scope.resetPageSize = function(){\r\n        $scope.pager.page = 1;        \r\n        $scope.loadEvents();\r\n    };\r\n    \r\n    $scope.getPage = function(page){    \r\n        $scope.pager.page = page;\r\n        $scope.loadEvents();\r\n    };\r\n    \r\n    $scope.sortEventGrid = function(gridHeader){        \r\n        if ($scope.sortHeader && $scope.sortHeader.id === gridHeader.id){\r\n            $scope.reverse = !$scope.reverse;            \r\n        }        \r\n        $scope.sortHeader = {id: gridHeader.id, direction: $scope.reverse ? 'desc' : 'asc'};        \r\n        $scope.loadEvents();\r\n    };\r\n    \r\n    $scope.showHideColumns = function(){        \r\n        var oldCols = ($filter('filter')(angular.copy($scope.eventGridColumns), {group: 'DYNAMIC', show: true})).length;        \r\n        $scope.gridColumnsInUserStore = $scope.gridColumnsInUserStore ? $scope.gridColumnsInUserStore : {};        \r\n        $scope.gridColumnsInUserStore[$scope.selectedProgram.id] = angular.copy( $scope.eventGridColumns );\r\n        \r\n        var modalInstance = $modal.open({\r\n            templateUrl: 'views/column-modal.html',\r\n            controller: 'ColumnDisplayController',\r\n            resolve: {\r\n                gridColumns: function () {\r\n                    return $scope.eventGridColumns;\r\n                },\r\n                hiddenGridColumns: function(){\r\n                    return ($filter('filter')($scope.eventGridColumns, {show: false})).length;\r\n                },\r\n                gridColumnsInUserStore: function () {\r\n                    return $scope.gridColumnsInUserStore;\r\n                },\r\n                gridColumnDomainKey: function(){\r\n                    return \"eventCaptureGridColumns\";\r\n                },\r\n                gridColumnKey: function(){\r\n                    return $scope.selectedProgram.id;\r\n                }\r\n            }\r\n        });\r\n\r\n        modalInstance.result.then(function (gridColumns) {            \r\n            $scope.eventGridColumns = gridColumns;\r\n            var newCols = ($filter('filter')($scope.eventGridColumns, {group: 'DYNAMIC', show: true})).length;\r\n            if( newCols > oldCols ){\r\n                $scope.loadEvents();\r\n            }            \r\n        });\r\n    };\r\n    \r\n    $scope.filterEvents = function(gridColumn, applyFilter){\r\n        $scope.filterParam = '';\r\n        \r\n        angular.forEach($scope.eventGridColumns, function(col){            \r\n            if( gridColumn ){\r\n                if( col.id === gridColumn.id ){\r\n                    col.showFilter = !col.showFilter;\r\n                }\r\n                else{\r\n                    col.showFilter = false;\r\n                }\r\n            }            \r\n            \r\n            if( applyFilter && $scope.filterText[col.id] ){\r\n                if( col.group === \"STATIC\" ){\r\n                    switch ( col.id ){\r\n                        case \"eventDate\":\r\n                            if( $scope.filterText[col.id].start || $scope.filterText[col.id].end ){                            \r\n                                if( $scope.filterText[col.id].start ){\r\n                                    $scope.filterParam += '&startDate=' + $scope.filterText[col.id].start;\r\n                                }                    \r\n                                if( $scope.filterText[col.id].end ){\r\n                                    $scope.filterParam += '&endDate=' + $scope.filterText[col.id].end;\r\n                                }\r\n                            }\r\n                            break;\r\n                        case \"lastUpdated\":\r\n                            if( $scope.filterText[col.id].start || $scope.filterText[col.id].end ){                            \r\n                                if( $scope.filterText[col.id].start ){\r\n                                    $scope.filterParam += '&lastUpdatedStartDate=' + $scope.filterText[col.id].start;\r\n                                }                    \r\n                                if( $scope.filterText[col.id].end ){\r\n                                    $scope.filterParam += '&lastUpdatedEndDate=' + $scope.filterText[col.id].end;\r\n                                }\r\n                            }\r\n                            break;\r\n                        case \"status\":\r\n                            $scope.filterParam += '&status=' + $scope.filterText[col.id];\r\n                            break;\r\n                    }                \r\n                }\r\n                else{                    \r\n                    if( $scope.prStDes[col.id] && \r\n                            $scope.prStDes[col.id].dataElement && \r\n                            $scope.prStDes[col.id].dataElement.optionSetValue ){\r\n                        \r\n                        if( $scope.filterText[col.id].length > 0  ){\r\n                            var filters = $scope.filterText[col.id].map(function(filt) {return filt.code;});\r\n                            if( filters.length > 0 ){\r\n                                $scope.filterParam += '&filter=' + col.id + ':IN:' + filters.join(';');\r\n                            }\r\n                        }\r\n                    }\r\n                    else{\r\n                        if( col.filterWithRange ){\r\n                            if($scope.filterText[col.id].start && $scope.filterText[col.id].start !== \"\" || $scope.filterText[col.id].end && $scope.filterText[col.id].end !== \"\"){\r\n                                $scope.filterParam += '&filter=' + col.id;\r\n                                if( $scope.filterText[col.id].start ){\r\n                                    $scope.filterParam += ':GT:' + $scope.filterText[col.id].start;\r\n                                }                    \r\n                                if( $scope.filterText[col.id].end ){\r\n                                    $scope.filterParam += ':LT:' + $scope.filterText[col.id].end;\r\n                                }\r\n                            }\r\n                        }\r\n                        else{                            \r\n                            $scope.filterParam += '&filter=' + col.id + ':like:' + $scope.filterText[col.id];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n                \r\n        if( applyFilter ){\r\n            $scope.loadEvents();\r\n        }       \r\n    };\r\n    \r\n    $scope.removeStartFilterText = function(gridColumnId){\r\n        $scope.filterText[gridColumnId].start = undefined;\r\n    };\r\n    \r\n    $scope.removeEndFilterText = function(gridColumnId){\r\n        $scope.filterText[gridColumnId].end = undefined;\r\n    };\r\n    \r\n    $scope.resetFilter = function(){        \r\n        $scope.filterText = angular.copy($scope.emptyFilterText);\r\n        $scope.filterEvents(null, true);\r\n    };\r\n    \r\n    $scope.cancel = function(){\r\n\r\n        resetUrl();        \r\n        if($scope.formIsChanged()){\r\n            var modalOptions = {\r\n                closeButtonText: 'no',\r\n                actionButtonText: 'yes',\r\n                headerText: 'warning',\r\n                bodyText: 'unsaved_data_exists_proceed'\r\n            };\r\n\r\n            ModalService.showModal({}, modalOptions).then(function(result){\r\n                for(var i=0; i<$scope.dhis2Events.length; i++){\r\n                    if($scope.dhis2Events[i].event === $scope.currentEvent.event){\r\n                        $scope.dhis2Events[i] = $scope.currentEventOriginialValue;                        \r\n                        break;\r\n                    }\r\n                }\r\n                \r\n                resetView();\r\n                $scope.currentEvent = {};\r\n                if( !angular.equals($scope.selectedOptionsOriginal, $scope.selectedOptions) ) {\r\n                    \r\n                    $scope.loadEvents();\r\n                }\r\n                else{\r\n                    $scope.showEventList();\r\n                }                \r\n            });\r\n        }\r\n        else{\r\n            resetView();\r\n            $scope.currentEvent = {};\r\n            if( !angular.equals($scope.selectedOptionsOriginal, $scope.selectedOptions) ) {\r\n                $scope.loadEvents();\r\n            }\r\n            else{\r\n                $scope.showEventList();\r\n            }\r\n        }\r\n    };\r\n    \r\n    $scope.showEventList = function(dhis2Event){\r\n        \r\n        ContextMenuSelectedItem.setSelectedItem(dhis2Event);\r\n        resetView();\r\n        $scope.currentElement.updated = false;\r\n        $scope.currentEvent = {};\r\n        $scope.fileNames['SINGLE_EVENT'] = {};\r\n        $scope.currentElement = {};\r\n        $scope.currentEventOriginialValue = angular.copy($scope.currentEvent);        \r\n    };\r\n    \r\n    $scope.showEventRegistration = function(){        \r\n        $scope.displayCustomForm = $scope.customDataEntryForm ? true : false;\r\n        $scope.currentEvent = {};\r\n        $scope.fileNames['SINGLE_EVENT'] = {};\r\n        $scope.currentFileNames = {};\r\n        $scope.eventRegistration = !$scope.eventRegistration;          \r\n        $scope.currentEvent = angular.copy($scope.newDhis2Event);        \r\n        $scope.outerForm.submitted = false;\r\n        $scope.note = {};\r\n        $scope.displayTextEffects = [];\r\n        \r\n        if($scope.selectedProgramStage.preGenerateUID){\r\n            $scope.eventUID = dhis2.util.uid();\r\n            $scope.currentEvent['uid'] = $scope.eventUID;\r\n        }        \r\n        $scope.currentEventOriginialValue = angular.copy($scope.currentEvent); \r\n        \r\n        if($scope.eventRegistration){\r\n            $scope.executeRules();\r\n        }\r\n    };\r\n\r\n    $scope.showEditEventInGrid = function(){\r\n        $scope.currentEvent = ContextMenuSelectedItem.getSelectedItem();\r\n        $scope.currentEventOriginialValue = angular.copy($scope.currentEvent);\r\n        $scope.editingEventInGrid = !$scope.editingEventInGrid;\r\n        $scope.outerForm.$valid = true;\r\n        checkEventEditingStatus();\r\n    };\r\n\r\n    var lastRoute = $route.current;\r\n    $scope.$on('$locationChangeSuccess', function(event) {\r\n        /* prevents rerouting when eventId, orgunit and category options\r\n         * are added to the url.*/\r\n        if ($route && $route.current && $route.current.params) {\r\n            var newRouteParams = $route.current.params;\r\n            if (newRouteParams.event || newRouteParams.ou || newRouteParams.options) {\r\n                $route.current = lastRoute;\r\n            }\r\n        }\r\n    });\r\n\r\n    $scope.showEditEventInFull = function(){\r\n        $scope.note = {};\r\n        $scope.displayTextEffects = [];\r\n        $scope.displayCustomForm = $scope.customDataEntryForm ? true:false;\r\n        $scope.selectedOptionsOriginal = angular.copy($scope.selectedOptions);\r\n\r\n        //$scope.currentEvent = ContextMenuSelectedItem.getSelectedItem();\r\n        \r\n        var event = ContextMenuSelectedItem.getSelectedItem();\r\n        \r\n        DHIS2EventFactory.get(event.event, event).then(function( event ){            \r\n            $scope.formatEvent( event );\r\n            $scope.currentEvent = event;\r\n            loadOptions();\r\n            /*\r\n              When the user goes directly to the event edit page for an event with category options,\r\n              the $scope.dhis2Events will not be initialised since the selected category option for the event\r\n              was not available. So we initialize it here so that the event list is visibile when the user\r\n              clicks 'Cancel'/'Update button.\r\n            */\r\n            if($scope.dhis2Events || ($scope.dhis2Events.length && $scope.dhis2Events.length===0)) {\r\n                $scope.loadEvents();\r\n            }\r\n            $scope.dhis2Events = DHIS2EventService.refreshList($scope.dhis2Events, $scope.currentEvent);\r\n            $scope.editingEventInFull = !$scope.editingEventInFull;\r\n            $scope.eventRegistration = false;\r\n\r\n            angular.forEach($scope.selectedProgramStage.programStageDataElements, function(prStDe){\r\n                if(!$scope.currentEvent.hasOwnProperty(prStDe.dataElement.id)){\r\n                    $scope.currentEvent[prStDe.dataElement.id] = '';\r\n                }\r\n            }); \r\n            $scope.currentEventOriginialValue = angular.copy($scope.currentEvent);\r\n\r\n            if($scope.editingEventInFull){\r\n                //Blank out rule effects, as there is no rules in effect before the first\r\n                //time the rules is run on a new page.\r\n                $rootScope.ruleeffects[$scope.currentEvent.event] = {};        \r\n                $scope.executeRules();\r\n            }\r\n\r\n            if(!$location.search().ou){\r\n                $location.search(\"ou\",$scope.selectedOrgUnit.id);\r\n            }\r\n            if(!$location.search().event){\r\n                $location.search(\"event\",$scope.currentEvent.event);\r\n            }\r\n            checkEventEditingStatus();\r\n        });\r\n        \r\n    };\r\n\r\n    function checkEventEditingStatus() {\r\n        if (!$scope.model.editingDisabled) {\r\n            $scope.model.editingDisabled = DHIS2EventService.getEventExpiryStatus($scope.currentEvent,\r\n                $scope.selectedProgram, $scope.selectedOrgUnit.id);\r\n\r\n            if ($scope.model.editingDisabled) {\r\n                var dialogOptions = {\r\n                    headerText: $translate.instant('event_expired'),\r\n                    bodyText: $translate.instant('editing_disabled')\r\n                };\r\n                DialogService.showDialog({}, dialogOptions).then(function (response) {\r\n                });\r\n            }\r\n        }\r\n    }\r\n    \r\n    $scope.switchDataEntryForm = function(){\r\n        $scope.displayCustomForm = !$scope.displayCustomForm;\r\n    };    \r\n    \r\n    $scope.checkAndShowProgramRuleFeedback = function() {\r\n        //preparing a warnings section in case it is needed by one of the other dialogs.\r\n        var warningSection = false;\r\n        if($scope.warningMessagesOnComplete && $scope.warningMessagesOnComplete.length > 0) {\r\n            warningSection = {\r\n                bodyText:'be_aware_of_validation_warnings',\r\n                bodyList:$scope.warningMessagesOnComplete,\r\n                itemType:'warning'\r\n            };\r\n        }\r\n        \r\n        //Prepare an error section if any errors exist:\r\n        var errorSection = false;\r\n        if($scope.errorMessagesOnComplete && $scope.errorMessagesOnComplete.length > 0) {\r\n            errorSection = {\r\n                bodyList:$scope.errorMessagesOnComplete,\r\n                itemType:'danger'\r\n            };\r\n        }\r\n        \r\n        var def = $q.defer();\r\n            \r\n        if(errorSection) {\r\n            var sections = [errorSection];\r\n            if(warningSection) {\r\n                sections.push(warningSection);\r\n            }\r\n                \r\n            var dialogOptions = {\r\n                headerText: 'validation_error',\r\n                bodyText: 'please_fix_errors_before_saving',\r\n                sections: sections\r\n            };   \r\n            \r\n            DialogService.showDialog({}, dialogOptions).then(function(response) {\r\n                def.reject(response);\r\n            });\r\n        } else if(warningSection) {\r\n            var modalOptions = warningSection;\r\n            modalOptions.bodyText = 'save_despite_warnings';\r\n            modalOptions.headerText = 'validation_warnings';\r\n            \r\n            ModalService.showModal({}, modalOptions).then(function() {\r\n                def.resolve(true);\r\n            },\r\n            function() {\r\n                def.reject(false);\r\n            });\r\n        } else {\r\n            def.resolve(true);\r\n        }\r\n        \r\n        return def.promise;\r\n    };\r\n    \r\n    $scope.addEvent = function(addingAnotherEvent){\r\n        \r\n        //check for form validity\r\n        $scope.outerForm.submitted = true;        \r\n        if( $scope.outerForm.$invalid ){\r\n            $scope.selectedSection.id = 'ALL';\r\n            angular.forEach($scope.selectedProgramStage.programStageSections, function(section){\r\n                section.open = true;\r\n            });\r\n            return false;\r\n        }\r\n        \r\n        $scope.checkAndShowProgramRuleFeedback().then(function() {\r\n            //the form is valid, get the values\r\n            //but there could be a case where all dataelements are non-mandatory and\r\n            //the event form comes empty, in this case enforce at least one value\r\n            var dataValues = [];        \r\n            for(var dataElement in $scope.prStDes){            \r\n                var val = $scope.currentEvent[dataElement];\r\n                val = CommonUtils.formatDataValue(null, val, $scope.prStDes[dataElement].dataElement, $scope.optionSets, 'API');\r\n                dataValues.push({dataElement: dataElement, value: val});\r\n            }\r\n\r\n            if(!dataValues.length || dataValues.length === 0){\r\n                var dialogOptions = {\r\n                    headerText: 'empty_form',\r\n                    bodyText: 'please_fill_at_least_one_dataelement'\r\n                };\r\n\r\n                DialogService.showDialog({}, dialogOptions);\r\n                return;\r\n            }        \r\n\r\n            $scope.model.savingRegistration = true;\r\n\r\n            var newEvent = angular.copy($scope.currentEvent);        \r\n\r\n            //prepare the event to be created\r\n            var dhis2Event = {\r\n                    program: $scope.selectedProgram.id,\r\n                    programStage: $scope.selectedProgramStage.id,\r\n                    orgUnit: $scope.selectedOrgUnit.id,\r\n                    status: $scope.currentEvent.status ? 'COMPLETED' : 'ACTIVE',\r\n                    eventDate: DateUtils.formatFromUserToApi(newEvent.eventDate),\r\n                    dataValues: dataValues\r\n            }; \r\n            \r\n            if( dhis2Event.status === 'COMPLETED' ){\r\n                dhis2Event.completedDate = DateUtils.formatFromUserToApi($scope.today);\r\n            }\r\n\r\n            if($scope.selectedProgramStage.preGenerateUID && !angular.isUndefined(newEvent['uid'])){\r\n                dhis2Event.event = newEvent['uid'];\r\n            }\r\n\r\n            if(!angular.isUndefined($scope.note.value) && $scope.note.value !== ''){\r\n                dhis2Event.notes = [{value: $scope.note.value}];\r\n\r\n                newEvent.notes = [{value: $scope.note.value, storedDate: $scope.today, storedBy: storedBy}];\r\n\r\n                $scope.noteExists = true;\r\n            }\r\n\r\n            if($scope.selectedProgramStage.captureCoordinates){\r\n                dhis2Event.coordinate = {latitude: $scope.currentEvent.coordinate.latitude ? $scope.currentEvent.coordinate.latitude : '',\r\n                                         longitude: $scope.currentEvent.coordinate.longitude ? $scope.currentEvent.coordinate.longitude : ''};             \r\n            }\r\n\r\n            if(!$scope.selectedProgram.categoryCombo.isDefault){            \r\n                if($scope.selectedOptions.length !== $scope.selectedCategories.length){\r\n                    var dialogOptions = {\r\n                        headerText: 'error',\r\n                        bodyText: 'fill_all_category_options'\r\n                    };\r\n\r\n                    DialogService.showDialog({}, dialogOptions);\r\n                    return;\r\n                }\r\n\r\n                //dhis2Event.attributeCc = $scope.selectedProgram.categoryCombo.id;\r\n                dhis2Event.attributeCategoryOptions = $scope.selectedOptions.join(';');\r\n            }\r\n\r\n            //send the new event to server        \r\n            DHIS2EventFactory.create(dhis2Event).then(function(data) {\r\n                if (data.response.importSummaries[0].status === 'ERROR') {\r\n                    var dialogOptions = {\r\n                        headerText: 'event_registration_error',\r\n                        bodyText: data.message\r\n                    };\r\n\r\n                    DialogService.showDialog({}, dialogOptions);\r\n                }\r\n                else {\r\n\r\n                    //add the new event to the grid                \r\n                    newEvent.event = data.response.importSummaries[0].reference; \r\n                    $scope.currentEvent.event = newEvent.event;\r\n\r\n                    $scope.updateFileNames();\r\n\r\n                    if( !$scope.dhis2Events ){\r\n                        $scope.dhis2Events = [];                   \r\n                    }\r\n                    newEvent['uid'] = newEvent.event;\r\n                    newEvent['eventDate'] = newEvent.eventDate; \r\n                    $scope.dhis2Events.splice(0,0,newEvent);\r\n\r\n                    $scope.eventLength++;\r\n\r\n                    resetView(); \r\n\r\n                    //reset form              \r\n                    $scope.currentEvent = {};\r\n                    $scope.currentEvent = angular.copy($scope.newDhis2Event); \r\n                    $scope.currentEventOriginialValue = angular.copy($scope.currentEvent);\r\n                    $scope.fileNames['SINGLE_EVENT'] = {};\r\n\r\n                    $scope.note = {};\r\n                    $scope.displayTextEffects = [];\r\n                    $scope.outerForm.submitted = false;\r\n                    $scope.outerForm.$setPristine();\r\n                    \r\n                    //decide whether to stay in the current screen or not.\r\n                    if(addingAnotherEvent){\r\n                        $scope.showEventRegistration();\r\n                        $anchorScroll();\r\n                    }\r\n                }\r\n                $scope.model.savingRegistration = false;\r\n            });\r\n        });\r\n    };\r\n\r\n    function resetUrl(){\r\n        if ($location.search().ou) {\r\n            orgUnitFromUrl = null;\r\n            eventIdFromUrl = null;\r\n            //selectedOptionsFromUrl = null;\r\n            $location.search(\"event\",null);\r\n            $location.search(\"ou\", null);\r\n        }\r\n    }\r\n\r\n    $scope.updateEvent = function(){\r\n        resetUrl();\r\n        //check for form validity\r\n        $scope.outerForm.submitted = true;\r\n        if( $scope.outerForm.$invalid ){\r\n            $scope.selectedSection.id = 'ALL';\r\n            angular.forEach($scope.selectedProgramStage.programStageSections, function(section){\r\n                section.open = true;\r\n            });\r\n            return false;\r\n        }\r\n        \r\n        $scope.checkAndShowProgramRuleFeedback().then(function() {\r\n            //the form is valid, get the values\r\n            var dataValues = [];        \r\n            for(var dataElement in $scope.prStDes){\r\n                var val = $scope.currentEvent[dataElement];            \r\n                val = CommonUtils.formatDataValue(null, val, $scope.prStDes[dataElement].dataElement, $scope.optionSets, 'API');            \r\n                dataValues.push({dataElement: dataElement, value: val});\r\n            }\r\n\r\n            var updatedEvent = {\r\n                                program: $scope.currentEvent.program,\r\n                                programStage: $scope.currentEvent.programStage,\r\n                                orgUnit: $scope.currentEvent.orgUnit,\r\n                                status: $scope.currentEvent.status ? 'COMPLETED' : 'ACTIVE',\r\n                                eventDate: DateUtils.formatFromUserToApi($scope.currentEvent.eventDate),\r\n                                event: $scope.currentEvent.event, \r\n                                dataValues: dataValues\r\n                            };\r\n\r\n            if($scope.selectedProgramStage.captureCoordinates){\r\n                updatedEvent.coordinate = {latitude: $scope.currentEvent.coordinate.latitude ? $scope.currentEvent.coordinate.latitude : '',\r\n                                         longitude: $scope.currentEvent.coordinate.longitude ? $scope.currentEvent.coordinate.longitude : ''};             \r\n            }\r\n\r\n            if(!angular.isUndefined($scope.note.value) && $scope.note.value !== ''){\r\n\r\n                updatedEvent.notes = [{value: $scope.note.value}];\r\n\r\n                if($scope.currentEvent.notes){\r\n                    $scope.currentEvent.notes.splice(0,0,{value: $scope.note.value, storedDate: $scope.today, storedBy: storedBy});\r\n                }\r\n                else{\r\n                    $scope.currentEvent.notes = [{value: $scope.note.value, storedDate: $scope.today, storedBy: storedBy}];\r\n                }   \r\n\r\n                $scope.noteExists = true;\r\n            }\r\n            \r\n            if( updatedEvent.status === 'COMPLETED' && $scope.currentEventOriginialValue.status !== 'COMPLETED' ){\r\n                updatedEvent.completedDate = DateUtils.formatFromUserToApi($scope.today);\r\n            }\r\n            \r\n            if( !angular.equals($scope.selectedOptionsOriginal, $scope.selectedOptions) ){\r\n                updatedEvent.attributeCategoryOptions = $scope.selectedOptions.join(';');                        \r\n            }\r\n\r\n            DHIS2EventFactory.update(updatedEvent).then(function(data){            \r\n                //reflect the change in the gird\r\n                $scope.outerForm.submitted = false;            \r\n                $scope.editingEventInFull = false;\r\n                $scope.currentEvent = {};\r\n                $scope.currentEventOriginialValue = angular.copy($scope.currentEvent);                \r\n                if( !angular.equals($scope.selectedOptionsOriginal, $scope.selectedOptions) ){\r\n                    $scope.loadEvents();\r\n                }\r\n                else{\r\n                    $scope.dhis2Events = DHIS2EventService.refreshList($scope.dhis2Events, $scope.currentEvent);    \r\n                    $scope.updateFileNames();\r\n                }                \r\n            });\r\n        });\r\n    };\r\n    \r\n    $scope.updateEventDate = function () {\r\n        \r\n        $scope.updateSuccess = false;\r\n        \r\n        $scope.currentElement = {id: 'eventDate'};\r\n        \r\n        var rawDate = angular.copy($scope.currentEvent.eventDate);\r\n        var convertedDate = DateUtils.format($scope.currentEvent.eventDate);\r\n\r\n        if (!rawDate || !convertedDate || rawDate !== convertedDate) {\r\n            $scope.invalidDate = true;\r\n            $scope.currentEvent.eventDate = $scope.currentEventOriginialValue.eventDate;            \r\n            $scope.dhis2Events = DHIS2EventService.refreshList($scope.dhis2Events, $scope.currentEvent);\r\n            $scope.currentElement.updated = false;\r\n            return;\r\n        }\r\n\r\n        //get new and old values\r\n        var newValue = $scope.currentEvent.eventDate;   \r\n        var oldValue = $scope.currentEventOriginialValue.eventDate;\r\n        \r\n        if ($scope.currentEvent.eventDate === '') {\r\n            $scope.currentEvent.eventDate = oldValue;            \r\n            $scope.dhis2Events = DHIS2EventService.refreshList($scope.dhis2Events, $scope.currentEvent);\r\n            $scope.currentElement.updated = false;\r\n            return;\r\n        }\r\n        \r\n        if(newValue !== oldValue){\r\n            var e = {event: $scope.currentEvent.event,\r\n                        orgUnit: $scope.currentEvent.orgUnit,     \r\n                        eventDate: DateUtils.formatFromUserToApi($scope.currentEvent.eventDate)\r\n                    };\r\n            \r\n            var updatedFullValueEvent = DHIS2EventService.reconstructEvent($scope.currentEvent, $scope.selectedProgramStage.programStageDataElements);\r\n\r\n            DHIS2EventFactory.updateForEventDate(e, updatedFullValueEvent).then(function () {\r\n                //reflect the new value in the grid\r\n                $scope.dhis2Events = DHIS2EventService.refreshList($scope.dhis2Events, $scope.currentEvent);\r\n                \r\n                //update original value\r\n                $scope.currentEventOriginialValue = angular.copy($scope.currentEvent);      \r\n                \r\n                $scope.currentElement.updated = true;\r\n                $scope.updateSuccess = true;\r\n            });\r\n        }        \r\n    };\r\n\r\n    $scope.updateEventDataValue = function(dataElement){\r\n\r\n        $scope.updateSuccess = false;\r\n        \r\n        //get current element\r\n        $scope.currentElement = {id: dataElement, pending: true, updated: false, failed: false};\r\n        \r\n        //get new and old values\r\n        var newValue = $scope.currentEvent[dataElement];        \r\n        var oldValue = $scope.currentEventOriginialValue[dataElement];\r\n        \r\n        //check for form validity\r\n        if( $scope.isFormInvalid() ){\r\n            $scope.currentElement.updated = false;\r\n            \r\n            //reset value back to original\r\n            $scope.currentEvent[dataElement] = oldValue;            \r\n            $scope.dhis2Events = DHIS2EventService.refreshList($scope.dhis2Events, $scope.currentEvent);\r\n            return;            \r\n        }        \r\n        \r\n        if( $scope.prStDes[dataElement].compulsory && !newValue ) {\r\n            $scope.currentElement.updated = false;                        \r\n            \r\n            //reset value back to original\r\n            $scope.currentEvent[dataElement] = oldValue;            \r\n            $scope.dhis2Events = DHIS2EventService.refreshList($scope.dhis2Events, $scope.currentEvent);\r\n            return;\r\n        }        \r\n\r\n        if( newValue !== oldValue ){            \r\n            newValue = CommonUtils.formatDataValue(null, newValue, $scope.prStDes[dataElement].dataElement, $scope.optionSets, 'API');            \r\n            var updatedSingleValueEvent = {event: $scope.currentEvent.event, dataValues: [{value: newValue, dataElement: dataElement}]};\r\n            var updatedFullValueEvent = DHIS2EventService.reconstructEvent($scope.currentEvent, $scope.selectedProgramStage.programStageDataElements);\r\n\r\n            DHIS2EventFactory.updateForSingleValue(updatedSingleValueEvent, updatedFullValueEvent).then(function(data){\r\n                \r\n                //reflect the new value in the grid\r\n                $scope.dhis2Events = DHIS2EventService.refreshList($scope.dhis2Events, $scope.currentEvent);\r\n                \r\n                //update original value\r\n                $scope.currentEventOriginialValue = angular.copy($scope.currentEvent);      \r\n                \r\n                $scope.currentElement.pending = false;\r\n                $scope.currentElement.updated = true;\r\n                $scope.updateSuccess = true;\r\n            }, function(){\r\n                $scope.currentElement.pending = false;\r\n                $scope.currentElement.updated = false;\r\n                $scope.currentElement.failed = true;\r\n            });\r\n        }\r\n    };\r\n    \r\n    $scope.removeEvent = function(){\r\n        \r\n        var dhis2Event = ContextMenuSelectedItem.getSelectedItem();\r\n        \r\n        var modalOptions = {\r\n            closeButtonText: 'cancel',\r\n            actionButtonText: 'remove',\r\n            headerText: 'remove',\r\n            bodyText: 'are_you_sure_to_remove_with_audit'\r\n        };\r\n\r\n        ModalService.showModal({}, modalOptions).then(function(result){\r\n            \r\n            DHIS2EventFactory.delete(dhis2Event).then(function(data){\r\n\r\n                $scope.currentFileNames = {};\r\n                delete $scope.fileNames[$scope.currentEvent.event];\r\n                var continueLoop = true, index = -1;\r\n                for(var i=0; i< $scope.dhis2Events.length && continueLoop; i++){\r\n                    if($scope.dhis2Events[i].event === dhis2Event.event ){\r\n                        $scope.dhis2Events[i] = dhis2Event;\r\n                        continueLoop = false;\r\n                        index = i;\r\n                    }\r\n                }\r\n                $scope.dhis2Events.splice(index,1);                \r\n                $scope.currentEvent = {}; \r\n                $scope.fileNames['SINGLE_EVENT'] = {};\r\n            }, function(error){\r\n\r\n                //temporarily error message because of new audit functionality\r\n                var dialogOptions = {\r\n                    headerText: 'error',\r\n                    bodyText: 'delete_error_audit'\r\n                };\r\n                DialogService.showDialog({}, dialogOptions);\r\n            });\r\n        });        \r\n    };\r\n\r\n    $scope.getCSVExportList = function () {\r\n        var csvFields = [\"event\", \"program\", \"programStage\", \"orgUnitName\", \"eventDate\", \"created\", \"status\"];\r\n        var selectedDataElements;\r\n        var deferred = $q.defer();\r\n\r\n\r\n        var dataElementUrl = $filter('filter')($scope.eventGridColumns, {group: 'DYNAMIC', show: true}).map(function(c){return c.id;});\r\n\r\n        if( dataElementUrl && dataElementUrl.length > 0 ){\r\n            dataElementUrl = '&dataElement=' + dataElementUrl.join(',');\r\n        }\r\n        else{\r\n            dataElementUrl = '';\r\n        }\r\n        selectedDataElements = dataElementUrl.substr(\"&dataElement=\".length).split(\",\");\r\n        csvFields = csvFields.concat(selectedDataElements);\r\n\r\n        DHIS2EventFactory.getByStage($scope.selectedOrgUnit.id, $scope.selectedProgramStage.id, $scope.attributeCategoryUrl,\r\n            null, false, null, $scope.filterParam + dataElementUrl).then(function(data){\r\n            var headerArray, headerFieldNames, headerFieldIds, eventsCSV=[], field, index, csvFieldsIndices=[], csvRow, processedData;\r\n            if (angular.isObject(data)) {\r\n                if (angular.isObject(data.headers)) {\r\n                    headerArray = data.headers;\r\n                    headerFieldIds = data.headers.map(function (object) {\r\n                        return object.name;\r\n                    });\r\n                    headerFieldNames = data.headers.map(function (object) {\r\n                        return object.column;\r\n                    });\r\n                    eventsCSV[0]=[];\r\n                    for (var i = 0; i < csvFields.length; i++) {\r\n                        field = csvFields[i];\r\n                        index = headerFieldIds.indexOf(field);\r\n                        if (index > -1) {\r\n                            csvFieldsIndices.push(index);\r\n                            eventsCSV[0].push(headerFieldNames[index]);\r\n                        }\r\n                    }\r\n                }\r\n                if (angular.isObject(data.rows)) {\r\n                    angular.forEach(data.rows, function (rowArray) {\r\n                        /* rowArray has one row of values for the event fields */\r\n                        if (angular.isObject(rowArray)) {\r\n                            csvRow = [];\r\n                            csvFieldsIndices.forEach((idx) => {\r\n                                processedData = getProcessedValue(headerArray[idx].name, rowArray[idx]);\r\n                                csvRow.push(processedData.value);\r\n                            });\r\n                            eventsCSV.push(csvRow);\r\n                        }\r\n                    });\r\n                }\r\n                deferred.resolve(eventsCSV);\r\n            }\r\n\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    $scope.getExportList = function (format) {\r\n        var eventsJSON = [];\r\n\r\n        DHIS2EventFactory.getByStage($scope.selectedOrgUnit.id, $scope.selectedProgramStage.id,\r\n            $scope.attributeCategoryUrl, true).then(function (data) {\r\n            var headerArray;\r\n            var eventsXML = '<eventList>';\r\n            var processedData;\r\n            var dataValues;\r\n            var eventJSON;\r\n            if (angular.isObject(data)) {\r\n                if (angular.isObject(data.headers)) {\r\n                    headerArray = data.headers;\r\n                }\r\n                if (angular.isObject(data.rows)) {\r\n                    angular.forEach(data.rows, function (rowArray) {\r\n                        /* rowArray has one row of values for the event fields */\r\n                        if (angular.isObject(rowArray)) {\r\n                            if (format === \"JSON\") {\r\n                                eventJSON = {};\r\n                                dataValues = [];\r\n                                headerArray.forEach((key, idx) => {\r\n                                    if (rowArray[idx]) {\r\n                                        processedData =   getProcessedValue(headerArray[idx].name, rowArray[idx]);\r\n                                        if (processedData.isDataValue) {\r\n                                            dataValues.push({name:processedData.name, id:processedData.id, value:processedData.value})\r\n                                        } else {\r\n                                            eventJSON[processedData.name] = processedData.value;\r\n                                        }\r\n                                    }\r\n                                });\r\n                                if (dataValues.length > 0) {\r\n                                    eventJSON[\"dataValues\"] = dataValues;\r\n                                }\r\n                                eventsJSON.push(eventJSON);\r\n                            } else if (format === \"XML\") {\r\n                                eventsXML += \"<event>\";\r\n                                dataValues = [];\r\n                                headerArray.forEach((key, idx) => {\r\n                                    if (rowArray[idx]) {\r\n                                        processedData = getProcessedValue(headerArray[idx].name, rowArray[idx]);\r\n                                        if(processedData.isDataValue) {\r\n                                            dataValues.push(processedData)\r\n                                        } else {\r\n                                            eventsXML += \"<\"+processedData.name+\">\"+processedData.value+\"</\"+processedData.name+\">\";\r\n                                        }\r\n                                    }\r\n                                });\r\n                                if(dataValues.length > 0) {\r\n                                    eventsXML += \"<dataValues>\";\r\n                                    for (var index = 0; index < dataValues.length; index++) {\r\n                                        eventsXML += '<dataValue dataElementId=\"' + dataValues[index].id + '\" ' +\r\n                                            'dataElementName=\"' + dataValues[index].name + '\" ' +\r\n                                            'value=\"' + dataValues[index].value + '\"/>';\r\n                                    }\r\n                                    eventsXML += \"</dataValues>\";\r\n                                }\r\n                                eventsXML += \"</event>\";\r\n                            }\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n\r\n            if(format === \"JSON\") {\r\n                saveFile(JSON.stringify({\"events\": eventsJSON}));\r\n            } else if (format === \"XML\") {\r\n                eventsXML += '</eventList>';\r\n                saveFile(eventsXML);\r\n            }\r\n        });\r\n\r\n        function saveFile(data) {\r\n            var fileName = \"eventList.\" + format.toLowerCase();// any file name with any extension\r\n            var a = document.createElement('a');\r\n            var blob, url;\r\n\r\n            a.style = \"display: none\";\r\n            blob = new Blob(['' + data], {type: \"octet/stream\", endings: 'native'});\r\n            url = window.URL.createObjectURL(blob);\r\n            a.href = url;\r\n            a.download = fileName;\r\n            document.body.appendChild(a);\r\n            a.click();\r\n            setTimeout(function () {\r\n                document.body.removeChild(a);\r\n                window.URL.revokeObjectURL(url);\r\n            }, 300);\r\n        }\r\n    };\r\n\r\n    function getProcessedValue(fieldName, fieldValue) {\r\n        var processedData = {name: fieldName, value: fieldValue};\r\n        switch (fieldName) {\r\n            case 'program':\r\n                processedData.value = $scope.selectedProgram && $scope.selectedProgram.name ? $scope.selectedProgram.name : fieldValue;\r\n                break;\r\n            case 'programStage':\r\n                processedData.value = $scope.currentStage && $scope.currentStage.name ? $scope.currentStage.name : fieldValue;\r\n                //alert(fieldValue);\r\n                break;\r\n            case 'created':\r\n            case 'completedDate':\r\n            case 'eventDate':\r\n            case 'dueDate':\r\n                processedData.value = DateUtils.formatFromApiToUser(fieldValue);\r\n            default:\r\n                if ($scope.prStDes[fieldName] && $scope.prStDes[fieldName].dataElement) {\r\n                    processedData.name = $scope.prStDes[fieldName].dataElement.name;\r\n                    processedData.value = CommonUtils.formatDataValue(null, processedData.value, $scope.prStDes[fieldName].dataElement, $scope.optionSets, 'USER');\r\n                    processedData.value = processedData.value.toString();\r\n                    processedData.isDataValue = true;\r\n                    processedData.id = $scope.prStDes[fieldName].dataElement.id;\r\n                }\r\n        }\r\n        return processedData;\r\n    }\r\n\r\n\r\n\r\n\r\n    $scope.showNotes = function(dhis2Event){\r\n        \r\n        var modalInstance = $modal.open({\r\n            templateUrl: 'views/notes.html',\r\n            controller: 'NotesController',\r\n            resolve: {\r\n                dhis2Event: function () {\r\n                    return dhis2Event;\r\n                }\r\n            }\r\n        });\r\n\r\n        modalInstance.result.then(function (){\r\n        });\r\n    };\r\n    \r\n    $scope.getHelpContent = function(){\r\n    };\r\n    \r\n    $scope.showAuditHistory = function(){\r\n        \r\n        var dhis2Event = ContextMenuSelectedItem.getSelectedItem();\r\n        \r\n        var modalInstance = $modal.open({\r\n            templateUrl: './templates/audit-history.html',\r\n            controller: 'AuditHistoryController',\r\n            resolve: {\r\n                eventId: function () {\r\n                    return dhis2Event.event;\r\n                },\r\n                dataType: function () {\r\n                    return 'dataElement';\r\n                },\r\n                nameIdMap: function () {\r\n                    return $scope.prStDes;\r\n                },\r\n                optionSets: function(){\r\n                    return $scope.optionSets;\r\n                }\r\n            }\r\n        });\r\n\r\n        modalInstance.result.then(function () {            \r\n        },function(){\r\n        });\r\n        \r\n    };\r\n\r\n    $scope.formIsChanged = function(){        \r\n        var isChanged = false;\r\n        var emptyForm = $scope.formIsEmpty();\r\n        for(var i=0; i<$scope.selectedProgramStage.programStageDataElements.length && !isChanged; i++){\r\n            var deId = $scope.selectedProgramStage.programStageDataElements[i].dataElement.id;\r\n            if($scope.currentEventOriginialValue[deId] !== $scope.currentEvent[deId]){\r\n                if($scope.currentEvent[deId] || $scope.currentEventOriginialValue[deId] !== \"\" && !emptyForm){                    \r\n                    isChanged = true; \r\n                }                               \r\n            }\r\n        }        \r\n        if(!isChanged){\r\n            if(($scope.currentEvent.eventDate !== $scope.currentEventOriginialValue.eventDate) ||\r\n                $scope.currentEvent.status !== $scope.currentEventOriginialValue.status){\r\n                isChanged = true;\r\n            }\r\n        }\r\n        \r\n        return isChanged;\r\n    };\r\n    \r\n    $scope.isFormInvalid = function(){\r\n        \r\n        if($scope.outerForm.submitted){\r\n            return $scope.outerForm.$invalid;\r\n        }\r\n\r\n        if($scope.model.invalidDate) {\r\n            return true;\r\n        }\r\n        \r\n        if(!$scope.outerForm.$dirty){\r\n            return false;\r\n        }\r\n        \r\n        var formIsInvalid = false;\r\n        for(var k in $scope.outerForm.$error){            \r\n            if(angular.isObject($scope.outerForm.$error[k])){\r\n                \r\n                for(var i=0; i<$scope.outerForm.$error[k].length && !formIsInvalid; i++){\r\n                    if($scope.outerForm.$error[k][i].$dirty && $scope.outerForm.$error[k][i].$invalid){\r\n                        formIsInvalid = true;\r\n                    }\r\n                }\r\n            }\r\n            \r\n            if(formIsInvalid){\r\n                break;\r\n            }\r\n        }\r\n        \r\n        return formIsInvalid;\r\n    };\r\n    \r\n    $scope.formIsEmpty = function(){\r\n        for(var dataElement in $scope.prStDes){\r\n            if($scope.currentEvent[dataElement]){\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    \r\n    //watch for event editing\r\n    $scope.$watchCollection('[editingEventInFull, eventRegistration]', function() {        \r\n        if($scope.editingEventInFull || $scope.eventRegistration){\r\n            //Disable ou selection while in editing mode\r\n            $( \"#orgUnitTree\" ).addClass( \"disable-clicks\" );\r\n        }\r\n        else{\r\n            //enable ou selection if not in editing mode\r\n            $( \"#orgUnitTree\" ).removeClass( \"disable-clicks\" );\r\n        }\r\n    });\r\n    \r\n    $scope.interacted = function(field) {\r\n        var status = false;\r\n        if(field){            \r\n            status = $scope.outerForm.submitted || field.$dirty;\r\n        }\r\n        return status;\r\n    };\r\n\r\n    //listen for rule effect changes    \r\n    $scope.$on('ruleeffectsupdated', function(event, args) {\r\n        $scope.warningMessages = [];\r\n        $scope.warningMessagesOnComplete = [];\r\n        $scope.errorMessagesOnComplete = [];\r\n        $scope.hiddenSections = [];\r\n        $scope.hiddenFields = [];\r\n        $scope.assignedFields = [];\r\n        $scope.displayTextEffects = [];\r\n\r\n        if($rootScope.ruleeffects[args.event]) {\r\n            //Establish which event was affected:\r\n            var affectedEvent = $scope.currentEvent;\r\n            //In most cases the updated effects apply to the current event. In case the affected event is not the current event, fetch the correct event to affect:\r\n            if(args.event !== affectedEvent.event) {\r\n                angular.forEach($scope.currentStageEvents, function(searchedEvent) {\r\n                    if(searchedEvent.event === args.event) {\r\n                        affectedEvent = searchedEvent;\r\n                    }\r\n                });\r\n            }\r\n            angular.forEach($rootScope.ruleeffects[args.event], function(effect) {\r\n                \r\n                if(effect.ineffect) {\r\n                    //in the data entry controller we only care about the \"hidefield\" actions\r\n                    if(effect.action === \"HIDEFIELD\") {\r\n                        if(effect.dataElement) {\r\n                            if(affectedEvent[effect.dataElement.id]) {\r\n                                //If a field is going to be hidden, but contains a value, we need to take action;\r\n                                if(effect.content) {\r\n                                    //TODO: Alerts is going to be replaced with a proper display mecanism.\r\n                                    alert(effect.content);\r\n                                }\r\n                                else {\r\n                                    //TODO: Alerts is going to be replaced with a proper display mecanism.\r\n                                    alert($scope.prStDes[effect.dataElement.id].dataElement.displayFormName + \" was blanked out and hidden by your last action\");\r\n                                }\r\n\r\n                                //Blank out the value:\r\n                                affectedEvent[effect.dataElement.id] = \"\";\r\n                            }\r\n\r\n                            $scope.hiddenFields[effect.dataElement.id] = effect.ineffect;\r\n                        }\r\n                        else {\r\n                            $log.warn(\"ProgramRuleAction \" + effect.id + \" is of type HIDEFIELD, bot does not have a dataelement defined\");\r\n                        }\r\n                    }\r\n                    else if(effect.action === \"HIDESECTION\") {\r\n                        if(effect.programStageSection){\r\n                            $scope.hiddenSections[effect.programStageSection] = effect.programStageSection;\r\n                        }\r\n                    }\r\n                    else if(effect.action === \"SHOWERROR\" \r\n                            || effect.action === \"ERRORONCOMPLETE\" ){\r\n                        \r\n                        var message = effect.content + (effect.data ? effect.data : \"\");\r\n                        \r\n                        if(effect.dataElement && effect.dataElement.id && effect.action===\"SHOWERROR\") {\r\n                            message = $scope.prStDes[effect.dataElement.id].dataElement.displayFormName\r\n                            + \": \" + message;\r\n                            $scope.currentEvent[effect.dataElement.id] = $scope.currentEventOriginialValue[effect.dataElement.id];\r\n                            var dialogOptions = {\r\n                                headerText: 'validation_error',\r\n                                bodyText: message\r\n                            };\r\n                            DialogService.showDialog({}, dialogOptions);\r\n                        }\r\n                        \r\n                        $scope.errorMessagesOnComplete.push(message);\r\n                    }\r\n                    else if(effect.action === \"SHOWWARNING\" \r\n                            || effect.action === \"WARNINGONCOMPLETE\"){\r\n                        if(effect.action === \"SHOWWARNING\") {\r\n                            $scope.warningMessages.push(effect.content + (effect.data ? effect.data : \"\"));\r\n                        }\r\n                        $scope.warningMessagesOnComplete.push(effect.content + (effect.data ? effect.data : \"\"));\r\n                    }\r\n                    else if(effect.action === \"ASSIGN\") {\r\n                        var processedValue = effect.data;\r\n                        \r\n                        //For \"ASSIGN\" actions where we have a dataelement, we save the calculated value to the dataelement:\r\n                        if($scope.prStDes[effect.dataElement.id].dataElement.optionSet) {\r\n                            processedValue = OptionSetService.getName(\r\n                                $scope.optionSets[$scope.prStDes[effect.dataElement.id].dataElement.optionSet.id].options, processedValue);\r\n                        }  \r\n                        processedValue = processedValue === \"true\" ? true : processedValue;\r\n                        processedValue = processedValue === \"false\" ? false : processedValue;\r\n\r\n                        affectedEvent[effect.dataElement.id] = processedValue;\r\n                        $scope.assignedFields[effect.dataElement.id] = true;\r\n                    }\r\n                    else if(effect.action === \"DISPLAYKEYVALUEPAIR\") {\r\n                        $scope.displayTextEffects.push({name:effect.content,text:effect.data});\r\n                    }\r\n                    else if(effect.action === \"DISPLAYTEXT\") {\r\n                        $scope.displayTextEffects.push({text:effect.data + effect.content});\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    });\r\n    \r\n    $scope.executeRules = function() {\r\n        $scope.currentEvent.event = !$scope.currentEvent.event ? 'SINGLE_EVENT' : $scope.currentEvent.event;\r\n        var flags = {debug: true, verbose: false};\r\n        TrackerRulesExecutionService.loadAndExecuteRulesScope($scope.currentEvent,$scope.selectedProgram.id,$scope.selectedProgramStage.id,$scope.prStDes,null,$scope.optionSets,$scope.selectedOrgUnit.id,flags);\r\n    };\r\n       \r\n    \r\n    $scope.formatNumberResult = function(val){        \r\n        return dhis2.validation.isNumber(val) ? new Number(val) : '';\r\n    };\r\n    \r\n    $scope.toTwoDecimals = function(val){        \r\n        //Round data to two decimals if it is a number:\r\n        if(dhis2.validation.isNumber(val)){\r\n            val = Math.round(val*100)/100;\r\n        }\r\n        \r\n        return val;\r\n    };\r\n    \r\n    //check if field is hidden\r\n    $scope.isHidden = function(id) {\r\n        //In case the field contains a value, we cant hide it. \r\n        //If we hid a field with a value, it would falsely seem the user was aware that the value was entered in the UI.\r\n        if($scope.currentEvent[id]) {\r\n           return false; \r\n        }\r\n        else {\r\n            return $scope.hiddenFields[id];\r\n        }\r\n    };\r\n    \r\n    $scope.saveDatavalue = function(){\r\n        $scope.executeRules();\r\n    };\r\n\r\n    $scope.saveDatavalueRadio = function(prStDe, event, value){\r\n        var id = prStDe.dataElement ? prStDe.dataElement.id : prStDe.id;\r\n        event[id] = value;\r\n        $scope.executeRules();\r\n    };\r\n\r\n   $scope.saveCurrentEventStatus = function(status) {\r\n       $scope.currentEvent.status = status;\r\n   };\r\n    \r\n    $scope.getInputNotifcationClass = function(id, custom){\r\n        if($scope.currentElement.id && $scope.currentElement.id === id){\r\n            if($scope.currentElement.pending){\r\n                if(custom){\r\n                    return 'input-pending';\r\n                }\r\n                return 'form-control input-pending';\r\n            }\r\n            if($scope.currentElement.updated){\r\n                if(custom){\r\n                    return 'input-success';\r\n                }\r\n                return 'form-control input-success';\r\n            }          \r\n            if($scope.currentElement.failed){\r\n                if(custom){\r\n                    return 'input-error';\r\n                }\r\n                return 'form-control input-error';\r\n            }            \r\n        }  \r\n        if(custom){\r\n            return '';\r\n        }\r\n        return 'form-control';\r\n    };\r\n    \r\n    $scope.getClickFunction = function(dhis2Event, column){\r\n        \r\n        if(column.id === 'comment'){\r\n            return \"showNotes(\" + dhis2Event + \")\"; \r\n        }\r\n        else{\r\n            if(dhis2Event.event ===$scope.currentEvent.event){\r\n                return '';\r\n            }\r\n            else{\r\n                return \"showEventList(\" + dhis2Event + \")\"; \r\n            }\r\n        }        \r\n        return '';        \r\n    };\r\n    \r\n    $scope.downloadFile = function(eventUid, dataElementUid, e) {\r\n        eventUid = eventUid ? eventUid : $scope.currentEvent.event ? $scope.currentEvent.event : null;        \r\n        if( !eventUid || !dataElementUid){\r\n            \r\n            var dialogOptions = {\r\n                headerText: 'error',\r\n                bodyText: 'missing_file_identifier'\r\n            };\r\n\r\n            DialogService.showDialog({}, dialogOptions);\r\n            return;\r\n        }\r\n        \r\n        $window.open(DHIS2URL + '/events/files?eventUid=' + eventUid +'&dataElementUid=' + dataElementUid, '_blank', '');\r\n        if(e){\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n        }\r\n    };\r\n    \r\n    $scope.deleteFile = function(dataElement){\r\n        \r\n        if( !dataElement ){            \r\n            var dialogOptions = {\r\n                headerText: 'error',\r\n                bodyText: 'missing_file_identifier'\r\n            };\r\n            DialogService.showDialog({}, dialogOptions);\r\n            return;\r\n        }\r\n        \r\n        var modalOptions = {\r\n            closeButtonText: 'cancel',\r\n            actionButtonText: 'remove',\r\n            headerText: 'remove',\r\n            bodyText: 'are_you_sure_to_remove'\r\n        };\r\n\r\n        ModalService.showModal({}, modalOptions).then(function(result){\r\n            delete $scope.fileNames[$scope.currentEvent.event][dataElement];\r\n            $scope.currentEvent[dataElement] = null;\r\n            $scope.updateEventDataValue(dataElement);\r\n        });\r\n    };\r\n    \r\n    $scope.updateFileNames = function(){        \r\n        for(var dataElement in $scope.currentFileNames){\r\n            if($scope.currentFileNames[dataElement]){\r\n                if(!$scope.fileNames[$scope.currentEvent.event]){\r\n                    $scope.fileNames[$scope.currentEvent.event] = {};\r\n                }                 \r\n                $scope.fileNames[$scope.currentEvent.event][dataElement] = $scope.currentFileNames[dataElement];\r\n            }\r\n        }\r\n    };\r\n    \r\n    $scope.filterTextExist = function(){        \r\n        return angular.equals($scope.filterText, $scope.emptyFilterText);\r\n    };\r\n})\r\n\r\neventCapture.controller('NotesController', function($scope, $modalInstance, dhis2Event){\r\n\r\n    $scope.dhis2Event = dhis2Event;\r\n\r\n    $scope.close = function () {\r\n        $modalInstance.close();\r\n    };\r\n});\n\n\n// WEBPACK FOOTER //\n// ./scripts/controllers.js","(function(window, document) {\n\n// Create all modules and define dependencies to make sure they exist\n// and are loaded in the correct order to satisfy dependency injection\n// before all nested files are concatenated by Grunt\n\n// Config\nangular.module('ngCsv.config', []).\n  value('ngCsv.config', {\n      debug: true\n  }).\n  config(['$compileProvider', function($compileProvider){\n    if (angular.isDefined($compileProvider.urlSanitizationWhitelist)) {\n      $compileProvider.urlSanitizationWhitelist(/^\\s*(https?|ftp|mailto|file|data):/);\n    } else {\n      $compileProvider.aHrefSanitizationWhitelist(/^\\s*(https?|ftp|mailto|file|data):/);\n    }\n  }]);\n\n// Modules\nangular.module('ngCsv.directives', ['ngCsv.services']);\nangular.module('ngCsv.services', []);\nangular.module('ngCsv',\n    [\n        'ngCsv.config',\n        'ngCsv.services',\n        'ngCsv.directives',\n        'ngSanitize'\n    ]);\n\n// Common.js package manager support (e.g. ComponentJS, WebPack)\nif (typeof module !== 'undefined' && typeof exports !== 'undefined' && module.exports === exports) {\n  module.exports = 'ngCsv';\n}\n/**\n * Created by asafdav on 15/05/14.\n */\nangular.module('ngCsv.services').\n  service('CSV', ['$q', function ($q) {\n\n    var EOL = '\\r\\n';\n    var BOM = \"\\ufeff\";\n\n    var specialChars = {\n      '\\\\t': '\\t',\n      '\\\\b': '\\b',\n      '\\\\v': '\\v',\n      '\\\\f': '\\f',\n      '\\\\r': '\\r'\n    };\n\n    /**\n     * Stringify one field\n     * @param data\n     * @param options\n     * @returns {*}\n     */\n    this.stringifyField = function (data, options) {\n      if (options.decimalSep === 'locale' && this.isFloat(data)) {\n        return data.toLocaleString();\n      }\n\n      if (options.decimalSep !== '.' && this.isFloat(data)) {\n        return data.toString().replace('.', options.decimalSep);\n      }\n\n      if (typeof data === 'string') {\n        data = data.replace(/\"/g, '\"\"'); // Escape double qoutes\n\n        if (options.quoteStrings || data.indexOf(',') > -1 || data.indexOf('\\n') > -1 || data.indexOf('\\r') > -1) {\n            data = options.txtDelim + data + options.txtDelim;\n        }\n\n        return data;\n      }\n\n      if (typeof data === 'boolean') {\n        return data ? 'TRUE' : 'FALSE';\n      }\n\n      return data;\n    };\n\n    /**\n     * Helper function to check if input is float\n     * @param input\n     * @returns {boolean}\n     */\n    this.isFloat = function (input) {\n      return +input === input && (!isFinite(input) || Boolean(input % 1));\n    };\n\n    /**\n     * Creates a csv from a data array\n     * @param data\n     * @param options\n     *  * header - Provide the first row (optional)\n     *  * fieldSep - Field separator, default: ',',\n     *  * addByteOrderMarker - Add Byte order mark, default(false)\n     * @param callback\n     */\n    this.stringify = function (data, options) {\n      var def = $q.defer();\n\n      var that = this;\n      var csv = \"\";\n      var csvContent = \"\";\n\n      var dataPromise = $q.when(data).then(function (responseData) {\n        //responseData = angular.copy(responseData);//moved to row creation\n        // Check if there's a provided header array\n        if (angular.isDefined(options.header) && options.header) {\n          var encodingArray, headerString;\n\n          encodingArray = [];\n          angular.forEach(options.header, function (title, key) {\n            this.push(that.stringifyField(title, options));\n          }, encodingArray);\n\n          headerString = encodingArray.join(options.fieldSep ? options.fieldSep : \",\");\n          csvContent += headerString + EOL;\n        }\n\n        var arrData = [];\n\n        if (angular.isArray(responseData)) {\n          arrData = responseData;\n        }\n        else if (angular.isFunction(responseData)) {\n          arrData = responseData();\n        }\n\n        // Check if using keys as labels\n        if (angular.isDefined(options.label) && options.label && typeof options.label === 'boolean') {\n            var labelArray, labelString;\n\n            labelArray = [];\n            angular.forEach(arrData[0], function(value, label) {\n                this.push(that.stringifyField(label, options));\n            }, labelArray);\n            labelString = labelArray.join(options.fieldSep ? options.fieldSep : \",\");\n            csvContent += labelString + EOL;\n        }\n\n        angular.forEach(arrData, function (oldRow, index) {\n          var row = angular.copy(arrData[index]);\n          var dataString, infoArray;\n\n          infoArray = [];\n\n          var iterator = !!options.columnOrder ? options.columnOrder : row;\n          angular.forEach(iterator, function (field, key) {\n            var val = !!options.columnOrder ? row[field] : field;\n            this.push(that.stringifyField(val, options));\n          }, infoArray);\n\n          dataString = infoArray.join(options.fieldSep ? options.fieldSep : \",\");\n          csvContent += index < arrData.length ? dataString + EOL : dataString;\n        });\n\n        // Add BOM if needed\n        if (options.addByteOrderMarker) {\n          csv += BOM;\n        }\n\n        // Append the content and resolve.\n        csv += csvContent;\n        def.resolve(csv);\n      });\n\n      if (typeof dataPromise['catch'] === 'function') {\n        dataPromise['catch'](function (err) {\n          def.reject(err);\n        });\n      }\n\n      return def.promise;\n    };\n\n    /**\n     * Helper function to check if input is really a special character\n     * @param input\n     * @returns {boolean}\n     */\n    this.isSpecialChar = function(input){\n      return specialChars[input] !== undefined;\n    };\n\n    /**\n     * Helper function to get what the special character was supposed to be\n     * since Angular escapes the first backslash\n     * @param input\n     * @returns {special character string}\n     */\n    this.getSpecialChar = function (input) {\n      return specialChars[input];\n    };\n\n\n  }]);\n/**\n * ng-csv module\n * Export Javascript's arrays to csv files from the browser\n *\n * Author: asafdav - https://github.com/asafdav\n */\nangular.module('ngCsv.directives').\n  directive('ngCsv', ['$parse', '$q', 'CSV', '$document', '$timeout', function ($parse, $q, CSV, $document, $timeout) {\n    return {\n      restrict: 'AC',\n      scope: {\n        data: '&ngCsv',\n        filename: '@filename',\n        header: '&csvHeader',\n        columnOrder: '&csvColumnOrder',\n        txtDelim: '@textDelimiter',\n        decimalSep: '@decimalSeparator',\n        quoteStrings: '@quoteStrings',\n        fieldSep: '@fieldSeparator',\n        lazyLoad: '@lazyLoad',\n        addByteOrderMarker: \"@addBom\",\n        ngClick: '&',\n        charset: '@charset',\n        label: '&csvLabel'\n      },\n      controller: [\n        '$scope',\n        '$element',\n        '$attrs',\n        '$transclude',\n        function ($scope, $element, $attrs, $transclude) {\n          $scope.csv = '';\n\n          if (!angular.isDefined($scope.lazyLoad) || $scope.lazyLoad != \"true\") {\n            if (angular.isArray($scope.data)) {\n              $scope.$watch(\"data\", function (newValue) {\n                $scope.buildCSV();\n              }, true);\n            }\n          }\n\n          $scope.getFilename = function () {\n            return $scope.filename || 'download.csv';\n          };\n\n          function getBuildCsvOptions() {\n            var options = {\n              txtDelim: $scope.txtDelim ? $scope.txtDelim : '\"',\n              decimalSep: $scope.decimalSep ? $scope.decimalSep : '.',\n              quoteStrings: $scope.quoteStrings,\n              addByteOrderMarker: $scope.addByteOrderMarker\n            };\n            if (angular.isDefined($attrs.csvHeader)) options.header = $scope.$eval($scope.header);\n            if (angular.isDefined($attrs.csvColumnOrder)) options.columnOrder = $scope.$eval($scope.columnOrder);\n            if (angular.isDefined($attrs.csvLabel)) options.label = $scope.$eval($scope.label);\n\n            options.fieldSep = $scope.fieldSep ? $scope.fieldSep : \",\";\n\n            // Replaces any badly formatted special character string with correct special character\n            options.fieldSep = CSV.isSpecialChar(options.fieldSep) ? CSV.getSpecialChar(options.fieldSep) : options.fieldSep;\n\n            return options;\n          }\n\n          /**\n           * Creates the CSV and updates the scope\n           * @returns {*}\n           */\n          $scope.buildCSV = function () {\n            var deferred = $q.defer();\n\n            $element.addClass($attrs.ngCsvLoadingClass || 'ng-csv-loading');\n\n            CSV.stringify($scope.data(), getBuildCsvOptions()).then(function (csv) {\n              $scope.csv = csv;\n              $element.removeClass($attrs.ngCsvLoadingClass || 'ng-csv-loading');\n              deferred.resolve(csv);\n            });\n            $scope.$apply(); // Old angular support\n\n            return deferred.promise;\n          };\n        }\n      ],\n      link: function (scope, element, attrs) {\n        function doClick() {\n          var charset = scope.charset || \"utf-8\";\n          var blob = new Blob([scope.csv], {\n            type: \"text/csv;charset=\"+ charset + \";\"\n          });\n\n          if (window.navigator.msSaveOrOpenBlob) {\n            navigator.msSaveBlob(blob, scope.getFilename());\n          } else {\n\n            var downloadContainer = angular.element('<div data-tap-disabled=\"true\"><a></a></div>');\n            var downloadLink = angular.element(downloadContainer.children()[0]);\n            downloadLink.attr('href', window.URL.createObjectURL(blob));\n            downloadLink.attr('download', scope.getFilename());\n            downloadLink.attr('target', '_blank');\n\n            $document.find('body').append(downloadContainer);\n            $timeout(function () {\n              downloadLink[0].click();\n              downloadLink.remove();\n            }, null);\n          }\n        }\n\n        element.bind('click', function (e) {\n          scope.buildCSV().then(function (csv) {\n            doClick();\n          });\n          scope.$apply();\n        });\n      }\n    };\n  }]);\n})(window, document);\n\n\n// WEBPACK FOOTER //\n// ./scripts/ng-csv.js"],"sourceRoot":""}