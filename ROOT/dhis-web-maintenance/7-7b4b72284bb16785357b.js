webpackJsonp([7],{1351:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e){m.a.saveOrganisationUnitLevels().subscribe(function(){return O.a.show({message:e.getTranslation("organisation_unit_levels_save_success")})},function(){return O.a.show({message:e.getTranslation("organisation_unit_levels_save_failed"),action:"ok"})})}function s(e,t){var n=t.d2.currentUser.canUpdate(t.d2.models.organisationUnitLevel);if(e.isLoading)return c.a.createElement(v.a,null);var a={paperWrap:{padding:"4rem 5rem",maxWidth:700,marginTop:"2rem"},rowStyle:{display:"flex",flexDirection:"row",height:"5rem"},formWrapStyle:{flex:1,display:"flex",flexDirection:"row"},fieldWrapStyle:{flex:1,paddingRight:"1rem"},translateButtonWrap:{alignItems:"flex-end",display:"flex",flex:"5rem",height:"5rem",verticalAlign:"middle"}},r=e.fieldsForOrganisationUnitLevel.map(function(t,r){var i=null;return t.organisationUnitLevel.id&&n&&(i=c.a.createElement("div",{style:a.translateButtonWrap},c.a.createElement(y.a,{iconClassName:"material-icons",onClick:function(){return e.onTranslateClick(t.organisationUnitLevel)}},"translate"))),c.a.createElement("div",{key:r,style:a.rowStyle},c.a.createElement(g.a,{style:a.formWrapStyle,fieldWrapStyle:a.fieldWrapStyle,fields:t.map(function(e){return U({},e,{props:U({},e.props,{disabled:!n})})}),onUpdateField:function(e,n){m.a.fieldUpdate({organisationUnitLevel:t.organisationUnitLevel,fieldName:e,fieldValue:n})},onUpdateFormStatus:function(e){return m.a.updateFormStatus({levelIndex:r,formStatus:e})}}),i)});return c.a.createElement("div",null,c.a.createElement(_.a,null,t.d2.i18n.getTranslation("organisation_unit_level_management")),c.a.createElement(b.a,{style:a.paperWrap},r,c.a.createElement(L.a,null,n?c.a.createElement(S.a,{onClick:function(){return o(t.d2.i18n)},isValid:e.formStatus.every(function(e){return e}),isSaving:e.isSaving}):[])))}Object.defineProperty(t,"__esModule",{value:!0});var l=n(0),c=n.n(l),u=n(33),p=n(1456),f=n(201),d=n(102),v=n.n(d),g=n(203),m=n(1529),h=n(85),y=n.n(h),T=n(55),b=n.n(T),S=n(1356),L=n(1371),O=n(67),_=n(150),E=n(1360),P=(n(1394),function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}()),U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e};s.defaultProps={fieldsForOrganisationUnitLevel:[],formStatus:[!1],isLoading:!0,isSaving:!1},s.propTypes={fieldsForOrganisationUnitLevel:l.PropTypes.array,formStatus:l.PropTypes.array,isLoading:l.PropTypes.bool,isSaving:l.PropTypes.bool};var j=p.a,w=n.i(f.a)(j,n.i(u.a)(s));t.default=n.i(u.a)(function(e){function t(){var e;a(this,t);for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];var s=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i)));return s.state={translation:{open:!1}},s._onTranslateClick=s._onTranslateClick.bind(s),s._closeTranslationDialog=s._closeTranslationDialog.bind(s),s._translationSaved=s._translationSaved.bind(s),s._translationErrored=s._translationErrored.bind(s),s}return i(t,e),P(t,[{key:"componentDidMount",value:function(){m.a.initOrgUnitLevels()}},{key:"render",value:function(){return c.a.createElement("div",null,c.a.createElement(w,{onTranslateClick:this._onTranslateClick}),this.state.translation.model?c.a.createElement(E.a,{objectToTranslate:this.state.translation.model,objectTypeToTranslate:this.state.translation.model&&this.state.translation.model.modelDefinition,open:this.state.translation.open,onTranslationSaved:this._translationSaved,onTranslationError:this._translationErrored,onRequestClose:this._closeTranslationDialog,fieldsToTranslate:["name"]}):null)}},{key:"_onTranslateClick",value:function(e){var t=this.context.d2.models.organisationUnitLevel.create(e);this.setState({translation:{open:!0,model:t}})}},{key:"_translationSaved",value:function(){O.a.show({message:this.context.d2.i18n.getTranslation("translation_saved")})}},{key:"_translationErrored",value:function(){O.a.show({message:this.context.d2.i18n.getTranslation("translation_save_error"),action:"ok"})}},{key:"_closeTranslationDialog",value:function(){this.setState({translation:{open:!1,model:void 0}})}}]),t}(c.a.Component))},1356:function(e,t,n){"use strict";function a(e,t){var n={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}function r(e,t){var n=t.d2,r=e.isValid,i=e.isSaving,s=e.onClick,c=a(e,["isValid","isSaving","onClick"]),p=i?n.i18n.getTranslation("saving"):n.i18n.getTranslation("save");return o.a.createElement(l.a,u({},c,{primary:!0,onClick:s,label:p,disabled:i||!r}))}var i=n(0),o=n.n(i),s=n(116),l=n.n(s),c=n(33),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e};r.propTypes={isSaving:o.a.PropTypes.bool,isValid:o.a.PropTypes.bool,onClick:o.a.PropTypes.func.isRequired},t.a=n.i(c.a)(r)},1359:function(e,t,n){"use strict";var a=n(0),r=n.n(a),i=n(118),o=n.n(i),s=n(84),l=n.n(s),c=n(100),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e};t.a=r.a.createClass({displayName:"LocaleSelector.component",propTypes:{value:r.a.PropTypes.string,locales:r.a.PropTypes.arrayOf(r.a.PropTypes.shape({name:r.a.PropTypes.string.isRequired,locale:r.a.PropTypes.string.isRequired})).isRequired,onChange:r.a.PropTypes.func.isRequired},mixins:[c.a],render:function(){var e=[{payload:"",text:""}].concat(this.props.locales).map(function(e,t){return r.a.createElement(l.a,{key:t,primaryText:e.name,value:e.locale})});return r.a.createElement(o.a,u({fullWidth:!0},this.props,{value:this.state&&this.state.locale,hintText:this.getTranslation("select_locale"),onChange:this._localeChange}),e)},_localeChange:function(e,t,n){this.setState({locale:n}),this.props.onChange(n,e)}})},1360:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=n(13),s=(n.n(o),n(292)),l=n.n(s),c=n(0),u=n.n(c),p=n(1361),f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();o.config.i18n.strings.add("close"),o.config.i18n.strings.add("sharing_settings");var v=function(e){function t(e,i){a(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return o.i18n=i.d2.i18n,o.state={TranslationForm:n.i(p.a)(o.props.objectToTranslate)},o.translationSaved=o.translationSaved.bind(o),o.translationError=o.translationError.bind(o),o.closeSharingDialog=o.closeSharingDialog.bind(o),o}return i(t,e),d(t,[{key:"render",value:function(){return u.a.createElement(l.a,f({title:this.i18n.getTranslation("translation_dialog_title"),autoDetectWindowHeight:!0,autoScrollBodyContent:!0},this.props),u.a.createElement(this.state.TranslationForm,{onTranslationSaved:this.translationSaved,onTranslationError:this.translationError,onCancel:this.closeSharingDialog,fieldsToTranslate:this.props.fieldsToTranslate}))}},{key:"componentWillReceiveProps",value:function(e){e.objectToTranslate&&this.setState({TranslationForm:n.i(p.a)(e.objectToTranslate)})}},{key:"closeSharingDialog",value:function(){this.props.onRequestClose()}},{key:"translationSaved",value:function(){this.props.onTranslationSaved(),this.closeSharingDialog()}},{key:"translationError",value:function(){this.props.onTranslationError()}}]),t}(c.Component);t.a=v,v.propTypes={objectToTranslate:u.a.PropTypes.shape({id:u.a.PropTypes.string.isRequired}).isRequired,onTranslationSaved:u.a.PropTypes.func.isRequired,onTranslationError:u.a.PropTypes.func.isRequired,open:u.a.PropTypes.bool,onRequestClose:u.a.PropTypes.func.isRequired,fieldsToTranslate:u.a.PropTypes.array},v.contextTypes={d2:c.PropTypes.object}},1361:function(e,t,n){"use strict";function a(e){var t=y.a.create();return n.i(p.a)(e).subscribe(function(e){t.setState(e)}),h.Observable.combineLatest(n.i(p.b)(),t,function(){for(var n=arguments.length,a=Array(n),r=0;r<n;r++)a[r]=arguments[r];return Object.assign.apply(Object,[{objectToTranslate:e,setTranslations:function(e){t.setState({translations:e})}}].concat(a))})}function r(e){return n.i(v.a)(a(e),b)}t.a=r;var i=n(0),o=n.n(i),s=n(45),l=n.n(s),c=n(100),u=n(1359),p=n(1362),f=n(82),d=n.n(f),v=n(201),g=n(116),m=n.n(g),h=n(14),y=(n.n(h),n(23)),T=n(83),b=o.a.createClass({displayName:"TranslationForm",propTypes:{onTranslationSaved:o.a.PropTypes.func.isRequired,onTranslationError:o.a.PropTypes.func.isRequired,objectToTranslate:o.a.PropTypes.shape({id:o.a.PropTypes.string.isRequired}),fieldsToTranslate:o.a.PropTypes.arrayOf(o.a.PropTypes.string)},mixins:[c.a],getInitialState:function(){return{loading:!0,translations:{},translationValues:{},currentSelectedLocale:""}},getDefaultProps:function(){return{fieldsToTranslate:["name","shortName","description"]}},getLoadingdataElement:function(){return o.a.createElement("div",{style:{textAlign:"center"}},o.a.createElement(T.a,{mode:"indeterminate"}))},renderFieldsToTranslate:function(){var e=this;return this.props.fieldsToTranslate.filter(function(e){return e}).map(function(t){return o.a.createElement("div",{key:t},o.a.createElement(l.a,{floatingLabelText:e.getTranslation(d()(t)),value:e.getTranslationValueFor(t),fullWidth:!0,onChange:e._setValue.bind(e,t)}),o.a.createElement("div",null,e.props.objectToTranslate[t]))})},renderForm:function(){return o.a.createElement("div",null,this.renderFieldsToTranslate(),o.a.createElement(m.a,{label:this.getTranslation("save"),primary:!0,onClick:this._saveTranslations}),o.a.createElement(m.a,{style:{marginLeft:"1rem"},label:this.getTranslation("cancel"),onClick:this.props.onCancel}))},renderHelpText:function(){return o.a.createElement("div",null,o.a.createElement("p",null,this.getTranslation("select_a_locale_to_enter_translations_for_that_language")))},render:function(){return this.props.locales||this.props.translations?o.a.createElement("div",{style:{minHeight:250}},o.a.createElement(u.a,{locales:this.props.locales,onChange:this.setCurrentLocale}),Boolean(this.state.currentSelectedLocale)?this.renderForm():this.renderHelpText()):this.getLoadingdataElement()},getTranslationValueFor:function(e){var t=this,n=this.props.translations.find(function(n){return n.locale===t.state.currentSelectedLocale&&n.property.toLowerCase()===d()(e)});if(n)return n.value},setCurrentLocale:function(e){this.setState({currentSelectedLocale:e})},_setValue:function(e,t){var n=this,a=[].concat(this.props.translations),r=a.find(function(t){return t.locale===n.state.currentSelectedLocale&&t.property.toLowerCase()===d()(e)});r?t.target.value?r.value=t.target.value:a=a.filter(function(e){return e!==r}):(r={property:d()(e).toUpperCase(),locale:this.state.currentSelectedLocale,value:t.target.value},a.push(r)),this.props.setTranslations(a)},_saveTranslations:function(){n.i(p.c)(this.props.objectToTranslate,this.props.translations).subscribe(this.props.onTranslationSaved,this.props.onTranslationError)}})},1362:function(e,t,n){"use strict";function a(){return a.localePromise||(a.localePromise=n.i(s.getInstance)().then(function(e){return e.Api.getApi().get("locales/db")}).then(function(e){return{locales:e}})),l.Observable.fromPromise(a.localePromise)}function r(e){return e.href?e.href:e.modelDefinition.apiEndpoint+"/"+e.id}function i(e){return l.Observable.of(e).flatMap(function(e){var t=e.modelDefinition;return t||t.name?n.i(s.getInstance)().then(function(t){return t.Api.getApi().get(r(e)+"/translations")}):Promise.reject(new Error("Can not find modelDefinition for "+e.id))})}t.b=a,t.a=i,n.d(t,"c",function(){return u});var o=n(37),s=n(13),l=(n.n(s),n(14)),c=(n.n(l),function(){function e(e,t){var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{!a&&s.return&&s.return()}finally{if(r)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()),u=o.a.create("saveTranslations");u.subscribe(function(e){var t=c(e.data,2),a=t[0],i=t[1],o=e.complete,l=e.error,u=r(a)+"/translations";n.i(s.getInstance)().then(function(e){e.Api.getApi().update(u,{translations:i},{dataType:"text"}).then(o).catch(l)})})},1371:function(e,t,n){"use strict";function a(e){var t={marginTop:"1rem"},n={marginRight:"1rem",width:"10rem"},a=s()(e.children)?e.children:[e.children];return i.a.createElement("div",{style:Object.assign(t,e.style)},a.map(function(e,t){return i.a.cloneElement(e,{style:n,key:t})}))}t.a=a;var r=n(0),i=n.n(r),o=n(86),s=n.n(o);a.propTypes={style:i.a.PropTypes.object,children:i.a.PropTypes.oneOfType([i.a.PropTypes.array,i.a.PropTypes.object]).isRequired,isFormValid:i.a.PropTypes.func}},1394:function(e,t,n){"use strict";function a(){return i.a.createElement("div",null,i.a.createElement(o.a,null,"Access denied!"),i.a.createElement("p",null,"Unfortunately you do not have access to this functionality."))}t.a=a;var r=n(0),i=n.n(r),o=n(150)},1456:function(e,t,n){"use strict";var a=n(23);t.a=a.a.create()},1529:function(e,t,n){"use strict";function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(r,i){try{var o=t[r](i),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){a("next",e)},function(e){a("throw",e)});e(s)}return a("next")})}}function r(e,t){var n={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}function i(e){var t=e.options,n=r(e,["options"]),a=[{value:void 0,text:"Default",label:" "}].concat(t.map(function(e){return{value:e,text:e,label:e}})).map(function(e,t){return p.a.createElement(S.a,{key:t,primaryText:e.text,value:e.value,label:e.label})});return p.a.createElement(T.a,E({},n,{onChange:function(t,n,a){return e.onChange({target:{value:a}})}}),a)}function o(e){return g.a.state.fieldsForOrganisationUnitLevel.map(function(t){return t.filter(function(e){return"name"===e.name}).some(function(t){return t.value===e})}).every(function(e){return!1===e})}function s(e,t){return e.map(function(e){var n=t.map(function(t){return Object.assign({},t,{value:e[t.name]})});return n.organisationUnitLevel=e,n})}function l(e){var t=e.data;return g.a.getState().formStatus.map(function(e,n){return n===t.levelIndex?t.formStatus.valid:e})}function c(e){var t=e.organisationUnitLevels,a=e.complete,r=e.error;return n.i(v.getInstance)().then(function(e){return e.Api.getApi()}).then(function(e){return e.post("filledOrganisationUnitLevels",{organisationUnitLevels:t},{dataType:"text"})}).then(function(){return a}).catch(function(){return r})}var u=n(0),p=n.n(u),f=n(37),d=n(14),v=(n.n(d),n(13)),g=(n.n(v),n(1456)),m=n(45),h=n.n(m),y=n(118),T=n.n(y),b=n(84),S=n.n(b),L=n(295),O=n(82),_=n.n(O),E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},P=function(){var e=a(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.i(v.getInstance)();case 2:return t=e.sent,a=t.Api.getApi(),e.next=6,a.get("filledOrganisationUnitLevels");case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),U=function(){var e=a(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.i(v.getInstance)();case 2:return t=e.sent,e.abrupt("return",j.map(function(e){var n=x.get(e)||{};return{name:e,component:n.component||h.a,props:Object.assign({floatingLabelText:t.i18n.getTranslation(_()(e))},n.props),validators:[{validator:o,message:t.i18n.getTranslation("value_not_unique")}]}}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),j=L.a.for("organisationUnitLevel"),w=f.a.createActionsFromNames(["initOrgUnitLevels","fieldUpdate","updateFormStatus","saveOrganisationUnitLevels"]);i.propTypes={options:u.PropTypes.array};var x=new Map([["name",{component:h.a}],["offlineLevels",{component:i,props:{options:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]}}]]),C=d.Observable.fromPromise(U());w.updateFormStatus.map(l).subscribe(function(e){g.a.setState(Object.assign({},g.a.getState(),{formStatus:e}))}),w.initOrgUnitLevels.flatMap(function(){return d.Observable.combineLatest(d.Observable.fromPromise(P()),C,function(e,t){return{organisationUnitLevels:e,organisationUnitLevelFormFields:t}})}).map(function(e){var t=e.organisationUnitLevels;return{fieldConfigsForAllLevels:s(t,e.organisationUnitLevelFormFields),organisationUnitLevels:t}}).subscribe(function(e){var t=e.fieldConfigsForAllLevels,n=e.organisationUnitLevels;g.a.setState({isSaving:!1,isLoading:!1,fieldsForOrganisationUnitLevel:t,formStatus:t.map(function(){return!0}),organisationUnitLevels:n})});var k=new d.ReplaySubject(1);w.fieldUpdate.subscribe(function(e){return k.next(e)}),d.Observable.combineLatest(k,C,function(e,t){return{action:e,organisationUnitLevelFormFields:t}}).map(function(e){var t=e.action,n=e.organisationUnitLevelFormFields;return E({},t.data,{storeState:g.a.getState(),organisationUnitLevelFormFields:n})}).subscribe(function(e){var t=e.storeState,n=void 0===t?{organisationUnitLevels:[]}:t,a=e.fieldName,r=e.fieldValue,i=e.organisationUnitLevel,o=e.organisationUnitLevelFormFields,l=n.organisationUnitLevels.find(function(e){return e===i});l&&a&&(l[a]=r),g.a.setState(Object.assign({},n,{organisationUnitLevels:n.organisationUnitLevels,fieldsForOrganisationUnitLevel:s(n.organisationUnitLevels,o)}))}),w.saveOrganisationUnitLevels.map(function(e){return E({organisationUnitLevels:g.a.getState().organisationUnitLevels.map(function(e){return{name:e.name,level:e.level,offlineLevels:e.offlineLevels}})},e)}).do(function(){g.a.setState(E({},g.a.getState(),{isSaving:!0}))}).flatMap(function(e){return d.Observable.fromPromise(c(e))}).subscribe(function(e){e.call(),w.initOrgUnitLevels()}),t.a=w}});
//# sourceMappingURL=7-7b4b72284bb16785357b.js.map